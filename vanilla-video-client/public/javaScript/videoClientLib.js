/*! For license information please see videoClientLib-full.js.LICENSE.txt */
var VideoClient;(()=>{var e={6010:(e,t,r)=>{"use strict";e.exports=r(1568)},2834:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.Feature=void 0,(r=t.Feature||(t.Feature={}))[r.APPLY_CONSTRAINTS=0]="APPLY_CONSTRAINTS",r[r.AUDIO_CONTEXT=1]="AUDIO_CONTEXT",r[r.CPU_USAGE=2]="CPU_USAGE",r[r.CREATE_CANVAS_ELEMENT=3]="CREATE_CANVAS_ELEMENT",r[r.CREATE_VIDEO_ELEMENT=4]="CREATE_VIDEO_ELEMENT",r[r.CREATE_AUDIO_ELEMENT=5]="CREATE_AUDIO_ELEMENT",r[r.CREATE_SCREENSHOT=6]="CREATE_SCREENSHOT",r[r.DOCUMENT=7]="DOCUMENT",r[r.BROWSER_TYPE=8]="BROWSER_TYPE",r[r.DEBUGGING=9]="DEBUGGING",r[r.HLSJS=10]="HLSJS",r[r.LOCAL_STORAGE=11]="LOCAL_STORAGE",r[r.MATCH_MEDIA=12]="MATCH_MEDIA",r[r.MEDIA_DEVICE=13]="MEDIA_DEVICE",r[r.MEDIA_RECORDER=14]="MEDIA_RECORDER",r[r.MEDIA_SOURCE=15]="MEDIA_SOURCE",r[r.MEDIA_STREAM=16]="MEDIA_STREAM",r[r.NETWORK_INFORMATION=17]="NETWORK_INFORMATION",r[r.URL_LOCATION=18]="URL_LOCATION",r[r.SCREEN_ORIENTATION=19]="SCREEN_ORIENTATION",r[r.WEB_SOCKET=20]="WEB_SOCKET",r[r.WEB_SOCKET_CLIENT=21]="WEB_SOCKET_CLIENT",r[r.PERMISSIONS=22]="PERMISSIONS",r[r.MPEGTS=23]="MPEGTS",r[r.URL_SEARCHPARAMS=24]="URL_SEARCHPARAMS",r[r.USER_ACTIVATION=25]="USER_ACTIVATION",r[r.WEBRTC=26]="WEBRTC"},9330:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},1149:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isPointerEvent=t.isKeyboardEvent=t.userActivationEvents=void 0,t.userActivationEvents=["touchend","mousedown","pointerup","pointerdown","keydown"],t.isKeyboardEvent=e=>void 0!==e.keyCode,t.isPointerEvent=e=>void 0!==e.pointerType},4280:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isSafari=t.isMobileDevice=t.isIosDevice=t.isAndroidDevice=t.implement=t.onceDeviceReady=t.device=t.Feature=void 0;const i=r(7582),n=r(398),s=r(2834);var a=r(2834);let o;Object.defineProperty(t,"Feature",{enumerable:!0,get:function(){return a.Feature}}),i.__exportStar(r(9330),t),t.device=new n.WebDevice,t.onceDeviceReady=new Promise((e=>{o=e})),t.implement=function(e){t.device=e,o(t.device)},t.isAndroidDevice=function(){return t.device.isAndroidDevice},t.isIosDevice=function(){return t.device.isIosDevice},t.isMobileDevice=function(){return t.device.isMobileDevice},t.isSafari=function(){return t.device.isImplements(s.Feature.BROWSER_TYPE)&&"safari"===t.device.browserInfo.name}},2323:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},813:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.isVideoClientError=t.ErrorCode=void 0,function(e){e.H264NotSupported="h264-not-supported",e.NoBackendEndpoints="no-backend-endpoints",e.NoPlayersAvailable="no-players-available",e.NoUserId="no-userId",e.UnableJoinCall="unable-join-call",e.UnableChangeBitrate="unable-change-bitrate",e.UnableSwitchQuality="unable-switch-quality",e.MediaStreamNotSupported="media-stream-not-supported",e.MediaDeviceNotSupported="media-device-not-supported",e.ConsumerNotCreated="consumer-not-created",e.NetworkError="network-error",e.ManifestNotLoaded="manifest-not-loaded",e.PlayerLoadingFailed="player-loading-failed",e.BadManifest="bad-manifest",e.MediaDeviceNotAvailable="media-device-not-available",e.MediaControllerNotInitialized="media-controller-not-initialized",e.MediaDeviceChangingFailed="media-device-changing-failed",e.MediaStreamPreparingConflict="media-stream-preparing-conflict",e.MediaTrackEnded="media-track-ended",e.ApplyingConstraintsFailed="constraints-not-applied",e.NativeError="native-error",e.PlayerSourceNotSupported="player-source-not-supported",e.UpdateResolutionsFailed="update-resolutions-failed",e.DisposingError="disposing-error",e.AssertionError="assertion-error",e.StreamNameAlreadyExists="stream-name-already-exists",e.StreamNotFound="stream-not-found",e.BroadcastVideoFailed="broadcast-video-failed",e.BroadcastAudioFailed="broadcast-video-failed",e.SFUBusy="sfu-busy",e.BadInput="bad-input",e.CallError="call-error",e.CapturableStreamError="capturable-stream-error",e.Constraints="constraints",e.ConsumerNotFound="consumer-not-foud",e.DeviceNotFound="device-not-found",e.DisableAudioError="disable-audio-error",e.DisableVideoError="disable-video-error",e.DisposedObject="disposed-object",e.DriverNotSupported="driver-not-supported",e.ElementRequired="element-required",e.EmbedSWFFailed="embedding-flash-swf-failed",e.EnableAudioError="enable-audio-error",e.EnableVideoError="enable-video-error",e.EnumeratingDevices="enumerating-devices-error",e.GetUserMediaFailed="get-user-media-failed",e.HandleHlsJsError="handle-hlsjs-error",e.HlsjsNotLoaded="hlsjs-not-loaded",e.InternalCallError="internal-call-error",e.InternalError="internal-error",e.InvalidBitrate="invalid-bitrate",e.InvalidControls="invalid-controls-parent",e.InvalidElement="invalid-element",e.InvalidMediaURL="invalid-media-url",e.InvalidPopoutURL="invalid-popout-url",e.JoinCallError="join-call-error",e.JoinCallRejected="join-call-rejected",e.LayerNotFound="layer-not-found",e.ManifestError="manifest-error",e.ManifestForbidden="manifest-forbidden",e.ManifestInternalError="manifest-internal-error",e.ManifestNotFound="manifest-not-found",e.ManifestUnauthorized="manifest-unauthorized",e.ManifestUnexpectedResponse="manifest-unexpected-response",e.MediaError="media-error",e.MediaRecorderError="media-recorder-error",e.MediasoupSetupError="mediasoup-setup-error",e.MeowDriverError="meow-driver-error",e.Mp4BufferError="mp4-buffer-error",e.NoDrivers="no-valid-drivers",e.NotInitialized="not-initialized",e.NotSupported="not-supported",e.Permission="permission-error",e.PlaybackError="playback-error",e.PlayingIssue="playing-issue",e.RetrievingMediaStreamError="retrieving-media-stream-error",e.SFUConsumerClosedEvent="sfu-consumer-closed-event",e.SFUConsumerLayersChangedEvent="sfu-consumer-layers-changed-event",e.SFUConsumerPausedEvent="sfu-consumer-paused-event",e.SFUConsumerResumedEvent="sfu-consumer-resumed-event",e.SFUConsumerScoreEvent="sfu-consumer-score-event",e.SFUConsumerSourcesEvent="sfu-consumer-sources-event",e.SFUNewConsumerEvent="sfu-new-consumer-event",e.SFUNewPeersEvent="sfu-new-peers-event",e.SFUPeerClosedEvent="sfu-peer-closed-event",e.SFUProducerClosedEvent="sfu-producer-closed-event",e.SFUProducerPausedEvent="sfu-producer-paused-event",e.SFUProducerResumedEvent="sfu-producer-resumed-event",e.SFUSwitchConsumerTrackEvent="sfu-switch-consumer-track-event",e.SimulcastDisabled="simulcast-disabled",e.StartBroadcastError="start-broadcast-error",e.StreamExists="stream-exists",e.TrackEnded="track-ended",e.TransportStateError="transport-state-error",e.UnknownDriver="unknown-driver",e.UnknownError="unknown-error",e.UnrecognizedDriver="unrecognized-driver",e.UpdateBroadcastError="start-broadcast-error",e.UpdateMSCError="update-msc-error",e.UserRequired="user-required",e.ValidationError="validation-error",e.WSNetworkError="websocket-network-error",e.WSRequestError="ws-request-error"}(r=t.ErrorCode||(t.ErrorCode={})),t.isVideoClientError=function(e){return e&&e.code&&Object.values(r).includes(e.code)}},167:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlayerFeature=t.ExistsStreamPolicy=t.isWebrtcFormat=t.isValidFormat=t.isManifest=t.isGenericFormat=t.ErrorCode=t.AdapterFeature=void 0;const i=r(7582);var n=r(2834);Object.defineProperty(t,"AdapterFeature",{enumerable:!0,get:function(){return n.Feature}}),i.__exportStar(r(9330),t),i.__exportStar(r(2323),t);var s=r(813);Object.defineProperty(t,"ErrorCode",{enumerable:!0,get:function(){return s.ErrorCode}});var a=r(6639);Object.defineProperty(t,"isGenericFormat",{enumerable:!0,get:function(){return a.isGenericFormat}}),Object.defineProperty(t,"isManifest",{enumerable:!0,get:function(){return a.isManifest}}),Object.defineProperty(t,"isValidFormat",{enumerable:!0,get:function(){return a.isValidFormat}}),Object.defineProperty(t,"isWebrtcFormat",{enumerable:!0,get:function(){return a.isWebrtcFormat}});var o=r(3999);Object.defineProperty(t,"ExistsStreamPolicy",{enumerable:!0,get:function(){return o.ExistsStreamPolicy}});var c=r(5445);Object.defineProperty(t,"PlayerFeature",{enumerable:!0,get:function(){return c.Feature}}),i.__exportStar(r(3968),t)},6639:(e,t)=>{"use strict";function r(e){const t=e;return"object"==typeof t&&"object"==typeof t.origin&&"string"==typeof t.origin.callId}function i(e){const t=e;return"object"==typeof t&&(Array.isArray(t.encodings)||null!=t.substitute)}Object.defineProperty(t,"__esModule",{value:!0}),t.isValidFormat=t.isGenericFormat=t.isWebrtcFormat=t.isManifestObject=t.isManifest=void 0,t.isManifest=function(e){return null!=e&&("string"==typeof e?e.startsWith("http://")||e.startsWith("https://")||e.startsWith("://"):"object"==typeof e&&"formats"in(null!=e?e:{}))},t.isManifestObject=function(e){return null!=e&&"object"==typeof e&&"formats"in(null!=e?e:{})},t.isWebrtcFormat=r,t.isGenericFormat=i,t.isValidFormat=function(e){return r(e)||i(e)}},3999:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.ExistsStreamPolicy=void 0,(r=t.ExistsStreamPolicy||(t.ExistsStreamPolicy={}))[r.stale=0]="stale",r[r.wait=1]="wait",r[r.ignore=2]="ignore",r[r.error=3]="error"},8762:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.players=void 0;const i=r(6514),n=r(5087),s=r(6395),a=r(7245),o=r(8052),c=r(4845);t.players={"native-hls":o.NativeHlsPlayer,hlsjs:n.HlsJsPlayer,webrtc:c.WebrtcPlayer,mediasoup:s.MediasoupPlayer,mp4ws:a.Mp4WsPlayer,flvhttp:i.FlvHttpPlayer}},2113:(e,t)=>{"use strict";var r,i;Object.defineProperty(t,"__esModule",{value:!0}),t.AutoQualityLevel=t.SourceScoreLevel=t.TranscodeScoreLevel=void 0,(i=t.TranscodeScoreLevel||(t.TranscodeScoreLevel={})).Lowest="transcode:lowest",i.Low="transcode:low",i.MediumLow="transcode:medium-low",i.Medium="transcode:medium",i.MediumHigh="transcode:medium-high",i.High="transcode:high",i.Highest="transcode:highest",(r=t.SourceScoreLevel||(t.SourceScoreLevel={})).Low="source:low",r.Medium="source:medium",r.High="source:high",(t.AutoQualityLevel||(t.AutoQualityLevel={})).Auto="auto-quality"},5445:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.Feature=void 0,(r=t.Feature||(t.Feature={}))[r.DURATION=0]="DURATION",r[r.CONSUMER=1]="CONSUMER",r[r.MUTED_AUTOPLAY=2]="MUTED_AUTOPLAY",r[r.BITRATE_SWITCHING=3]="BITRATE_SWITCHING",r[r.PLAYER_SELECTOR=4]="PLAYER_SELECTOR",r[r.BROADCAST=5]="BROADCAST"},3968:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AutoQualityLevel=t.TranscodeScoreLevel=t.SourceScoreLevel=void 0;var i=r(2113);Object.defineProperty(t,"SourceScoreLevel",{enumerable:!0,get:function(){return i.SourceScoreLevel}}),Object.defineProperty(t,"TranscodeScoreLevel",{enumerable:!0,get:function(){return i.TranscodeScoreLevel}}),Object.defineProperty(t,"AutoQualityLevel",{enumerable:!0,get:function(){return i.AutoQualityLevel}})},9864:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Feature=void 0;const i=r(7582);var n=r(5445);Object.defineProperty(t,"Feature",{enumerable:!0,get:function(){return n.Feature}}),i.__exportStar(r(3968),t)},8329:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isOverconstrainedError=t.isErrorLike=void 0,t.isErrorLike=function(e){return null!=e&&"object"==typeof e&&void 0!==e.message&&void 0!==e.name},t.isOverconstrainedError=function(e){return void 0!==e.constraint&&void 0!==e.name&&void 0!==e.message}},4508:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.isVideoElement=t.MediaErrorCodeConstants=t.isMediaStream=void 0,t.isMediaStream=function(e){return"object"==typeof e&&null!=e&&"getAudioTracks"in e&&"getVideoTracks"in e},(r=t.MediaErrorCodeConstants||(t.MediaErrorCodeConstants={}))[r.UNKNOWN=0]="UNKNOWN",r[r.MEDIA_ERR_ABORTED=1]="MEDIA_ERR_ABORTED",r[r.MEDIA_ERR_NETWORK=2]="MEDIA_ERR_NETWORK",r[r.MEDIA_ERR_DECODE=3]="MEDIA_ERR_DECODE",r[r.MEDIA_ERR_SRC_NOT_SUPPORTED=4]="MEDIA_ERR_SRC_NOT_SUPPORTED",r[r.MEDIA_ERR_ENCRYPTED=5]="MEDIA_ERR_ENCRYPTED",t.isVideoElement=function(e){return void 0!==(null==e?void 0:e.src)}},1568:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isSafari=t.isMobileDevice=t.isIosDevice=t.isAndroidDevice=t.MediaElementSupervisor=t.AutoQualityLevel=t.SourceScoreLevel=t.TranscodeScoreLevel=t.ObservableEventEmitter=t.InstanceCollector=t.makeBounded=t.timeupdateWrapper=t.UserInteraction=t.applyUserInteractionHook=t.instanceId=t.contextId=t.RecorderCore=t.utils=t.CONSTRAINTS_SCREENCAPTURE_OPTIMAL_WEAK=t.CONSTRAINTS_VIDEO_OPTIMAL_WEAK=t.CONSTRAINTS_VIDEO_OPTIMAL_STRICT=t.CONSTRAINTS_AUDIO_OPTIMAL_WEAK=t.CONSTRAINTS_AUDIO_OPTIMAL_STRICT=t.errors=t.player=t.types=t.mediaController=t.VideoClient=t.adapter=void 0;const i=r(7582),n=r(8949);t.adapter=i.__importStar(r(4280));const s=r(7170),a=r(59),o=r(2122);t.VideoClient=o.VideoClient,t.mediaController=s.mediaController,t.types=i.__importStar(r(167)),t.player=i.__importStar(r(9864)),t.errors=i.__importStar(r(3199));var c=r(7170);Object.defineProperty(t,"CONSTRAINTS_AUDIO_OPTIMAL_STRICT",{enumerable:!0,get:function(){return c.CONSTRAINTS_AUDIO_OPTIMAL_STRICT}}),Object.defineProperty(t,"CONSTRAINTS_AUDIO_OPTIMAL_WEAK",{enumerable:!0,get:function(){return c.CONSTRAINTS_AUDIO_OPTIMAL_WEAK}}),Object.defineProperty(t,"CONSTRAINTS_VIDEO_OPTIMAL_STRICT",{enumerable:!0,get:function(){return c.CONSTRAINTS_VIDEO_OPTIMAL_STRICT}}),Object.defineProperty(t,"CONSTRAINTS_VIDEO_OPTIMAL_WEAK",{enumerable:!0,get:function(){return c.CONSTRAINTS_VIDEO_OPTIMAL_WEAK}}),Object.defineProperty(t,"CONSTRAINTS_SCREENCAPTURE_OPTIMAL_WEAK",{enumerable:!0,get:function(){return c.CONSTRAINTS_SCREENCAPTURE_OPTIMAL_WEAK}}),t.utils=i.__importStar(r(5423));var l=r(3013);Object.defineProperty(t,"RecorderCore",{enumerable:!0,get:function(){return l.Recorder}});var d=r(2914);Object.defineProperty(t,"contextId",{enumerable:!0,get:function(){return d.contextId}}),Object.defineProperty(t,"instanceId",{enumerable:!0,get:function(){return d.instanceId}}),Object.defineProperty(t,"applyUserInteractionHook",{enumerable:!0,get:function(){return d.applyUserInteractionHook}});var u=r(7029);Object.defineProperty(t,"UserInteraction",{enumerable:!0,get:function(){return u.UserInteraction}});var h=r(2835);Object.defineProperty(t,"timeupdateWrapper",{enumerable:!0,get:function(){return h.timeupdateWrapper}});var p=r(3757);Object.defineProperty(t,"makeBounded",{enumerable:!0,get:function(){return p.makeBounded}});var f=r(6107);Object.defineProperty(t,"InstanceCollector",{enumerable:!0,get:function(){return f.InstanceCollector}});var m=r(327);Object.defineProperty(t,"ObservableEventEmitter",{enumerable:!0,get:function(){return m.ObservableEventEmitter}});var g=r(2113);Object.defineProperty(t,"TranscodeScoreLevel",{enumerable:!0,get:function(){return g.TranscodeScoreLevel}}),Object.defineProperty(t,"SourceScoreLevel",{enumerable:!0,get:function(){return g.SourceScoreLevel}}),Object.defineProperty(t,"AutoQualityLevel",{enumerable:!0,get:function(){return g.AutoQualityLevel}});var v=r(7671);Object.defineProperty(t,"MediaElementSupervisor",{enumerable:!0,get:function(){return v.MediaElementSupervisor}});var _=r(4280);Object.defineProperty(t,"isAndroidDevice",{enumerable:!0,get:function(){return _.isAndroidDevice}}),Object.defineProperty(t,"isIosDevice",{enumerable:!0,get:function(){return _.isIosDevice}}),Object.defineProperty(t,"isMobileDevice",{enumerable:!0,get:function(){return _.isMobileDevice}}),Object.defineProperty(t,"isSafari",{enumerable:!0,get:function(){return _.isSafari}}),(0,n.configure)({observableRequiresReaction:!1,reactionRequiresObservable:!1,enforceActions:"never"}),(0,a.startMobxDebugging)()},398:(e,t,r)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.WebDevice=void 0;const n=r(7582),s=r(7881),a=n.__importDefault(r(1206)),o=r(2834),c=r(7029),l=null!==(i=globalThis)&&void 0!==i?i:function(){return this}();l.Hls=r(7631);try{l.mpegts=r(2527)}catch(e){}class d extends Error{constructor(e,t){super(`${e} is not supported. ${t||""}`)}}class u{constructor(){var e,t;this.hadUserInteraction=!1,this.canvasElement=null,this.setTimeout=setTimeout.bind(l),this.clearTimeout=clearTimeout.bind(l),this.clearInterval=clearInterval.bind(l);const r=null===(t=null===(e=null==l?void 0:l.navigator)||void 0===e?void 0:e.storage)||void 0===t?void 0:t.estimate;"function"==typeof r&&(this.storageEstimate=r.bind(l.navigator.storage)),this.logger=new s.LoggerCore("VDC-core").setLoggerMeta("client","VDC").appendChain(u),l||this.logger.error("globalScope is undefined"),(null==l?void 0:l.navigator)||this.logger.info("globalScope navigator is undefined"),"object"!=typeof l.__VDC_VARS__&&(l.__VDC_VARS__=new Map),this.globals=l.__VDC_VARS__,this.isImplements(o.Feature.CREATE_CANVAS_ELEMENT)&&(this.canvasElement=this.createCanvasElement()),this.browser=this.parseBrowserInfo()}applyUserInteractionHook(){const e=new c.UserInteraction({silentAudio:{playSilentAudio:!0,infiniteLoop:!1}});l.document.addEventListener("beforeunload",e.dispose)}processRtpCapabilities(e,t){return t}parseBrowserInfo(){const e=a.default.getParser(this.userAgent);return{name:null==e?void 0:e.getBrowserName(!0),version:null==e?void 0:e.getBrowserVersion(),osname:null==e?void 0:e.getOSName(!0)}}get browserInfo(){return this.browser}get isIosDevice(){var e;let t=!1;if(null!=this.platform){if("MacIntel"===this.platform&&(null===(e=null==l?void 0:l.navigator)||void 0===e?void 0:e.maxTouchPoints)>1)return!0;t=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(this.platform)}return t}get isAndroidDevice(){let e=!1;return null!=this.userAgent&&(e=/Android/.test(this.userAgent)),e}get isMobileDevice(){var e;let t=!1;return((null===(e=null==l?void 0:l.navigator)||void 0===e?void 0:e.maxTouchPoints)>1||null!=this.userAgent&&/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(this.userAgent))&&(t=!0),t}get isSafari(){return this.isImplements(o.Feature.BROWSER_TYPE)&&"safari"===this.browserInfo.name}get hidden(){var e;return null!==(e=l.document.hidden)&&void 0!==e&&e}get appVersion(){var e,t;return null!==(t=null===(e=null==l?void 0:l.navigator)||void 0===e?void 0:e.appVersion)&&void 0!==t?t:null}get platform(){var e,t;return null!==(t=null===(e=null==l?void 0:l.navigator)||void 0===e?void 0:e.platform)&&void 0!==t?t:null}get supportFullscreen(){const e=l.document.createElement("video"),t=l.document;return!0===l.document.fullscreenEnabled||!0===t.mozFullScreenEnabled||!0===t.msFullscreenEnabled||!0===t.webkitSupportsFullscreen||!0===t.webkitFullscreenEnabled||null!=e.webkitRequestFullScreen||null!=e.webkitEnterFullScreen}get onLine(){var e,t;return null===(t=null===(e=null==l?void 0:l.navigator)||void 0===e?void 0:e.onLine)||void 0===t||t}get location(){return(null==l?void 0:l.location)||null}get userAgent(){var e,t;return null!==(t=null===(e=null==l?void 0:l.navigator)||void 0===e?void 0:e.userAgent)&&void 0!==t?t:"<unknown ua>"}get permissions(){var e;return null===(e=null==l?void 0:l.navigator)||void 0===e?void 0:e.permissions}get userActivation(){var e;return(null===(e=null==l?void 0:l.navigator)||void 0===e?void 0:e.userActivation)||null}addEventListener(e,t){null!=l.addEventListener&&l.addEventListener(e,t)}removeEventListener(e,t){null!=l.removeEventListener&&l.removeEventListener(e,t)}setInterval(e,t){return l.setInterval(e,t)}get console(){return l.console}fetch(e,t){return l.fetch(e,t)}get URLSearchParams(){return l.URLSearchParams}get AudioContext(){var e;return null!==(e=l.AudioContext)&&void 0!==e?e:l.webkitAudioContext}get MediaRecorder(){return l.MediaRecorder}get MediaStream(){return l.MediaStream}get WebSocketClient(){return l.WebSocketClient}get RTCRtpReceiver(){return l.RTCRtpReceiver}get RTCRtpSender(){return l.RTCRtpSender}get Uint8Array(){return l.Uint8Array}matchMedia(e){return null==l?void 0:l.matchMedia(e)}get mediaDevices(){var e;return null===(e=null==l?void 0:l.navigator)||void 0===e?void 0:e.mediaDevices}get connection(){var e,t,r,i,n;return null!==(i=null!==(t=null===(e=null==l?void 0:l.navigator)||void 0===e?void 0:e.connection)&&void 0!==t?t:null===(r=null==l?void 0:l.navigator)||void 0===r?void 0:r.mozConnection)&&void 0!==i?i:null===(n=null==l?void 0:l.navigator)||void 0===n?void 0:n.webkitConnection}get localStorage(){return l.localStorage}get performance(){return l.performance}get screenOrientation(){var e,t,r;const i=l.screen;return null!==(r=null!==(t=(null!==(e=i.orientation)&&void 0!==e?e:{}).type)&&void 0!==t?t:i.mozOrientation)&&void 0!==r?r:i.msOrientation}get MediaSource(){return l.MediaSource||l.WebKitMediaSource}get WebSocket(){return l.WebSocket}get SourceBuffer(){return l.SourceBuffer||l.WebKitSourceBuffer}get Hls(){return l.Hls}applyConstraints(e,t){return e.applyConstraints(t)}createVideoElement(){const e=l.document.createElement("video");e.autoplay=!0,e.setAttribute("webkit-playsinline","true"),e.setAttribute("playsinline","true");const t=l.document.createTextNode("Sorry, your browser doesn't support embedded videos.");return e.appendChild(t),e}createAudioElement(){return l.document.createElement("audio")}createCanvasElement(){return l.document.createElement("canvas")}createScreenshot(e){const t=this.canvasElement;return null==t?"":(t.width=e.videoWidth,t.height=e.videoHeight,t.getContext("2d").drawImage(e,0,0,t.width,t.height),t.toDataURL())}supportsMediaStreamCapture(e){return null==e?void 0:e.captureStream}createVideoStub(){throw new Error("not implemented")}disableCpuStats(){}enableCpuStats(){}averageCpuUsage(e){return 0}isCodecSupported(e){return!1}isHlsLoaded(){try{return null!=this.Hls}catch(e){return!1}}loadHlsScript(e){if(null!=this.hlsPromise)return this.hlsPromise;if(this.isHlsLoaded())return Promise.resolve();const t=null!=e?e:"https://cdnjs.cloudflare.com/ajax/libs/hls.js/1.4.5/hls.min.js";return this.hlsPromise=new Promise(((e,r)=>{if(this.isHlsLoaded())return void e();const i=l.document.createElement("script");i.setAttribute("src",null!=t?t:""),i.onload=()=>{this.isHlsLoaded()?e():r(new Error("hlsjs not loaded"))},i.onerror=e=>{r(new Error(`hlsjs not loaded: ${e}`))},l.document.body.appendChild(i)})),this.hlsPromise}get mpegts(){return l.mpegts}isMpegtsLoaded(){try{return null!=this.mpegts}catch(e){return!1}}loadMpegtsScript(e){if(null!=this.mpegtsPromise)return this.mpegtsPromise;if(this.isMpegtsLoaded())return Promise.resolve();const t=null!=e?e:"https://cdn-us.threadsafesystems.com/mpegts.min.js";return this.mpegtsPromise=new Promise(((e,r)=>{if(this.isMpegtsLoaded())return void e();const i=l.document.createElement("script");i.setAttribute("src",null!=t?t:""),i.onload=()=>{this.isMpegtsLoaded()?e():r(new Error("mpegts not loaded"))},i.onerror=e=>{r(new Error(`mpegts not loaded: ${e}`))},l.document.body.appendChild(i)})),this.mpegtsPromise}showSaveFilePicker(e){return null==l?void 0:l.showSaveFilePicker(e)}confirmMessage(e){null==l||l.confirm(e)}get document(){return l.document}get isFirefox(){return"firefox"===this.browserInfo.name}isImplements(e){var t,r;try{switch(e){case o.Feature.NETWORK_INFORMATION:return null!=this.location;case o.Feature.CREATE_VIDEO_ELEMENT:return null!=l.document&&null!=this.createVideoElement;case o.Feature.CREATE_AUDIO_ELEMENT:return null!=l.document&&null!=this.createAudioElement;case o.Feature.CREATE_CANVAS_ELEMENT:return null!=l.document&&null!=this.createCanvasElement;case o.Feature.CREATE_SCREENSHOT:return null!=(null===(t=this.canvasElement)||void 0===t?void 0:t.getContext);case o.Feature.DEBUGGING:return null!=this.console&&null!=this.performance;case o.Feature.DOCUMENT:return null!=this.document;case o.Feature.SCREEN_ORIENTATION:return null!=this.screenOrientation;case o.Feature.MEDIA_RECORDER:return null!=this.MediaRecorder;case o.Feature.APPLY_CONSTRAINTS:return!0;case o.Feature.MEDIA_DEVICE:return null!=this.mediaDevices;case o.Feature.MATCH_MEDIA:return null!=this.matchMedia;case o.Feature.MEDIA_STREAM:return null!=this.MediaStream;case o.Feature.MEDIA_SOURCE:return null!=this.MediaSource&&null!=this.SourceBuffer;case o.Feature.WEB_SOCKET:case o.Feature.WEB_SOCKET_CLIENT:return null!=this.WebSocket;case o.Feature.LOCAL_STORAGE:try{return null!=this.localStorage}catch(e){return!1}case o.Feature.AUDIO_CONTEXT:return null!=this.AudioContext;case o.Feature.URL_LOCATION:return null!=this.location;case o.Feature.URL_SEARCHPARAMS:return null!=this.URLSearchParams;case o.Feature.CPU_USAGE:return!1;case o.Feature.HLSJS:return!0;case o.Feature.PERMISSIONS:return null!=this.permissions;case o.Feature.USER_ACTIVATION:return null!=this.userActivation;case o.Feature.WEBRTC:return null!=(null===(r=this.RTCRtpReceiver)||void 0===r?void 0:r.getCapabilities)&&null!=this.RTCRtpSender;case o.Feature.MPEGTS:return!0;case o.Feature.BROWSER_TYPE:return""!==this.browserInfo.name&&""!==this.browserInfo.version&&""!==this.browserInfo.osname;default:return!1}}catch(e){if(e instanceof d)return!1;throw e}}}t.WebDevice=u,u.displayName="WebDevice"},1857:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Broadcast=void 0;const i=r(7582),n=r(4702),s=r(960),a=r(8949),o=r(5580),c=r(644),l=r(327);class d extends l.ObservableEventEmitter{constructor(e,t,r,i,n){var s;super(),this.state="active",this.lastTrafficTS=0,this.lastTrafficBitrate=[],(0,a.makeObservable)(this,{state:a.observable});const l=null==r?void 0:r.streams[n.streamName];if(null==r||null==l)throw new o.StreamNotFoundError("stream not found",{call:t,broadcast:this});this.ctx=e,this.ctrl=i,this.call=t,this.pvcCall=r,this.stream=l,this.options=n,this.options.simulcast&&(this.options.videoProducerOptions=null!==(s=this.options.videoProducerOptions)&&void 0!==s?s:{},this.options.videoProducerOptions.simulcast=this.options.simulcast),this.call.isOwner&&(this.lastTrafficTS=Date.now()),i.on("audioDeviceChanged",this.onAudioDeviceChanged),i.on("videoDeviceChanged",this.onVideoDeviceChanged),i.on("audioMuted",this.onAudioMuted),i.on("videoPaused",this.onVideoPaused),e.logger.attachObject(this),e.logger.trace("constructor()"),this.sourceUpdate().catch((e=>{this.emitErrorDeprecated(new o.UpdateBroadcastError("initial source update error",{broadcast:this,call:this.call,inner:(0,o.wrapNativeError)(e)}))})),(0,c.onceCanceled)(e).then((e=>this.dispose(`Broadcast Class Context Cancelled: ${e}`))),this.addInnerDisposer((()=>{try{this.stop()}catch(e){this.ctx.logger.warn("unable to stop broadcast while disposing",{err:`${e}`})}this.options.disposeController&&this.ctrl.dispose("Broadcast options are set to disposeController")}))}get streamName(){return this.options.streamName}get audioMuted(){return this.ctrl.audioMuted}set audioMuted(e){this.ctrl.audioMuted=e}get videoHidden(){return this.ctrl.videoPaused}set videoHidden(e){this.ctrl.videoPaused=e}pause(){null!=this.ctrl.audioDeviceId&&this.stream.pauseAudio(),null!=this.ctrl.videoDeviceId&&this.stream.pauseVideo(),this.state="paused"}get controller(){return this.ctrl}replaceController(e){this.ctrl=e}resume(){null!=this.ctrl.audioDeviceId&&this.stream.enableAudio(this.options.audioProducerOptions).then((()=>{this.state="active"})).catch((e=>{this.emitErrorDeprecated(new o.UpdateBroadcastError("unable to resume audio device",{broadcast:this,call:this.call,inner:(0,o.wrapNativeError)(e)}))})),null!=this.ctrl.videoDeviceId&&this.stream.enableVideo(this.options.videoProducerOptions).then((()=>{this.state="active"})).catch((e=>{this.emitErrorDeprecated(new o.UpdateBroadcastError("unable to resume video device",{broadcast:this,call:this.call,inner:(0,o.wrapNativeError)(e)}))}))}stop(){this.ctx.logger.debug("stop()"),this.state="closed",this.stream.close(),this.ctrl.off("source",this.sourceUpdate),this.ctrl.off("audioDeviceChanged",this.onAudioDeviceChanged),this.ctrl.off("videoDeviceChanged",this.onVideoDeviceChanged),this.ctrl.off("audioMuted",this.onAudioMuted),this.ctrl.off("videoPaused",this.onVideoPaused),this.pvcCall.removeStream(this.stream.streamName)}sourceUpdate(){var e,t;return i.__awaiter(this,void 0,void 0,(function*(){if(this.ctx.logger.debug("sourceUpdate()",{audio:this.ctrl.audioDeviceId,video:this.ctrl.videoDeviceId}),null==this.ctrl.videoDeviceId||this.ctrl.videoPaused||this.options.audioOnly||this.ctrl.videoDisabled)this.options.audioOnly&&this.ctx.logger.debug("Broadcast is set to audioOnly, video not produced",{options:this.options});else{const r=this.pvcCall._closed||(null===(e=this.pvcCall.peer)||void 0===e?void 0:e._closed);try{yield this.pvcCall.enableVideo(this.stream.streamName,!0,!1,this.options.videoProducerOptions)}catch(e){const i=this.pvcCall._closed||(null===(t=this.pvcCall.peer)||void 0===t?void 0:t._closed);if(!r&&i)return;this.emitErrorDeprecated(new o.EnableVideoError("unable to enable video on `source` event",{inner:(0,o.wrapNativeError)(e),broadcast:this,call:this.call}))}}if(null==this.ctrl.audioDeviceId||this.ctrl.audioMuted||this.options.videoOnly)this.options.videoOnly&&this.ctx.logger.debug("Broadcast is set to videoOnly, audio not produced",{options:this.options});else try{yield this.pvcCall.enableAudio(this.stream.streamName,!0,!1,this.options.audioProducerOptions)}catch(e){this.emitErrorDeprecated(new o.EnableAudioError("unable to enable audio on `source` event",{inner:(0,o.wrapNativeError)(e),broadcast:this,call:this.call}))}}))}onAudioDeviceChanged(e){return i.__awaiter(this,void 0,void 0,(function*(){if(this.ctx.logger.debug("audioDeviceChanged()",{device:e}),null==e)try{yield this.pvcCall.disableAudio(this.stream.streamName)}catch(e){if(e instanceof s.types.InvalidStateError&&"track ended"===e.message)return void this.ctx.logger.warn("broadcast has not been updated because the audio track is ended");const t=e instanceof Error?e:null;this.emitErrorDeprecated(new o.DisableAudioError("unable to disable audio on `audioDeviceChanged` event",{inner:t,broadcast:this,call:this.call}))}else try{yield this.pvcCall.enableAudio(this.stream.streamName,!0,!1,this.options.audioProducerOptions)}catch(e){if(e instanceof s.types.InvalidStateError&&"track ended"===e.message)return void this.ctx.logger.warn("broadcast has not been updated because the audio track is ended");const t=e instanceof Error?e:null;this.emitErrorDeprecated(new o.EnableAudioError("unable to enable audio on `audioDeviceChanged` event",{inner:t,broadcast:this,call:this.call}))}}))}onVideoDeviceChanged(e){return i.__awaiter(this,void 0,void 0,(function*(){if(this.ctx.logger.debug("videoDeviceChanged()",{device:e}),null==e)try{yield this.pvcCall.disableVideo(this.stream.streamName)}catch(e){if(e instanceof s.types.InvalidStateError&&"track ended"===e.message)return void this.ctx.logger.warn("broadcast has not been updated because the video track is ended");const t=e instanceof Error?e:null;this.emitErrorDeprecated(new o.DisableVideoError("unable to disable video on `videoDeviceChanged` event",{inner:t,broadcast:this,call:this.call}))}else try{yield this.pvcCall.enableVideo(this.stream.streamName,!0,!1,this.options.videoProducerOptions)}catch(e){if(e instanceof s.types.InvalidStateError&&"track ended"===e.message)return void this.ctx.logger.warn("broadcast has not been updated because the video track is ended");this.emitErrorDeprecated(new o.EnableVideoError("unable to enable video on `videoDeviceChanged` event",{inner:(0,o.wrapNativeError)(e),broadcast:this,call:this.call}))}}))}onAudioMuted(e){return i.__awaiter(this,void 0,void 0,(function*(){if(this.ctx.logger.debug("audioMuted()",{value:e}),this.ctrl.hasActiveAudioTrack())if(e)try{yield this.pvcCall.muteAudio(this.stream.streamName)}catch(e){this.emitErrorDeprecated(new o.EnableAudioError("unable to mute audio on `audioMuted` event",{inner:(0,o.wrapNativeError)(e),broadcast:this,call:this.call}))}else try{yield this.pvcCall.unmuteAudio(this.stream.streamName,this.options.audioProducerOptions)}catch(e){this.emitErrorDeprecated(new o.DisableAudioError("unable to unmute audio on `audioMuted` event",{inner:(0,o.wrapNativeError)(e),broadcast:this,call:this.call}))}}))}onVideoPaused(e){return i.__awaiter(this,void 0,void 0,(function*(){if(this.ctx.logger.debug("videoPaused()",{value:e}),this.ctrl.hasActiveVideoTrack())if(e)try{yield this.pvcCall.pauseVideo(this.stream.streamName)}catch(e){const t=e instanceof Error?e:null;this.emitErrorDeprecated(new o.DisableVideoError("unable to pause video on `videoPaused` event",{inner:t,broadcast:this,call:this.call}))}else try{yield this.pvcCall.unpauseVideo(this.stream.streamName,this.options.videoProducerOptions)}catch(e){const t=e instanceof Error?e:null;this.emitErrorDeprecated(new o.EnableVideoError("unable to unpause video on `videoPaused` event",{inner:t,broadcast:this,call:this.call}))}}))}hotswapProducer(e,t){return i.__awaiter(this,void 0,void 0,(function*(){this.ctx.logger.debug("hotswapProducer()",{kind:e,producerOptions:t}),yield this.pvcCall.hotswapProducer(e,this.streamName,t)}))}toJSON(){return{msc:this.controller,stream:this.stream,options:this.options,aggregates:Object.assign(Object.assign({},(0,n.extractAggregates)(this.stream,"support")),{support:this.ctx.support.hash,state:this.state})}}}t.Broadcast=d,d.displayName="Broadcast"},1536:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Call=void 0;const i=r(7582),n=r(4866),s=r(8949),a=r(167),o=r(1857),c=r(3199),l=r(5580),d=r(6214),u=i.__importDefault(r(4962)),h=r(3757),p=r(644),f=r(327),m=r(2149),g=r(791),v=i.__importDefault(r(711)),_=r(8705),y=i.__importDefault(r(816)),b="v2",E=new g.EventsHandler;class S extends f.ObservableEventEmitter{constructor(e,t,r,i){super(!1),this.state="active",this.failover=[],this.failoverCallUrls=[],this.region=null,this.auth=void 0,this.pvcCall=null,this.connectedPeers=[],this.joinUrl=null,this.failoverJoinUrls=[],this.broadcasts=new Map,this.isOwner=!1,(0,s.makeObservable)(this,{broadcasts:s.observable}),this.ctx=e,(0,p.onceCanceled)(e).then((e=>this.dispose(`VideoClient Context Cancelled: ${e}`)));const n=(0,h.makeBounded)(new Proxy(this,E));return n.init(t,r,i),e.logger.attachObject(n),e.logger.trace("constructor()"),n}init(e,t,r){var n,s,o,l,d,u;if(this.isOwner=e,this.options=t,0===(null!==(s=null===(n=t.backendEndpoints)||void 0===n?void 0:n.length)&&void 0!==s?s:0)&&null==this.options.sfu.joinUrl&&this.throwError((0,c.createError)(a.ErrorCode.NoBackendEndpoints,"backendEndpoints or joinUrl are required",{})),this.joinUrl=null!==(o=this.options.sfu.joinUrl)&&void 0!==o?o:null,null!=t.backendEndpoints){const[e,...r]=t.backendEndpoints;this.backendEndpoint=e,this.failover=r,this.callUrl=`${e}/lb/calls`,this.failoverCallUrls=r.map((e=>`${e}/lb/calls`)),null==this.joinUrl&&(this.joinUrl=`${this.backendEndpoint}/lb/${b}/calls/${this.options.callId}/join`,this.failoverJoinUrls=this.failover.map((e=>`${e}/lb/${b}/calls/${this.options.callId}/join`)))}"string"==typeof t.token?this.token=t.token:this.tokenRefresher=t.token,null!=t.callId&&this.emit("callId",{callId:t.callId,user:null!==(d=null===(l=this.pvcCall)||void 0===l?void 0:l.user)&&void 0!==d?d:null}),this.auth=new y.default({bootstrap:{token:this.token,refreshToken:this.tokenRefresher}});const{callId:h}=this.options,p=null!==(u=t.sfu)&&void 0!==u?u:{};this.readyPromise=(()=>i.__awaiter(this,void 0,void 0,(function*(){const e=yield(0,_.retry)(0,1e3,this.createInternalCall.bind(this,h,t,r,p),this.ctx.logger);this.pvcCall=e})))(),this.addInnerDisposer(this.close)}createInternalCall(e,t,r,n,s){var o,l;return i.__awaiter(this,void 0,void 0,(function*(){let i;if(null==e)null==this.callUrl&&this.throwError((0,c.createError)(a.ErrorCode.NoBackendEndpoints,"backendEndpoints or joinUrl are required",{})),i=yield this.createCallAndJoin(t,n);else{const a=null===(o=t.playerOptions)||void 0===o?void 0:o.retryCall;s>0&&a&&(null==r||delete r.call),i=yield this.joinCall(e,r,n)}return i.on("error",(e=>{this.emit("error",e)})),this.emit("callId",{callId:i.call.id,user:null!==(l=i.user)&&void 0!==l?l:null}),i.on("CALL_ADD_PEER",this.handleAddPeer),i.on("CALL_REMOVE_PEER",this.handleRemovePeer),i.on("CALL_SFU_CONNECTION",(()=>this.emit("sfuConnection"))),i.on("CALL_DOMINANT_SPEAKER",(e=>{this.emit("dominantSpeaker",e)})),this[g.addProxy](i),i.on("CALL_PRODUCER_KICKED",(()=>{this.emit("viewerKicked")})),i.on("CALL_PEER_AT_CAPACITY",(e=>{this.emit("peerAtCapacity",e)})),i.on("CALL_ACCESS_DENIED",(e=>{this.emit("accessDenied",e)})),i.on("CALL_CONNECTING",(e=>{this.emit("isConnecting",e)})),i.on("CALL_SET_CONNECTED",(({connected:e})=>{this.emit("isConnected",e)})),i.on("CALL_WEBSOCKET_RECONNECT",(()=>{this.emit("websocketReconnect")})),i.on("CALL_ENDED",(()=>{this.emit("callEnded")})),new Promise(((e,t)=>{i.start().catch((e=>{t((0,c.createError)(a.ErrorCode.UnableJoinCall,"Unable to start call",{},e)),i.dispose(`Join call error: ${String(e)}`)})),i.once("CALL_READY",(()=>{e(i)}))}))}))}get id(){var e,t,r;return null!==(r=null===(t=null===(e=this.pvcCall)||void 0===e?void 0:e.call)||void 0===t?void 0:t.id)&&void 0!==r?r:""}get peers(){return this.connectedPeers}handleAddPeer({peer:e}){var t,r,i,n,s,a;if(null==this.pvcCall)return void this.ctx.logger.warn("handleAddPeer() call is null",{aggregates:{peerId:null!==(t=e.peerId)&&void 0!==t?t:"",displayName:null!==(r=e.displayName)&&void 0!==r?r:"",scope:null!==(i=e.scope)&&void 0!==i?i:""}});if(this.connectedPeers.some((t=>t.peerId===e.id)))return void this.ctx.logger.debug("handleAddPeer() peer already exists",{aggregates:{peerId:null!==(n=e.peerId)&&void 0!==n?n:"",displayName:null!==(s=e.displayName)&&void 0!==s?s:"",scope:null!==(a=e.scope)&&void 0!==a?a:""}});const o=new d.Peer((0,m.extendContext)(this.ctx,d.Peer),this,this.pvcCall,e,this.options.playerOptions);this.connectedPeers.push(o),o.on("videoConsumer",(()=>{this.emit("videoConsumer")})),this[g.addProxy](o),this.ctx.logger.debug("handleAddPeer() peer added",o),this.emit("peerAdded",{call:this,peer:o})}handleRemovePeer({peerId:e}){const t=this.connectedPeers.findIndex((t=>t.peerId===e));if(-1!==t){const e=this.peers.splice(t,1)[0];e instanceof d.Peer&&(this.ctx.logger.debug("handleRemovePeer() peer removed",e),e.dispose("removing peer")),this.emit("peerRemoved",{call:this,peer:e})}}ready(){return i.__awaiter(this,void 0,void 0,(function*(){return yield this.readyPromise,this}))}createCall(e){var t;return i.__awaiter(this,void 0,void 0,(function*(){null==this.callUrl&&this.throwErrorDeprecated(new l.ValidationError("callUrl is null",{critical:!0}));const r={mode:"broadcast",region:null!==(t=this.region)&&void 0!==t?t:"",msVersion:[3]};Object.assign(r,e),this.ctx.logger.info("call creation",{callUrl:this.callUrl,auth:{token:this.token,hasRefreshToken:null!=this.tokenRefresher},body:r});const i=yield(0,v.default)(this.ctx,this.callUrl,{auth:this.auth,method:"post",body:JSON.stringify(r),failoverUrls:this.failoverCallUrls});return null!=i?i.body:(this.ctx.logger.error("response is null",Object.assign({callUrl:this.callUrl,auth:{token:this.token,hasRefreshToken:null!=this.tokenRefresher}},r)),null)}))}createCallAndJoin(e,t={}){var r,n;return i.__awaiter(this,void 0,void 0,(function*(){null!=(null===(r=this.options)||void 0===r?void 0:r.clientReferrer)&&(e.clientReferrer=this.options.clientReferrer);const i=yield this.createCall(e),s=null!==(n=null==i?void 0:i.id)&&void 0!==n?n:"";return(0,u.default)(this.ctx,s,`${this.backendEndpoint}/lb/${b}/calls/${s}/join`,Object.assign({auth:this.auth,failoverUrls:this.failover.map((e=>`${e}/lb/${b}/calls/${s}/join`))},t),this)}))}joinCall(e,t=null,r={}){return i.__awaiter(this,void 0,void 0,(function*(){null==this.joinUrl&&this.throwErrorDeprecated(new l.ValidationError("joinUrl is null",{}));const i=Object.assign(Object.assign({},this.options.sfu),r);return(0,u.default)(this.ctx,e,this.joinUrl,Object.assign({auth:this.auth,failoverUrls:this.failoverJoinUrls},i),this,t)}))}broadcast(e,t){var r;return i.__awaiter(this,void 0,void 0,(function*(){null==this.pvcCall&&this.throwErrorDeprecated(new l.InternalCallError("call is not started; pvcCall is null",{})),(null!=this.pvcCall.streams[t.streamName]||this.broadcasts.has(t.streamName))&&this.throwErrorDeprecated(new l.StreamExistsError("stream name already exists",{broadcast:null!==(r=this.broadcasts.get(t.streamName))&&void 0!==r?r:{},call:this})),this.ctx.logger.debug("starting broadcast",{hasAudio:e.hasActiveAudioTrack(),hasVideo:e.hasActiveVideoTrack(),broadcastOptions:t}),this.pvcCall.setStream(t.streamName,{audio:{streamProvider:e},video:{streamProvider:e}});const i=new o.Broadcast((0,m.extendContext)(this.ctx,o.Broadcast),this,this.pvcCall,e,t);return this[g.addProxy](i),i.once("disposed",(()=>{this.broadcasts.delete(t.streamName),this[g.removeProxy](i)})),this.broadcasts.set(t.streamName,i),i}))}close(e="Implementer did not pass debugString"){var t,r,i;if(null!=this.auth&&this.auth.destroy(),"closed"!==this.state){null===(t=this.pvcCall)||void 0===t||t.off("CALL_ADD_PEER",this.handleAddPeer),null===(r=this.pvcCall)||void 0===r||r.off("CALL_REMOVE_PEER",this.handleRemovePeer);try{null===(i=this.pvcCall)||void 0===i||i.close(e)}catch(e){}this.connectedPeers.splice(0,this.connectedPeers.length),(0,p.cancel)(this.ctx,"Call has been closed"),this.emit("callClosed",{callId:this.id}),this.state="closed"}}kickViewer(e,t,r=!1){var n;return i.__awaiter(this,void 0,void 0,(function*(){return null===(n=this.pvcCall)||void 0===n?void 0:n.kickViewer(e,t,r)}))}kickPeer(e,t,r){var n;return i.__awaiter(this,void 0,void 0,(function*(){return null===(n=this.pvcCall)||void 0===n?void 0:n.kickPeer(e,t,r)}))}promoteViewer(e,t,r=!1){var n;return i.__awaiter(this,void 0,void 0,(function*(){return null===(n=this.pvcCall)||void 0===n?void 0:n.promoteViewer(e,t,r)}))}demoteViewer(e,t,r=!1){var n;return i.__awaiter(this,void 0,void 0,(function*(){return null===(n=this.pvcCall)||void 0===n?void 0:n.demoteViewer(e,t,r)}))}toJSON(){var e,t,r,i;return{callUrl:this.callUrl,joinUrl:this.joinUrl,backendEndpoint:this.backendEndpoint,peersIds:this.connectedPeers.map((e=>e.peerId)),options:{callId:null===(e=this.options)||void 0===e?void 0:e.callId,backendEndpoints:null===(t=this.options)||void 0===t?void 0:t.backendEndpoints,playerOptions:null===(r=this.options)||void 0===r?void 0:r.playerOptions,sfu:null===(i=this.options)||void 0===i?void 0:i.sfu},aggregates:Object.assign(Object.assign({},(0,n.extractAggregates)(this.pvcCall,"support")),{support:this.ctx.support.hash,state:this.state})}}}t.Call=S,S.displayName="Call"},5580:(e,t,r)=>{"use strict";var i,n;Object.defineProperty(t,"__esModule",{value:!0}),t.HlsjsNotLoadedError=t.InvalidBitrateError=t.UserRequiredError=t.UnrecognizedDriverError=t.UnknownError=t.UnknownDriverError=t.PlaybackError=t.NoDriversError=t.WSNetworkError=t.InvalidElementError=t.InvalidPopoutURLError=t.InvalidMediaURLError=t.InvalidControlsError=t.ManifestNotFoundError=t.ManifestInternalError=t.ManifestForbiddenError=t.ManifestUnauthorizedError=t.ManifestUnexpectedResponseError=t.GetUserMediaFailedError=t.EmbedSWFFailedError=t.ElementRequiredError=t.DriverNotSupportedError=t.ManifestBadInputError=t.ManifestError=t.DisableAudioError=t.DisableVideoError=t.EnableAudioError=t.EnableVideoError=t.StreamNotFoundError=t.StreamExistsError=t.UpdateBroadcastError=t.StartBroadcastError=t.BroadcastError=t.JoinCallError=t.CallError=t.TrackEndedError=t.CapturableStreamError=t.DeviceNotFoundError=t.ConstraintsError=t.NetworkError=t.PermissionsError=t.InternalCallError=t.ValidationError=t.NotSupportedError=t.NotInitializedError=t.InternalError=t.NativeError=t.VideoClientErrorDeprecated=t.wrapNativeError=t.ErrorCode=void 0,t.HandleHlsJsError=t.Mp4BufferError=t.ChangeMSCDeviceError=t.UpdateMSCError=t.MediaRecorderError=t.TransportStateError=t.MediaError=t.MediasoupSetupError=t.WSRequestError=t.SFUProducerResumedEventError=t.SFUProducerPausedEventError=t.SFUProducerClosedEventError=t.SFUConsumerLayersChangedEventError=t.SFUConsumerScoreEventError=t.SFUConsumerResumedEventError=t.SFUConsumerPausedEventError=t.SFUConsumerClosedEventError=t.SFUSwitchConsumerTrackEventError=t.SFUPeerClosedEventError=t.SFUNewConsumerEventError=t.SFUConsumerSourcesEventError=t.SFUNewPeersEventError=t.RetrievingMediaStreamError=t.DisposedObjectError=t.MeowDriverError=t.PlayingIssueError=t.ConsumerNotFoundError=t.LayerNotFoundError=void 0;const s=r(7582),a=r(4702),o=r(167),c=r(8329);var l=r(167);Object.defineProperty(t,"ErrorCode",{enumerable:!0,get:function(){return l.ErrorCode}});const d=new Set(["toJSON","ppStack","stack","detailed","handled","inner","aggregates"]);function u(e){var t;return null==e?null:"toJSON"in e&&"function"==typeof e.toJSON?e:{err:null!==(t=e.name)&&void 0!==t?t:e.constructor.name,message:e.message,stack:e.stack}}t.wrapNativeError=function(e){return e instanceof Error?new m(e.message,{native:e}):new m(String(e),{})};const h="Video Client Error: ";function p(e){return null==e||"object"!=typeof e||"string"!=typeof e.message?"":`${null==e.code?"; ":`; [${String(e.code)} `}${e.message}${p(e.inner)}`}class f extends Error{constructor(e,t){super(),this.inner=null,i.set(this,void 0),n.set(this,null),this.handled=!1,s.__classPrivateFieldSet(this,i,e,"f");const{inner:r,critical:a}=t,o=s.__rest(t,["inner","critical"]);this.inner=r,this.critical=null!=a?a:r instanceof f&&r.critical;for(const[e,t]of Object.entries(o))this[e]=t}get message(){var e;let t=null===(e=this.inner)||void 0===e?void 0:e.message;return null!=t?(t.startsWith(h)&&(t=t.slice(20)),`${h}[${this.code}] ${s.__classPrivateFieldGet(this,i,"f")}; ${t}`):Reflect.has(this,"err")?`${h}[${this.code}] ${s.__classPrivateFieldGet(this,i,"f")}${p(Reflect.get(this,"err"))}`:`${h}[${this.code}] ${s.__classPrivateFieldGet(this,i,"f")}`}static loadPrettyPrintStacktrace(e){return s.__awaiter(this,void 0,void 0,(function*(){return Promise.resolve()}))}static log(e,t){f.loadPrettyPrintStacktrace(e).finally((()=>{t.error(e.message,{err:e})}))}toJSON(){var e,t;const r={message:this.message,stack:null!==(t=null!==(e=s.__classPrivateFieldGet(this,n,"f"))&&void 0!==e?e:this.stack)&&void 0!==t?t:null,inner:u(this.inner),aggregates:this.aggregates()};for(const e of Object.keys(this))d.has(e)||(r[e.toString()]=this[e]);return r}aggregates(){var e,t;return this.inner instanceof f?Object.assign(Object.assign({},this.inner.aggregates()),{errCode:this.code,errCritical:null!==(e=this.critical)&&void 0!==e&&e,errHandled:this.handled}):{errCode:this.code,errCritical:null!==(t=this.critical)&&void 0!==t&&t,errHandled:this.handled}}}t.VideoClientErrorDeprecated=f,i=new WeakMap,n=new WeakMap;class m extends f{constructor(){super(...arguments),this.code=o.ErrorCode.NativeError}}t.NativeError=m,t.InternalError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.InternalError}},t.NotInitializedError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.NotInitialized}},t.NotSupportedError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.NotSupported}},t.ValidationError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.ValidationError}},t.InternalCallError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.InternalCallError}aggregates(){return Object.assign(Object.assign({},super.aggregates()),(0,a.extractAggregates)(this.internalCall))}},t.PermissionsError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.Permission}aggregates(){return Object.assign(Object.assign({},super.aggregates()),(0,a.extractAggregates)(this.stream))}},t.NetworkError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.NetworkError}aggregates(){var e;return Object.assign(Object.assign({},super.aggregates()),{errStatus:null!==(e=this.status)&&void 0!==e?e:0})}},t.ConstraintsError=class extends f{constructor(e,t){super(e,t),this.code=o.ErrorCode.Constraints;const{inner:r}=t;this.failedConstraint=null!=r&&(0,c.isOverconstrainedError)(r)?r.constraint:"NA"}},t.DeviceNotFoundError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.DeviceNotFound}},t.CapturableStreamError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.CapturableStreamError}},t.TrackEndedError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.TrackEnded}},t.CallError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.CallError}aggregates(){return Object.assign(Object.assign({},super.aggregates()),{reason:this.reason})}},t.JoinCallError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.JoinCallError}aggregates(){return Object.assign(Object.assign({},super.aggregates()),(0,a.extractAggregates)(this.call))}};class g extends f{aggregates(){return Object.assign(Object.assign({},super.aggregates()),(0,a.extractAggregates)(this.broadcast))}}t.BroadcastError=g,t.StartBroadcastError=class extends g{constructor(){super(...arguments),this.code=o.ErrorCode.StartBroadcastError}},t.UpdateBroadcastError=class extends g{constructor(){super(...arguments),this.code=o.ErrorCode.UpdateBroadcastError}},t.StreamExistsError=class extends g{constructor(){super(...arguments),this.code=o.ErrorCode.StreamExists}},t.StreamNotFoundError=class extends g{constructor(){super(...arguments),this.code=o.ErrorCode.StreamNotFound}},t.EnableVideoError=class extends g{constructor(){super(...arguments),this.code=o.ErrorCode.EnableVideoError}},t.EnableAudioError=class extends g{constructor(){super(...arguments),this.code=o.ErrorCode.EnableAudioError}},t.DisableVideoError=class extends g{constructor(){super(...arguments),this.code=o.ErrorCode.DisableVideoError}},t.DisableAudioError=class extends g{constructor(){super(...arguments),this.code=o.ErrorCode.DisableAudioError}},t.ManifestError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.ManifestError}aggregates(){return Object.assign(Object.assign({},super.aggregates()),(0,a.extractAggregates)(this.loader))}},t.ManifestBadInputError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.BadInput}},t.DriverNotSupportedError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.DriverNotSupported}aggregates(){return Object.assign(Object.assign({},super.aggregates()),(0,a.extractAggregates)(this.loader))}},t.ElementRequiredError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.ElementRequired}},t.EmbedSWFFailedError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.EmbedSWFFailed}},t.GetUserMediaFailedError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.GetUserMediaFailed}},t.ManifestUnexpectedResponseError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.ManifestUnexpectedResponse}},t.ManifestUnauthorizedError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.ManifestUnauthorized}},t.ManifestForbiddenError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.ManifestForbidden}},t.ManifestInternalError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.ManifestInternalError}},t.ManifestNotFoundError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.ManifestNotFound}},t.InvalidControlsError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.InvalidControls}},t.InvalidMediaURLError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.InvalidMediaURL}},t.InvalidPopoutURLError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.InvalidPopoutURL}},t.InvalidElementError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.InvalidElement}},t.WSNetworkError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.WSNetworkError}},t.NoDriversError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.NoDrivers}},t.PlaybackError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.PlaybackError}aggregates(){return Object.assign(Object.assign({},super.aggregates()),(0,a.extractAggregates)(this.loader))}},t.UnknownDriverError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.UnknownDriver}},t.UnknownError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.UnknownError}},t.UnrecognizedDriverError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.UnrecognizedDriver}},t.UserRequiredError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.UserRequired}},t.InvalidBitrateError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.InvalidBitrate}},t.HlsjsNotLoadedError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.HlsjsNotLoaded}},t.LayerNotFoundError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.LayerNotFound}},t.ConsumerNotFoundError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.ConsumerNotFound}},t.PlayingIssueError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.PlayingIssue}aggregates(){return Object.assign(Object.assign({},super.aggregates()),(0,a.extractAggregates)(this.player))}},t.MeowDriverError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.MeowDriverError}},t.DisposedObjectError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.DisposedObject}},t.RetrievingMediaStreamError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.RetrievingMediaStreamError}aggregates(){return Object.assign(Object.assign({},super.aggregates()),{streamName:this.streamName,mediaKind:this.mediaKind})}},t.SFUNewPeersEventError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.SFUNewPeersEvent}aggregates(){return Object.assign(Object.assign({},super.aggregates()),(0,a.extractAggregates)(this.peer))}},t.SFUConsumerSourcesEventError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.SFUConsumerSourcesEvent}aggregates(){return Object.assign(Object.assign({},super.aggregates()),(0,a.extractAggregates)(this.peer))}},t.SFUNewConsumerEventError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.SFUNewConsumerEvent}aggregates(){return Object.assign(Object.assign({},super.aggregates()),(0,a.extractAggregates)(this.peer))}},t.SFUPeerClosedEventError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.SFUPeerClosedEvent}aggregates(){return Object.assign(Object.assign({},super.aggregates()),(0,a.extractAggregates)(this.peer))}},t.SFUSwitchConsumerTrackEventError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.SFUSwitchConsumerTrackEvent}aggregates(){return Object.assign(Object.assign({},super.aggregates()),(0,a.extractAggregates)(this.peer))}},t.SFUConsumerClosedEventError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.SFUConsumerClosedEvent}aggregates(){return Object.assign(Object.assign({},super.aggregates()),(0,a.extractAggregates)(this.peer))}},t.SFUConsumerPausedEventError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.SFUConsumerPausedEvent}aggregates(){return Object.assign(Object.assign({},super.aggregates()),(0,a.extractAggregates)(this.peer))}},t.SFUConsumerResumedEventError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.SFUConsumerResumedEvent}aggregates(){return Object.assign(Object.assign({},super.aggregates()),(0,a.extractAggregates)(this.peer))}},t.SFUConsumerScoreEventError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.SFUConsumerScoreEvent}aggregates(){return Object.assign(Object.assign({},super.aggregates()),(0,a.extractAggregates)(this.peer))}},t.SFUConsumerLayersChangedEventError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.SFUConsumerLayersChangedEvent}aggregates(){return Object.assign(Object.assign({},super.aggregates()),(0,a.extractAggregates)(this.peer))}},t.SFUProducerClosedEventError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.SFUProducerClosedEvent}aggregates(){return Object.assign(Object.assign({},super.aggregates()),(0,a.extractAggregates)(this.peer))}},t.SFUProducerPausedEventError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.SFUProducerPausedEvent}aggregates(){return Object.assign(Object.assign({},super.aggregates()),(0,a.extractAggregates)(this.peer))}},t.SFUProducerResumedEventError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.SFUProducerResumedEvent}aggregates(){return Object.assign(Object.assign({},super.aggregates()),(0,a.extractAggregates)(this.peer))}},t.WSRequestError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.WSRequestError}aggregates(){return Object.assign(Object.assign({},super.aggregates()),(0,a.extractAggregates)(this.internalCall))}},t.MediasoupSetupError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.MediasoupSetupError}},t.MediaError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.MediaError}},t.TransportStateError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.TransportStateError}},t.MediaRecorderError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.MediaRecorderError}},t.UpdateMSCError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.UpdateMSCError}aggregates(){return Object.assign(Object.assign({},super.aggregates()),(0,a.extractAggregates)(this.msc))}},t.ChangeMSCDeviceError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.UpdateMSCError}aggregates(){var e,t,r,i,n,s,o,c;return Object.assign(Object.assign(Object.assign({},super.aggregates()),(0,a.extractAggregates)(this.msc)),{prevVideoDeviceId:null!==(e=this.prevVideoDeviceId)&&void 0!==e?e:"",prevVideoDeviceLabel:null!==(t=this.prevVideoDeviceLabel)&&void 0!==t?t:"",failedVideoDeviceId:null!==(r=this.failedVideoDeviceId)&&void 0!==r?r:"",failedVideoDeviceLabel:null!==(i=this.failedVideoDeviceLabel)&&void 0!==i?i:"",prevAudioDeviceId:null!==(n=this.prevAudioDeviceId)&&void 0!==n?n:"",prevAudioDeviceLabel:null!==(s=this.prevAudioDeviceLabel)&&void 0!==s?s:"",failedAudioDeviceId:null!==(o=this.failedAudioDeviceId)&&void 0!==o?o:"",failedAudioDeviceLabel:null!==(c=this.failedAudioDeviceLabel)&&void 0!==c?c:""})}},t.Mp4BufferError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.Mp4BufferError}},t.HandleHlsJsError=class extends f{constructor(){super(...arguments),this.code=o.ErrorCode.HandleHlsJsError}}},3199:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VideoClientError=t.createError=t.wrapError=t.ErrorCode=void 0;const i=r(167),n=r(813);var s=r(167);Object.defineProperty(t,"ErrorCode",{enumerable:!0,get:function(){return s.ErrorCode}});const a=new Set(["toJSON","stack","detailed","handled","inner","aggregates"]);function o(e){var t;return null==e?null:"toJSON"in e&&"function"==typeof e.toJSON?e:{err:null!==(t=e.name)&&void 0!==t?t:e.constructor.name,message:e.message,stack:e.stack}}function c(e){return null==e?null:(0,n.isVideoClientError)(e)?e:e instanceof Error?l(i.ErrorCode.NativeError,e.message,{type:e.name}):e instanceof ErrorEvent?l(i.ErrorCode.NativeError,e.message,{type:e.type}):l(i.ErrorCode.NativeError,String(e),{type:"unknown"})}function l(e,t,r,i=null){return new d(e,t,r,i)}t.wrapError=c,t.createError=l;class d extends Error{constructor(e,t,r={},i=null){super(function(e,t,r){let i=`[${e}] ${t}`;for(;null!=r;)i+=`; [${r.code}] ${r.message}`,r=r.inner;return i}(e,t,c(i))),this.inner=null,this.innerCodes=new Set,this.muted=!1,this.code=e,this.inner=c(i);for(const[e,t]of Object.entries(r))this[e]=t}static log(e,t){t.error(e.message,{err:e})}get isMuted(){return this.muted}toJSON(){var e;const t={message:this.message,stack:null!==(e=this.stack)&&void 0!==e?e:null,inner:o(this.inner),aggregates:this.aggregates()};for(const e of Object.keys(this))a.has(e)||(t[e.toString()]=this[e]);return t}aggregates(){return this.inner instanceof d?Object.assign(Object.assign({},this.inner.aggregates()),{errCode:this.code}):{errCode:this.code}}mute(){this.muted=!0}}t.VideoClientError=d},7170:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MediaStreamController=t.optionsKey=t.mediaController=t.CONSTRAINTS_SCREENCAPTURE_OPTIMAL_WEAK=t.CONSTRAINTS_VIDEO_OPTIMAL_WEAK=t.CONSTRAINTS_VIDEO_OPTIMAL_STRICT=t.CONSTRAINTS_AUDIO_OPTIMAL_WEAK=t.CONSTRAINTS_AUDIO_OPTIMAL_STRICT=t.VIDEO_DEVICE_CAPTURABLE=t.VIDEO_DEVICE_SCREENCAPTURE=void 0;const i=r(7582),n=r(7881),s=i.__importDefault(r(8439)),a=r(5910),o=r(8949),c=r(167),l=r(4280),d=r(8329),u=i.__importDefault(r(5856)),h=r(2914),p=r(3199),f=r(3757),m=r(327);t.VIDEO_DEVICE_SCREENCAPTURE={deviceId:"screencapture",groupId:"screencapture",label:"Screen Capture",kind:"videoinput",virtual:!0,toJSON(){return{deviceId:this.deviceId,groupId:this.groupId,label:this.label,kind:this.kind}}},t.VIDEO_DEVICE_CAPTURABLE={deviceId:"capturable",groupId:"capturable",label:"Capturable",kind:"videoinput",virtual:!0,toJSON(){return{deviceId:this.deviceId,groupId:this.groupId,label:this.label,kind:this.kind}}},t.CONSTRAINTS_AUDIO_OPTIMAL_STRICT={autoGainControl:{exact:!0},channelCount:{min:1,ideal:2},echoCancellation:{exact:!0},latency:{ideal:0},noiseSuppression:{exact:!0},sampleRate:{min:8e3,ideal:48e3,max:48e3},sampleSize:{min:16,ideal:32}},t.CONSTRAINTS_AUDIO_OPTIMAL_WEAK={autoGainControl:{ideal:!0},channelCount:{min:1,ideal:2},echoCancellation:{ideal:!0},latency:{ideal:0},noiseSuppression:{ideal:!0},sampleRate:{min:8e3,ideal:48e3,max:48e3},sampleSize:{min:16,ideal:32}},t.CONSTRAINTS_VIDEO_OPTIMAL_STRICT={facingMode:{ideal:"user"},aspectRatio:{exact:16/9},height:l.device.isAndroidDevice?{min:240,max:2160}:{min:240,ideal:2160,max:2160},frameRate:{ideal:24}},t.CONSTRAINTS_VIDEO_OPTIMAL_WEAK={facingMode:{ideal:"user"},aspectRatio:{ideal:16/9},height:l.device.isAndroidDevice?{min:240,max:2160}:{min:240,ideal:2160,max:2160},frameRate:{ideal:24}},t.CONSTRAINTS_SCREENCAPTURE_OPTIMAL_WEAK={frameRate:{ideal:24}};const g=o.observable.array([],{name:"mediaDevicesList"}),v=new Proxy({},{get:(e,r)=>{var i;return r===t.VIDEO_DEVICE_SCREENCAPTURE.deviceId?t.VIDEO_DEVICE_SCREENCAPTURE:r===t.VIDEO_DEVICE_CAPTURABLE.deviceId?t.VIDEO_DEVICE_CAPTURABLE:null!==(i=g.find((e=>e.deviceId===r&&"videoinput"===e.kind)))&&void 0!==i?i:null}}),_=new Proxy({},{get:(e,t)=>{var r;return null!==(r=g.find((e=>e.deviceId===t&&"audioinput"===e.kind)))&&void 0!==r?r:null}}),y=new Proxy({},{get:(e,r)=>{var i;return r===t.VIDEO_DEVICE_SCREENCAPTURE.deviceId?t.VIDEO_DEVICE_SCREENCAPTURE:r===t.VIDEO_DEVICE_CAPTURABLE.deviceId?t.VIDEO_DEVICE_CAPTURABLE:null!==(i=g.find((e=>e.deviceId===r)))&&void 0!==i?i:null}}),b=[4320,2160,1440,1080,720,480,240],E=new WeakMap,S={};let w=0,T=null;const R={defaultConstraints:{audio:t.CONSTRAINTS_AUDIO_OPTIMAL_STRICT,video:t.CONSTRAINTS_VIDEO_OPTIMAL_STRICT,screencapture:t.CONSTRAINTS_SCREENCAPTURE_OPTIMAL_WEAK},fallbackConstraints:{audio:t.CONSTRAINTS_AUDIO_OPTIMAL_WEAK,video:t.CONSTRAINTS_VIDEO_OPTIMAL_WEAK,screencapture:{}},replaceTracks:!0,waitingDelay:100,defaultLockPolicy:c.ExistsStreamPolicy.wait,noEchoGainAmplifier:l.device.isIosDevice,requestAudioPermission:!0};function C({stream:e,audio:t=!0,video:r=!0,removeEventListenerCb:i}){var n;if(null!=e)for(const s of e.getTracks()){if("audio"===s.kind&&!t||"video"===s.kind&&!r)continue;null!=i&&i(s);const a=E.get(s);null!=a&&(null!=i&&null!=a.originalTrack&&i(a.originalTrack),null===(n=a.originalTrack)||void 0===n||n.stop()),s.stop(),e.removeTrack(s)}}function A(e){var t;let r;try{r=null===(t=e.getSettings)||void 0===t?void 0:t.call(e)}catch(e){r={}}return r}function P(e){var t;let r;try{r=null===(t=e.getConstraints)||void 0===t?void 0:t.call(e)}catch(e){r={}}return r}function D(e,t,r){const i=JSON.parse(JSON.stringify(e));if(null!=r.aspectRatio)if("number"==typeof r.aspectRatio)i.aspectRatio={exact:r.aspectRatio};else{const[e,t]=r.aspectRatio;i.aspectRatio={min:e,max:t}}if(null!=r.autoGainControl&&(i.autoGainControl={exact:r.autoGainControl}),null!=r.echoCancellation&&(i.echoCancellation={exact:r.echoCancellation}),null!=r.facingMode&&(i.facingMode={exact:r.facingMode}),null!=r.frameRate)if("number"==typeof r.frameRate)i.frameRate={exact:r.frameRate};else{const[e,t]=r.frameRate;i.frameRate={min:e,max:t}}if(null!=r.resolution)if("number"==typeof r.resolution)i.height={exact:r.resolution};else if(Array.isArray(r.resolution)){const[e,t]=r.resolution;i.height={min:e,max:t}}else i.height={min:r.resolution.min,ideal:r.resolution.ideal,max:r.resolution.max};var n;return i.deviceId=null==t||null!=(n=y[t])&&n.virtual?void 0:{exact:t},i}function L({defaults:e,audioDeviceInfo:r,videoDeviceInfo:i,overrides:n}){const{echoCancellation:s,autoGainControl:a,noiseSuppression:o,frameRate:c,resolution:l,aspectRatio:d,facingMode:u}=n,h=(null==i?void 0:i.deviceId)===(null===t.VIDEO_DEVICE_SCREENCAPTURE||void 0===t.VIDEO_DEVICE_SCREENCAPTURE?void 0:t.VIDEO_DEVICE_SCREENCAPTURE.deviceId)?e.screencapture:e.video,{audio:p}=e;return{audio:null!=r&&D(p,null==r?void 0:r.deviceId,{echoCancellation:s,autoGainControl:a,noiseSuppression:o}),video:null!=i&&D(h,null==i?void 0:i.deviceId,{resolution:l,frameRate:c,aspectRatio:d,facingMode:u})}}class k extends m.ObservableEventEmitter{constructor(){var e,t;super(),this.isInitialized=!1,this.initialized=null,this._supportSharedDevices=null,this.logger=new n.LoggerCore(h.PACKAGE_NAME).setLoggerMeta("client","VDC").setLoggerMeta("release",u.default.version).appendChain(k).setMessageAggregate("contextId",null!==(e=(0,h.contextId)())&&void 0!==e?e:void 0).setMessageAggregate("instanceId",null!==(t=(0,h.instanceId)())&&void 0!==t?t:void 0),(0,f.makeBounded)(this),(0,o.makeObservable)(this,{requestController:o.action})}audioDevices(){return this.isInitialized?g.filter((e=>"audioinput"===e.kind)):(this.logger.warn("init() must be called on the media-controller singleton",{}),[])}videoDevices(){return this.isInitialized?g.filter((e=>"videoinput"===e.kind)):(this.logger.warn("init() must be called on the media-controller singleton",{}),[])}get devices(){return Object.fromEntries(g.entries())}get supportSharedDevices(){return null!=this._supportSharedDevices&&this._supportSharedDevices}checkSupportSharedDevices(e,t){var r,n,s,a;return i.__awaiter(this,void 0,void 0,(function*(){if((i=l.device).isAndroidDevice&&"ReactNative"===i.platform)return void(this._supportSharedDevices=!1);var i;if(!l.device.isImplements(l.Feature.MEDIA_DEVICE))return void(this._supportSharedDevices=!1);if(!1===e&&!1===t)return this.logger.warn("video and audio device permissions denied"),void(this._supportSharedDevices=!1);let o=null,c=null;try{const t=e?{video:{deviceId:"default"}}:{audio:{deviceId:"default"}};o=yield l.device.mediaDevices.getUserMedia(t);const i=null===(n=null===(r=o.getTracks()[0])||void 0===r?void 0:r.getSettings())||void 0===n?void 0:n.deviceId,d=e?{video:{deviceId:i}}:{audio:{deviceId:i}};c=yield l.device.mediaDevices.getUserMedia(d);const u=null===(a=null===(s=c.getTracks()[0])||void 0===s?void 0:s.getSettings())||void 0===a?void 0:a.deviceId;this._supportSharedDevices=i===u}catch(e){this._supportSharedDevices=!1}finally{C({stream:o}),C({stream:c})}}))}init(e){return i.__awaiter(this,void 0,void 0,(function*(){if(this.mediaControllerOptions=e,null!=this.initialized)return e&&this.setOptions(e),this.initialized;this.initialized=this._init(),e&&this.setOptions(e);try{yield this.initialized}catch(e){throw this.initialized=null,e}return this.isInitialized=!0,this.initialized}))}setOptions(e){var t;clearInterval(w),null!=e.updateByTimer&&(w=l.device.setInterval(this.enumerateDevices,e.updateByTimer)),null!=e.logger&&(null===(t=this.logger)||void 0===t||t.destroy(),this.logger=e.logger)}handleDeviceChange(){this.enumerateDevices(!1)}_init(){return i.__awaiter(this,void 0,void 0,(function*(){return l.device.isImplements(l.Feature.MEDIA_DEVICE)||this.throwError((0,p.createError)(c.ErrorCode.MediaDeviceNotSupported,"media device is not supported",{})),l.device.mediaDevices.removeEventListener("devicechange",this.handleDeviceChange),l.device.mediaDevices.addEventListener("devicechange",this.handleDeviceChange),this.enumerateDevices(!0).then(this.observePerms)}))}observePerms(){return i.__awaiter(this,void 0,void 0,(function*(){if(!l.device.isImplements(l.Feature.PERMISSIONS))return;const e=e=>{const t=e.target;this.enumerateDevices("prompt"===t.state)};try{const t=yield l.device.permissions.query({name:"camera"}),r=yield l.device.permissions.query({name:"microphone"});t.addEventListener("change",e),r.addEventListener("change",e)}catch(e){}}))}requestController(e=R){var t,r;const i=Object.assign(Object.assign(Object.assign({},R),{replaceTracks:this.supportSharedDevices,requestAudioPermission:null===(r=null===(t=this.mediaControllerOptions)||void 0===t?void 0:t.requestAudioPermission)||void 0===r||r}),e);return this.logger.info("request new MediaStreamController",{options:{defaultConstraints:JSON.stringify(i.defaultConstraints),fallbackConstraints:JSON.stringify(i.fallbackConstraints),defaultLockPolicy:i.defaultLockPolicy,replaceTracks:i.replaceTracks,waitingDelay:i.waitingDelay,displayName:i.displayName,requestAudioPermission:i.requestAudioPermission}}),this.isInitialized||this.throwError((0,p.createError)(c.ErrorCode.MediaControllerNotInitialized,"init() must be called on the media-controller singleton",{})),Promise.resolve(new I(i))}enumerateDevices(e=!1){return i.__awaiter(this,void 0,void 0,(function*(){l.device.isImplements(l.Feature.MEDIA_DEVICE)&&null!=l.device.mediaDevices.enumerateDevices||this.throwError((0,p.createError)(c.ErrorCode.MediaDeviceNotSupported,"media device is not supported",{})),e&&(yield this.requestPermissions());try{const e=yield l.device.mediaDevices.enumerateDevices();let t=[];for(const r of e)""===r.deviceId||""===r.label||t.some((e=>e.deviceId===r.deviceId&&e.kind===r.kind))||t.push(r);if(l.device.isSafari&&l.device.isImplements(l.Feature.PERMISSIONS)){const e=yield l.device.permissions.query({name:"camera"}),r=yield l.device.permissions.query({name:"microphone"});"granted"!==e.state&&(t=t.filter((e=>"videoinput"!==e.kind))),"granted"!==r.state&&(t=t.filter((e=>"audioinput"!==e.kind)))}(g.length!==t.length||g.some(((e,r)=>e.deviceId!==t[r].deviceId||e.groupId!==t[r].groupId||e.label!==t[r].label||e.kind!==t[r].kind)))&&((0,o.runInAction)((function(){g.replace(t)})),this.emit("deviceListChanged",g.slice()))}catch(e){this.throwError((0,p.createError)(c.ErrorCode.EnumeratingDevices,"error enumerating devices",{}))}}))}requestPermissions(){var e,t;return i.__awaiter(this,void 0,void 0,(function*(){l.device.isImplements(l.Feature.MEDIA_DEVICE)&&null!=l.device.mediaDevices.enumerateDevices||this.throwError((0,p.createError)(c.ErrorCode.MediaDeviceNotSupported,"media device is not supported",{}));const r=[];let i=!1,n=!1;const s=null===(t=null===(e=this.mediaControllerOptions)||void 0===e?void 0:e.requestAudioPermission)||void 0===t||t;try{r.push(yield l.device.mediaDevices.getUserMedia({audio:s,video:!0})),i=s,n=!0}catch(e){try{s&&(r.push(yield l.device.mediaDevices.getUserMedia({audio:!0,video:!1})),i=!0)}catch(e){e instanceof Error&&("NotFoundError"===e.name?(this.logger.warn("no audio devices found",{err:(0,p.wrapError)(e)}),this.emit("audioNotFound")):"NotAllowedError"===e.name?(this.logger.warn("audio device permission denied",{err:(0,p.wrapError)(e)}),this.emit("audioNotAllowed")):this.logger.warn("Audio device error",{err:(0,p.wrapError)(e)}))}try{r.push(yield l.device.mediaDevices.getUserMedia({audio:!1,video:!0})),n=!0}catch(e){e instanceof Error&&("NotFoundError"===e.name?(this.logger.warn("no video devices found",{err:(0,p.wrapError)(e)}),this.emit("videoNotFound")):"NotAllowedError"===e.name?(this.logger.warn("video device permission denied",{err:(0,p.wrapError)(e)}),this.emit("videoNotAllowed")):this.logger.warn("Video device error",{err:(0,p.wrapError)(e)}))}}finally{for(const e of r)C({stream:e})}yield this.checkSupportSharedDevices(n,i)}))}}k.displayName="MediaController",t.mediaController=new k,t.optionsKey=Symbol("options");class I extends m.ObservableEventEmitter{get[t.optionsKey](){return this.optionsAtom.reportObserved(),this.options}get settings(){var e,t,r,i,n,s,a;this.applyConstraintsAtom.reportObserved();const o={};if(this.hasActiveAudioTrack()){const s=null===(e=this.source)||void 0===e?void 0:e.getAudioTracks()[0],a=E.get(s);null!=s&&null!=a?(o.audioCtx={gain:null===(t=a.gainNode)||void 0===t?void 0:t.gain.value,internallyEnded:a.internallyEnded,track:s.getSettings()},o.audio=null===(r=a.originalTrack)||void 0===r?void 0:r.getSettings()):o.audio=null===(n=null===(i=this.source)||void 0===i?void 0:i.getAudioTracks()[0])||void 0===n?void 0:n.getSettings()}return this.hasActiveVideoTrack()&&(o.video=null===(a=null===(s=this.source)||void 0===s?void 0:s.getVideoTracks()[0])||void 0===a?void 0:a.getSettings()),o}get sourceUrl(){return URL.createObjectURL(s.default)}get audioDeviceId(){var e,t;return null!==(t=null===(e=this.audioDeviceChanged)||void 0===e?void 0:e.deviceId)&&void 0!==t?t:null}set audioDeviceId(e){var t,r;null!=e?(null==_[e]&&this.emitError((0,p.createError)(c.ErrorCode.MediaDeviceNotAvailable,"audio device not found or not available",{deviceId:e,deviceLabel:null,prevDeviceId:this.audioDeviceId,prevDeviceLabel:null!==(r=null===(t=this.audioDeviceChanged)||void 0===t?void 0:t.label)&&void 0!==r?r:null,kind:"audio"})),this.audioDeviceChanging=this.options.requestAudioPermission?_[e]:null):this.audioDeviceChanging=null}get inVideoDeviceTransition(){return null!=this.sync&&this.videoDeviceChanging!==this.videoDeviceChanged}get inAudioDeviceTransition(){return null!=this.sync&&this.audioDeviceChanging!==this.audioDeviceChanged}get videoDeviceId(){var e,t,r,i;return this.videoDisabled?null!==(t=null===(e=this.videoDeviceChanging)||void 0===e?void 0:e.deviceId)&&void 0!==t?t:null:null!==(i=null===(r=this.videoDeviceChanged)||void 0===r?void 0:r.deviceId)&&void 0!==i?i:null}set videoDeviceId(e){var t,r;null!=e?(null==v[e]&&this.emitError((0,p.createError)(c.ErrorCode.MediaDeviceNotAvailable,"video device not found or not available",{deviceId:e,deviceLabel:null,prevDeviceId:this.videoDeviceId,prevDeviceLabel:null!==(r=null===(t=this.videoDeviceChanged)||void 0===t?void 0:t.label)&&void 0!==r?r:null,kind:"video"})),this.videoDeviceChanging=v[e]):this.videoDeviceChanging=null}get isScreenCaptured(){var e;return(null===(e=this.videoDeviceChanged)||void 0===e?void 0:e.deviceId)===t.VIDEO_DEVICE_SCREENCAPTURE.deviceId}constructor(e){var r,i,s,a;super(),this.sync=null,this.audioCtx=null,this.optionsAtom=(0,o.createAtom)("options"),this.applyConstraintsAtom=(0,o.createAtom)("applyConstraints"),this.capturable=null,this.batchUpdates={timeout:null,changes:[],videoDevice:!1,audioDevice:!1,gain:!1,videoPaused:!1,audioMuted:!1,constraints:!1},this.audioDeviceChanged=null,this.videoDeviceChanged=null,this.audioDeviceChanging=null,this.videoDeviceChanging=null,this.videoDeviceRemoved=null,this.audioDeviceRemoved=null,this.audioMuted=!1,this.availableResolutions=[],this.maxWidth=null,this.maxHeight=null,this.videoPaused=!1,this.videoDisabled=!1,this.facingMode=null,this.gain=1,this.noEchoGainAmplifier=!1,this.resolution=null,this.frameRate=null,this.aspectRatio=null,this.echoCancellation=null,this.noiseSuppression=null,this.autoGainControl=null,l.device.isImplements(l.Feature.MEDIA_STREAM)||this.throwError((0,p.createError)(c.ErrorCode.MediaStreamNotSupported,"MediaStream is not supported",{})),this.source=new l.device.MediaStream,this.logger=new n.LoggerCore(h.PACKAGE_NAME).setLoggerMeta("package","VDC-core").setLoggerMeta("client","VDC").setLoggerMeta("release",u.default.version).setLoggerMeta("commitHash",u.default.commit).setLoggerMeta("contextId",null!==(r=(0,h.contextId)())&&void 0!==r?r:"").setLoggerMeta("instanceId",null!==(i=(0,h.instanceId)())&&void 0!==i?i:"").setMessageAggregate("displayName",null==e?void 0:e.displayName).appendChain(I).attachObject(this),this.logger.trace("constructor()",this),this.on("error",(e=>{this.logger.error(e.message)})),(0,o.makeObservable)(this,{audioDeviceChanged:o.observable.ref,videoDeviceChanged:o.observable.ref,audioDeviceChanging:o.observable.ref,videoDeviceChanging:o.observable.ref,audioMuted:o.observable,availableResolutions:o.observable,maxWidth:o.observable,maxHeight:o.observable,videoPaused:o.observable,videoDisabled:o.observable,facingMode:o.observable,gain:o.observable,resolution:o.observable,frameRate:o.observable,aspectRatio:o.observable,echoCancellation:o.observable,noiseSuppression:o.observable,autoGainControl:o.observable,source:o.observable.ref,audioDeviceId:o.computed,videoDeviceId:o.computed,isScreenCaptured:o.computed,sourceUrl:o.computed,settings:o.computed,toggleCamera:o.action,toggleMic:o.action,onDeviceListChanged:o.action}),this.options=JSON.parse(JSON.stringify(R)),null!=e&&(this.setOptions(Object.assign(Object.assign({},R),e)),null!=(null===(s=null==e?void 0:e.capturable)||void 0===s?void 0:s.element)&&l.device.supportsMediaStreamCapture(null===(a=null==e?void 0:e.capturable)||void 0===a?void 0:a.element)&&(this.capturable=e.capturable,this.videoDeviceId=t.VIDEO_DEVICE_CAPTURABLE.deviceId,this.applyNewDevices())),this.options.noEchoGainAmplifier&&(this.noEchoGainAmplifier=!0),this.setupMobxBatching(),t.mediaController.on("deviceListChanged",this.onDeviceListChanged),this.addInnerDisposer(this.close)}hasActiveStream(){const e=this.hasActiveAudioTrack(),t=this.hasActiveAudioTrack();return e||t}hasActiveVideoTrack(){const{videoDeviceChanged:e,videoDisabled:t}=this;return null!=e&&!t}hasActiveAudioTrack(){return null!=this.audioDeviceChanged}toggleCamera(){this.videoPaused=!this.videoPaused}toggleMic(){this.audioMuted=!this.audioMuted}onDeviceListChanged(e){if(null!=this.videoDeviceChanged&&!e.some((e=>{var t;return e.deviceId===(null===(t=this.videoDeviceChanged)||void 0===t?void 0:t.deviceId)}))){const t=e.filter((e=>"videoinput"===e.kind));t.length>0?[this.videoDeviceChanging]=t:this.videoDeviceChanging=null}if(null!=this.audioDeviceChanged&&!e.some((e=>{var t;return e.deviceId===(null===(t=this.audioDeviceChanged)||void 0===t?void 0:t.deviceId)}))){const t=e.filter((e=>"audioinput"===e.kind));t.length>0?[this.audioDeviceChanging]=t:this.audioDeviceChanging=null}}setupMobxBatching(){const e={scheduler:this.batchUpdatesScheduler,name:"MediaStreamController(batch update)"};this.addInnerDisposer((0,o.reaction)((()=>this.videoDeviceChanging),(()=>{this.batchUpdates.videoDevice=!0}),e)),this.addInnerDisposer((0,o.reaction)((()=>this.audioDeviceChanging),(()=>{this.batchUpdates.audioDevice=!0}),e)),this.addInnerDisposer((0,o.reaction)((()=>this.videoDisabled),(()=>{this.batchUpdates.videoDevice=!0}),e)),this.addInnerDisposer((0,o.reaction)((()=>this.gain),(()=>{this.batchUpdates.gain=!0}),e)),this.addInnerDisposer((0,o.reaction)((()=>this.videoPaused),(()=>{this.batchUpdates.videoPaused=!0}),e)),this.addInnerDisposer((0,o.reaction)((()=>this.audioMuted),(()=>{this.batchUpdates.audioMuted=!0}),e)),this.addInnerDisposer((0,o.reaction)((()=>[this.facingMode,this.aspectRatio,this.frameRate,this.resolution,this.noiseSuppression,this.autoGainControl,this.echoCancellation]),(()=>{this.batchUpdates.constraints=!0}),e))}batchUpdatesScheduler(e,...t){this.batchUpdates.changes.push(e),null==this.batchUpdates.timeout&&(this.batchUpdates.timeout=l.device.setInterval((()=>{var e;if(null!=this.sync)return;l.device.clearInterval(null!==(e=this.batchUpdates.timeout)&&void 0!==e?e:void 0),this.batchUpdates.changes.forEach((e=>e()));const t=this.batchUpdates;this.batchUpdates={timeout:null,changes:[],videoDevice:!1,audioDevice:!1,gain:!1,videoPaused:!1,audioMuted:!1,constraints:!1},t.audioDevice||t.videoDevice?this.applyNewDevices():!t.constraints||l.device.isImplements(l.Feature.APPLY_CONSTRAINTS)?(t.audioMuted&&this.applyAudioMute(),t.videoPaused&&this.applyVideoPause(),t.gain&&this.applyGain(),t.constraints&&this.applyConstraints()):this.applyConstraints()}),10))}setOptions(e){let t=!1;null!=e.replaceTracks&&(this.options.replaceTracks=e.replaceTracks),null!=e.requestAudioPermission&&(this.options.requestAudioPermission=e.requestAudioPermission),null!=e.defaultConstraints&&(this.options.defaultConstraints=Object.assign({},e.defaultConstraints),t=!0),void 0!==e.fallbackConstraints&&(this.options.fallbackConstraints=null==e.fallbackConstraints?null:Object.assign({},e.fallbackConstraints),t=!0),void 0!==e.capturable&&(this.capturable=e.capturable),t&&this.applyConstraints(),this.optionsAtom.reportChanged()}constraints({withAudio:e=!0,withVideo:t=!0}){return L({defaults:this.options.defaultConstraints,audioDeviceInfo:this.options.requestAudioPermission&&e?this.audioDeviceChanging:null,videoDeviceInfo:this.videoDisabled||!t?null:this.videoDeviceChanging,overrides:{aspectRatio:this.aspectRatio,autoGainControl:this.autoGainControl,echoCancellation:this.echoCancellation,facingMode:this.facingMode,frameRate:this.frameRate,noiseSuppression:this.noiseSuppression,resolution:null!=this.maxHeight&&0!==this.maxHeight&&null==this.resolution?{min:240,ideal:this.maxHeight,max:this.maxHeight}:this.resolution}})}fallbackConstraints({withAudio:e=!0,withVideo:t=!0}){return null==this.options.fallbackConstraints?null:L({defaults:this.options.fallbackConstraints,audioDeviceInfo:this.options.requestAudioPermission&&e?this.audioDeviceChanging:null,videoDeviceInfo:this.videoDisabled||!t?null:this.videoDeviceChanging,overrides:{aspectRatio:this.aspectRatio,autoGainControl:this.autoGainControl,echoCancellation:this.echoCancellation,facingMode:this.facingMode,frameRate:this.frameRate,noiseSuppression:this.noiseSuppression,resolution:null!=this.maxHeight&&0!==this.maxHeight&&null==this.resolution?{min:240,ideal:this.maxHeight,max:this.maxHeight}:this.resolution}})}activeConstraints(){var e,t,r,i,n,s;this.applyConstraintsAtom.reportObserved();const a={};try{if(this.hasActiveVideoTrack()&&(a.video=null===(r=null===(t=null===(e=this.source)||void 0===e?void 0:e.getVideoTracks())||void 0===t?void 0:t[0])||void 0===r?void 0:r.getConstraints()),this.hasActiveAudioTrack()){const e=null===(n=null===(i=this.source)||void 0===i?void 0:i.getAudioTracks())||void 0===n?void 0:n[0];if(null!=e){const t=null===(s=E.get(e))||void 0===s?void 0:s.originalTrack;a.audio=null!=t?t.getConstraints():e.getConstraints()}}}catch(e){this.logger.warn("unable to detect active constaints")}return a}stopTracksInternal({stream:e,audio:t,video:r}){C({stream:e,audio:t,video:r,removeEventListenerCb:e=>{"audio"===e.kind?e.removeEventListener("ended",this.handleAudioTrackEnded):e.removeEventListener("ended",this.handleVideoTrackEnded)}})}applyVideoPause(){var e;const{videoPaused:r}=this;(null===(e=this.videoDeviceChanged)||void 0===e?void 0:e.deviceId)!==t.VIDEO_DEVICE_SCREENCAPTURE.deviceId&&this.source.getVideoTracks().forEach((e=>{r?this.logger.debug("pause video track",{trackId:e.id}):this.logger.debug("unpause video track",{trackId:e.id}),e.enabled=!r}))}applyAudioMute(){const{audioMuted:e}=this;this.source.getAudioTracks().forEach((t=>{e?this.logger.debug("disable audio track",{trackId:t.id}):this.logger.debug("enable audio track",{trackId:t.id}),t.enabled=!e}))}applyNewDevices(){return i.__awaiter(this,void 0,void 0,(function*(){const{replaceTracks:e}=this.options,t=this.videoDisabled?null:this.videoDeviceChanging,r=this.audioDeviceChanging,i=this.videoDeviceChanged,n=this.audioDeviceChanged,s=t!==this.videoDeviceChanged,a=this.audioDeviceChanging!==this.audioDeviceChanged;if(null==t&&null==r)return void(0,o.action)("applyNewDevices",(()=>{l.device.isImplements(l.Feature.MEDIA_STREAM)&&(this.audioDeviceChanged=r,this.videoDeviceChanged=t,this.stopTracksInternal({stream:this.source}),this.source=new l.device.MediaStream)}))();this.logger.debug("preparing new devices",{videoDevice:t,audioDevice:r,videoChanged:s,audioChanged:a,replaceTracks:e});let c=null;const d=this.source;if(e)try{yield this.handleUpdateResolutions({videoDevice:t,videoChanged:s,videoDeviceOld:i}),c=yield this.lockAndPrepareStream(t,this.options.defaultLockPolicy,this.constraints({withAudio:a,withVideo:s}),this.fallbackConstraints({withAudio:a,withVideo:s})),this.stopTracksInternal({stream:d,audio:a,video:s})}catch(e){return void this.handleNewStreamError({newStream:c,err:e,deviceState:{videoDevice:t,audioDevice:r,videoDeviceOld:i,audioDeviceOld:n,videoChanged:s,audioChanged:a}})}else try{this.stopTracksInternal({stream:d,audio:a,video:s}),yield this.handleUpdateResolutions({videoDevice:t,videoChanged:s,videoDeviceOld:i}),c=yield this.lockAndPrepareStream(t,this.options.defaultLockPolicy,this.constraints({withAudio:a,withVideo:s}),this.fallbackConstraints({withAudio:a,withVideo:s}))}catch(e){return void this.handleNewStreamError({newStream:c,err:e,deviceState:{videoDevice:t,audioDevice:r,videoDeviceOld:i,audioDeviceOld:n,videoChanged:s,audioChanged:a}})}for(const e of d.getTracks())d.removeTrack(e),c.addTrack(e);const u=c;(0,o.action)("applyNewDevices",(()=>{this.audioDeviceChanged=r,this.videoDeviceChanged=t,this.source=u,this.logger.info("applied new devices",{videoDevice:t,audioDevice:r})}))()}))}handleNewStreamError({newStream:e,err:t,deviceState:r}){var i,n,s,a,l,d,u,h;const{videoDevice:f,audioDevice:m,videoDeviceOld:g,audioDeviceOld:v,videoChanged:_,audioChanged:y}=r;this.stopTracksInternal({stream:e}),_&&this.emitError((0,p.createError)(c.ErrorCode.MediaDeviceChangingFailed,"unable to change video device",{deviceId:null!==(i=null==f?void 0:f.deviceId)&&void 0!==i?i:null,deviceLabel:null!==(n=null==f?void 0:f.label)&&void 0!==n?n:null,prevDeviceId:null!==(s=null==g?void 0:g.deviceId)&&void 0!==s?s:null,prevDeviceLabel:null!==(a=null==g?void 0:g.label)&&void 0!==a?a:null,kind:"video"},t)),y&&this.emitError((0,p.createError)(c.ErrorCode.MediaDeviceChangingFailed,"unable to change audio device",{deviceId:null!==(l=null==m?void 0:m.deviceId)&&void 0!==l?l:null,deviceLabel:null!==(d=null==m?void 0:m.label)&&void 0!==d?d:null,prevDeviceId:null!==(u=null==v?void 0:v.deviceId)&&void 0!==u?u:null,prevDeviceLabel:null!==(h=null==v?void 0:v.label)&&void 0!==h?h:null,kind:"audio"},t)),this.emit("changeDevicesError",{err:t,audio:{old:v,new:m},video:{old:g,new:f}}),null==this.sync&&(0,o.action)("rollbackDevices",(()=>{this.videoDeviceChanging=g,this.audioDeviceChanging=v}))()}handleUpdateResolutions(e){var r,n,s,a;return i.__awaiter(this,void 0,void 0,(function*(){const{videoDevice:i,videoDeviceOld:o,videoChanged:l}=e;if(l&&i!==t.VIDEO_DEVICE_SCREENCAPTURE&&i!==t.VIDEO_DEVICE_CAPTURABLE)try{yield this.updateResolutions(i)}catch(e){this.emitError((0,p.createError)(c.ErrorCode.UpdateResolutionsFailed,"unable to update available resolutions",{kind:"video",deviceId:null!==(r=null==i?void 0:i.deviceId)&&void 0!==r?r:null,deviceLabel:null!==(n=null==i?void 0:i.label)&&void 0!==n?n:null,prevDeviceId:null!==(s=null==o?void 0:o.deviceId)&&void 0!==s?s:null,prevDeviceLabel:null!==(a=null==o?void 0:o.label)&&void 0!==a?a:null},e))}}))}updateResolutions(e){return i.__awaiter(this,void 0,void 0,(function*(){if(!this.options.replaceTracks&&this.source.getVideoTracks().some((e=>"live"===e.readyState)))throw new Error("attempt to get resolutions with replaceTracks enabled and running stream");const t=null==e?void 0:e.deviceId;if(null==t)return void(0,o.runInAction)((()=>{this.maxWidth=0,this.maxHeight=0,this.availableResolutions=[]}));const r="number"==typeof this.aspectRatio?this.aspectRatio:16/9;let i=null,n=null;if(null==S[t]){const r=yield this.lockAndPrepareStream(e,c.ExistsStreamPolicy.error,{video:{deviceId:{exact:t}}});S[t]=function(e,t){var r,i,n,s;const a=e.getVideoTracks()[0];if(null==a)return[null,null];const o=function(e,t){var r,i;let n;try{n=null!==(i=null===(r=null==e?void 0:e.getCapabilities)||void 0===r?void 0:r.call(e))&&void 0!==i?i:{},null==t||t.debug("videoTrack capabilities",{capabilities:n})}catch(e){n={}}return n}(a,t),c=A(a),d=null!==(i=null===(r=null==o?void 0:o.width)||void 0===r?void 0:r.max)&&void 0!==i?i:null==c?void 0:c.width;let u=null!==(s=null===(n=null==o?void 0:o.height)||void 0===n?void 0:n.max)&&void 0!==s?s:null==c?void 0:c.height;const h=l.device.isMobileDevice?1080:2160;return null!=u&&u>h&&(u=h),null==u||null==d?[null,null]:(null==t||t.debug("adjusted maxHeight",{adjuestedMaxHeight:u}),[d,u])}(r,this.logger),this.stopTracksInternal({stream:r})}[i,n]=S[t];const s=b.filter((e=>null!=i&&null!=n&&e<=n&&e*r<=i));(0,o.runInAction)((()=>{this.maxWidth=i,this.maxHeight=n,this.availableResolutions=s}))}))}applyConstraintsVideo(e,t,r){var n;return i.__awaiter(this,void 0,void 0,(function*(){if(l.device.isImplements(l.Feature.APPLY_CONSTRAINTS)){this.logger.debug("apply video constraints",{defaultVideo:r,fallbackVideo:t}),l.device.isImplements(l.Feature.BROWSER_TYPE)&&"safari"===l.device.browserInfo.name&&delete r.deviceId;try{yield l.device.applyConstraints(e,r)}catch(i){this.logger.warn("unable to apply video constraints",{defaultVideo:r});const s=i instanceof Error||(0,d.isErrorLike)(i)?i:null,o=this.activeConstraints(),c=(0,a.diff)(r,null!==(n=o.video)&&void 0!==n?n:{});this.emit("videoConstraintsError",{diff:c,isFallback:!1,constraints:r,err:(0,p.wrapError)(s)}),null!=t&&"boolean"!=typeof t&&(this.logger.debug("trying fallback video constraints",{fallbackVideo:t}),l.device.applyConstraints(e,t).catch((i=>{var n;const s=i instanceof Error||(0,d.isErrorLike)(i)?i:null,o=this.activeConstraints(),c=(0,a.diff)(t,null!==(n=o.video)&&void 0!==n?n:{});null!=s&&(0,d.isOverconstrainedError)(s)&&"height"===s.constraint?(this.logger.error("Unable to apply selected resolution, please select a resolution supported by your current video device.",{fallbackConstraints:t,defaultConstraints:r,trackId:e.id,trackType:e.kind,err:(0,p.wrapError)(s)}),this.emit("videoConstraintsError",{diff:c,isFallback:!0,constraints:t,err:(0,p.wrapError)(s)})):(this.logger.error("Unable to apply video constraints. Try restarting the stream.",{fallbackConstraints:t,defaultConstraints:r,trackId:e.id,trackType:e.kind,err:(0,p.wrapError)(s)}),this.emit("videoConstraintsError",{diff:c,isFallback:!0,constraints:t,err:(0,p.wrapError)(s)}))})))}}}))}applyConstraintsAudio(e,t,r){var n,s;return i.__awaiter(this,void 0,void 0,(function*(){if(l.device.isImplements(l.Feature.APPLY_CONSTRAINTS))try{l.device.isImplements(l.Feature.BROWSER_TYPE)&&"safari"===l.device.browserInfo.name&&delete t.deviceId,yield l.device.applyConstraints(e,t)}catch(i){this.logger.warn("unable to apply constraints",{defaultAudio:t});const o=i instanceof Error||(0,d.isErrorLike)(i)?i:null,c=this.activeConstraints(),u=(0,a.diff)(t,null!==(n=c.audio)&&void 0!==n?n:{});if(this.emit("audioConstraintsError",{diff:u,isFallback:!1,constraints:t,err:(0,p.wrapError)(o)}),null!=r&&"boolean"!=typeof r){this.logger.debug("trying fallback apply constraints",{fallbackAudio:r});const i=this.activeConstraints(),n=(0,a.diff)(r,null!==(s=i.audio)&&void 0!==s?s:{});l.device.applyConstraints(e,r).catch((i=>{const s=i instanceof Error||(0,d.isErrorLike)(i)?i:null;this.logger.error("unable to apply audio constraints. restart stream",{fallbackConstraints:r,defaultConstraints:t,trackId:e.id,trackType:e.kind,err:(0,p.wrapError)(s)}),this.emit("audioConstraintsError",{diff:n,isFallback:!0,constraints:r,err:(0,p.wrapError)(s)})}))}}}))}applyConstraints(){return i.__awaiter(this,void 0,void 0,(function*(){if(null==this.audioDeviceChanging&&null==this.videoDeviceChanging)return;if(!l.device.isImplements(l.Feature.APPLY_CONSTRAINTS)){this.stopTracksInternal({stream:this.source});try{this.source=yield this.lockAndPrepareStream(this.videoDeviceChanging,this.options.defaultLockPolicy,this.constraints({withAudio:!0,withVideo:!0}),this.fallbackConstraints({withAudio:!0,withVideo:!0}))}catch(e){this.emitError((0,p.createError)(c.ErrorCode.ApplyingConstraintsFailed,"applying constraints failed",{constraints:this.constraints({withAudio:!0,withVideo:!0}),fallbackConstraints:this.fallbackConstraints({withAudio:!0,withVideo:!0})},e))}return}const e=this.source,t=this.constraints({withAudio:!0,withVideo:!0}),r=this.fallbackConstraints({withAudio:!0,withVideo:!0}),i=[],n=t.video,s=null==r?void 0:r.video,a=t.audio,o=null==r?void 0:r.audio;null!=n&&"boolean"!=typeof n&&i.push(...e.getVideoTracks().filter((e=>"ended"!==e.readyState)).map((e=>this.applyConstraintsVideo(e,s,n)))),null!=a&&"boolean"!=typeof a&&i.push(...e.getAudioTracks().map((e=>{var t;return null!=(null===(t=E.get(e))||void 0===t?void 0:t.originalTrack)?E.get(e).originalTrack:e})).filter((e=>e)).map((e=>this.applyConstraintsAudio(e,a,o)))),yield Promise.all(i),this.applyConstraintsAtom.reportChanged()}))}supportsNoiseSuppression(){var e;if(l.device.isImplements(l.Feature.MEDIA_DEVICE))try{return null!==(e=l.device.mediaDevices.getSupportedConstraints().noiseSuppression)&&void 0!==e&&e}catch(e){return!1}return!1}supportsEchoCancellation(){var e;if(l.device.isImplements(l.Feature.MEDIA_DEVICE))try{return null!==(e=l.device.mediaDevices.getSupportedConstraints().echoCancellation)&&void 0!==e&&e}catch(e){return!1}return!1}applyGain(){return i.__awaiter(this,void 0,void 0,(function*(){const e=this.source.getAudioTracks()[0],t=E.get(e);if(null!=(null==t?void 0:t.gainNode)){const r=P(e);this.noEchoGainAmplifier&&!1===r.echoCancellation?t.gainNode.gain.value=10*this.gain:t.gainNode.gain.value=this.gain,this.applyConstraintsAtom.reportChanged()}}))}lockAndPrepareStream(e,r,n,s){return i.__awaiter(this,void 0,void 0,(function*(){const i=e===t.VIDEO_DEVICE_SCREENCAPTURE?"screencapture":e===t.VIDEO_DEVICE_CAPTURABLE?"captureable":"media";if(!1===n.audio&&!1===n.video&&l.device.isImplements(l.Feature.MEDIA_STREAM))return new l.device.MediaStream;if(this.logger.trace("lockAndPrepareStream()",{policy:c.ExistsStreamPolicy[r],constraints:n}),null!=this.sync)switch(r){case c.ExistsStreamPolicy.error:this.throwError((0,p.createError)(c.ErrorCode.MediaStreamPreparingConflict,"MediaStream is preparing already",{}));break;case c.ExistsStreamPolicy.stale:return this.logger.debug("stream is preparing already, waiting"),this.sync;case c.ExistsStreamPolicy.wait:return yield this.sync,new Promise(((t,i)=>{l.device.setTimeout((()=>{this.lockAndPrepareStream(e,r,n,s).then(t).catch(i)}),this.options.waitingDelay)}));case c.ExistsStreamPolicy.ignore:this.sync.then((e=>{this.stopTracksInternal({stream:e})}));break;default:throw new Error(`Unknown policy MediaStream ${r}`)}return this.sync=this.prepareStream(i,n).catch((e=>{if(null!=s&&"media"===i)return this.logger.warn("constraints failed. using fallback constraints",{constraints:n,fallbackConstraints:s,err:e}),this.prepareStream(i,s);throw e})),this.sync.finally((()=>{this.sync=null}))}))}prepareStream(e,t){var r,n;return i.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("prepareStream() start",{constraints:t});let i=null;if(i="screencapture"===e?yield this.prepareScreenCaptureStream({audio:t.audio,video:this.options.defaultConstraints.screencapture}):"captureable"===e?yield this.prepareCapturableStream({audio:t.audio}):yield this.prepareMediaStream(t),"media"===e&&i.getVideoTracks().forEach((e=>{e.addEventListener("ended",this.handleVideoTrackEnded)})),i.getAudioTracks().forEach((e=>{e.addEventListener("ended",this.handleAudioTrackEnded)})),!1!==t.audio){const e=this.noEchoGainAmplifier&&"boolean"!=typeof t.audio&&!1===(null===(r=t.audio)||void 0===r?void 0:r.echoCancellation)?10*this.gain:this.gain;i=function(e,t,r){if(!l.device.isImplements(l.Feature.AUDIO_CONTEXT))return t;if(!t.getAudioTracks().length)return t;if(e.debug("attach gain controller to stream"),null==T&&(T=new l.device.AudioContext),null==T.createAnalyser||null==T.createGain||null==T.createMediaStreamSource||null==T.createMediaStreamDestination)return t;const i=T.createGain(),n=T.createMediaStreamSource(t),s=T.createMediaStreamDestination(),a=s.stream;n.connect(i),i.connect(s),i.gain.value=r;const o=t.getAudioTracks()[0],c=a.getAudioTracks()[0];if(null==o||null==c)throw new Error("no audio tracks");const d=function(e){var t,r,i;const n=E.get(e);if(null!=(null==n?void 0:n.deviceId))return n.deviceId;const s=A(e),a=P(e),o=null!==(t=null==s?void 0:s.deviceId)&&void 0!==t?t:"object"==typeof(null==a?void 0:a.deviceId)?a.deviceId.exact:Array.isArray(a.deviceId)?a.deviceId[0]:a.deviceId;return null!=o?o.toString():null!==(i=null===(r=g.find((t=>t.label===e.label)))||void 0===r?void 0:r.deviceId)&&void 0!==i?i:null}(o);null!=d&&E.set(c,{deviceId:d,originalTrack:o,gainNode:i}),t.getVideoTracks().forEach((e=>{a.addTrack(e)}));const u=()=>{e.debug("modified audio track is ended. stopping original one",{originalTrack:o.id}),o.stop(),c.removeEventListener("ended",u)};return c.addEventListener("ended",u),a}(this.logger,i,e)}for(const e of null!==(n=null==i?void 0:i.getTracks())&&void 0!==n?n:[])"ended"===e.readyState&&this.throwError((0,p.createError)(c.ErrorCode.MediaTrackEnded,"track ended unexpectedly",{trackId:e.id,kind:e.kind})),"video"===e.kind&&(e.enabled=!this.videoPaused),"audio"===e.kind&&(e.enabled=!this.audioMuted);return this.logger.trace("prepareStream() finished"),i}))}handleAudioTrackEnded(){return i.__awaiter(this,void 0,void 0,(function*(){yield t.mediaController.enumerateDevices(),(null==g?void 0:g.some((e=>"audioinput"===e.kind&&e.deviceId===this.audioDeviceId)))||(this.logger.warn("Audio device no longer exists in list of available devices, check to see if device was removed"),this.emit("audioDeviceRemoved",this.audioDeviceId),this.audioDeviceId=null)}))}handleVideoTrackEnded(){return i.__awaiter(this,void 0,void 0,(function*(){this.logger.warn("video track has ended unexpectedly (perm revoked?)"),yield t.mediaController.enumerateDevices(),(null==g?void 0:g.some((e=>"videoinput"===e.kind&&e.deviceId===this.videoDeviceId)))||(this.logger.warn("Video device no longer exists in list of available devices, check to see if device was removed"),this.emit("videoDeviceRemoved",this.videoDeviceId),this.videoDeviceId=null)}))}prepareMediaStream(e){return i.__awaiter(this,void 0,void 0,(function*(){return this.logger.trace("prepareMediaStream()"),l.device.isImplements(l.Feature.MEDIA_DEVICE)&&null!=l.device.mediaDevices.getUserMedia||this.throwError((0,p.createError)(c.ErrorCode.MediaDeviceNotSupported,"MediaDevices not supported",{})),this.logger.debug("using constraints",{constraints:e}),l.device.mediaDevices.getUserMedia(e)}))}prepareScreenCaptureStream(e){var r,n;return i.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("prepareScreenCaptureStream()",{constraints:e});let i=null,s=null;if(l.device.isImplements(l.Feature.MEDIA_STREAM)&&l.device.isImplements(l.Feature.MEDIA_DEVICE)&&"function"==typeof l.device.mediaDevices.getDisplayMedia){const t=null===(n=null===(r=l.device.mediaDevices)||void 0===r?void 0:r.getDisplayMedia)||void 0===n?void 0:n.call(r,{video:e.video});if(null!=t)try{i=yield t}catch(e){throw this.videoDeviceChanging=null,e}s=!1!==e.audio?yield this.prepareMediaStream({audio:e.audio}):new l.device.MediaStream}if(null==i||null==s)throw new Error("unable to capture screen");return i.getTracks().forEach((e=>{E.set(e,{deviceId:t.VIDEO_DEVICE_SCREENCAPTURE.deviceId}),null==s||s.addTrack(e)})),s}))}prepareCapturableStream(e){var r,n;return i.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("prepareCapturableStream()",{constraints:e});let i=null,s=null;if(l.device.isImplements(l.Feature.MEDIA_STREAM)&&null!=(null===(r=this.capturable)||void 0===r?void 0:r.element)&&l.device.supportsMediaStreamCapture(null===(n=this.capturable)||void 0===n?void 0:n.element)?i=this.capturable.element.captureStream(this.capturable.framerate):this.logger.warn("unable to support stream capture"),l.device.isImplements(l.Feature.MEDIA_DEVICE)&&l.device.isImplements(l.Feature.MEDIA_STREAM)&&(s=!1===e.audio||null==e.audio?new l.device.MediaStream:yield this.prepareMediaStream({audio:e.audio})),null==i||null==s)throw new Error(`prepareCapturableStream(): unable to generate MediaStream from provided inputs. CapturableStream is null: ${null==i}. Base MediaStream is null: ${null==s}`);return i.getTracks().forEach((e=>{E.set(e,{deviceId:t.VIDEO_DEVICE_CAPTURABLE.deviceId}),null==s||s.addTrack(e)})),s}))}close(e="not provided"){var t;try{this.stopTracksInternal({stream:this.source}),this.audioDeviceChanging=null,this.videoDeviceChanging=null,this.logger.info("MediaController Class close()",{aggregates:{reason:e}})}catch(t){this.emitError((0,p.createError)(c.ErrorCode.DisposingError,"unable to dispose media stream controller",{className:I.displayName,reason:e},t))}null===(t=this.audioCtx)||void 0===t||t.close().catch((()=>{}))}toJSON(){var e,t,r;return{audioMuted:this.audioMuted,videoPaused:this.videoPaused,videoDisabled:this.videoDisabled,inAudioDeviceTransition:this.inAudioDeviceTransition,inVideoDeviceTransition:this.inVideoDeviceTransition,hasSync:null!=this.sync,mscOptions:{replaceTracks:null===(e=this.options)||void 0===e?void 0:e.replaceTracks,waitingDelay:null===(t=this.options)||void 0===t?void 0:t.waitingDelay,defaultLockPolicy:null===(r=this.options)||void 0===r?void 0:r.defaultLockPolicy},aggregates:{audioDeviceId:this.audioDeviceId,videoDeviceId:this.videoDeviceId}}}}t.MediaStreamController=I,I.displayName="MediaStreamController"},6772:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(7582),n=r(8949),s=r(167),a=r(4280),o=r(3199),c=r(644),l=r(327),d=r(2914),u=["aac"];class h extends l.ObservableEventEmitter{constructor(e,t,r){super(),this.source=null,this.currentState="offline",this.formats={},this.uri=null,this.originalAuthToken=null,this.viewCount=0,this.pingUri=null,this.destroyed=!1,this.shouldBePolling=!1,this.manifest=null,this.type=null,this.pollingTimeout=null,this.noLongerUnauthorizedPolling=!1,this.unauthorizedRecoveryTimout=null,this.ctx=e,(0,c.onceCanceled)(e).then((e=>this.dispose(`MediaLoader Class Context Closed: ${e}`))),(0,n.makeObservable)(this,{source:n.observable.ref}),this.currentState="offline",this.formats={},this.pingUri=null,this.destroyed=!1,this.options=r,this.setManifest(t),this.setUri(t),this.shouldBePolling=!1,e.logger.attachObject(this),e.logger.trace("constructor()",{manifest:t}),this.addInnerDisposer((()=>{var e;this.destroyed=!0,clearInterval(null!==(e=this.pollingTimeout)&&void 0!==e?e:0)}))}static modifyFormats(e){for(const t of Object.keys(e))if("mp4-ws"===t){const r=e[t];null!=(null==r?void 0:r.origin)&&u.includes(r.audioCodec)&&(r.origin=void 0)}return e}load(e=!1){var t,r,n,c,l,u,p,f,m,g,v;return i.__awaiter(this,void 0,void 0,(function*(){if(null!=this.manifest||this.vod)return this.emit("manifest",{state:this.currentState,formats:this.formats}),void(null!=this.manifest&&"string"!=typeof this.manifest&&(this.source=this.manifest));if(null==this.uri)return;this.ctx.logger.debug("loading manifest",{uri:this.uri});let i,_,y=null,b=null;const E=this.uri.split("?");let S;S=null!==(t=E[1])&&void 0!==t?t:"",S=(0,d.removeSearchParameterFromUrl)(S,"img"),S=`${S}&img=${e.toString()}`,S=(0,d.removeSearchParameterFromUrl)(S,"vdc"),(null==(null===(n=null===(r=this.options)||void 0===r?void 0:r.urlParams)||void 0===n?void 0:n.vdc)||(null===(l=null===(c=this.options)||void 0===c?void 0:c.urlParams)||void 0===l?void 0:l.vdc))&&(S=`${S}&vdc=true`),S=(0,d.removeSearchParameterFromUrl)(S,"sbp"),(null==(null===(p=null===(u=this.options)||void 0===u?void 0:u.urlParams)||void 0===p?void 0:p.substitute)||(null===(m=null===(f=this.options)||void 0===f?void 0:f.urlParams)||void 0===m?void 0:m.substitute))&&(S=`${S}&sbp=true`);const w=`${E[0]}?${S}`;try{y=yield a.device.fetch(w,Object.assign({method:"GET"},null!=this.options.requestHeaders&&{headers:this.options.requestHeaders})),i=y.status}catch(e){i=null!==(g=null==y?void 0:y.status)&&void 0!==g?g:0,b=(0,o.createError)(s.ErrorCode.NetworkError,"Internal Error",{status:i})}if(this.isDisposed)return;i>499?b=(0,o.createError)(s.ErrorCode.NetworkError,"Internal Error",{status:i}):404===i?b=(0,o.createError)(s.ErrorCode.NetworkError,"Not Found",{status:i}):403===i?b=(0,o.createError)(s.ErrorCode.NetworkError,"Forbidden",{status:i}):401===i&&(b=(0,o.createError)(s.ErrorCode.NetworkError,"Unauthorized",{status:i}));let T=null;b||null==y||(_=yield y.json(),T=this.validateResponse(_)?_:null),b||null!=T||(b=(0,o.createError)(s.ErrorCode.NetworkError,"Unexpected Response",{status:i})),null!=b&&(404===i?this.ctx.logger.debug("manifest not found"):this.emitError(b)),this.ctx.logger.debug("manifest received",{body:T,code:i,uri:this.uri});let R=null;if(404===i||null==T||null==T.formats)R="offline";else if(200===i&&null!=T.self){let{self:e}=T;if(!e.includes("://")&&this.uri.includes("://")){const t=/(\w*:\/\/[^/]+)/.exec(this.uri);(null!==(v=null==t?void 0:t.length)&&void 0!==v?v:0)>1&&(e=`${null==t?void 0:t[1]}/${e}`)}this.uri=e}if(null==R&&null!=(null==T?void 0:T.formats)&&(this.formats=h.modifyFormats(T.formats),R=0===Object.keys(this.formats).length?"offline":"online"),"online"===R&&null!=(null==T?void 0:T.viewCount)&&(this.viewCount=T.viewCount),null==R){const e=i>=400?"Network error while retrieving manifest":"Invalid manifest";this.throwError((0,o.createError)(s.ErrorCode.ManifestError,e,{url:this.uri},b))}R!==this.currentState&&this.emit(R),this.currentState=R,this.pingUri=null!=(null==T?void 0:T.ping)?T.ping:null,this.type=null!=(null==T?void 0:T.type)?T.type:"live",this.emit("manifest",{state:this.currentState,code:i,formats:this.formats,viewCount:this.viewCount}),null!=T&&(this.source=T),"recorded"!==(null==T?void 0:T.type)&&this.setNextPoll(i)}))}setNextPoll(e){var t;if(this.vod)return;a.device.clearTimeout(null!==(t=this.pollingTimeout)&&void 0!==t?t:0);let r=this.options.pollingInterval;switch(e){case 401:case 403:if(this.noLongerUnauthorizedPolling)return this.currentState="forbidden",void this.emit("manifest",{state:this.currentState,code:e,formats:this.formats});r=this.options.unauthorizedPollingInterval,null==this.unauthorizedRecoveryTimout&&(this.unauthorizedRecoveryTimout=a.device.setTimeout((()=>{this.noLongerUnauthorizedPolling=!0}),this.options.unauthorizedRecoveryDuration));break;case 404:r=this.options.notFoundPollingInterval;break;default:this.noLongerUnauthorizedPolling=!1}this.pollingTimeout=a.device.setTimeout((()=>{this.load().catch((e=>this.emit("error",e)))}),r)}setManifest(e){var t,r,i,n;if(this.type=null,this.formats={},"string"==typeof e?this.uri=e:this.validateResponse(e)&&(this.uri=null!==(t=e.self)&&void 0!==t?t:null,this.manifest=e,this.currentState="online",this.type=null!==(r=this.manifest.type)&&void 0!==r?r:null,this.formats=null!==(i=this.manifest.formats)&&void 0!==i?i:{}),null==this.uri)return;const s=this.uri.indexOf("accessToken=");if(s>-1){const e=this.uri.slice(s+12),t=null!==(n=e.indexOf("&"))&&void 0!==n?n:-1;this.originalAuthToken=t>-1?e.slice(0,t):e}}get hasPlayableMedia(){return null!=this.uri||null!=this.manifest}validateResponse(e){var t,r,i;try{const n=null===(t=e.formats)||void 0===t?void 0:t.webrtc;null!=n&&("string"==typeof(null===(r=n.origin)||void 0===r?void 0:r.location)&&(n.origin.location=null===(i=n.origin)||void 0===i?void 0:i.location.replace(/https?:\/\/(https?):?\/\//,"$1://")),"string"==typeof n.origin.rsrc&&(n.origin.rsrc=n.origin.rsrc.replace(/:3000:3000/,":3000")))}catch(e){return this.emitError((0,o.createError)(s.ErrorCode.BadManifest,"bad manifest",{},e)),!1}return!0}setUri(e){return null==e?null!=this.uri:"string"==typeof e?(this.uri=e,!0):this.validateResponse(e)?(this.manifest=e,null!=e.self&&(this.uri=e.self),!0):(this.emitError((0,o.createError)(s.ErrorCode.BadManifest,"Invalid Media URL",{})),!1)}get(e){var t;const r=this.formats[e];if(null==r)return{encodings:[],state:"online",auto:!1,driver:""};let i,n=[];return"origin"in r&&null!=r.origin&&(i=r.origin,i.origin=!0),"encodings"in r&&null!=r.encodings&&(n=r.encodings.sort(((e,t)=>{var r,i,n,s;return(null!==(r=e.videoKbps)&&void 0!==r?r:0)+(null!==(i=e.audioKbps)&&void 0!==i?i:0)>(null!==(n=t.videoKbps)&&void 0!==n?n:0)+(null!==(s=t.audioKbps)&&void 0!==s?s:0)?1:-1}))),{type:null!==(t=this.type)&&void 0!==t?t:void 0,origin:null!=i?i:void 0,encodings:n,audioCodec:"audioCodec"in r?r.audioCodec:void 0,videoCodec:"videoCodec"in r?r.videoCodec:void 0,manifest:"manifest"in r?r.manifest:void 0,state:"online",auto:!1,driver:""}}get vod(){return"recorded"===this.type}startInterval(){null==this.options.pollingInterval||null!=this.manifest||this.vod?this.shouldBePolling=!1:this.shouldBePolling=!0}toJSON(){return{uri:this.uri,options:this.options,aggregates:{support:this.ctx.support.hash,state:this.currentState}}}}h.displayName="MediaLoader",t.default=h},8101:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MediasoupSource=void 0;const i=r(4702),n=r(8949),s=r(167),a=r(4280),o=r(3199),c=r(9182),l=r(327),d={replaceTracks:!0};class u extends l.ObservableEventEmitter{constructor(e,t,r,i=d){var c;super(),this.consumers={},this.currentQuality=null,this.availableQualities=[],this.ctx=e,(0,n.makeObservable)(this,{currentQuality:n.observable.ref,availableQualities:n.observable.shallow}),a.device.isImplements(a.Feature.MEDIA_STREAM)||this.throwError((0,o.createError)(s.ErrorCode.MediaStreamNotSupported,"MediaStream is not supported by device",{})),this.options=i,this.peer=t,this.streamName=r,this.stream=new a.device.MediaStream,null===(c=this.peer.call)||void 0===c||c.on("accessDenied",this.handlePeerAccessDenied),this.addInnerDisposer((()=>{var e;null===(e=this.peer.call)||void 0===e||e.removeListener("accessDenied",this.handlePeerAccessDenied)})),e.logger.attachObject(this),e.logger.trace("constructor()")}handlePeerAccessDenied(e){this.emit("accessDenied",e)}get source(){return this.stream}get consumerIds(){return Object.keys(this.consumers)}addConsumer(e,t=!0){if(!e.dontAdd){if("video"===e.track.kind&&this.stream.getVideoTracks().length>0&&this.stream.getVideoTracks().forEach((e=>this.stream.removeTrack(e))),"audio"===e.track.kind&&this.stream.getAudioTracks().length>0&&this.stream.getAudioTracks().forEach((e=>this.stream.removeTrack(e))),"video"===e.track.kind){const t=(0,c.fetchManifestQualities)(e.layers,null);(0,n.runInAction)((()=>{this.availableQualities=t;const r=e.activeLayer;if(null!=r){const t=this.availableQualities.find((e=>{var t;return(null===(t=e.layer)||void 0===t?void 0:t.id)===r.id}));null!=t?this.currentQuality=t:this.ctx.logger.warn("Consumer refers to a layer which doesn't exist",{layers:e.layers,activeLayer:e.activeLayer})}}))}this.stream.addTrack(e.track)}this.consumers[e.id]=e,t&&!e.dontAdd&&this.emit("source",this.stream)}removeConsumer(e,t=!0){const r=this.consumers[e];null!=r&&(this.stream.removeTrack(r.track),delete this.consumers[e],this.stream.getTracks().length>0&&t&&this.emit("source",this.stream))}swapConsumers(e,t){t.forEach((e=>{this.stream.removeTrack(e)})),e.forEach((e=>{this.stream.addTrack(e)})),this.emit("source",this.stream)}pauseConsumer(e){const t=this.consumers[e];null!=t&&(t.paused=!0,this.stream.getTracks().some((e=>e.id===t.track.id))&&("video"===t.kind?this.emit("videoPaused",t.paused):this.emit("audioMuted",t.paused)))}resumeConsumer(e){const t=this.consumers[e];null!=t&&(t.paused=!1,this.stream.getTracks().some((e=>e.id===t.track.id))&&("video"===t.kind?this.emit("videoPaused",t.paused):this.emit("audioMuted",t.paused)))}consumerLayersChanged(e){const t=this.availableQualities.find((t=>{var r;return(null===(r=t.layer)||void 0===r?void 0:r.id)===e.id}));null!=t&&(this.currentQuality=t)}consumerSourcesChanged(e){const t=(0,c.fetchManifestQualities)(e,null);this.availableQualities=t}getTracks(){return this.stream.getTracks()}get hasAudio(){return Object.values(this.consumers).some((e=>"audio"===e.kind&&!1===e.dontAdd))}get hasVideo(){return Object.values(this.consumers).some((e=>"video"===e.kind&&!1===e.dontAdd))}get audioMuted(){const e=Object.values(this.consumers).filter((e=>"audio"===e.kind&&!1===e.dontAdd));return 0===e.length||e.some((e=>e.paused))}get videoPaused(){const e=Object.values(this.consumers).filter((e=>"video"===e.kind&&!1===e.dontAdd));return 0===e.length||e.some((e=>e.paused))}toJSON(){return{hasAudio:this.hasAudio,hasVideo:this.hasVideo,audioMuted:this.audioMuted,videoPaused:this.videoPaused,options:this.options,aggregates:Object.assign(Object.assign({},(0,i.extractAggregates)(this.peer,"support")),{support:this.ctx.support.hash,streamName:this.streamName})}}}t.MediasoupSource=u,u.displayName="MediasoupSource"},6214:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Peer=void 0;const i=r(4702),n=r(8949),s=r(813),a=r(3199),o=r(8101),c=r(6395),l=r(644),d=r(327),u=r(2149);class h extends d.ObservableEventEmitter{constructor(e,t,r,i,s){super(),this.remoteSources=new Map,(0,n.makeObservable)(this,{remoteSources:n.observable,streams:n.computed,players:n.computed}),this.ctx=e,this.call=t,this.pvcCall=r,this.playerOptions=null!=s?s:{},this.pvcCall.on("CALL_ADD_CONSUMER",this.addConsumer),this.pvcCall.on("CALL_REMOVE_CONSUMER",this.removeConsumer),this.pvcCall.on("CALL_SWAP_CONSUMERS",this.swapConsumers),this.pvcCall.on("CALL_SET_CONSUMER_PAUSED",this.pauseConsumer),this.pvcCall.on("CALL_SET_CONSUMER_RESUMED",this.resumeConsumer),this.pvcCall.on("CALL_CONSUMER_LAYER_CHANGED",this.layerChanged),this.pvcCall.on("CALL_CONSUMER_SOURCES",this.sourcesChanged),(0,l.onceCanceled)(e).then((e=>this.dispose(`Peer Context Cancelled: ${e}`))),this.peerParams=i,e.logger.attachObject(this),e.logger.trace("constructor()"),this.addInnerDisposer(this.close)}get streams(){return Array.from(this.remoteSources.values()).map((e=>e.provider))}get players(){return Array.from(this.remoteSources.values()).map((e=>e.player))}get peerId(){var e;return null!==(e=this.peerParams.peerId)&&void 0!==e?e:""}get userId(){var e;return null!==(e=this.peerParams.userId)&&void 0!==e?e:""}get appData(){var e;return null!==(e=this.peerParams.appData)&&void 0!==e?e:{}}addConsumer({peerId:e,streamName:t,consumer:r}){var i,n,l;if(e===this.peerParams.peerId){this.ctx.logger.debug("addConsumer()",{streamName:t,consumerId:r.id});try{const e=this.remoteSources.get(t);if(null==e){const e=new o.MediasoupSource((0,u.extendContext)(this.ctx,o.MediasoupSource),this,t),s=Object.assign({autoPlay:null===(l=null===(n=null===(i=null==this?void 0:this.ctx)||void 0===i?void 0:i.videoClient)||void 0===n?void 0:n.options)||void 0===l?void 0:l.autoPlay},this.playerOptions),a=new c.MediasoupPlayer((0,u.extendContext)(this.ctx,c.MediasoupPlayer),e,s);this.emit("videoConsumer"),e.addConsumer(r),this.remoteSources.set(t,{player:a,provider:e}),this.emit("playerAdded",{player:a,streamName:t,peer:this}),this.emit("streamAdded",{stream:e,streamName:t,peer:this})}else e.provider.addConsumer(r)}catch(t){let i="Consumer has not created";(0,s.isVideoClientError)(t)&&t.code===a.ErrorCode.MediaStreamNotSupported&&(i="Consumer has not created because MediaStream is not supported"),this.emitError((0,a.createError)(a.ErrorCode.ConsumerNotCreated,i,{consumerId:r.id,peerId:e},t))}}}removeConsumer({peerId:e,streamName:t,consumerId:r}){if(e!==this.peerParams.peerId)return;this.ctx.logger.trace("removeConsumer()",{peerId:e,streamName:t,consumerId:r});const i=this.remoteSources.get(t);null!=i&&(i.provider.removeConsumer(r),0===i.provider.getTracks().length&&(this.emit("playerRemoved",{player:i.player,streamName:t,peer:this}),this.emit("streamRemoved",{stream:i.provider,streamName:t,peer:this}),this.remoteSources.delete(t)))}swapConsumers({peerId:e,streamName:t,add:r,remove:i}){if(e!==this.peerParams.peerId)return;this.ctx.logger.trace("swapConsumer()",{peerId:e,streamName:t,add:r.map((e=>e.id)),remove:i.map((e=>e.id))});const n=this.remoteSources.get(t);null!=n?n.provider.swapConsumers(r,i):this.ctx.logger.warn("Unable to swap consumer stream not found",{peerId:e,streamName:t})}pauseConsumer({peerId:e,streamName:t,consumerId:r}){if(e!==this.peerParams.peerId)return;this.ctx.logger.debug("CALL_SET_CONSUMER_PAUSED",{streamName:t,consumerId:r});const i=this.remoteSources.get(t);null!=i?i.provider.pauseConsumer(r):this.ctx.logger.warn("Unable to pause consumer stream not found",{peerId:e,streamName:t,consumerId:r})}resumeConsumer({peerId:e,streamName:t,consumerId:r}){if(e!==this.peerParams.peerId)return;this.ctx.logger.debug("CALL_SET_CONSUMER_RESUMED",{streamName:t,consumerId:r});const i=this.remoteSources.get(t);null!=i?i.provider.resumeConsumer(r):this.ctx.logger.warn("Unable to resumeConsumer stream not found",{peerId:e,streamName:t,consumerId:r})}layerChanged(e){if(e.peerId!==this.peerParams.peerId)return;this.ctx.logger.debug("CALL_CONSUMER_LAYER_CHANGED",{ev:e});const t=this.remoteSources.get(e.streamName);null!=t?t.provider.consumerLayersChanged(e):this.ctx.logger.warn("Unable to change layer stream not found",{streamName:e.streamName,ev:e})}sourcesChanged(e){if(e.peerId!==this.peerParams.peerId)return;this.ctx.logger.debug("CALL_CONSUMER_SOURCES",{ev:e});const t=this.remoteSources.get(e.streamName);null!=t?t.provider.consumerSourcesChanged(e.layers):this.ctx.logger.warn("Unable to change source stream not found",{remoteSources:Object.fromEntries(this.remoteSources.entries()),streamName:e.streamName,ev:e})}close(){this.pvcCall.off("CALL_ADD_CONSUMER",this.addConsumer),this.pvcCall.off("CALL_REMOVE_CONSUMER",this.removeConsumer),this.pvcCall.off("CALL_SET_CONSUMER_PAUSED",this.pauseConsumer),this.pvcCall.off("CALL_SET_CONSUMER_RESUMED",this.resumeConsumer),this.pvcCall.off("CALL_CONSUMER_LAYER_CHANGED",this.layerChanged);for(const[e,t]of this.remoteSources.entries())t.provider.consumerIds.forEach((t=>{this.removeConsumer({peerId:this.peerId,streamName:e,consumerId:t})}))}setPreferredEncoding(e){var t;const r=null===(t=e.appData)||void 0===t?void 0:t.consumerId;null!=r&&"string"==typeof r||this.throwError((0,a.createError)(a.ErrorCode.UnableChangeBitrate,"unable to set preferred encoding because consumerId is not provided",{layerId:e.id,peerId:this.peerId})),this.ctx.logger.info("setPreferredEncoding",{layer:e}),this.pvcCall.setPreferredEncoding(r,e.id)}toJSON(){return{call:this.call,aggregates:Object.assign(Object.assign({},(0,i.extractAggregates)(this.call,"support")),{support:this.ctx.support.hash,peerId:this.peerId})}}}t.Peer=h,h.displayName="Peer"},2835:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CorePlayer=t.proxyHandler=t.timeupdateWrapper=void 0;const i=r(7582),n=r(7881),s=r(8949),a=r(4280),o=r(2834),c=r(2113),l=r(5445),d=r(4508),u=r(5580),h=r(8101),p=r(644),f=r(3676),m=r(327),g=r(3772),v=r(5184),_=r(9182),y=r(7671),b=[0,1e3,2e3,5e3,25e3],E={bufferOverflowCount:0,bufferUnderflowCount:0,currentErrorCount:0,downshift:0,fragCounts:0,fragDownloadTime:0,fragDuration:0,fragMaxTime:0,fragMinTime:0,fragFetchTime:0,fragSize:0,lastProgress:0,recentErrorCount:0,restartCount:0,upshift:0};t.timeupdateWrapper=new v.TimeupdateWrapper,t.proxyHandler=new g.SyncHandler({logger:new n.LoggerCore("VDC-core"),methods:{isSupported:"postpone",initVideoEl:"postpone",getClosestQuality:"stub"}});const S={bitrate:null,muted:!1,volume:.75,autoPlay:!0,origin:!1,preset:null,recoverErrorCount:0,timeout:3e4,driverFailover:!0};class w extends m.ObservableEventEmitter{get logger(){return this.ctx.logger}get poster(){return this._poster}set poster(e){null!=e&&null!=this.elementSupervisor&&this.elementSupervisor.setPoster(e),this._poster=e}get activeLayer(){var e,t;return null!==(t=null===(e=this.currentQuality)||void 0===e?void 0:e.layer)&&void 0!==t?t:null}get layers(){return(0,_.getBitrateLayersFromQualities)(this.availableQualities)}constructor(e,t,r){var i,n;if(super(),this.counters=E,this.lockRestart=!1,this.clearRestartCount=0,this.playingPromise=null,this.elementSupervisor=null,this.consumerAudioMuted=void 0,this.consumerVideoPaused=void 0,this.lowPowerMode=!1,this.internalPaused=!1,this.qualityEqual=!1,this.internalMuted=!1,this.internalVolume=1,this.startedPlaying=!1,this.pausedOnUnmount=!1,this.mutedOnHidden=!1,this.autoPlay=!0,this.driverFailover=!0,this.forcedMute=!1,this.source=null,this.errors={},this.availableQualities=[],this.currentQuality=null,this.isConnecting=null,this.isConnected=null,this.blurred=!1,this.qualityHasChanged=!1,this.successfulPlayTimeStamp=null,this._poster=null,this.preferredLevel=null,(0,s.makeObservable)(this,{consumerAudioMuted:s.observable,consumerVideoPaused:s.observable,internalPaused:s.observable,internalMuted:s.observable,internalVolume:s.observable,forcedMute:s.observable,source:s.observable.ref,availableQualities:s.observable.shallow,currentQuality:s.observable.shallow,_poster:s.observable,driverFailover:s.observable,blurred:s.observable,preferredLevel:s.observable,lowPowerMode:s.observable,attached:s.computed,localVideoPaused:s.computed,localAudioMuted:s.computed,localAudioVolume:s.computed,poster:s.computed,attachTo:s.action}),this.ctx=e,this.options=null!=r?r:S,null!=this.options.autoPlay&&(this.autoPlay=this.options.autoPlay),this.provider=t,this.internalPaused=!this.autoPlay,null!=(null===(i=this.options)||void 0===i?void 0:i.muted)&&(this.internalMuted=this.options.muted),null!=(null===(n=this.options)||void 0===n?void 0:n.volume)&&(this.localAudioVolume=this.options.volume),this.addInnerDisposer((0,s.reaction)((()=>[this.availableQualities,this.preferredLevel]),(([t,r])=>{var i,n,s;if(null!=r||1!==(null==t?void 0:t.length)&&"flv-http"!==this.format){if(null==r&&1!==(null==t?void 0:t.length))return void(this.currentQuality=null)}else r=c.TranscodeScoreLevel.Highest;if(null!=r&&null!=t){const a=(0,_.findClosestQuality)(r,t);a!==this.currentQuality&&(this.qualityHasChanged=!0,e.logger.debug("quality change",{format:this.format,oldQuality:null!==(n=null===(i=this.currentQuality)||void 0===i?void 0:i.level)&&void 0!==n?n:null,newQuality:null!==(s=null==a?void 0:a.level)&&void 0!==s?s:null,preferredQuality:r})),this.currentQuality=a,this.qualityHasChanged&&this.updatePosterWithLatestFrame(),null!=this.currentQuality&&null!=this.provider.source&&this.handleSource(this.provider.source)}}),{equals:s.comparer.structural})),e.logger.attachObject(this),e.logger.trace("constructor()",{options:this.options}),(0,p.onceCanceled)(e).then((e=>this.dispose(`Core Player Context Cancelled: ${e}`))),this._handleVisibilityChange=()=>{(a.device.isIosDevice||a.device.isAndroidDevice)&&(a.device.hidden?(this.mutedOnHidden=this.internalMuted,this.localAudioMuted=!0):this.localAudioMuted=this.mutedOnHidden)},a.device.addEventListener("visibilitychange",this._handleVisibilityChange),this.provider.on("source",this.handleSource),this.provider.on("source",this.isSource),this.provider.on("audioMuted",this.handleAudioMuted),this.provider.on("videoPaused",this.handleVideoPaused),this.provider instanceof h.MediasoupSource&&this.provider.on("accessDenied",this.handleProviderAccessDenied),this.addInnerDisposer((()=>{this.provider.off("source",this.handleSource),this.provider.off("source",this.isSource),this.provider.off("audioMuted",this.handleAudioMuted),this.provider.off("videoPaused",this.handleVideoPaused),a.device.removeEventListener("visibilitychange",this._handleVisibilityChange),this.provider instanceof h.MediasoupSource&&this.provider.off("accessDenied",this.handleProviderAccessDenied)})),null!=this.provider.source){const e=this.provider.source;setTimeout((()=>{this.handleSource(e)}),0)}}updatePosterWithLatestFrame(){null!=this.elementSupervisor&&a.device.isImplements(o.Feature.CREATE_SCREENSHOT)?this.poster=this.elementSupervisor.createScreenshot():this.ctx.logger.warn("Unable to set update poster. Create screenshot is not compatible with device.")}ready(){return i.__awaiter(this,void 0,void 0,(function*(){if(null==this.source)return this.ctx.logger.debug("no source, not ready"),new Promise(((e,t)=>{let r;const i=(0,s.autorun)((t=>{null!=this.source&&(t.dispose(),a.device.clearTimeout(r),e())}));null!=this.options.timeout&&(r=a.device.setTimeout((()=>{i();const e=new u.PlayingIssueError(`timeout after ${this.options.timeout}ms`,{player:this});this.emitErrorDeprecated(e),this.options.driverFailover&&this.emit("driverFailover",!0),t(e)}),this.options.timeout))}))}))}handleAudioMuted(e){this.consumerAudioMuted=e}handleVideoPaused(e){this.consumerVideoPaused=e}handleProviderAccessDenied(e){this.emit("playerAccessDenied",e)}isSource(){this.provider instanceof h.MediasoupSource&&(this.consumerVideoPaused=!this.provider.hasVideo||this.provider.videoPaused)}get attached(){return null!=this.elementSupervisor}get localVideoPaused(){return this.internalPaused}set localVideoPaused(e){this.internalPaused=e,null!=this.elementSupervisor&&(this.internalPaused?this.pauseEl():(()=>{i.__awaiter(this,void 0,void 0,(function*(){try{yield this.play()}catch(e){this.emitErrorDeprecated(new u.PlayingIssueError("VideoElement.play() error",{inner:e instanceof Error?e:null,player:this}))}}))})())}pauseEl(){var e;null===(e=this.elementSupervisor)||void 0===e||e.pause()}get localAudioMuted(){return this.internalMuted}set localAudioMuted(e){this.internalMuted=e,null!=this.elementSupervisor&&(this.elementSupervisor.muted=e)}get localAudioVolume(){return this.internalVolume}set localAudioVolume(e){e>1||e<0?this.ctx.logger.warn(`Volume level not set. ${e} is not a valid volume value for an HTMLMediaElement. Volume levels must be between 0-1.`):(this.internalVolume=e,null!=this.elementSupervisor&&(this.elementSupervisor.volume=e))}handleElPlay(){this.suspended||(this.internalPaused?(this.ctx.logger.warn("A try to call .play() on HTMLVideoElement outside the Player"),a.device.isImplements(o.Feature.BROWSER_TYPE)&&"safari"===a.device.browserInfo.name?this.localVideoPaused=!0:this.internalPaused=!1):this.ctx.logger.info(".play() called on HTMLVideoElement"))}handleElPause(){if(!this.suspended&&!this.internalPaused&&null!=this.elementSupervisor){if(!this.elementSupervisor.paused)return;this.play().catch((e=>{a.device.setTimeout(this.handleElPause,50),this.ctx.logger.error("An error occured on the play() request",{err:(0,u.wrapNativeError)(e)})}))}}handleElError(){var e,t;if(null==this.elementSupervisor||this.suspended)return;const r=d.MediaErrorCodeConstants[null!==(t=null===(e=this.elementSupervisor.error)||void 0===e?void 0:e.code)&&void 0!==t?t:0];this.ctx.logger.warn(`VideoElement Error: ${r}`)}handleElVolumeChange(){null==this.elementSupervisor||this.suspended||(Math.abs(this.internalVolume-this.elementSupervisor.volume)>.01&&(this.ctx.logger.warn("A try to change volume on HTMLVideoElement outside the Player"),this.elementSupervisor.volume=this.internalVolume),this.elementSupervisor.muted!==this.internalMuted&&(this.elementSupervisor.muted=this.internalMuted))}attachTo(e){return i.__awaiter(this,void 0,void 0,(function*(){this.ctx.logger.trace("attachTo()",{el:(0,f.dumpVideoElement)(e)}),this.elementSupervisor=y.MediaElementSupervisor.getSupervisor(e).attachToPlayer(this),this.pausedOnUnmount=this.internalPaused,this.ctx.logger.debug("attach to host element",{element:(0,f.dumpVideoElement)(e),options:this.options}),this.initVideoEl(this.elementSupervisor).catch((e=>this.ctx.logger.error(`Unable to initialize VideoElement: ${e}`))),null!=this.source&&(this.emit("hostElementAttached",{el:e}),this.ctx.logger.debug("hostElementAttached",{el:(0,f.dumpVideoElement)(e)}))}))}initVideoEl(e,t=!1){return i.__awaiter(this,void 0,void 0,(function*(){e.muted=this.internalMuted,e.volume=this.internalVolume,t&&(this.pausedOnUnmount=this.internalPaused),this.pausedOnUnmount||"flv-http"===this.format?e.autoplay=!1:e.autoplay=!0,this.startedPlaying=!1,null!=this._poster&&e.setPoster(this._poster),this.ctx.logger.debug("host element is initialized",{autoPlay:this.options.autoPlay,internalPaused:this.internalPaused,internalMuted:this.internalMuted}),null!=this.source&&("string"==typeof this.source?e.updateSrc(this.source):e.updateSrcObject(this.source)),this.pausedOnUnmount||(this.ctx.logger.info("core: initVideoEl() -> await play()"),yield this.play())}))}handleElProgress(){a.device.isImplements(o.Feature.DEBUGGING)?this.counters.lastProgress=a.device.performance.now():this.counters.lastProgress=Date.now(),this.emit("progress")}handleElTimeupdate(){null!=this.elementSupervisor&&this.elementSupervisor.isVideoPlaying()&&!this.startedPlaying&&(this.startedPlaying=!0,this.successfulPlayTimeStamp=Date.now(),this.emit("videoFirstPlay")),null!=this.successfulPlayTimeStamp&&15===Math.floor((Date.now()-this.successfulPlayTimeStamp)/1e3)&&(this.ctx.logger.debug("Successful playback."),this.successfulPlayTimeStamp=null),this.counters.fragCounts+=1,this.emit("timeupdate")}resetCounts(){this.counters=E}*bufferTimes(){var e,t,r;const i=null!==(r=null===(t=null===(e=this.elementSupervisor)||void 0===e?void 0:e.buffered)||void 0===t?void 0:t.length)&&void 0!==r?r:0;for(let e=0;null!=this.elementSupervisor&&e<i;e++)yield[this.elementSupervisor.buffered.start(e),this.elementSupervisor.buffered.end(e)]}get details(){var e;return{bufferOverflowCount:this.counters.bufferOverflowCount,bufferUnderflowCount:this.counters.bufferUnderflowCount,downshift:this.counters.downshift,errors:null!==(e=this.errors)&&void 0!==e?e:{},muted:this.localAudioMuted,segments:this.counters.fragCounts,segmentsSize:this.counters.fragSize,segmentsDuration:this.counters.fragDuration,segmentTotalDownloadTime:this.counters.fragDownloadTime,segMaxTime:this.counters.fragMaxTime,segMinTime:this.counters.fragMinTime,upshift:this.counters.upshift,volume:this.localAudioVolume}}restart(e){var t;return i.__awaiter(this,void 0,void 0,(function*(){if(this.ctx.logger.info("restart()",{immediate:e}),!this.lockRestart)return this.lockRestart=!0,this.counters.currentErrorCount=0,this.counters.recentErrorCount=0,this.counters.restartCount+=1,e?new Promise((t=>{this.stop();try{this.play(e).then((()=>{this.lockRestart=!1,t()}))}catch(e){this.ctx.logger.error("An error occured on the play() request",{err:(0,u.wrapNativeError)(e)})}})):(a.device.clearTimeout(null!==(t=this.clearRestartCount)&&void 0!==t?t:0),this.clearRestartCount=a.device.setTimeout((()=>{this.counters.restartCount=0}),2*b[b.length-1]),this.emit("restartDriver",{timeout:b[Math.min(this.counters.restartCount,b.length-1)]}),this.restartTimeout())}))}restartTimeout(){return i.__awaiter(this,void 0,void 0,(function*(){return new Promise((e=>{a.device.setTimeout((()=>{if(!this.isDisposed){this.stop();try{this.play().then((()=>{this.lockRestart=!1,e()}))}catch(e){this.ctx.logger.error("An error occured on the play() request",{err:(0,u.wrapNativeError)(e)})}}}),b[Math.min(this.counters.restartCount,b.length-1)])}))}))}stop(){null!=this.elementSupervisor&&(this.elementSupervisor.updateSrc(""),this.elementSupervisor.updateSrcObject(null))}play(e=!1){var t;return i.__awaiter(this,void 0,void 0,(function*(){return this.ctx.logger.info("play()",{videoEl:null===(t=this.elementSupervisor)||void 0===t?void 0:t.dumpVideoElement(),aggregates:{debug:"play"}}),yield this.ready(),this.ctx.logger.info("ready to play",{aggregates:{debug:"play"}}),null==this.elementSupervisor?(this.ctx.logger.warn("a try to play without host element attached",{aggregates:{debug:"play"}}),!1):this.elementSupervisor.isSourceSet()?(null==this.playingPromise&&(this.ctx.logger.setMessageAggregate("debug","play"),this.ctx.logger.setMessageAggregate("playImmediately",e),this.ctx.logger.setMessageAggregate("hasPlayingPromise",null!=this.playingPromise),this.playingPromise=this.playInternal(this.elementSupervisor,e).then((()=>{var e;return this.ctx.logger.trace("playingPromise.then()"),!(null===(e=this.elementSupervisor)||void 0===e?void 0:e.paused)})).catch((e=>(this.ctx.logger.trace("playingPromise.catch()",{err:(0,u.wrapNativeError)(e)}),e))).finally((()=>{this.ctx.logger.trace("playingPromise.finally()"),this.playingPromise=null,this.ctx.logger.removeMessageAggregate("debug"),this.ctx.logger.removeMessageAggregate("playImmediately"),this.ctx.logger.removeMessageAggregate("hasPlayingPromise")}))),this.playingPromise):(this.ctx.logger.debug("nothing to play",{aggregates:{debug:"play"}}),!1)}))}playInternal(e,t=!1){var r;return i.__awaiter(this,void 0,void 0,(function*(){if(this.ctx.logger.trace("playInternal()"),(0,d.isMediaStream)(e.srcObject)&&(null===(r=e.srcObject)||void 0===r?void 0:r.getTracks().length)<=0)return;a.device.isImplements(o.Feature.BROWSER_TYPE)&&"safari"===a.device.browserInfo.name&&"mp4-hls"===this.format&&(this.ctx.logger.info("playInternal safari hls bypassing loadeddata check"),t=!0);const i=t?e.play.bind(e):_.playOncePossible.bind(null,e,this.ctx.logger);try{this.ctx.logger.trace("playInternal() trying playDelegate (first time)"),yield i()}catch(e){if(!(e instanceof Error))throw this.ctx.logger.info("playDelegate unknown error type",{errType:typeof e,player:this}),e;{const r={inner:(0,u.wrapNativeError)(e),playImmediately:t,player:this};if("AbortError"!==e.name&&"NotAllowedError"!==e.name||this.localAudioMuted||!this.isImplements(l.Feature.MUTED_AUTOPLAY)){this.ctx.logger.info("bypassed forcedMute autoplay",{errName:e.name,localAudioMuted:this.localAudioMuted,implementsMutedAutoplay:this.isImplements(l.Feature.MUTED_AUTOPLAY)});try{yield new Promise((e=>{a.device.setTimeout(e,500)})),yield i(),this.ctx.logger.info("playDelegate playing (one more time just in case)",r)}catch(t){t instanceof Error&&(0,_.isInLowPowerMode)(t)?(this.lowPowerMode=!0,this.ctx.logger.info("iOS Device in low power mode, cannot autoplay",{err:(0,u.wrapNativeError)(e),lowPowerMode:this.lowPowerMode})):this.throwErrorDeprecated(new u.PlayingIssueError("playDelegate error after second try",r))}}else{this.ctx.logger.info("attempting forcedMute play",r),this.localAudioMuted=!0,this.forcedMute=!0;try{yield i(),this.ctx.logger.info("playDelegate playing muted due to low page engagement",r)}catch(t){t instanceof Error&&(0,_.isInLowPowerMode)(t)?(this.lowPowerMode=!0,this.ctx.logger.info("iOS Device in low power mode, cannot autoplay",{err:(0,u.wrapNativeError)(e),lowPowerMode:this.lowPowerMode})):this.throwErrorDeprecated(new u.PlayingIssueError("playDelegate error after mute play",r))}}}}finally{this.ctx.logger.trace("playInternal() finally"),this.internalPaused=e.paused}}))}checkRestart(e){return i.__awaiter(this,void 0,void 0,(function*(){const t=e;if(this.counters.recentErrorCount+=1,a.device.setTimeout((()=>{this.counters.recentErrorCount-=1,this.counters.recentErrorCount=Math.max(this.counters.recentErrorCount,0)}),1e4),this.counters.recentErrorCount>=10&&(t.fatal=!0),this.counters.currentErrorCount>=10&&(t.fatal=!0),t.fatal)return this.restart(!1)}))}setPreferredLevel(e){this.preferredLevel=e}getClosestQuality(e){return(0,_.findClosestQuality)(e,this.availableQualities)}isImplements(e){return this.implementedFeatures.includes(e)}dispose(e){this.updatePosterWithLatestFrame(),super.dispose(e)}toJSON(){var e;return{availableQualities:(0,s.toJS)(this.availableQualities),currentQuality:(0,s.toJS)(this.currentQuality),attached:this.attached,counters:this.counters,aggregates:Object.assign({support:this.ctx.support.hash,autoPlay:this.autoPlay,localAudioMuted:this.localAudioMuted,localVideoPaused:this.localVideoPaused,playingPromise:null==this.playingPromise,format:this.format},null===(e=this.elementSupervisor)||void 0===e?void 0:e.dumpVideoElement())}}}t.CorePlayer=w},6514:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FlvHttpPlayer=void 0;const i=r(7582),n=r(8949),s=r(4280),a=r(5445),o=r(5580),c=r(2835),l=r(2843),d=r(3199);class u extends c.CorePlayer{static isSupported(e){return i.__awaiter(this,void 0,void 0,(function*(){return(0,l.supportsFlvHttp)(e)}))}isSupported(){return i.__awaiter(this,void 0,void 0,(function*(){return u.isSupported()}))}static get format(){return"flv-http"}get format(){return u.format}constructor(e,t,r){super(e,t,r),this.player=null,this.isFirstLoad=!0,this.isStartingToPlay=!1,this.isPauseQueued=!1,this.addInnerDisposer((0,n.reaction)((()=>{var e;return[null===(e=this.currentQuality)||void 0===e?void 0:e.layer,this.internalPaused]}),(([e,t])=>{null==e||"string"!=typeof e.id||""===e.id||t||this.isStartingToPlay||this.requestUrl(e.id)}))),this.on("hostElementAttached",this.handleElAttached),this.addInnerDisposer((()=>{this.destroyPlayer()}))}ready(){const e=Object.create(null,{ready:{get:()=>super.ready}});return i.__awaiter(this,void 0,void 0,(function*(){s.device.isImplements(s.Feature.MPEGTS)&&(yield s.device.loadMpegtsScript()),yield e.ready.call(this)}))}pauseEl(){var e;this.isStartingToPlay?this.isPauseQueued=!0:(super.pauseEl(),null===(e=this.player)||void 0===e||e.pause())}handleSource(e){this.suspended||null==(null==e?void 0:e.formats["flv-http"])&&this.emitErrorDeprecated(new o.DriverNotSupportedError("manifest doesn't contains 'flv-http' format",{manifest:e}))}requestUrl(e){var t;s.device.isImplements(s.Feature.MPEGTS)||this.throwErrorDeprecated(new o.PlayingIssueError("mpegts library is not loaded",{player:this})),this.destroyPlayer();const r=null!==(t=this.options.requestHeaders)&&void 0!==t?t:null,i=null!=r?{headers:r}:void 0;this.player=s.device.mpegts.createPlayer({type:"flv",isLive:!0,url:e},i),this.player.on(s.device.mpegts.Events.ERROR,this.handleMpegtsError),null!=this.elementSupervisor&&this.handleElAttached({el:Reflect.get(this.elementSupervisor,"element")})}handleElAttached(e){if(null!=this.player){if(this.player.attachMediaElement(e.el),this.player.load(),this.ctx.logger.debug("host element is attached and loaded"),this.isFirstLoad&&!this.options.autoPlay)return void(this.isFirstLoad=!1);try{this.internalPaused?(this.ctx.logger.debug("pause"),this.player.pause()):(this.ctx.logger.debug("play"),this.isPauseQueued=!1,this.isStartingToPlay=!0,(this.player.play()||Promise.resolve()).then((()=>{this.handleStartedToPlay()})))}catch(e){const t=e instanceof Error?e:null;this.emitErrorDeprecated(new o.PlayingIssueError("mpegts call failed in handleElAttached()",{inner:t,player:this}))}}}handleStartedToPlay(){this.isStartingToPlay=!1,this.isPauseQueued&&this.pauseEl()}destroyPlayer(){null!=this.player&&s.device.isImplements(s.Feature.MPEGTS)&&(this.player.pause(),this.player.unload(),this.player.detachMediaElement(),this.player.off(s.device.mpegts.Events.ERROR,this.handleMpegtsError),this.player.destroy(),this.player=null)}handleMpegtsError(e){"NetworkError"===e?this.ctx.logger.error(`FLVHTTP ${e}`):this.throwError((0,d.createError)(d.ErrorCode.PlaybackError,"Unable to play the stream due to an uncaught error",{}))}get implementedFeatures(){return[a.Feature.BITRATE_SWITCHING,a.Feature.MUTED_AUTOPLAY]}}t.FlvHttpPlayer=u,u.displayName="FlvHttpPlayer"},9182:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.attachVideoElement=t.isInLowPowerMode=t.lowPowerModeMsg=t.dataProperties=t.equalQualities=t.findClosestQuality=t.isFatalError=t.ERRORS=t.fetchManifestQualities=t.encodingToLayer=t.sortEncodings=t.getBitrateLayersFromQualities=t.isBitrateLayer=t.playOncePossible=void 0;const i=r(4280),n=r(2113),s=r(5087),a=r(8052);function o(e){return"id"in e&&"bitrate"in e&&"isSource"in e}function c(e){return[...e].sort(((e,t)=>{var r,i,n,s,a,c;const l=o(e)?null!==(r=e.bitrate)&&void 0!==r?r:e.maxBitrate:(null!==(i=e.audioKbps)&&void 0!==i?i:0)+(null!==(n=e.videoKbps)&&void 0!==n?n:0),d=o(t)?null!==(s=t.bitrate)&&void 0!==s?s:t.maxBitrate:(null!==(a=t.audioKbps)&&void 0!==a?a:0)+(null!==(c=t.videoKbps)&&void 0!==c?c:0);return 0===l?-1:d-l}))}function l(e){var t,r,i,n,s;if(o(e))return{id:e.id,bitrate:null!==(t=e.bitrate)&&void 0!==t?t:e.maxBitrate,isSource:null!==(r=e.isSource)&&void 0!==r&&r,appData:null!==(i=e.appData)&&void 0!==i?i:{}};const a={id:e.location,bitrate:(null!==(n=e.audioKbps)&&void 0!==n?n:0)+(null!==(s=e.videoKbps)&&void 0!==s?s:0),isSource:!1,appData:{},encoding:e};return null!=a.appData&&e.videoWidth&&e.videoHeight&&(a.appData.videoWidth=e.videoWidth,a.appData.videoHeight=e.videoHeight),a}function d(e){switch(e){case n.SourceScoreLevel.Low:return n.SourceScoreLevel.Medium;case n.SourceScoreLevel.Medium:return n.SourceScoreLevel.High;case n.SourceScoreLevel.High:return null;case n.TranscodeScoreLevel.Lowest:return n.TranscodeScoreLevel.Low;case n.TranscodeScoreLevel.Low:return n.TranscodeScoreLevel.MediumLow;case n.TranscodeScoreLevel.MediumLow:return n.TranscodeScoreLevel.Medium;case n.TranscodeScoreLevel.Medium:return n.TranscodeScoreLevel.MediumHigh;case n.TranscodeScoreLevel.MediumHigh:return n.TranscodeScoreLevel.High;case n.TranscodeScoreLevel.High:return n.TranscodeScoreLevel.Highest;default:return null}}function u(e){switch(e){case n.SourceScoreLevel.High:return n.SourceScoreLevel.Medium;case n.SourceScoreLevel.Medium:return n.SourceScoreLevel.Low;case n.SourceScoreLevel.Low:return null;case n.TranscodeScoreLevel.Highest:return n.TranscodeScoreLevel.High;case n.TranscodeScoreLevel.High:return n.TranscodeScoreLevel.MediumHigh;case n.TranscodeScoreLevel.MediumHigh:return n.TranscodeScoreLevel.Medium;case n.TranscodeScoreLevel.Medium:return n.TranscodeScoreLevel.MediumLow;case n.TranscodeScoreLevel.MediumLow:return n.TranscodeScoreLevel.Low;case n.TranscodeScoreLevel.Low:return n.TranscodeScoreLevel.Lowest;default:return null}}t.playOncePossible=function(e,t){return t.debug("playOncePossible()",{aggregates:e.dumpVideoElement()}),e.paused||e.ended?e.readyState>2?e.play():new Promise(((r,n)=>{t.debug("playOncePossible() returned Promise",{aggregates:e.dumpVideoElement()});const s=()=>{e.readyState>2&&(e.removeListener("loadeddata",s),e.play().catch(n).then((()=>{if(!e.paused)return void r();let t=20;const s=i.device.setInterval((()=>{e.paused||(i.device.clearInterval(s),r()),0==--t&&(i.device.clearInterval(s),n(new Error("Video element remains paused for 1s after play() call")))}),50)})))};e.addListener("loadeddata",s)})):Promise.resolve()},t.isBitrateLayer=o,t.getBitrateLayersFromQualities=function(e){return e.map((e=>e.layer)).filter((function(e){return null!=e&&void 0!==e}))},t.sortEncodings=c,t.encodingToLayer=l,t.fetchManifestQualities=function(e,t,r){let i;i=Array.isArray(e)?e:null!=e.substitute?[e.substitute]:e.encodings;const o=c(null!=i?i:[]),d=[];if(null!=t)d.push({level:n.SourceScoreLevel.High,layer:{bitrate:0,isSource:!0,id:t}});else{const e=o.map((e=>l(e))).filter((e=>e.isSource));e.sort(((e,t)=>e.bitrate>t.bitrate?1:-1));for(let t=0;t<e.length;t++)switch(t){case 0:d.push({level:n.SourceScoreLevel.Low,layer:e[t],encoding:e[t].encoding});break;case 1:d.push({level:n.SourceScoreLevel.Medium,layer:e[t],encoding:e[t].encoding});break;case 2:d.push({level:n.SourceScoreLevel.High,layer:e[t],encoding:e[t].encoding})}}const u=o.map((e=>l(e))).filter((e=>!e.isSource));switch(u.length){case 0:break;case 1:d.push({level:n.TranscodeScoreLevel.Medium,layer:l(u[0]),encoding:u[0].encoding});break;case 2:d.push({level:n.TranscodeScoreLevel.Low,layer:l(u[1]),encoding:u[1].encoding}),d.push({level:n.TranscodeScoreLevel.High,layer:l(u[0]),encoding:u[0].encoding});break;case 3:d.push({level:n.TranscodeScoreLevel.Low,layer:l(u[2]),encoding:u[2].encoding}),d.push({level:n.TranscodeScoreLevel.Medium,layer:l(u[1]),encoding:u[1].encoding}),d.push({level:n.TranscodeScoreLevel.High,layer:l(u[0]),encoding:u[0].encoding});break;case 4:d.push({level:n.TranscodeScoreLevel.Low,layer:l(u[3]),encoding:u[3].encoding}),d.push({level:n.TranscodeScoreLevel.MediumLow,layer:l(u[2]),encoding:u[2].encoding}),d.push({level:n.TranscodeScoreLevel.MediumHigh,layer:l(u[1]),encoding:u[1].encoding}),d.push({level:n.TranscodeScoreLevel.High,layer:l(u[0]),encoding:u[0].encoding});break;case 5:d.push({level:n.TranscodeScoreLevel.Low,layer:l(u[4]),encoding:u[4].encoding}),d.push({level:n.TranscodeScoreLevel.MediumLow,layer:l(u[3]),encoding:u[3].encoding}),d.push({level:n.TranscodeScoreLevel.Medium,layer:l(u[2]),encoding:u[2].encoding}),d.push({level:n.TranscodeScoreLevel.MediumHigh,layer:l(u[1]),encoding:u[1].encoding}),d.push({level:n.TranscodeScoreLevel.High,layer:l(u[0]),encoding:u[0].encoding});break;case 6:d.push({level:n.TranscodeScoreLevel.Lowest,layer:l(u[5]),encoding:u[5].encoding}),d.push({level:n.TranscodeScoreLevel.Low,layer:l(u[4]),encoding:u[4].encoding}),d.push({level:n.TranscodeScoreLevel.MediumLow,layer:l(u[3]),encoding:u[3].encoding}),d.push({level:n.TranscodeScoreLevel.MediumHigh,layer:l(u[2]),encoding:u[2].encoding}),d.push({level:n.TranscodeScoreLevel.High,layer:l(u[1]),encoding:u[1].encoding}),d.push({level:n.TranscodeScoreLevel.Highest,layer:l(u[0]),encoding:u[0].encoding});break;default:d.push({level:n.TranscodeScoreLevel.Lowest,layer:l(u[6]),encoding:u[6].encoding}),d.push({level:n.TranscodeScoreLevel.Low,layer:l(u[5]),encoding:u[5].encoding}),d.push({level:n.TranscodeScoreLevel.MediumLow,layer:l(u[4]),encoding:u[4].encoding}),d.push({level:n.TranscodeScoreLevel.Medium,layer:l(u[3]),encoding:u[3].encoding}),d.push({level:n.TranscodeScoreLevel.MediumHigh,layer:l(u[2]),encoding:u[2].encoding}),d.push({level:n.TranscodeScoreLevel.High,layer:l(u[1]),encoding:u[1].encoding}),d.push({level:n.TranscodeScoreLevel.Highest,layer:l(u[0]),encoding:u[0].encoding})}return null!=r&&(r instanceof s.HlsJsPlayer||r instanceof a.NativeHlsPlayer)&&d.push({level:n.AutoQualityLevel.Auto}),d},t.ERRORS={BAD_INPUT:"bad-input",DRIVER_NOT_SUPPORTED:"driver-not-supported",ELEMENT_REQUIRED:"element-required",EMBED_SWF_FAILED:"embedding-flash-swf-failed",GET_USER_MEDIA_FAILED:"get-user-media-failed",HTTP_SERVER_UNEXPECTED_RESPONSE:"http-server-unexpected-response",HTTP_SERVER_UNAUTHORIZED:"http-server-unauthorized",HTTP_SERVER_FORBIDDEN:"http-server-forbidden",HTTP_SERVER_INTERNAL_ERROR:"http-server-internal-error",HTTP_SERVER_NOT_FOUND:"http-server-not-found",MANIFEST:"http-response",INVALID_CONTROLS:"invalid-controls-parent",INVALID_MEDIA_URL:"invalid-media-url",INVALID_POPOUT_URL:"invalid-popout-url",INVALID_EL:"invalid-element",WS_NETWORK_ERROR:"websocket-network-error",NETWORK_ERROR:"network-error",NO_DRIVERS:"no-valid-drivers",PLAYBACK_ERROR:"playback-error",UNKNOWN_DRIVER:"unknown-driver",UNKNOWN_ERROR:"unknown-error",UNRECOGNIZED_DRIVER:"unrecognized-driver",USER_REQUIRED:"user-required",INVALD_BITRATE:"invalid-bitrate",HLSJS_NOT_LOADED:"hlsjs-not-loaded"},t.isFatalError=function(e){return!(!e||"object"!=typeof e||!("fatal"in e))&&!0===e.fatal},t.findClosestQuality=function(e,t){if(0===t.length)return null;if(e===n.AutoQualityLevel.Auto)return{level:e};let r;const i=Object.fromEntries(t.map((e=>[e.level,e])));for(r=e;null!=r&&null==i[r];)r=u(r);if(null==r)for(r=e;null!=r&&null==i[r];)r=d(r);return null!=r?i[r]:null},t.equalQualities=function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r].level!==t[r].level)return!1;return!0},t.dataProperties=function(e){return{details:e.details,fatal:e.fatal,type:e.type,url:e.url}},t.lowPowerModeMsg="The request is not allowed by the user agent or the platform in the current context, possibly because the user denied permission.",t.isInLowPowerMode=function(e){return i.device.isIosDevice&&e instanceof Error&&"NotAllowedError"===e.name&&e.message===t.lowPowerModeMsg},t.attachVideoElement=function(e){return e}},5087:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HlsJsPlayer=void 0;const i=r(7582),n=r(4280),s=r(2834),a=r(813),o=r(2113),c=r(5445),l=r(4508),d=r(3199),u=r(5580),h=r(2843),p=r(3676),f=r(3078),m=r(2835),g=r(9182),v=(...e)=>{};class _ extends m.CorePlayer{static isSupported(e){return i.__awaiter(this,void 0,void 0,(function*(){return(0,h.supportsHlsjs)(e)}))}get hostEl(){return null==this.elementSupervisor?null:Reflect.get(this.elementSupervisor,"element")}isSupported(){return i.__awaiter(this,void 0,void 0,(function*(){return _.isSupported()}))}static get format(){return"mp4-hls"}get format(){return _.format}ready(){const e=Object.create(null,{ready:{get:()=>super.ready}});return i.__awaiter(this,void 0,void 0,(function*(){yield this.device.loadHlsScript(this.options.hlsjsPath),yield e.ready.call(this)}))}handleSource(e){var t,r,s,a;return i.__awaiter(this,void 0,void 0,(function*(){if(this.suspended)return;const i=null!=(null===(r=null===(t=this.manifestJson)||void 0===t?void 0:t.formats["mp4-hls"])||void 0===r?void 0:r.substitute);if(this.manifestJson=e,null!=(null==e?void 0:e.formats["mp4-hls"])){if(this.source=this.manifest,null!=(null===(s=null==e?void 0:e.formats["mp4-hls"])||void 0===s?void 0:s.substitute)!==i&&!this._firstSourceEv)return this.ctx.logger.debug("Changing stream to/from blurredStream. Restart hlsjs."),void this.restart(!0);if(this._firstSourceEv&&(this._firstSourceEv=!1),null!=this.hostEl&&null!=this.source&&(!this.hostEl.src||null!=this.hostEl.srcObject||this.qualityHasChanged||n.device.isImplements(n.Feature.URL_LOCATION)&&this.hostEl.src===n.device.location)){const e=this.hostEl.currentTime;this.qualityHasChanged=!1,this.hostEl.srcObject=null,this.hostEl.setAttribute("src",this.source),"recorded"===(null===(a=this.manifestJson)||void 0===a?void 0:a.type)&&e>0&&(this.hostEl.currentTime=e),this.ctx.logger.debug("hlsjs: await play()",{aggregates:(0,p.dumpVideoElement)(this.hostEl)}),yield this.play()}}else this.emitErrorDeprecated(new u.DriverNotSupportedError("Manifest did not receive a 'mp4-hls' format, the driver was not provided.",{manifest:e}))}))}get implementedFeatures(){return[c.Feature.BITRATE_SWITCHING,c.Feature.MUTED_AUTOPLAY]}get device(){if(null!=this._device)return this._device;if(!n.device.isImplements(s.Feature.HLSJS))throw new Error("Device is not supported");return this._device=n.device,this._device}constructor(e,t,r){if(super(e,t,r),this.lastProgress=0,this.manifestJson=null,this.destroyed=!1,this.m3u8ManifestLoadId=0,this.indexManifestLoadId=0,this.initialFragmentLoadId=0,this._firstSourceEv=!0,this.lastFrag=null,this.loadingHls=!1,this.loadFailure=null,this.recoverDecodingErrorDate=0,this.recoverSwapAudioCodecDate=0,this.hls=null,this.isAttached=!1,this._device=null,this.chosenLevel=null,this.hlsJsInitId=f.stats.start(f.STATS_EVENTS.HLSJS_INIT),!n.device.isImplements(s.Feature.HLSJS))throw new Error("Device is not supported");this.loadHls(),this.addInnerDisposer(this.destroy),this.on("error",(()=>{}))}get data(){var e,t;return null!==(t=null===(e=this.manifestJson)||void 0===e?void 0:e.formats["mp4-hls"])&&void 0!==t?t:null}get mediaLoader(){return this.provider}get manifest(){var e,t,r,i,n,s,a;const c=this.data;if(null==c)return null;let l;if(l=c.substitute?c.substitute.location:(null===(e=this.currentQuality)||void 0===e?void 0:e.level)!==o.SourceScoreLevel.High&&(null===(t=this.currentQuality)||void 0===t?void 0:t.level)!==o.SourceScoreLevel.Medium&&(null===(r=this.currentQuality)||void 0===r?void 0:r.level)!==o.SourceScoreLevel.Low||null==(null===(i=c.origin)||void 0===i?void 0:i.location)?null!=(null===(a=null===(s=this.currentQuality)||void 0===s?void 0:s.layer)||void 0===a?void 0:a.id)&&""!==this.currentQuality.layer.id?this.currentQuality.layer.id.toString():c.manifest:null===(n=c.origin)||void 0===n?void 0:n.location,null==l)return this.ctx.logger.info("Returning null in manifest getter. Data: ",{format:c}),null;const d=l.includes("?")?"&":"?";l+=d;const u=this.device.globals.get("lv_auto_last_kbps");if(null!=u){const e=l.includes("?")?"&":"?";l+=`${e}kbps=${u}`}return l}reloadAndRestart(){return i.__awaiter(this,void 0,void 0,(function*(){this.isDisposed||(yield this.mediaLoader.load(),"online"===this.mediaLoader.currentState&&(yield this.restart(!1)))}))}loadHls(e){const t=null!=e?e:v;this.device.loadHlsScript(this.options.hlsjsPath).then((()=>t())).catch((e=>{this.ctx.logger.error("hlsjs not loaded",{path:this.options.hlsjsPath,err:e}),t(e)}))}playNow(){const e=Object.create(null,{play:{get:()=>super.play}});return i.__awaiter(this,void 0,void 0,(function*(){const t=this.manifest;if(!this.device.isHlsLoaded())throw new Error(g.ERRORS.HLSJS_NOT_LOADED);if(null==t&&"online"===this.mediaLoader.currentState)return this.emitErrorDeprecated(new u.DriverNotSupportedError("manifest doesn't contains 'flv-http' format",{manifest:t,loader:this.mediaLoader})),!1;if(null==this.hostEl)return this.emitErrorDeprecated(new u.ElementRequiredError("cannot play, no video element",{})),!1;if(null!=this.hls){if(this.mediaLoader.vod&&t===this.hls.url){try{yield e.play.call(this)}catch(e){const t=e instanceof Error?e:null;this.emitErrorDeprecated(new u.PlayingIssueError("vod play failed in playNow()",{inner:t,player:this}))}return!0}this.destroyHls()}if(null==t)return this.emitErrorDeprecated(new u.ManifestNotFoundError("cannot play, manifest is null",{})),!1;this.hostEl.setAttribute("src",t);const r=()=>{var i;if(this.isDisposed)return;if(!this.device.isHlsLoaded())throw new Error("Hls.js is not loaded");this.device.removeEventListener("visibilitychange",r);const n={debug:this.options.debug,maxBufferLength:this.options.maxBufferLength,maxBufferSize:this.options.maxBufferSize,fragLoadingTimeOut:3900,maxBufferHole:2,backBufferLength:90,progressive:!1,autoLevelEnabled:!0},s=null!==(i=this.options.requestHeaders)&&void 0!==i?i:null,a=this.hls=new this.device.Hls(Object.assign(Object.assign(Object.assign({},n),this.options.hlsjsConfig),{xhrSetup(e,t){null!=s&&Object.entries(s).forEach((([t,r])=>{e.setRequestHeader(t,r)}))}}));if(this.listen(),a.loadSource(t),a.attachMedia(this.hostEl),null!=this.hostEl&&!this.localVideoPaused)try{e.play.call(this,!0)}catch(e){const t=e instanceof Error?e:null;this.emitErrorDeprecated(new u.PlayingIssueError("play failed in startIt() method",{inner:t,player:this}))}this.mediaLoader.vod||a.on(this.device.Hls.Events.BUFFER_APPENDED,(()=>{null==this.hostEl||0===this.hostEl.buffered.length||this.hostEl.paused||this.hostEl.buffered.end(this.hostEl.buffered.length-1)-this.hostEl.currentTime>25&&(this.ctx.logger.warn("player fell behind more than 25s, restarting"),this.reloadAndRestart())})),a.on(this.device.Hls.Events.MEDIA_ATTACHED,(()=>{this.isAttached=!0})),a.on(this.device.Hls.Events.MEDIA_DETACHED,(()=>{this.isAttached=!1})),a.on(this.device.Hls.Events.MANIFEST_PARSED,(()=>{this.counters.lastProgress=Date.now()}))};return this.device.hidden?this.device.addEventListener("visibilitychange",r):r(),!this.hostEl.paused}))}play(){return i.__awaiter(this,void 0,void 0,(function*(){if(this.ctx.logger.debug("play()"),null==this.hostEl)return!1;if(null!=this.hls&&!this.localVideoPaused){try{yield this.playNow()}catch(e){const t=e instanceof Error?e:null;this.emitErrorDeprecated(new u.PlayingIssueError("playNow() failed",{inner:t,player:this}))}return!0}this.hostEl.onprogress=null,yield this.ready();try{yield this.playNow()}catch(e){const t=e instanceof Error?e:null;this.emitErrorDeprecated(new u.PlayingIssueError("play failed",{inner:t,player:this}))}return!0}))}get autoLevelEnabled(){var e,t;return null!==(t=null===(e=this.hls)||void 0===e?void 0:e.autoLevelEnabled)&&void 0!==t&&t}set bitrate(e){if(null!=this.hostEl&&(n.device.isImplements(s.Feature.BROWSER_TYPE)&&"firefox"===n.device.browserInfo.name||this.mediaLoader.vod)){const e=this.hostEl.currentTime;if(this.stop(),this.mediaLoader.vod){const{hostEl:t}=this,r=()=>{var i;null===(i=this.hostEl)||void 0===i||i.removeEventListener("loadedmetadata",r),t.currentTime=e};this.hostEl.addEventListener("loadedmetadata",r)}this.play().catch((e=>{const t=e instanceof Error?e:null;this.emitErrorDeprecated(new u.PlayingIssueError("play failed after changing bitrate",{inner:t,player:this}))}))}}stop(){null!=this.hls&&this.destroyHls()}pause(){var e;null===(e=this.hostEl)||void 0===e||e.pause()}destroy(){this.destroyed=!0,this.destroyHls()}destroyHls(){const{hls:e}=this;null!=e&&(null!=this.hostEl&&this.hostEl.removeEventListener("error",this._handleElError),null==e||e.detachMedia(),null==e||e.destroy(),this.hls=null,this.loadFailure=null)}recoverFromBufferSeekOverHole(){return i.__awaiter(this,void 0,void 0,(function*(){if(null!=this.data){this.stop();try{yield this.play()}catch(e){const t=e instanceof Error?e:null;this.emitErrorDeprecated(new u.PlayingIssueError("play failed after recoverFromBufferSeekOverHole()",{inner:t,player:this}))}}}))}pickEncoding(e){if(null==this.data)return null;if(null!=e&&(this.options.bitrate=e),null==this.options.bitrate)return null;const{encodings:t}=this.data;return 0===t.length||null==this.chosenLevel?null:t[this.chosenLevel]}ifNoProgress(e){const t=this.hostEl;if(null==t)return;const r=t.currentTime;n.device.setTimeout((()=>{t.currentTime<=r&&e()}),250)}emitProgress(){n.device.isImplements(s.Feature.DEBUGGING)?this.lastProgress=n.device.performance.now():this.lastProgress=Date.now(),this.emit("progress")}listen(){var e,t,r,i;let s=0;const{hls:c}=this,l=this.hostEl;if(null==c)throw new Error(g.ERRORS.HLSJS_NOT_LOADED);if(null==l)throw new Error(g.ERRORS.ELEMENT_REQUIRED);c.on(this.device.Hls.Events.ERROR,((e,t)=>{var r;try{switch(t.details){case this.device.Hls.ErrorDetails.LEVEL_LOAD_ERROR:case this.device.Hls.ErrorDetails.FRAG_LOAD_TIMEOUT:if(this.mediaLoader.vod){const e=(0,g.dataProperties)(t);return void this.emitErrorDeprecated(new u.PlaybackError("hlsjs playback error",Object.assign(Object.assign({},e),{loader:this.mediaLoader})))}return"offline"===this.mediaLoader.currentState?void this.stop():(this.ctx.logger.warn("level load reload and restart",{type:String(e)}),this.reloadAndRestart().catch((e=>{const t=(0,a.isVideoClientError)(e)&&e.code===u.ErrorCode.ManifestNotLoaded?"hlsjs restart failed because manifest has not loaded":"hlsjs restart failed";this.emitError((0,d.createError)(u.ErrorCode.PlayerLoadingFailed,t,{player:_.displayName,format:this.format},e))})),s=l.currentTime,void n.device.setTimeout((()=>{l.currentTime<=s&&(this.ctx.logger.warn("level load reload and restart",{type:String(e)}),this.reloadAndRestart().catch((e=>{const t=(0,a.isVideoClientError)(e)&&e.code===u.ErrorCode.ManifestNotLoaded?"hlsjs restart failed because manifest has not loaded":"hlsjs restart failed";this.emitError((0,d.createError)(u.ErrorCode.PlayerLoadingFailed,t,{player:_.displayName,format:this.format},e))})))}),100));case this.device.Hls.ErrorDetails.BUFFER_SEEK_OVER_HOLE:return void this.ifNoProgress((()=>{this.recoverFromBufferSeekOverHole()}));case this.device.Hls.ErrorDetails.BUFFER_APPEND_ERROR:case this.device.Hls.ErrorDetails.BUFFER_FULL_ERROR:this.counters.bufferOverflowCount++;break;case this.device.Hls.ErrorDetails.FRAG_LOAD_ERROR:case this.device.Hls.ErrorDetails.FRAG_DECRYPT_ERROR:case this.device.Hls.ErrorDetails.FRAG_PARSING_ERROR:case this.device.Hls.ErrorDetails.BUFFER_APPENDING_ERROR:case this.device.Hls.ErrorDetails.BUFFER_STALLED_ERROR:this.counters.bufferUnderflowCount++;break;case this.device.Hls.ErrorDetails.MANIFEST_LOAD_ERROR:return this.ctx.logger.error("unable to load m3u8 manifest",{level:void 0,url:t.url}),void this.setPreferredLevel(o.TranscodeScoreLevel.Highest)}switch(t.type){case this.device.Hls.ErrorTypes.NETWORK_ERROR:t.details!==this.device.Hls.ErrorDetails.FRAG_LOAD_TIMEOUT?this.counters.currentErrorCount++:this.counters.currentErrorCount=null!==(r=this.options.recoverErrorCount)&&void 0!==r?r:0,this.emitErrorDeprecated(new u.NetworkError("hlsjs playback error",{data:(0,g.dataProperties)(t)}));break;case this.device.Hls.ErrorTypes.MEDIA_ERROR:if(t.fatal)return void this.handleMediaError();if(t.details===this.device.Hls.ErrorDetails.BUFFER_STALLED_ERROR)return void this.emitErrorDeprecated(new u.PlaybackError("hlsjs media error",{data:(0,g.dataProperties)(t),loader:this.mediaLoader}));t.details===this.device.Hls.ErrorDetails.FRAG_LOAD_ERROR&&this.counters.currentErrorCount++,this.emitErrorDeprecated(new u.PlaybackError("hlsjs media error",{data:(0,g.dataProperties)(t),loader:this.mediaLoader}));break;case this.device.Hls.ErrorTypes.OTHER_ERROR:this.counters.currentErrorCount++,this.ctx.logger.warn("hlsjs other error",(0,g.dataProperties)(t));break;default:return void this.ctx.logger.error("unhandled hlsjs error",(0,g.dataProperties)(t))}this.checkRestart(t);const i=(0,g.dataProperties)(t);this.ctx.logger.warn(`${e}`,i)}catch(e){const t=e instanceof Error?e:null;this.emitErrorDeprecated(new u.HandleHlsJsError("error handling error from hlsjs library",{inner:t}))}})),l.addEventListener("progress",(()=>{this.emitProgress()})),l.addEventListener("ended",(()=>{this.emit("ended")}));const h={driver:this.format,abr:null===(e=this.manifestJson)||void 0===e?void 0:e.abr,aor:null===(t=this.manifestJson)||void 0===t?void 0:t.aor,atr:null===(r=this.manifestJson)||void 0===r?void 0:r.atr,rep:null===(i=this.manifestJson)||void 0===i?void 0:i.rep};m.timeupdateWrapper.wrap(l,(()=>{this.emit("timeupdate"),-1!==this.initialFragmentLoadId&&l.currentTime>0&&!l.paused&&!l.ended&&l.readyState>2&&(this.emit("initialFragmentLoad",f.stats.stop(this.initialFragmentLoadId,h)),this.initialFragmentLoadId=-1)})),l.addEventListener("error",this._handleElError),c.on(this.device.Hls.Events.MANIFEST_LOADING,((e,t)=>{this.emit("hlsJsInit",f.stats.stop(this.hlsJsInitId,h)),this.m3u8ManifestLoadId=f.stats.start(f.STATS_EVENTS.M3U8_MANIFEST_LOAD)})),c.on(this.device.Hls.Events.MANIFEST_LOADED,((e,t)=>{this.emit("m3u8ManifestLoad",f.stats.stop(this.m3u8ManifestLoadId,h)),this.indexManifestLoadId=f.stats.start(f.STATS_EVENTS.INDEX_MANIFEST_LOAD)})),c.once(this.device.Hls.Events.LEVEL_UPDATED,((e,t)=>{this.emit("indexManifestLoad",f.stats.stop(this.indexManifestLoadId,h))})),c.once(this.device.Hls.Events.FRAG_LOADING,(e=>{this.initialFragmentLoadId=f.stats.start(f.STATS_EVENTS.INITIAL_FRAGMENT_LOAD)})),c.on(this.device.Hls.Events.FRAG_LOADED,((e,t)=>{this.loadedFrag(t.frag)}))}_handleElError(e){var t;if((0,l.isVideoElement)(e.target)&&null!=e.target.error){switch(e.target.error.code){case l.MediaErrorCodeConstants.MEDIA_ERR_DECODE:this.handleMediaError();break;case l.MediaErrorCodeConstants.MEDIA_ERR_SRC_NOT_SUPPORTED:this.emitErrorDeprecated(new u.DriverNotSupportedError("hlsjs src not supported",{manifest:this.manifest,loader:this.mediaLoader}))}this.autoPlay&&(null===(t=this.hostEl)||void 0===t||t.play())}}handleMediaError(){const e=this.device.isImplements(s.Feature.DEBUGGING)?this.device.performance.now():Date.now(),{hls:t}=this;if(null==t){if(this.destroyed||this.isDisposed)return;throw new Error(g.ERRORS.HLSJS_NOT_LOADED)}null!=this.recoverDecodingErrorDate||e-this.recoverDecodingErrorDate>3e3?(this.recoverDecodingErrorDate=e,t.recoverMediaError()):(null!=this.recoverSwapAudioCodecDate||e-this.recoverSwapAudioCodecDate>3e3)&&(this.recoverSwapAudioCodecDate=e,t.swapAudioCodec(),t.recoverMediaError()),this.ifNoProgress((()=>{this.recoverFromBufferSeekOverHole()}))}get currentLevel(){const{hls:e}=this;return null==e||null==e.abrController.fragCurrent?null:e.abrController.fragCurrent.level}get nextLevel(){const{hls:e}=this;if(null==e)throw new Error(g.ERRORS.HLSJS_NOT_LOADED);return e.abrController.nextAutoLevel}bitrateSwitch(e){var t;null!=this.hls&&(e>(null!==(t=this.currentLevel)&&void 0!==t?t:0)?this.counters.upshift++:this.counters.downshift++,this.emit("bitrate-switch"))}loadedFrag(e){var t,r,i;const n=e;this.counters.fragCounts++,n.request=null!=this.lastFrag?n.trequest-(null!==(r=null===(t=this.lastFrag)||void 0===t?void 0:t.trequest)&&void 0!==r?r:0):n.trequest,this.lastFrag=n,this.counters.fragSize+=n.loaded,this.counters.fragDuration+=n.duration,this.counters.fragDownloadTime+=n.request,this.counters.fragMaxTime=Math.max(this.counters.fragMaxTime,n.request),this.counters.fragMinTime=Math.min(null!==(i=this.counters.fragMinTime)&&void 0!==i?i:n.request,n.request)}}t.HlsJsPlayer=_,_.displayName="HlsJsPlayer"},9354:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ManifestPlayer=void 0;const i=r(7582),n=r(4702),s=r(8949),a=r(167),o=r(4280),c=r(813),l=r(6639),d=r(8762),u=r(5445),h=r(2834),p=r(3199),f=r(5580),m=r(3757),g=r(644),v=r(327),_=r(2149),y=r(3772),b=r(3078),E=r(2835),S=r(9182),w=r(7671);class T extends v.ObservableEventEmitter{attachTo(e){this.elementSupervisor=w.MediaElementSupervisor.getSupervisor(e).attachToPlayer(this);const t=this.currentPlayer;null!=t&&null!=this.elementSupervisor&&t.initVideoEl(this.elementSupervisor,!0).catch((e=>this.ctx.logger.error(e)))}setPreferredLevel(e){this.preferredLevel=e}get noConsumerAudioAndVideo(){var e;return!!(null===(e=this.currentPlayer)||void 0===e?void 0:e.isImplements(u.Feature.CONSUMER))&&!this.currentPlayer.consumerAudioEnabled&&!this.currentPlayer.consumerVideoEnabled}get webrtcConnecting(){var e;return!!(null===(e=this.currentPlayer)||void 0===e?void 0:e.isImplements(u.Feature.BROADCAST))&&this.currentPlayer.isConnecting}get currentPlayer(){return this[y.implementation]}set currentPlayer(e){this[y.implementation]=e}get lowLatency(){var e;return!!this.isImplements(u.Feature.BITRATE_SWITCHING)&&"webrtc"===(null===(e=this.currentPlayer)||void 0===e?void 0:e.format)}set lowLatency(e){var t,r;this.supportsLowLatency?e?("webrtc"!==(null===(t=this.currentPlayer)||void 0===t?void 0:t.format)&&this.selectWebrtcPlayer(),this.preferredLevel=a.SourceScoreLevel.High):("webrtc"===(null===(r=this.currentPlayer)||void 0===r?void 0:r.format)&&this.nextPlayer(),this.preferredLevel=a.TranscodeScoreLevel.Highest):this.logger.warn("unable to set low latency. player does not support low latency.")}selectWebrtcPlayer(){const e=this.availablePlayers.findIndex((e=>"webrtc"===e.id));this.selectPlayer(e)}isImplements(e){var t;const r=this[y.implementation];return e===u.Feature.PLAYER_SELECTOR||null!==(t=null==r?void 0:r.isImplements(e))&&void 0!==t&&t}get supportsLowLatency(){return this.availablePlayers.some((e=>"webrtc"===e.id))}get logger(){return this.ctx.logger}constructor(e,t,r){var i;super(!1),this.lastTimeUpdate=Date.now()+5e3,this.manifest=null,this.availablePlayers=[],this.providedPlayers=[],this.currentPlayerIndex=null,this.allPlayers=[],this.manifestLoadId=0,this.blurred=!1,this.firstLoadId=b.stats.start(b.STATS_EVENTS.FIRST_LOAD),this.ctx=e,this.options=Object.assign(Object.assign({displayPoster:"preview"},r),{driverFailoverSeconds:null!==(i=r.driverFailoverSeconds)&&void 0!==i?i:10}),(0,s.makeObservable)(this,{blurred:s.observable}),this.provider=t,(0,g.onceCanceled)(e).then((e=>this.dispose(`ManifestPlayer Context Cancelled: ${e}`)));const n=(0,m.makeBounded)(new Proxy(this,E.proxyHandler));return n.init(),e.logger.attachObject(n),e.logger.trace("constructor()",r),n}handleTimeUpdate(){this.lastTimeUpdate=Date.now()}handleWebsocketReconnect(){this.selectWebrtcPlayer()}init(){this.provider.on("manifest",this.updateManifest),this.on("timeupdate",this.handleTimeUpdate),this.addInnerDisposer((()=>this.off("timeupdate",this.handleTimeUpdate)));const e={autoPlay:this.options.autoPlay,muted:this.options.muted,volume:this.options.volume};this.allPlayers=this.parsePlayerSpecs(this.options.players,e),this.validatePlayers(this.allPlayers).then((()=>{this.provider.once("source",(e=>{var t,r,i,n,s;this.manifest=e,this.emit("manifestLoadTime",b.stats.stop(this.manifestLoadId,{driver:(null===(t=this.currentPlayer)||void 0===t?void 0:t.format)||void 0,abr:null===(r=this.manifest)||void 0===r?void 0:r.abr,aor:null===(i=this.manifest)||void 0===i?void 0:i.aor,atr:null===(n=this.manifest)||void 0===n?void 0:n.atr,rep:null===(s=this.manifest)||void 0===s?void 0:s.rep}))})),this.manifestLoadId=b.stats.start(b.STATS_EVENTS.MANIFEST_LOAD),this.provider.load("preview"===this.options.displayPoster).then(this.firstLoad).catch((e=>this.emitError((0,p.createError)(c.ErrorCode.PlayerLoadingFailed,"unable to start playing because of manifest loading error",{},e))))})),this.driverFailoverInterval(),this.on("localVideoPaused",(e=>{e?this.currentPlayer?this.currentPlayer.updatePosterWithLatestFrame():this.poster=this.selectPoster():this.driverFailoverInterval()})),this.on("implementation",(()=>this.emit("currentPlayer",this)))}driverFailoverInterval(){null!=this.options.driverFailoverSeconds&&!0!==this.localVideoPaused&&(o.device.clearInterval(this.driverFailInterval),this.driverFailInterval=o.device.setInterval((()=>{null!=this.options.driverFailoverSeconds&&(!0!==this.localVideoPaused?this.driverFailoverCheck(this.options.driverFailoverSeconds):o.device.clearInterval(this.driverFailInterval))}),1e3),this.addInnerDisposer((()=>o.device.clearInterval(this.driverFailInterval))))}driverFailoverCheck(e){"online"!==this.provider.currentState||this.noConsumerAudioAndVideo||o.device.hidden||this.webrtcConnecting?this.lastTimeUpdate=Date.now():Date.now()-this.lastTimeUpdate>1e3*e&&(this.logger.warn(`driver failover check: no timeupdate for ${e} seconds`),this.lastTimeUpdate=Date.now()+5e3,this.nextPlayer())}firstLoad(){var e;(null===(e=this.elementSupervisor)||void 0===e?void 0:e.hasPoster())||(this.poster=this.selectPoster())}selectPoster(){var e,t,r,i,n;const s=this.options.displayPoster,a=null===(e=this.manifest)||void 0===e?void 0:e.formats.jpeg;if(null==s||!1===s||null==a)return this.ctx.logger.debug("no posters",{displayPoster:s,manifest:this.manifest}),null;if("preview"===s&&null!=(null===(t=this.manifest)||void 0===t?void 0:t.previewImg))return this.ctx.logger.debug("select previewImg poster"),null===(r=this.manifest)||void 0===r?void 0:r.previewImg;let o,c;"object"==typeof s?(o=s.videoHeight,c=s.videoWidth):null!=(null===(n=null===(i=this.currentQuality)||void 0===i?void 0:i.layer)||void 0===n?void 0:n.appData)&&(o=this.currentQuality.layer.appData.videoHeight,c=this.currentQuality.layer.appData.videoWidth);const l=a.encodings.find((e=>e.videoHeight===o&&e.videoWidth===c));return null!=l?(this.ctx.logger.debug(`select ${c}x${o} poster`),l.location):a.encodings.length>0?(this.ctx.logger.debug("select first poster"),a.encodings[0].location):(this.ctx.logger.debug("poster not found"),null)}updatePosterWithLatestFrame(){null!=this.elementSupervisor&&o.device.isImplements(h.Feature.CREATE_SCREENSHOT)?this.poster=this.elementSupervisor.createScreenshot():this.ctx.logger.warn("Unable to set update poster. Create screenshot is not compatible with device.")}parsePlayerSpecs(e,t){return e.map((e=>{var r;if("string"==typeof e)return{id:e,options:t};const i=null!==(r=e.options)&&void 0!==r?r:{};return Object.assign(Object.assign({},e),{options:Object.assign(Object.assign({},t),i)})}))}validatePlayers(e){return i.__awaiter(this,void 0,void 0,(function*(){this.providedPlayers=[];const t=yield Promise.all(e.map((e=>d.players[e.id].isSupported(this.logger)))),r=e.map(((e,r)=>Object.assign(Object.assign({},e),{supported:t[r]})));this.providedPlayers=r.filter((e=>e.supported)),this.emit("availablePlayers",{players:this.providedPlayers}),0===this.providedPlayers.length&&this.noDrivers()}))}updateManifest(e){var t;this.emit("manifest",e);const r={401:"MANIFEST_UNAUTHORIZED",403:"MANIFEST_FORBIDDEN",404:"MANIFEST_NOT_FOUND"};if(this.manifest=e,"forbidden"===e.state){const e=`manifest is forbidden after polling it for '${this.provider.options.unauthorizedRecoveryDuration}' ms`;return this.emitErrorDeprecated(new f.ManifestError(e,{loader:this.provider})),void this.dispose(e)}if("online"!==e.state)return 401!==e.code&&403!==e.code||(this.options.refetch?this.emit("info",{code:r[e.code]}):(this.emitErrorDeprecated(new f.ManifestError(`manifest error: ${r[e.code]}`,{loader:this.provider})),this.dispose(r[e.code]))),void(404!==e.code&&403!==e.code||(null===(t=this.currentPlayer)||void 0===t||t.dispose(),this.currentPlayer=null,this.emit("info",{code:r[e.code]})));this.availablePlayers=this.providedPlayers.filter((t=>{const r=e.formats[d.players[t.id].format];return null!=r&&(0,l.isValidFormat)(r)})),this.emit("availablePlayers",{players:this.availablePlayers}),null==this.currentPlayer&&(0===this.availablePlayers.length?this.noDrivers():(this.ctx.logger.debug("Select the first player"),this.selectPlayer(0)));const i=this.currentPlayer,n=e.formats[null==i?void 0:i.format];this.updateQualities(n)}updateQualities(e){var t,r,i,n;const s=this.currentPlayer;if(null!=s&&(0,a.isGenericFormat)(e)){const a=null!==(i=(0,S.fetchManifestQualities)(e,null!==(r=null===(t=e.origin)||void 0===t?void 0:t.location)&&void 0!==r?r:null,s))&&void 0!==i?i:[];(0,S.equalQualities)(a,null!==(n=this.availableQualities)&&void 0!==n?n:[])||(this.availableQualities=a),this.blurred=null!=e.substitute}}noDrivers(){"online"===this.provider.currentState&&(this.emit("noPlayers",!0),this.emitErrorDeprecated(new f.NoDriversError("no drivers",{})))}nextPlayer(){var e;1!==this.availablePlayers.length?null==this.currentPlayerIndex||this.currentPlayerIndex>=this.availablePlayers.length-1?this.selectPlayer(0):this.selectPlayer(this.currentPlayerIndex+1):null===(e=this.restart)||void 0===e||e.call(this,!1)}selectPlayer(e){var t;if(this.suspended=!0,this.ctx.logger.debug("selectPlayer()",{index:e}),e>=this.availablePlayers.length)return void this.noDrivers();const r=this.availablePlayers[e];this.emit("driver",r.id);const i=d.players[r.id];if(null==i)return void this.noDrivers();if(null!=this.currentPlayer){const e=this.currentPlayer;this.currentPlayer=null,e.removeAllListeners("error"),e.dispose("replacing current player")}if(null!=i.format){const e=null===(t=this.manifest)||void 0===t?void 0:t.formats[i.format];this.updateQualities(e)}const n=new i((0,_.extendContext)(this.ctx,i),this.provider,r.options);this.currentPlayer=n,this.currentPlayerIndex=e,this.ctx.logger.debug("set manifest player",{player:this.currentPlayer,format:n.format,name:r}),n.on("error",(e=>{switch(e.code){case c.ErrorCode.EmbedSWFFailed:case c.ErrorCode.NotSupported:case c.ErrorCode.HandleHlsJsError:case c.ErrorCode.JoinCallError:case c.ErrorCode.UnableJoinCall:this.ctx.logger.debug(`Select next player because ${e.code}`),this.nextPlayer();break;default:e.critical&&(this.ctx.logger.debug("Select next player because the error is critical"),this.nextPlayer())}})),n.on("videoFirstPlay",(()=>{var e,t,r,i,n;this.emit("initialLoadTime",b.stats.stop(this.firstLoadId,{driver:(null===(e=this.currentPlayer)||void 0===e?void 0:e.format)||void 0,abr:null===(t=this.manifest)||void 0===t?void 0:t.abr,aor:null===(r=this.manifest)||void 0===r?void 0:r.aor,atr:null===(i=this.manifest)||void 0===i?void 0:i.atr,rep:null===(n=this.manifest)||void 0===n?void 0:n.rep}))})),n.isImplements(u.Feature.BROADCAST)&&(n.on("websocketReconnect",this.handleWebsocketReconnect),n.addInnerDisposer((()=>this.off("websocketReconnect",this.handleWebsocketReconnect)))),null!=this.elementSupervisor&&n.initVideoEl(this.elementSupervisor,!0).catch((e=>this.ctx.logger.error(e))),this.suspended=!1}handlePlayerAccessDenied(e){this.dispose(e.message)}toJSON(){var e,t,r;const i=null===(e=this[y.implementation])||void 0===e?void 0:e.toJSON();if(null==i||"object"!=typeof i||Array.isArray(i)||(0,n.isSerializableObject)(i))return{};const s=null!==(t=i.aggregates)&&void 0!==t?t:{};return null==s||"object"!=typeof s||Array.isArray(s)||(0,n.isSerializableObject)(s)?i:(delete i.aggregates,Object.assign(Object.assign({},i),{options:this.options,playersSpecs:this.availablePlayers,currentPlayerIndex:this.currentPlayerIndex,uri:null===(r=this.provider)||void 0===r?void 0:r.uri,aggregates:Object.assign(Object.assign(Object.assign({},s),(0,n.extractAggregates)(this.provider,"support")),{support:this.ctx.support.hash})}))}}t.ManifestPlayer=T,T.displayName="ManifestPlayer"},7671:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MediaElementSupervisor=void 0;const i=r(4280),n=r(3676),s=r(327),a=r(2835),o=new WeakMap;class c extends s.ObservableEventEmitter{static getSupervisor(e){return o.has(e)||o.set(e,new c(e)),o.get(e)}constructor(e){super(),this.element=e,this.activePlayer=null,this.debugSuspendTimeupdate=!1,e.setAttribute("playsinline","true"),e.setAttribute("webkit-playsinline","true"),this.startListenEvent("play","handleElPlay"),this.startListenEvent("pause","handleElPause"),this.startListenEvent("volumechange","handleElVolumeChange"),this.startListenEvent("error","handleElError"),this.startListenEvent("progress","handleElProgress"),a.timeupdateWrapper.wrap(e,this.createEventHandler("handleElTimeupdate")),this.element.addEventListener("loadeddata",(()=>{this.emit("loadeddata")}))}attachToPlayer(e){return this.element.src="",this.element.srcObject=null,this.activePlayer=e,this}createEventHandler(e){return()=>{var t,r;null==this.activePlayer||this.activePlayer.isDisposed||"handleElTimeupdate"===e&&this.debugSuspendTimeupdate||null===(r=null===(t=this.activePlayer)||void 0===t?void 0:t[e])||void 0===r||r.call(t)}}startListenEvent(e,t){const r=this.createEventHandler(t);this.element.addEventListener(e,r),this.addInnerDisposer(this.stopListenEvent.bind(this,e,r))}stopListenEvent(e,t){this.element.removeEventListener(e,t)}isVideoPlaying(){return this.element.currentTime>0&&!this.element.paused&&!this.element.ended&&this.element.readyState>2}setPoster(e){this.element.setAttribute("poster",e)}hasPoster(){return null!=this.element.getAttribute("poster")}createScreenshot(){try{return i.device.isImplements(i.Feature.CREATE_SCREENSHOT)?i.device.createScreenshot(this.element):null}catch(e){return null}}pause(){this.element.pause()}updateSrc(e){this.element.src=e,this.element.srcObject=null}updateSrcObject(e){this.element.src="",this.element.srcObject=e}dumpVideoElement(){return(0,n.dumpVideoElement)(this.element)}get muted(){return this.element.muted}set muted(e){this.element.muted=e}get paused(){return this.element.paused}get volume(){return this.element.volume}set volume(e){this.element.volume=e}get error(){return this.element.error}get autoplay(){return this.element.autoplay}set autoplay(e){this.element.autoplay=e}get buffered(){return this.element.buffered}get ended(){return this.element.ended}get readyState(){return this.element.readyState}get currentTime(){return this.element.currentTime}set currentTime(e){this.element.currentTime=e}get playbackRate(){return this.element.playbackRate}set playbackRate(e){this.element.playbackRate=e}get sourceKind(){const e=i.device.isImplements(i.Feature.URL_LOCATION)?i.device.location:"";return null!=this.element.srcObject?"srcObject":null!=this.element.src&&""!==this.element.src&&this.element.src!==e?"src":null}isSourceSet(){const e=i.device.isImplements(i.Feature.URL_LOCATION)?i.device.location:"";return null!=this.element.src&&""!==this.element.src&&this.element.src!==e||null!=this.element.srcObject}get srcObject(){return this.element.srcObject}play(){return this.element.play()}}t.MediaElementSupervisor=c},6395:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MediasoupPlayer=void 0;const i=r(7582),n=r(4702),s=r(8949),a=r(5445),o=r(3199),c=r(5580),l=r(8101),d=r(6214),u=r(5904),h=r(2835),p=r(9182);class f extends h.CorePlayer{get displayName(){return f.displayName}static isSupported(e){return i.__awaiter(this,void 0,void 0,(function*(){return(0,u.supportsMediasoupWebrtc)("Mediasoup Player",e)}))}isSupported(){return i.__awaiter(this,void 0,void 0,(function*(){return f.isSupported()}))}static get format(){return"webrtc"}get format(){return f.format}get implementedFeatures(){return this.isManifestPlayer?[a.Feature.CONSUMER,a.Feature.BITRATE_SWITCHING,a.Feature.MUTED_AUTOPLAY]:[a.Feature.CONSUMER,a.Feature.BITRATE_SWITCHING]}constructor(e,t,r){super(e,t,r),this.preferredSource=null,this.hasAudio=!1,this.hasVideo=!1,this.isManifestPlayer=!1,(0,s.makeObservable)(this,{hasAudio:s.observable,hasVideo:s.observable,consumerAudioEnabled:s.computed,consumerVideoEnabled:s.computed,noConsumerAudioAndVideo:s.computed}),this.playerOptions=r,this.playerOptions.mutedAutoplayFallback&&(this.isManifestPlayer=!0),this.addInnerDisposer((0,s.reaction)((()=>this.availableQualities),(e=>{this.emit("layers",(0,p.getBitrateLayersFromQualities)(e))}),{equals:s.comparer.structural})),this.addInnerDisposer((0,s.reaction)((()=>this.currentQuality),(e=>{var t;if(this.emit("activeLayer",null!==(t=null==e?void 0:e.layer)&&void 0!==t?t:null),this.provider instanceof l.MediasoupSource&&this.provider.peer instanceof d.Peer&&null!=(null==e?void 0:e.layer))try{this.provider.peer.setPreferredEncoding(e.layer)}catch(t){this.emitError((0,o.createError)(c.ErrorCode.UnableSwitchQuality,"Failed to change quality for webrtc consumer after currentQuality is changed",{player:this.displayName,format:this.format,preferredLevel:e.level}))}}),{equals:s.comparer.structural})),this.provider instanceof l.MediasoupSource&&(this.provider.on("availableQualities",this.handleAvailableQualities),this.provider.on("accessDenied",this.handleAccessDenied)),this.addInnerDisposer((()=>{this.provider instanceof l.MediasoupSource&&(this.provider.off("availableQualities",this.handleAvailableQualities),this.provider.off("accessDenied",this.handleAccessDenied))})),this.ctx.logger.trace("constructor()",{options:r})}handleSource(e){return i.__awaiter(this,void 0,void 0,(function*(){this.suspended||(this.ctx.logger.trace("handleSource()"),this.source=e,null!=this.elementSupervisor&&(this.autoPlay||!this.internalPaused?(yield this.playingPromise,this.ctx.logger.trace("handleSource() -> await this.playingPromise"),this.elementSupervisor.updateSrcObject(e),yield this.play(),this.ctx.logger.trace("handleSource() -> await play()")):this.elementSupervisor.updateSrcObject(e),this.ctx.logger.debug("srcObject set")),this.provider instanceof l.MediasoupSource&&(this.hasAudio=this.provider.hasAudio,this.hasVideo=this.provider.hasVideo,this.consumerAudioMuted=!this.hasAudio||this.provider.audioMuted,this.consumerVideoPaused=!this.hasVideo||this.provider.videoPaused,this.availableQualities=this.provider.availableQualities))}))}handleAccessDenied(e){var t;this.provider instanceof l.MediasoupSource&&(null===(t=this.provider.peer.call)||void 0===t||t.dispose(e.message))}handleAvailableQualities(e){this.availableQualities=e}get consumerAudioEnabled(){const{consumerAudioMuted:e,hasAudio:t}=this;return this.provider instanceof l.MediasoupSource&&t&&!1===e}get consumerVideoEnabled(){const{consumerVideoPaused:e,hasVideo:t}=this;return this.provider instanceof l.MediasoupSource&&t&&!1===e}get noConsumerAudioAndVideo(){const{consumerAudioMuted:e,hasAudio:t,consumerVideoPaused:r,hasVideo:i}=this;return!(t&&!1===e||i&&!1===r)}get streamName(){return this.provider instanceof l.MediasoupSource?this.provider.streamName:""}get peerId(){var e,t;return this.provider instanceof l.MediasoupSource&&null!==(t=null===(e=this.provider.peer)||void 0===e?void 0:e.peerId)&&void 0!==t?t:""}get callId(){var e,t,r;return this.provider instanceof l.MediasoupSource&&null!==(r=null===(t=null===(e=this.provider.peer)||void 0===e?void 0:e.call)||void 0===t?void 0:t.id)&&void 0!==r?r:""}get userId(){var e,t;return this.provider instanceof l.MediasoupSource&&null!==(t=null===(e=this.provider.peer)||void 0===e?void 0:e.userId)&&void 0!==t?t:""}toJSON(){var e;const t=super.toJSON();if(null==t||"object"!=typeof t||Array.isArray(t)||(0,n.isSerializableObject)(t))return{};const r=null!==(e=t.aggregates)&&void 0!==e?e:{};return null==r||"object"!=typeof r||Array.isArray(r)||(0,n.isSerializableObject)(r)?t:(delete t.aggregates,Object.assign(Object.assign({},t),{options:this.options,aggregates:Object.assign(Object.assign(Object.assign({},r),(0,n.extractAggregates)(this.provider,"support")),{support:this.ctx.support.hash,consumerAudioEnabled:this.consumerAudioEnabled,consumerVideoEnabled:this.consumerVideoEnabled,noConsumerAudioAndVideo:this.noConsumerAudioAndVideo,preferredSource:this.preferredSource,currentQuality:this.currentQuality,isManifestPlayer:this.isManifestPlayer,peerId:this.peerId,userId:this.userId})}))}}t.MediasoupPlayer=f,f.displayName="MediasoupPlayer"},7245:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Mp4WsPlayer=void 0;const i=r(7582),n=r(7881),s=r(8949),a=r(4280),o=r(5445),c=r(2914),l=r(5580),d=r(2843),u=r(644),h=r(6107),p=r(327),f=r(2149),m=r(4851),g=r(2835),v=r(9182),_="lv_origin",y=["A","B","N"];let b=0;class E extends g.CorePlayer{static isSupported(e){return i.__awaiter(this,void 0,void 0,(function*(){return(0,d.supportsMp4)(e)}))}isSupported(){return i.__awaiter(this,void 0,void 0,(function*(){return E.isSupported()}))}static get format(){return"mp4-ws"}get format(){return E.format}handleSource(e){this.ctx.logger.debug("mp4-ws: handleSource()");const t=null==e?void 0:e.formats["mp4-ws"];null!=t?0===this.data.encodings.length&&(this.data=t):this.emitErrorDeprecated(new l.DriverNotSupportedError("manifest doesn't contains 'mp4-hls' format",{manifest:e}))}get implementedFeatures(){return[o.Feature.BITRATE_SWITCHING,o.Feature.MUTED_AUTOPLAY]}constructor(e,t,r){var i;if(super(e,t,r),this.data={encodings:[],audioCodec:"",videoCodec:""},this.sessionKey=(0,m.uuidv4)(),this.origin=null,this.player=null,this.currentManifest=null,this.seekingOverHole=!1,this.activeEncoding=null,this.estimatedKbps=null,this.playbackLock=!1,this.nudgeInterval=void 0,this.nudgeTime=null,this.lastBufferEnd=null,this.fragFetchTime=0,!a.device.isImplements(a.Feature.DEBUGGING)||!a.device.isImplements(a.Feature.MEDIA_DEVICE))throw new Error("Device is not supported");(0,u.onceCanceled)(this.ctx).then((e=>this.dispose(`Mp4Ws Player Context Cancelled: ${e}`))),this.addInnerDisposer(this.stop),this.device=a.device;const n=this.options;(null==n.backFill||Number.isNaN(n.backFill)||n.backFill<0||n.backFill>10)&&(n.backFill=2),(null==n.maxGap||Number.isNaN(n.maxGap)||n.maxGap<0||n.maxGap>1e4)&&(n.maxGap=500),(null==n.retry||Number.isNaN(n.retry)||n.retry<0||n.retry>30)&&(n.retry=20),(null==n.requiredBuffer||Number.isNaN(n.requiredBuffer)||n.requiredBuffer<0||n.requiredBuffer>10)&&(n.requiredBuffer=1),(a.device.isImplements(a.Feature.BROWSER_TYPE)&&"edge"===a.device.browserInfo.name||a.device.isImplements(a.Feature.BROWSER_TYPE)&&"ie"===a.device.browserInfo.name)&&(n.backFill=Math.max(n.backFill,4),n.requiredBuffer=Math.max(n.requiredBuffer,3)),(null==n.initFailTimeout||Number.isNaN(n.initFailTimeout)||n.initFailTimeout<0)&&(n.initFailTimeout=3e4),(null==n.playbackFailTimeout||Number.isNaN(n.playbackFailTimeout)||n.playbackFailTimeout<0)&&(n.playbackFailTimeout=6e4),null!=n.mode&&y.includes(n.mode)||(n.mode="B"),n.requiredBufferBeforeRemove=n.requiredBuffer,n.skipWatchInterval=Math.floor(400*n.requiredBuffer),n.skipForwardThreshold=25,Number.isNaN(null!==(i=n.maxShifts)&&void 0!==i?i:NaN)&&(n.maxShifts=1/0),this.mse=this.options,this.on("currentQuality",(e=>{var t;this.setQuality(e),null===(t=this.player)||void 0===t||t.setupTransport()})),(0,s.autorun)((e=>{const t=this.elementSupervisor,r=this.provider.source;null!=t&&null!=r&&(e.dispose(),this.handleSource(r),this.initSource(t))}))}handleElTimeupdate(){var e;super.handleElTimeupdate();const t=this.elementSupervisor,r=null===(e=this.elementSupervisor)||void 0===e?void 0:e.buffered;null!=t&&null!=r&&0!==r.length&&(r.end(r.length-1)-t.currentTime>this.mse.requiredBuffer?a.device.isImplements(a.Feature.BROWSER_TYPE)&&"safari"===a.device.browserInfo.name?t.playbackRate=1.01:t.playbackRate=1.05:t.playbackRate=1)}handleElError(){var e,t,r;super.handleElError();const i=null===(t=null===(e=this.elementSupervisor)||void 0===e?void 0:e.error)||void 0===t?void 0:t.code;if(null!=i)switch(i){case 1:this.emitErrorDeprecated(new l.MediaError("MEDIA_ERR_ABORTED",{critical:!0,eventTargetCode:i}));break;case 2:this.emitErrorDeprecated(new l.MediaError("MEDIA_ERR_NETWORK",{critical:!0,eventTargetCode:i}));break;case 3:this.emitErrorDeprecated(new l.DriverNotSupportedError("MEDIA_ERR_DECODE",{critical:!0,eventTargetCode:i}));break;case 4:this.emitErrorDeprecated(new l.DriverNotSupportedError("MEDIA_ERR_SRC_NOT_SUPPORTED",{critical:!0,eventTargetCode:i}));break;default:(null===(r=this.elementSupervisor)||void 0===r?void 0:r.isSourceSet())||this.ctx.logger.error("meow unknown element error",{manifest:this.manifest}),this.localVideoPaused||this.isDisposed||this.restart(!1)}}handleElPause(){super.handleElPause(),"offline"===this.provider.currentState&&this.stop()}getLevelForBitrate(e){var t,r;const{encodings:i}=this.data;if(0===i.length)return null;let n;for(n=0;n<i.length;n++){const s=i[n];if(null!=s&&null!=s.videoWidth&&(null!==(t=i[n].videoKbps)&&void 0!==t?t:0)+(null!==(r=i[n].audioKbps)&&void 0!==r?r:0)>e)break}return n=Math.max(n-1,0),n}get currentLevel(){var e,t,r,i,n;return null!=this.options.bitrate?this.getLevelForBitrate(this.options.bitrate):null==this.activeEncoding?this.getLevelForBitrate(null!==(e=this.options.estimatedKbps)&&void 0!==e?e:0):this.getLevelForBitrate((null!==(r=null===(t=this.activeEncoding)||void 0===t?void 0:t.videoKbps)&&void 0!==r?r:0)+(null!==(n=null===(i=this.activeEncoding)||void 0===i?void 0:i.audioKbps)&&void 0!==n?n:0))}pickEncoding(e){var t;const r=null!=e?e:this.options.bitrate;let{encodings:i}=this.data;if(0===i.length)return null;if(null==r)return i[0];i=i.sort(((e,t)=>{var r,i,n,s;return(null!==(r=e.audioKbps)&&void 0!==r?r:0)+(null!==(i=e.videoKbps)&&void 0!==i?i:0)<(null!==(n=t.audioKbps)&&void 0!==n?n:0)+(null!==(s=t.videoKbps)&&void 0!==s?s:0)?1:-1}));const n=i.find((e=>{var t,i;return(null!==(t=e.audioKbps)&&void 0!==t?t:0)+(null!==(i=e.videoKbps)&&void 0!==i?i:0)<=r}));return null!=n?n:i[null!==(t=this.currentLevel)&&void 0!==t?t:0]}setQuality(e){null!=(null==e?void 0:e.encoding)?this.setEncoding(e.encoding):this.ctx.logger.warn("encoding not found",{qty:e})}setEncoding(e){var t,r,i,n,s;if(null==e||(null===(t=this.activeEncoding)||void 0===t?void 0:t.videoKbps)===e.videoKbps&&(null===(r=this.activeEncoding)||void 0===r?void 0:r.audioKbps)===e.audioKbps)return;if(this.activeEncoding=e,this.estimatedKbps=(null!==(i=e.videoKbps)&&void 0!==i?i:0)+(null!==(n=e.audioKbps)&&void 0!==n?n:0),a.device.isImplements(a.Feature.BROWSER_TYPE)&&"safari"===a.device.browserInfo.name){this.stop();try{this.play().then((()=>{this.emit("bitrate-switch")}))}catch(e){const t=e instanceof Error?e:null;this.emitErrorDeprecated(new l.PlayingIssueError("play failed after setEncoding()",{inner:t,player:this}))}return}const o=e.location.split("/");null===(s=this.player)||void 0===s||s.switchBitrate(o[o.length-1]),this.emit("bitrate-switch")}switchBitrate(e){this.ctx.logger.debug("meow switch bitrate",{bitrate:e}),this.options.origin=!1,this.options.bitrate=e,this.emit("bitrate-switch"),this.stop();try{this.play().then((()=>{this.emit("bitrate-switch")}))}catch(e){const t=e instanceof Error?e:null;this.emitErrorDeprecated(new l.PlayingIssueError("play failed after switchBitrate()",{inner:t,player:this}))}}addSessionKey(e){if(e.includes("sid"))return e;b++;const t=e.includes("?")?"&":"?";return`${e}${t}sid=${this.sessionKey}&c=${b}`}get originLocation(){const e=this.origin;return null==e?null:this.addSessionKey(e.location)}get manifest(){var e,t;let r;if(this.options.origin){if(r=this.originLocation,null==r)return this.options.origin=!1,this.manifest}else{if(0===this.data.encodings.length){const e=this.originLocation;return null!=e&&(this.options.origin=!0),e}const i=this.pickEncoding(null!==(t=null!==(e=this.options.bitrate)&&void 0!==e?e:this.estimatedKbps)&&void 0!==t?t:this.options.estimatedKbps);if(null==i)return null;r=i.location}return null==r?null:this.addSessionKey(r)}pause(){this.stop()}stop(){this.playbackLock=!1,clearInterval(this.nudgeInterval),null!=this.player&&this.player.once("disposed",(()=>{this.player=null}))}get location(){return null==this.player?null:this.player.manifest}set location(e){}corePlay(){const e=Object.create(null,{play:{get:()=>super.play}});return i.__awaiter(this,void 0,void 0,(function*(){return e.play.call(this,!0)}))}play(){return i.__awaiter(this,void 0,void 0,(function*(){const e=this.elementSupervisor;if(null==e)throw new Error(v.ERRORS.ELEMENT_REQUIRED);return this.playbackLock?!e.paused:(this.playbackLock=!0,this.options.autoPlay&&this.localVideoPaused&&setTimeout((()=>{this.localVideoPaused=!1})),null!=this.player?this.player.play():(this.ctx.logger.debug("meow driver play received"),!this.localVideoPaused))}))}initSource(e){if(null!=this.player)return;clearInterval(this.nudgeInterval),this.nudgeTime=null;let t=0;this.nudgeInterval=a.device.setInterval((()=>{if(!this.localVideoPaused&&0!==e.currentTime){if(null!=this.nudgeTime&&e.currentTime===this.nudgeTime&&(null==this.lastBufferEnd||e.currentTime<this.lastBufferEnd)){this.ctx.logger.debug("meow playback halted, nudging"),t++,e.currentTime+=.1;const r=this.corePlay();null!=r.then&&r.catch((()=>{}))}else t=0,this.nudgeTime=e.currentTime;t>29&&(clearInterval(this.nudgeInterval),this.ctx.logger.debug("meow too many halt nudges, restart"),this.restart(!1))}}),500);const r=this.provider.source;if(null!=r&&setTimeout((()=>{var e;null===(e=this.provider)||void 0===e||e.emit("source",r)})),this.ctx.logger.debug("meow manifest verified, player created"),null==this.elementSupervisor)throw new Error(v.ERRORS.ELEMENT_REQUIRED);if(this.player=new w(this.ctx,this,this.options,this.provider,Reflect.get(this.elementSupervisor,"element")),this.counters.upshift=0,this.counters.downshift=0,this.counters.currentErrorCount=0,this.counters.fragCounts=0,this.counters.fragSize=0,this.counters.fragFetchTime=0,this.counters.fragMaxTime=0,this.counters.fragMinTime=0,this.player.on("stop",(()=>{this.stop()})),this.player.on("no-audio",(()=>{this.emit("no-audio")})),this.player.on("upshift",(()=>{this.counters.upshift++})),this.player.on("downshift",(()=>{this.counters.downshift++})),this.player.on("fragment",(e=>{var t;this.counters.fragCounts++,this.counters.fragSize+=e.size,this.counters.fragFetchTime+=e.time,this.counters.fragMaxTime=Math.max(this.counters.fragMaxTime,e.time),this.counters.fragMinTime=Math.min(null!==(t=this.counters.fragMinTime)&&void 0!==t?t:e.time,e.time)})),this.player.on("error",(e=>{this.counters.currentErrorCount++,e.notSupported?this.emitErrorDeprecated(new l.DriverNotSupportedError("player error",{data:{fatal:e.fatal,message:e.message,notSupported:e.notSupported,err:(0,l.wrapNativeError)(e.err)}})):e.fatal&&(this.ctx.logger.debug("meow player fatal error, restarting"),this.restart(!1))})),this.device.hidden)this.device.addEventListener("visibilitychange",(()=>{var e;try{null===(e=this.player)||void 0===e||e.play()}catch(e){const t=e instanceof Error?e:null;this.emitErrorDeprecated(new l.PlayingIssueError("play failed after visibilitychange event triggered",{inner:t,player:this}))}}));else try{this.pausedOnUnmount||this.player.play()}catch(e){const t=e instanceof Error?e:null;this.emitErrorDeprecated(new l.PlayingIssueError("play failed",{inner:t,player:this}))}}}t.Mp4WsPlayer=E,E.displayName="Mp4WsPlayer";const S=new WeakMap;class w extends p.ObservableEventEmitter{constructor(e,t,r,i,n){var s,o;if(super(),this.buffering=!1,this.queue=[],this.sourceBuffers=[],this.receivedSegments=0,this.abrController=null,this.encoding=null,this.transport=null,this.version=null,this.ms=null,this.mediaSourceTime=null,this.manifest=null,this.lastMessageReceived=null,this.logInterval=void 0,this.gcInterval=void 0,this.destroyed=!1,this.ctx=e,(0,u.onceCanceled)(e).then((e=>this.dispose(`Mp4ws Context Cancelled: ${e}`))),this.addInnerDisposer(this.destroy),!a.device.isImplements(a.Feature.DEBUGGING)||!a.device.isImplements(a.Feature.MEDIA_SOURCE)||!a.device.isImplements(a.Feature.LOCAL_STORAGE))throw new Error("Device is not supported");if(this.device=a.device,this.videoPlayer=t,this.mediaLoader=i,this.options=r,this.el=n,null==this.options.bitrate){const t=null!==(s=this.device.localStorage.getItem(_))&&void 0!==s?s:"normal",r=new D((0,f.extendContext)(e,D),this,this.videoPlayer,t,!1,null!==(o=this.options.maxShifts)&&void 0!==o?o:1/0,this.options);this.abrController=r,r.on("profile",(e=>{this.device.localStorage.setItem("lv_estimated_kbps",e.estimatedKbps.toString()),this.device.localStorage.setItem(_,e.profile.key)})),this.abrController.on("upshift",(()=>{this.emit("upshift")})),this.abrController.on("downshift",(()=>{this.emit("downshift")}))}let c;c=this.options.origin?this.videoPlayer.data.origin:this.videoPlayer.pickEncoding(),null==c&&this.videoPlayer.data.encodings.length>0&&([c]=this.videoPlayer.data.encodings),null!=c&&(this.encoding=c),this.setupMSE()}appendBuffer(){if(this.buffering)return;const e=()=>{this.buffering=!0,a.device.setTimeout((()=>{this.buffering=!1,this.appendBuffer()}),20)};if("open"!==this.readyState)return void e();const t=this.queue.shift();if(null!=t)if(this.buffering=!0,"remove"===t.type){if(null==t.sb)return this.buffering=!1,void this.appendBuffer();this.ctx.logger.debug("remove buffer",{buffer:`${t.start}-${t.end} buffered until ${t.sb.buffered.end(0)}`}),t.sb.remove(t.start,t.end)}else t.blob.arrayBuffer().then((r=>{if(null==this.transport)throw new Error("Transport is not defined");const i=this.transport.getSegmentInfo(r);1===this.version&&(i.contentTag=0);const n=this.sourceBuffers[i.contentTag];if(this.emit("fragment",{size:t.blob.size,time:t.time,duration:300}),"open"!==this.readyState)return this.ctx.logger.debug("meow mse not ready",{readyState:this.readyState}),this.queue.unshift(t),void e();if(null==n)return this.queue.unshift(t),void e();try{n.appendBuffer(r)}catch(e){this.emitErrorDeprecated(new l.Mp4BufferError("failed to append source buffer in appendBuffer()",{inner:(0,l.wrapNativeError)(e)}))}}));else e()}get readyState(){var e;if(null==this.ms)return null;const{encoding:t}=this;return null==t||(null===(e=t.channels)||void 0===e?void 0:e.length)!==this.sourceBuffers.length?null:this.ms.readyState}checkSourceBuffers(){var e,t,r;for(const t of this.sourceBuffers)if(0===(null!==(e=null==t?void 0:t.buffered.length)&&void 0!==e?e:0))return!1;return 0!==(null!==(r=null===(t=this.el)||void 0===t?void 0:t.buffered.length)&&void 0!==r?r:0)}newSourceBuffer(e){if(null==e||!this.device.MediaSource.isTypeSupported(e))return void this.sourceBuffers.push(null);if(null==this.ms)return;const t=this.ms.addSourceBuffer(e);this.ctx.logger.debug("meow adding sourcebuffer",{mimetype:e}),S.set(t,{mimetype:e}),t.addEventListener("error",(e=>{this.emitErrorDeprecated(new l.Mp4BufferError("failed to append source buffer in newSourceBffer()",{inner:e})),this.buffering=!1,this.appendBuffer()})),t.addEventListener("updateend",(()=>{var e,t,r;this.buffering=!1,this.appendBuffer();const{el:i}=this;if(null==i)return;if(i.buffered.length>0){const n=i.buffered.end(i.buffered.length-1)-i.currentTime;if(0===i.currentTime){if(i.buffered.end(i.buffered.length-1)-i.buffered.start(0)>(null!==(e=this.options.requiredBuffer)&&void 0!==e?e:0)){const e=Math.max(i.buffered.end(i.buffered.length-1)-(null!==(t=this.options.requiredBuffer)&&void 0!==t?t:0),i.buffered.start(0));i.currentTime=e,this.ctx.logger.debug("meow attempting to start",{startTime:e}),this.play()}}else if(n>25){const e=i.currentTime,t=Math.max(i.buffered.end(i.buffered.length-1)-(null!==(r=this.options.requiredBuffer)&&void 0!==r?r:0),i.buffered.start(0));i.currentTime=t,this.ctx.logger.warn("meow buffer max reached, moving to playback head",{max:25,ct:e,nt:t})}}if(this.receivedSegments++,this.receivedSegments>60&&!this.checkSourceBuffers())return this.ctx.logger.error("no buffer after 60 segments"),void this.emit("error",{message:"media-error",fatal:!0,notSupported:!0});const n=[];this.sourceBuffers.forEach(((e,t)=>{if(null!=e&&"open"===this.readyState)for(let r=0;r<e.buffered.length;r++)n.push({sourceBufferIndex:t,index:r,start:e.buffered.start(r),end:e.buffered.end(r)})})),n.length})),this.sourceBuffers.push(t)}setupMSE(){this.ms=new this.device.MediaSource,this.ms.addEventListener("error",(()=>{this.ctx.logger.error("meow mediasource dom error"),this.emit("error",{message:"media-error",fatal:!0})})),this.ms.addEventListener("abort",(()=>{this.ctx.logger.error("meow mediasource dom abort"),this.emit("error",{message:"media-error",fatal:!0})})),this.ms.addEventListener("sourceended",(()=>{this.ctx.logger.debug("meow mediasource source ended")})),this.ms.addEventListener("sourceclose",(()=>{this.ctx.logger.debug("meow mediasource source closed")})),this.ms.addEventListener("sourceopen",this.onSourceOpen),this.ctx.logger.debug("meow attempting to create media source"),this.mediaSourceTime=this.device.performance.now(),this.videoPlayer.source=URL.createObjectURL(this.ms),null!=this.el&&(this.el.src=this.videoPlayer.source)}onSourceOpen(){this.ms.removeEventListener("sourceopen",this.onSourceOpen),this.ctx.logger.debug("meow media source opened");const{encoding:e}=this;if(null!=e)try{if(null!=(null==e?void 0:e.channels)){if(0===e.channels.length)return void this.emit("error",{message:"media-error",fatal:!0,notSupported:!0});this.version=2;for(const t of e.channels)this.newSourceBuffer(t)}else{this.version=1;const{origin:e}=this.videoPlayer.data;let t;t=null!=this.options.origin&&null!=e&&"aac"!==e.audioCodec||!this.options.origin&&"aac"!==this.videoPlayer.data.audioCodec?'video/mp4; codecs="avc1.4d4028"':'video/mp4; codecs="avc1.4d4028, mp4a.40.2"',this.ctx.logger.debug("meow adding sourcebuffer",{mimetype:t}),this.newSourceBuffer(t)}}catch(e){const t=e instanceof Error?e:null;this.emitErrorDeprecated(new l.MeowDriverError("meow error in newSourceBuffer(). restarting player",{inner:t})),this.destroy(),this.videoPlayer.player=null,this.videoPlayer.restart(!1)}else this.emit("error",{message:"media-error",fatal:!0})}setupTransport(){var e,t,r,i,n,s;const a=(null!==(r=null===(t=null===(e=this.encoding)||void 0===e?void 0:e.channels)||void 0===t?void 0:t.length)&&void 0!==r?r:0)>0?null!==(s=null===(n=null===(i=this.encoding)||void 0===i?void 0:i.channels)||void 0===n?void 0:n.length)&&void 0!==s?s:0:1,{manifest:o}=this.videoPlayer;this.manifest=o,null!=o?(null!=this.transport&&(this.transport.removeAllListeners(),this.transport.destroy()),this.transport=new A((0,f.extendContext)(this.ctx,A),o,this.options.backFill,this.options.maxGap,this.options.retry,this.options.mode,this.options.download,this.options.segmentDuration,a),this.transport.on("error",(()=>{var e;(null===(e=this.transport)||void 0===e?void 0:e.disconnected)?this.emit("error",{message:v.ERRORS.WS_NETWORK_ERROR,fatal:!1}):this.emit("error",{message:"websocket-connection",notSupported:!0})})),this.transport.on("destroy",(()=>{this.emit("error",{message:"websocket-connection",fatal:!0})})),this.transport.on("message",(e=>{this.lastMessageReceived=this.device.performance.now(),this.queue.push({type:"append",blob:e.data,time:e.fetchTime}),this.appendBuffer()}))):this.emit("error",{message:v.ERRORS.INVALID_MEDIA_URL,fatal:!0})}switchBitrate(e){var t;this.ctx.logger.debug("meow switching bitrate to ",{name:e}),null===(t=this.transport)||void 0===t||t.switchBitrate(e)}play(){return i.__awaiter(this,void 0,void 0,(function*(){return new Promise((e=>{const{el:t}=this;if(null==t)throw new Error(v.ERRORS.ELEMENT_REQUIRED);return this.queue=[],null==this.transport&&this.setupTransport(),this.lastMessageReceived=this.device.performance.now(),this.logInterval=a.device.setInterval((()=>{var e;const t=this.device.performance.now()-(null!==(e=this.lastMessageReceived)&&void 0!==e?e:0);t>2e3&&this.emit("error",{message:"stall",timeSinceLastFrag:t})}),1e3),this.gcInterval=a.device.setInterval((()=>{if(null!=(null==t?void 0:t.currentTime))for(const e of this.sourceBuffers)this.queue.push({type:"remove",sb:null!=e?e:void 0,start:0,end:t.currentTime-15})}),3e4),this.ctx.logger.info("meow player play attempted"),this.videoPlayer.corePlay().catch((e=>{this.ctx.logger.warn("meow player play attempt failed",{errName:e.name,errMessage:e.message}),this.stop()}))}))}))}stop(){var e;const{el:t}=this;if(null==t)throw new Error(v.ERRORS.ELEMENT_REQUIRED);this.ctx.logger.debug("meow player stop"),clearInterval(this.gcInterval),clearInterval(this.logInterval),null===(e=this.transport)||void 0===e||e.removeAllListeners("message"),this.buffering=!1,t.pause(),""!==t.src&&(this.ctx.logger.debug("meow revoking media source url"),URL.revokeObjectURL(t.src),t.src=""),this.emit("stop")}destroy(){var e;this.destroyed=!0,null!=this.transport&&(this.transport.removeAllListeners("destroy"),this.transport.removeAllListeners("message"),this.transport.destroy()),null===(e=this.abrController)||void 0===e||e.destroy(),this.stop()}}w.displayName="Mp4WsPlayer";const T=["moof","mfhd"];function R(e,t){return String.fromCharCode(e.getUint8(t))}class C{constructor(){this.lastTime=a.device.isImplements(a.Feature.DEBUGGING)?a.device.performance.now():Date.now(),this.lastSegmentTime=a.device.isImplements(a.Feature.DEBUGGING)?a.device.performance.now():Date.now(),this.lastSegmentDuration=0}}class A extends p.ObservableEventEmitter{constructor(e,t,r=0,i=500,n=20,s="B",o=!1,c=300,l=1){if(super(),this.downloadedSegments=[],this.introFrag={},this.channelTracker=0,this.channelLatency=[],this.pingInterval=void 0,this.ctx=e,(0,u.onceCanceled)(e).then((e=>this.dispose(`Transport Class Context Cancelled: ${e}`))),this.addInnerDisposer(this.destroy),!a.device.isImplements(a.Feature.DEBUGGING)||!a.device.isImplements(a.Feature.MEDIA_SOURCE)||!a.device.isImplements(a.Feature.LOCAL_STORAGE))throw new Error("Device is not supported");this.device=a.device,this.uri=t,this.backFill=r,this.maxGap=i,this.retry=n,this.mode=s,this.segmentDuration=c,this.saveToDownload=o,this.introFrag={};const d=`${this.uri}&bckfil=${this.backFill}`;this.ws=new WebSocket(d),h.InstanceCollector.reportNewInstance("websocket",this.ws,{file:"player/mp4-ws.ts"}),this.channelLatency=[];for(let e=0;e<l;e++)this.channelLatency.push(new C);this.ctx.logger.debug("meow ws connecting",{url:d}),this.ws.onopen=()=>{this.ctx.logger.debug("meow ws open")},this.ws.onmessage=e=>{var t;if("object"==typeof e.data)return this.emit("message",Object.assign(Object.assign({},e),{data:e.data,fetchTime:this.device.performance.now()-this.lastTime+10,segmentDuration:null!==(t=this.lastSegmentDuration)&&void 0!==t?t:this.segmentDuration})),this.lastSegmentTime=this.device.performance.now(),this.saveToDownload&&this.downloadedSegments.push(e.data),void this.nextChannel();const r=e.data.split(/\s/g),i=parseInt(r[0],10);if(Number.isNaN(i))try{this.introFrag=JSON.parse(e.data)}catch(t){this.ctx.logger.error("unhandled websocket frame - attempted to parse and failed",{event:e.data})}else this.lastTime=this.device.performance.now(),this.lastSegmentDuration=i<2e3&&i>0?i:this.segmentDuration},this.ws.onclose=e=>{this.ctx.logger.debug("meow ws closing",{reason:e.reason,code:e.code}),h.InstanceCollector.disposeInstance("websocket",this.ws),this.emit("destroy")},this.ws.onerror=()=>{this.emit("error")},e.logger.attachObject(this),e.logger.trace("constructor()")}get lastTime(){return this.channelLatency[this.channelTracker].lastTime}set lastTime(e){this.channelLatency[this.channelTracker].lastTime=e}get lastSegmentTime(){return this.channelLatency[this.channelTracker].lastSegmentTime}set lastSegmentTime(e){this.channelLatency[this.channelTracker].lastSegmentTime=e}get lastSegmentDuration(){return this.channelLatency[this.channelTracker].lastSegmentDuration}set lastSegmentDuration(e){this.channelLatency[this.channelTracker].lastSegmentDuration=e}nextChannel(){this.channelTracker++,this.channelLatency.length>=this.channelTracker&&(this.channelTracker=0)}download(){}get disconnected(){return this.ws.readyState>1}getSegmentInfo(e){const t=new DataView(e),r=function(e,t){return e.byteLength<9||1936419184!==t.getUint32(e.byteLength-5)?1:t.getUint8(e.byteLength-1)}(e,t);let i=0,n=0,s=0,a=e.byteLength,o=0,c=!1;for("ftyp"==`${R(t,4)}${R(t,5)}${R(t,6)}${R(t,7)}`&&(c=!0),n=0;n<a&&s<T.length;)i=t.getUint32(n),R(t,n+4)===T[s].charAt(0)&&R(t,n+5)===T[s].charAt(1)&&R(t,n+6)===T[s].charAt(2)&&R(t,n+7)===T[s].charAt(3)?(a=n+i,s++,n+=8):n+=i;return s===T.length&&(o=t.getUint32(n+4)),{contentTag:r,segment:o,init:c}}switchBitrate(e){this.ws.send(`switch_stream?name=${e}&mode=${this.mode}&bckfil=${this.backFill}&retry=${this.retry}&mxgap=${this.maxGap}`)}destroy(){this.ctx.logger.info("meow transport destroy"),this.downloadedSegments=[],clearInterval(this.pingInterval),null!=this.ws&&(this.ctx.logger.info("meow ws close"),this.ws.onerror=null,this.ws.onclose=null,this.ws.close(),h.InstanceCollector.disposeInstance("websocket",this.ws),this.dispose("Transport was destroyed"))}toJSON(){return{uri:this.uri,disconnected:this.disconnected,retry:this.retry,aggregates:{support:this.ctx.support.hash,wsReadyState:this.ws.readyState}}}}A.displayName="Mp4WsTransport";const P={stable:{key:"stable",bwModifier:e=>Math.min(e,e-(.01*e+Math.log(e*e)/Math.log(2))),resistUpshift:(e,t)=>2.5*t+Math.pow(Math.log(2*t),3.2)>2*e,resistDownshift:(e,t)=>2*e+Math.pow(Math.log(2*e),3.2)>2*t},normal:{key:"normal",bwModifier:e=>Math.min(e,e-(.06*e+Math.log(e*e)/Math.log(2))),resistUpshift:(e,t)=>2.5*t+Math.pow(Math.log(2*t),3.4)>2*e,resistDownshift:(e,t)=>2*e+Math.pow(Math.log(2*e),3.4)>2*t},uncertain:{key:"uncertain",bwModifier:e=>Math.min(e,e-(.3*e+Math.log(e*e)/Math.log(2))),resistUpshift:(e,t)=>2.5*t+Math.pow(Math.log(2*t),3.6)>2*e,resistDownshift:(e,t)=>2*e+Math.pow(Math.log(2*e),3.4)>2*t},sporadic:{key:"sporadic",bwModifier:e=>Math.min(e,e-(.5*e+Math.log(e*e)/Math.log(2))),resistUpshift:(e,t)=>2.5*t+Math.pow(Math.log(2*t),4)>2*e,resistDownshift:(e,t)=>2*e+Math.pow(Math.log(2*e),3.4)>2*t}};class D extends p.ObservableEventEmitter{constructor(e,t,r,i,s,o,l){var d,h,p;if(super(),this.switchThreshold=8e3,this.count=0,this.dropCount=0,this.totalShifts=0,this.rawKbps=[],this.recentKbps=[],this.sampleBws=[],this.selectedEncoding=null,this.emergencyModifier=1,this.releaseEmergencyTimeout=void 0,this.profileInterval=void 0,this.trackRecentKbpsInterval=void 0,this.estimatedKbpsInterval=void 0,this.destroyed=!1,this.spinTimeout=void 0,this.ctx=e,(0,u.onceCanceled)(e).then((e=>this.dispose(`AbrController Class Context Cancelled: ${e}`))),this.addInnerDisposer(this.destroy),!a.device.isImplements(a.Feature.DEBUGGING)||!a.device.isImplements(a.Feature.MEDIA_SOURCE)||!a.device.isImplements(a.Feature.LOCAL_STORAGE))throw new Error("Device is not supported");this.logger=new n.LoggerCore(c.PACKAGE_NAME).extend(e.logger),this.device=a.device,this.options=l,this.player=t,this.driver=r,this.switchImmediately=s,this.profile=null!==(d=P[i])&&void 0!==d?d:P.normal,this.maxShifts=null!=o?o:1/0,this.currentKbps=null!==(h=this.options.bitrate)&&void 0!==h?h:Math.max(null!==(p=this.options.estimatedKbps)&&void 0!==p?p:0,244),this.lastMessageTime=this.device.performance.now(),this.lastSwitch=-8e3,this.init()}init(){this.player.on("fragment",this.onMessage),this.profileInterval=a.device.setInterval(this.profileStream.bind(this),1e4),this.trackRecentKbpsInterval=a.device.setInterval((()=>{let e=0;for(let t=0;t<this.rawKbps.length;t++)e+=this.rawKbps[t];const t=e/this.rawKbps.length;this.rawKbps=[],this.recentKbps.unshift(t),this.recentKbps.splice(120)}),1e3),this.estimatedKbpsInterval=a.device.setInterval((()=>{this.emit("profile",{estimatedKbps:this.currentKbps,profile:this.profile}),null!=this.selectedEncoding?this.logger.debug("meow abr estimated",{KBPS:this.currentKbps,modifier:this.emergencyModifier,lastSwitch:this.lastSwitch,shiftable:this.shiftable,profile:this.profile.key,encoding:this.selectedEncoding}):this.logger.debug("meow abr estimated",{KBPS:this.currentKbps,modifier:this.emergencyModifier,lastSwitch:this.lastSwitch,shiftable:this.shiftable,profile:this.profile.key})}),4e3)}get shiftable(){return this.totalShifts<this.maxShifts&&this.sampleBws.length>25&&this.device.performance.now()-this.lastSwitch>this.switchThreshold}handleEmergencyDrop(e,t){this.dropCount++,this.dropCount<2||(this.dropCount=0,this.emergencyModifier=e,this.sampleBws.splice(t),a.device.clearTimeout(this.releaseEmergencyTimeout),a.device.setTimeout((()=>{this.emergencyModifier=1}),900))}profileStream(){const e=[];e.push(...this.recentKbps),e.sort(((e,t)=>e>t?1:-1));const t=Math.floor(e.length/4),r=(e[2*t]-e[t])/e[2*t]+(e[3*t]-e[2*t])/e[3*t];this.profile=r>1?P.sporadic:r>.65?P.uncertain:r>.3?P.normal:P.stable}onMessage(e){if(this.destroyed)return;this.lastMessageTime=this.device.performance.now(),e.time>2.5*e.duration?(this.dropCount++,this.handleEmergencyDrop(.6,72)):e.time>2.25*e.duration?this.handleEmergencyDrop(.7,Math.max(24,Math.floor(150))):e.time>2*e.duration?this.handleEmergencyDrop(.8,Math.max(24,Math.floor(210))):e.time>1.75*e.duration?this.handleEmergencyDrop(.9,Math.max(24,Math.floor(240))):this.dropCount=0;const t=this.profile.bwModifier(8*e.size)*this.emergencyModifier/e.time;this.rawKbps.push(8*e.size/e.time),e.time<2&&(e.time=2),e.size<2e3?this.count>0&&(this.count=Math.floor(0)):(this.count++,!Number.isNaN(t)&&this.count>0&&t<4e5&&(this.sampleBws.unshift(t),this.sampleBws.splice(300),this.currentKbps=this.calculateCurrentKbps()),this.shiftable&&this.shiftIfNecessary())}shiftIfNecessary(){var e,t,r,i,n,s,o,c,l,d,u,h;if(null==this.driver.currentLevel||a.device.isImplements(a.Feature.BROWSER_TYPE)&&"safari"===a.device.browserInfo.name)return;const{activeLayer:p}=this.driver,f=this.driver.data.encodings.filter((e=>{var t,r,i;return null==p||(null!==(t=e.videoKbps)&&void 0!==t?t:0)+(null!==(r=e.audioKbps)&&void 0!==r?r:0)<(null!==(i=p.bitrate)&&void 0!==i?i:0)+1e-4})),m=f[this.driver.currentLevel];let g=f[0],v=0;for(let r=0;r<f.length&&(null!==(e=f[r].videoKbps)&&void 0!==e?e:0)+(null!==(t=f[r].audioKbps)&&void 0!==t?t:0)<this.currentKbps;r++)g=f[r],v=r;if(this.switchImmediately)return this.switchBitrate(g),this.switchImmediately=!1,void this.logger.debug("meowpick first adaptive encoding",{suggestedEncoding:g});if(null!=m&&m.videoKbps!==g.videoKbps){if(g.kbps=(null!==(r=g.videoKbps)&&void 0!==r?r:0)+(null!==(i=g.audioKbps)&&void 0!==i?i:0),m.kbps=(null!==(n=m.videoKbps)&&void 0!==n?n:0)+(null!==(s=m.audioKbps)&&void 0!==s?s:0),g.kbps>m.kbps){for(;this.profile.resistUpshift(this.currentKbps,null!==(o=g.kbps)&&void 0!==o?o:0)&&(null!==(c=g.kbps)&&void 0!==c?c:0)>m.kbps;)if(g=f[--v],null==g||(null!==(l=g.kbps)&&void 0!==l?l:0)<m.kbps)return;this.emit("upshift")}else{for(;this.profile.resistDownshift(this.currentKbps,null!==(d=g.kbps)&&void 0!==d?d:0)&&(null!==(u=g.kbps)&&void 0!==u?u:0)<m.kbps;)if(g=f[++v],null==g||(null!==(h=g.kbps)&&void 0!==h?h:0)>m.kbps)return;this.emit("downshift")}m.videoKbps!==g.videoKbps&&(this.logger.debug("meow switching bitrate",{currentEncoding:m,suggestedEncoding:m,currentKbps:this.currentKbps}),this.lastSwitch=this.device.performance.now(),this.selectedEncoding=g,this.switchBitrate(g),this.totalShifts++)}}switchBitrate(e){this.emit("meow profile",{estimatedKbps:this.currentKbps,profile:this.profile}),this.driver.setEncoding(e)}calculateCurrentKbps(){let e=0;for(let t=0;t<this.sampleBws.length;t++)e+=this.sampleBws[t];return e/this.sampleBws.length}destroy(){var e;a.device.clearTimeout(this.spinTimeout),a.device.clearTimeout(this.releaseEmergencyTimeout),clearInterval(this.estimatedKbpsInterval),this.destroyed=!0,null===(e=this.player)||void 0===e||e.removeListener("fragment",this.onMessage)}}D.displayName="AbrController"},8052:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NativeHlsPlayer=void 0;const i=r(7582),n=r(4280),s=r(5445),a=r(5580),o=r(5904),c=r(2835);class l extends c.CorePlayer{constructor(e,t,r){super(e,t,r),this.srcReset=!1,this.manifestJson=null,this.on("currentQuality",this.handleCurrentQuality),this.addInnerDisposer((()=>{this.off("currentQuality",this.handleCurrentQuality)}))}handleCurrentQuality(){this.srcReset=!1,this.handleSource(this.manifestJson)}static isSupported(e){return i.__awaiter(this,void 0,void 0,(function*(){return(0,o.supportsNativeHls)(e)}))}isSupported(){return i.__awaiter(this,void 0,void 0,(function*(){return l.isSupported()}))}static get format(){return"mp4-hls"}get format(){return l.format}handleSource(e){var t,r,s,o;return i.__awaiter(this,void 0,void 0,(function*(){if(this.suspended)return;this.ctx.logger.debug("native-hls: handleSource()");const i=null==e?void 0:e.formats["mp4-hls"];if(null!=i){if(null!=e&&(this.manifestJson=e),null!=(null===(r=null===(t=this.currentQuality)||void 0===t?void 0:t.layer)||void 0===r?void 0:r.id)&&""!==this.currentQuality.layer.id?this.source=this.currentQuality.layer.id.toString():null!=(null===(s=null==i?void 0:i.substitute)||void 0===s?void 0:s.location)?this.source=i.substitute.location:this.source=i.manifest,n.device.isImplements(n.Feature.URL_LOCATION)&&null!=this.elementSupervisor&&"src"!==this.elementSupervisor.sourceKind&&(this.srcReset=!0),null!=this.elementSupervisor&&"src"!==this.elementSupervisor.sourceKind||null!=this.elementSupervisor&&!this.srcReset){const e=this.elementSupervisor.currentTime;if(this.srcReset=!0,null===(o=this.elementSupervisor)||void 0===o||o.updateSrc(this.source),e>0&&(this.elementSupervisor.currentTime=e),this.options.autoPlay||!this.internalPaused)try{yield this.play(!0)}catch(e){const t=e instanceof Error?e:null;this.emitErrorDeprecated(new a.PlayingIssueError("autoplay call failed after handleSource()",{inner:t,player:this}))}}}else this.emitErrorDeprecated(new a.DriverNotSupportedError("manifest doesn't contains 'mp4-hls' format",{manifest:e,loader:this.provider}))}))}attachTo(e){const t=Object.create(null,{attachTo:{get:()=>super.attachTo}});return i.__awaiter(this,void 0,void 0,(function*(){if(yield t.attachTo.call(this,e),this.options.autoPlay)try{yield this.play(!0)}catch(e){const t=e instanceof Error?e:null;this.emitErrorDeprecated(new a.PlayingIssueError("autoplay call failed after attachTo()",{inner:t,player:this}))}}))}get implementedFeatures(){return[s.Feature.BITRATE_SWITCHING,s.Feature.MUTED_AUTOPLAY]}}t.NativeHlsPlayer=l,l.displayName="NativeHlsPlayer"},4845:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebrtcPlayer=void 0;const i=r(7582),n=r(8949),s=r(167),a=r(4280),o=r(2834),c=r(5445),l=r(3199),d=r(5580),u=r(3757),h=r(5904),p=r(644),f=r(327),m=r(2149),g=r(3772),v=r(3078),_=r(2122),y=r(2835),b=r(9182),E=r(6395);class S extends f.ObservableEventEmitter{attachTo(e){this.hostEl=(0,b.attachVideoElement)(e)}setPreferredLevel(e){this.preferredLevel=e}get canBroadcast(){return null!=this.call}get callBroadcast(){return this.call}get currentPlayer(){return this[g.implementation]}set currentPlayer(e){this[g.implementation]=e}get logger(){return this.ctx.logger}static isSupported(e){return i.__awaiter(this,void 0,void 0,(function*(){return(0,h.supportsMediasoupWebrtc)("Webrtc",e)}))}isImplements(e){switch(e){case c.Feature.MUTED_AUTOPLAY:case c.Feature.CONSUMER:case c.Feature.BROADCAST:case c.Feature.BITRATE_SWITCHING:return!0;default:return!1}}static get format(){return"webrtc"}get format(){return S.format}constructor(e,t,r){super(!1),this.isConnecting=!1,this.isConnected=!1,this.call=null,this.manifestJson=null,this.videoEl=null,this.callStreamName=null,this.callId=null,this.isJoiningCall=!1,this.sfuConnectionLoadId=0,this.videoConsumerLoadId=0,this.firstTimeUpdateLoadId=0,this.joinCallEndpointLoadId=v.stats.start(v.STATS_EVENTS.JOIN_CALL_ENDPOINT),this.ctx=e,this.mediaLoader=t,this.options=r,this.autoPlay=null==r.autoPlay||r.autoPlay,(0,n.makeObservable)(this,{isConnected:n.observable,isConnecting:n.observable}),(0,p.onceCanceled)(e).then((e=>this.dispose(`WebrtcPlayer Context Cancelled: ${e}`)));const i=(0,u.makeBounded)(new Proxy(this,y.proxyHandler));return i.init(),e.logger.attachObject(i),e.logger.trace("constructor()",{}),i}init(){this.mediaLoader.on("source",this.handleSource),this.addInnerDisposer((e=>{this.mediaLoader.off("source",this.handleSource)})),null!=this.mediaLoader.source&&this.handleSource(this.mediaLoader.source)}handleSource(e){return i.__awaiter(this,void 0,void 0,(function*(){if(!this.suspended)if(this.ctx.logger.debug("webrtc: handleSource()"),this.manifestJson=e,null==e)this.stopCall();else{const{webrtc:t}=e.formats;if(null==t)return void this.emitErrorDeprecated(new d.NotSupportedError("manifest doesn't contains webrtc format",{}));this.isJoiningCall&&this.callId===t.origin.callId&&this.callStreamName===t.origin.streamNames[0]||(this.isJoiningCall=!0,this.callId=t.origin.callId,this.callStreamName=t.origin.streamNames[0],this.stopCall(),yield this.joinCall(this.callId,t.origin.streamNames[0],t.origin.token,{rsrc:t.origin.rsrc,xkey:t.origin.publicKey,bpeerId:t.origin.peerId,joinUrl:t.origin.location}))}}))}stopCall(){var e;null!=this.call&&(null===(e=this.call)||void 0===e||e.removeAllListeners("playerAdded"),this.call=null)}get sfuJoinParams(){var e,t;const{webrtc:r}=null!==(t=null===(e=this.manifestJson)||void 0===e?void 0:e.formats)&&void 0!==t?t:{};return null==(null==r?void 0:r.origin.uri)?null:{call:{id:r.origin.callId,sfu:{uri:r.origin.uri,httpUri:r.origin.httpUri,region:r.origin.region,version:r.origin.version},turn:r.origin.turn,support:"ovh"},user:{userId:r.origin.token,scope:"viewer",displayName:"",authorizeToken:r.origin.token}}}joinCall(e,t,r,n){var a,o,c,d,u;return i.__awaiter(this,void 0,void 0,(function*(){const i={driver:this.format,abr:null===(a=this.manifestJson)||void 0===a?void 0:a.abr,aor:null===(o=this.manifestJson)||void 0===o?void 0:o.aor,atr:null===(c=this.manifestJson)||void 0===c?void 0:c.atr,rep:null===(d=this.manifestJson)||void 0===d?void 0:d.rep},h={token:r,onCallJoinEndpoint:()=>{this.emit("joinCallEndpoint",v.stats.stop(this.joinCallEndpointLoadId,i)),this.sfuConnectionLoadId=v.stats.start(v.STATS_EVENTS.SFU_CONNECTION)},onSFUConnection:()=>{this.emit("sfuConnection",v.stats.stop(this.sfuConnectionLoadId,i)),this.videoConsumerLoadId=v.stats.start(v.STATS_EVENTS.VIDEO_CONSUMER)},playerOptions:this.options};try{this.call=yield this.ctx.videoClient.internalJoinCall(e,this.sfuJoinParams,Object.assign(Object.assign({},n),h),(0,m.extendContext)(this.ctx,_.VideoClient)),this.emit("joinedCall",{call:this.call}),this.call.once("videoConsumer",(()=>{this.emit("videoConsumer",v.stats.stop(this.videoConsumerLoadId,i)),this.firstTimeUpdateLoadId=v.stats.start(v.STATS_EVENTS.FIRST_TIME_UPDATE)})),this.call.on("playerAdded",(e=>{this.ctx.logger.debug("got a player",{ev:e}),t===e.streamName&&(this.ctx.logger.debug("set currentPlayer",{old:this.currentPlayer}),e.player instanceof E.MediasoupPlayer&&(e.player.isManifestPlayer=!0),this.currentPlayer=e.player,this.currentPlayer.once("videoFirstPlay",(()=>{this.emit("firstTimeUpdate",v.stats.stop(this.firstTimeUpdateLoadId,i))})))})),this.call.on("peerAtCapacity",(e=>{this.emit("peerAtCapacity",e)})),this.call.on("callEnded",(()=>{this.emit("callEnded")})),this.call.on("isConnected",(e=>{this.isConnected=e})),this.call.on("isConnecting",(e=>{this.isConnecting=e})),this.call.on("playerRemoved",(e=>{var r;t===e.streamName&&(null===(r=this.currentPlayer)||void 0===r||r.dispose("peer player removed due to call.on('playerRemoved') event"))})),this.call.on("websocketReconnect",(()=>{this.emit("websocketReconnect")})),this.call.on("error",(e=>{this.emitErrorDeprecated(e)}))}catch(e){this.emit("error",null!==(u=(0,l.wrapError)(e))&&void 0!==u?u:(0,l.createError)(s.ErrorCode.CallError,"unknown error",{}))}}))}updatePosterWithLatestFrame(){null!=this.hostEl&&a.device.isImplements(o.Feature.CREATE_SCREENSHOT)?this.poster=a.device.createScreenshot(this.hostEl):this.ctx.logger.warn("Unable to set update poster. Create screenshot is not compatible with device.")}toJSON(){var e,t;return null!==(t=null===(e=this.currentPlayer)||void 0===e?void 0:e.toJSON())&&void 0!==t?t:{}}}t.WebrtcPlayer=S,S.displayName="WebrtcPlayer"},4962:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Call=void 0;const i=r(7582),n=r(2045),s=r(960),a=i.__importDefault(r(129)),o=r(167),c=r(4280),l=r(3199),d=r(5580),u=r(644),h=r(2149),p=i.__importDefault(r(711)),f=r(2696),m=r(3611),g=r(735),v=i.__importDefault(r(1970)),_=i.__importDefault(r(3935)),y=i.__importDefault(r(816)),b=r(2914),E=()=>{if(!c.device.isImplements(c.Feature.BROWSER_TYPE))return"not-available";const e=c.device.isMobileDevice?"mobile":"desktop";return[c.device.browserInfo.name,c.device.browserInfo.osname,e].join("-")};class S extends n.EventEmitter{get peer(){return this._peer}get _iceServers(){return this.__iceServers}get _edgeIceServers(){return this.__edgeIceServers}get _iceTransportPolicy(){return this.__iceTransportPolicy}get maxBitrate(){return this._maxBitrate}get _requireRecv(){return this.__requireRecv}get _requireSend(){return this.__requireSend}get _wsTransport(){return this.__wsTransport}get _closed(){return this.__closed}get streams(){return this._streams}get permissions(){return this._permissions}get peerId(){return this._localPeerId}get behaviours(){return this._behaviours}get wsReady(){var e,t;return null!==(t=null===(e=this.__wsTransport)||void 0===e?void 0:e.connected)&&void 0!==t&&t}userShould(e){return!!this.hasPermission(e)&&this._behaviours.includes(e)}constructor(e,t,r,i={}){var n,s,a,o,l,d;super(),this.setPreferredEncodingProcessing=!1,this.__wsTransport=null,this._startPromise=null,this._iceTransportPolicyUsed=null,this.isDisposed=!1,this.ctx=e,(0,u.onceCanceled)(e).then((e=>this.dispose(`VideoClient Context Cancelled: ${e}`))),e.logger.trace("constructor()",{options:i});const{maxProducingViewers:h}=i;if(this.options={call:{maxProducingViewers:h}},this._maxBitrate=i.maxBitrate,this._messages=new m.MessageList,this._handleOffline=()=>{this.emit("CALL_EMIT_MESSAGES",{messages:m.offlineMessages.messages})},this._handleOnline=()=>{this.emit("CALL_EMIT_MESSAGES",{messages:m.offlineMessages.messages})},c.device.addEventListener("offline",this._handleOffline),c.device.addEventListener("online",this._handleOnline),null==t.call)throw new Error("join.call is undefined");this.call=t.call,this._userOverrides=i.user,this.user=Object.assign(Object.assign({},t.user),this._userOverrides),this._stunServers=null!==(a=null===(s=null===(n=this.call.stun)||void 0===n?void 0:n.servers)||void 0===s?void 0:s.map((e=>`stun:${e}`)))&&void 0!==a?a:[],this._stunIndex=5,this.__iceServers=()=>{var e,t,r,i;if(0===this._stunIndex||0===this._stunServers.length)return(null===(t=null===(e=this.call.turn)||void 0===e?void 0:e.servers)||void 0===t?void 0:t.length)>0?this.call.turn.servers:[];const n=[{urls:this._stunServers.slice(this._stunIndex-5,this._stunIndex)}];return(null===(i=null===(r=this.call.turn)||void 0===r?void 0:r.servers)||void 0===i?void 0:i.length)>0?this.call.turn.servers.concat(n):n},this.__edgeIceServers=()=>{var e,t;const r=[];return(null===(t=null===(e=this.call.turn)||void 0===e?void 0:e.servers)||void 0===t?void 0:t.length)>0&&this.call.turn.servers.forEach((e=>{if(Array.isArray(e.urls)){const t=e.urls.filter((e=>e.startsWith("turn:")));(null==t?void 0:t.length)>0&&r.push(Object.assign(Object.assign({},e),{urls:t.map((e=>{var t;return null!==(t=e.split("?")[0])&&void 0!==t?t:""}))}))}})),r},this._joinCall=r,this._localPeerId=null,this.__iceTransportPolicy=i.iceTransportPolicy,this.__requireRecv=!0===i.requireRecv,this.__requireSend=!0===i.requireSend,this._flushLogs=!i.test,this._retries=null!==(o=i.retries)&&void 0!==o?o:1/0,this._wsReconnect=null!==(l=i.wsReconnect)&&void 0!==l&&l,this._wsReconnectTime=null!==(d=i.wsReconnectTime)&&void 0!==d?d:10,this._iceTransportPolicyUsed=null,this._ip=null,this._permissions=[],this._behaviours=[],this._initialRun=!0,this.__closed=!1,this._startResolve=null,this._startPromise=null,this._serverOptions=null,this._stableTimeout=void 0,this._stable=null,this._streams={};const{streams:p}=i;null!=p&&Object.keys(p).length>0?Object.keys(p).forEach((e=>{const t=p[e];this.setStream(e,t)})):this.ctx.logger.debug("Setting stream failed, there are no defined streams",{streams:p}),this.setLogData()}dispose(e){this.close(`disposed: ${e}`),this.isDisposed=!0}hasPermission(e){var t;return null===(t=this._permissions)||void 0===t?void 0:t.includes(e)}get streamNames(){return Object.keys(this._streams)}setStream(e,t){this._streams[e]=new v.default((0,h.extendContext)(this.ctx,v.default),e,this,t)}getStream(e){return this._streams[e]}removeStream(e){delete this._streams[e]}forEachStream(e){null!=this._streams&&Object.keys(this._streams).length>0?Object.keys(this._streams).forEach((t=>{e(this._streams[t],t)})):this.ctx.logger.debug("Stream close() failed, there are no defined streams to close",{streams:this._streams})}*streamsIterator(){for(const e of Object.keys(this._streams))yield this._streams[e]}setLogData(){var e;this.ctx.logger.setMessageAggregate("callId",this.call.id),this.ctx.logger.setMessageAggregate("userId",this.user.userId),this.ctx.logger.setMessageAggregate("scope",null!==(e=this.user.scope)&&void 0!==e?e:"no scope"),this.ctx.logger.setMessageAggregate("displayName",this.user.displayName)}clearLogData(){this.ctx.logger.removeMessageAggregate("callId"),this.ctx.logger.removeMessageAggregate("peerId"),this.ctx.logger.removeMessageAggregate("userId"),this.ctx.logger.removeMessageAggregate("scope"),this.ctx.logger.removeMessageAggregate("displayName"),this.ctx.logger.removeMessageAggregate("recvTransportId"),this.ctx.logger.removeMessageAggregate("recvTransportState"),this.ctx.logger.removeMessageAggregate("sendTransportId"),this.ctx.logger.removeMessageAggregate("sendTransportState")}_addMessage(e){this._messages.addMessage(e),this.emit("CALL_EMIT_MESSAGES",{messages:m.offlineMessages.messages})}_removeMessage(e){this._messages.removeMessage(e),this.emit("CALL_EMIT_MESSAGES",{messages:m.offlineMessages.messages})}get messages(){return this._messages.messages}close(e="Implementer did not pass debugString",t=!1,r=!1){return i.__awaiter(this,void 0,void 0,(function*(){return this.__closed?null:(this.ctx.logger.info("Call Class, call closed()",{aggregates:{internal:t,reason:e}}),this._flushLogs&&this.ctx.logger.flush(),null!=this._peer&&(yield this._peer.close(e)),null!=this.__wsTransport&&this.__wsTransport.setClosing(),c.device.removeEventListener("offline",this._handleOffline),c.device.removeEventListener("online",this._handleOnline),this.__closed=!0,this.forEachStream((e=>e.close())),c.device.clearTimeout(this._stableTimeout),this._stable=null,this._cleanup(r),Promise.resolve())}))}_cleanup(e=!1){e||null==this._startResolve||this._startResolve(),null!=this.__wsTransport&&(this.__wsTransport.close(),this.__wsTransport=null),this.emit("CALL_SET_ROOM_DONE"),this.clearLogData()}updateMaxBitrate(e){return i.__awaiter(this,void 0,void 0,(function*(){if(null!=this.__wsTransport){const t={bitrate:e};try{yield this._request("updateMaxBitrate",t),this._maxBitrate=e}catch(e){const r=e instanceof Error?e:null;this.emit("error",new d.WSRequestError("ws request error",{inner:r,request:"updateMaxBitrate",args:t,internalCall:this}))}}}))}setDisplayName(e){this.ctx.logger.info("updating displayName",{displayName:e}),this.user.displayName=e,null!=this.__wsTransport&&this.__wsTransport.send("options",{peer:{displayName:e}})}setMaxProducingViewers(e){this.ctx.logger.info("updating maxProducingViewers",{maxProducingViewers:e}),null!=this.__wsTransport&&this.__wsTransport.send("options",{call:{maxProducingViewers:e}})}getViewers(){throw new Error("getViewers is deprecated")}promoteViewer(e,t,r=!1){var n;return i.__awaiter(this,void 0,void 0,(function*(){if(null==this.__wsTransport)throw this.ctx.logger.warn("calling get viewers on a disconnected call"),new Error("call not connected");if(!this.hasPermission(f.PERMISSIONS.CHANGE_PEER_SCOPE))throw this.ctx.logger.warn("viewer does not have permission to promote other viewers"),new Error("no admin change scope permissions");let i;const s={userId:e,permissions:t,webhook:r};try{i=yield this._request("promote",s)}catch(e){const t=e instanceof Error?e:null;return void this.emit("error",new d.WSRequestError("ws request error",{inner:t,request:"promote",args:s,internalCall:this}))}this.emit("CALL_VIEWERS",{viewers:null!==(n=i.viewers)&&void 0!==n?n:[]})}))}demoteViewer(e,t,r=!1){var n;return i.__awaiter(this,void 0,void 0,(function*(){if(null==this.__wsTransport)throw this.ctx.logger.warn("calling get viewers on a disconnected call"),new Error("call not connected");if(!this.hasPermission(f.PERMISSIONS.CHANGE_PEER_SCOPE))throw this.ctx.logger.warn("viewer does not have permission to demote other viewers"),new Error("no admin change scope permissions");let i;const s={userId:e,webhook:r,permissions:t};try{i=yield this._request("demote",s)}catch(e){const t=e instanceof Error?e:null;return void this.emit("error",new d.WSRequestError("ws request error",{inner:t,request:"demote",args:s,internalCall:this}))}this.emit("CALL_VIEWERS",{viewers:null!==(n=i.viewers)&&void 0!==n?n:[]})}))}kickViewer(e,t,r=!1){var n;return i.__awaiter(this,void 0,void 0,(function*(){if(null==this.__wsTransport)throw this.ctx.logger.warn("calling get viewers on a disconnected call"),new Error("call not connected");if(!this.hasPermission(f.PERMISSIONS.CHANGE_PEER_SCOPE))throw this.ctx.logger.warn("viewer does not have permission to kick other viewers"),new Error("no admin change scope permissions");let t;const r={userId:e};try{t=yield this._request("kick",r)}catch(e){const t=e instanceof Error?e:null;return void this.emit("error",new d.WSRequestError("ws request error",{inner:t,request:"kick",args:r,internalCall:this}))}this.emit("CALL_VIEWERS",{viewers:null!==(n=t.viewers)&&void 0!==n?n:[]})}))}kickPeer(e,t,r=!1){var n;return i.__awaiter(this,void 0,void 0,(function*(){if(null==this.__wsTransport)throw this.ctx.logger.warn("calling get peers on a disconnected call"),new Error("call not connected");if(!this.hasPermission(f.PERMISSIONS.CHANGE_PEER_SCOPE))throw this.ctx.logger.warn("viewer does not have permission to kick other peers"),new Error("no admin change scope permissions");let t;const r={peerId:e};try{t=yield this._request("kick",r)}catch(e){const t=e instanceof Error?e:null;return void this.emit("error",new d.WSRequestError("ws request error",{inner:t,request:"kick",args:r,internalCall:this}))}this.emit("CALL_VIEWERS",{viewers:null!==(n=t.viewers)&&void 0!==n?n:[]})}))}connect(){var e,t;return i.__awaiter(this,void 0,void 0,(function*(){if(this.emit("CALL_CONNECTING",!0),this.__wsTransport){try{this.__wsTransport.close(!0)}catch(e){this.ctx.logger.info("Error closing websocket transport",{error:e})}this.__wsTransport=null}return null===(e=this._peer)||void 0===e||e.peers.forEach((e=>{var t;null===(t=this._peer)||void 0===t||t._onPeerClosed(e)})),yield null===(t=this._peer)||void 0===t?void 0:t.dispose("Reconnecting"),this._peer=void 0,new Promise(((e,t)=>{if(null==this.call.callUri)return t(new Error("callUri is undefined")),void this.emit("CALL_CONNECTING",!1);this.__wsTransport=new _.default((0,h.extendContext)(this.ctx,_.default),this.call.callUri,this._joinCall,this._retries,this._wsReconnect,this._wsReconnectTime),this.__wsTransport.on("websocket-reconnect",(e=>{(this._wsReconnect||e)&&(this.ctx.logger.info("Attempting websocket reconnect"),this.emit("CALL_WEBSOCKET_RECONNECT"))})),this.__wsTransport.on("prepare-rejoin-call",(()=>{for(const e of this.streamsIterator())e.close(!1)})),this.__wsTransport.on("callEnded",(()=>{this.close("call already ended on websocket",!0).catch(this.ctx.logger.error),e(),this.ctx.logger.info("calls-core/call: end"),this.emit("CALL_ENDED")})),this.__wsTransport.on("callError",(e=>{var r,i;t(new d.CallError(null!==(r=e.errorMessage)&&void 0!==r?r:"Unknown call error",{reason:e.reason})),"sfu-busy"===e.reason&&this.emit("error",(0,l.createError)(o.ErrorCode.SFUBusy,null!==(i=e.errorMessage)&&void 0!==i?i:"unknown reason",{})),this.close("call error on websocket",!0,!0).catch(this.ctx.logger.error)})),this._setup(e,t),this.__wsTransport.once("connect",(()=>{this.emit("CALL_CONNECTING",!1),this.emit("CALL_SET_CONNECTED",{connected:!0})}))}))}))}start(){return this.ctx.logger.info("calls-core/call: start",{}),null!=this._startPromise?(this.ctx.logger.info("call: start has already been called"),this._startPromise):(this._startPromise=new Promise(((e,t)=>{this.ctx.support.any?(this._startResolve=e,this._initialRun||(this.emit("CALL_SET_CONNECTED",{connected:!1}),this.emit("CALL_EMIT_MESSAGES",{messages:m.disconnectedMessages.messages})),null!=this.call.callUri?this.connect().then((()=>{var e;this._messages=new m.MessageList,this.emit("CALL_EMIT_MESSAGES",{messages:null!==(e=this._messages.messages)&&void 0!==e?e:[]}),this._initialRun=!1})).catch(t):t(new Error("Call URI is undefined"))):t(new Error("Device is not supported"))})),this._startPromise)}_setup(e,t){if(this.ctx.logger.debug("call setup"),null==this.__wsTransport){const e=new Error("_wsTransport is null");throw this.ctx.logger.warn("call _setup",{err:null==e?void 0:e.message}),e}this.__wsTransport.on("disconnect",(()=>{this.emit("CALL_CONNECTING",!1)})),this.__wsTransport.on("need-user",(()=>{var e;null===(e=this.__wsTransport)||void 0===e||e.send("user",this.user)})),this.__wsTransport.on("join-refresh",(e=>{null!=e.body.call?(this.user=Object.assign(Object.assign({},e.body.user),this._userOverrides),this.call=e.body.call):this.ctx.logger.error("response.body.call is undefined")})),this.__wsTransport.on("join-call-error",(e=>{const r=e.error instanceof Error?e.error:null,i=new d.JoinCallError("WS: Join Call Error",{inner:r});this.emit("error",i),t(i)})),this.__wsTransport.on("call-rejected",(()=>{this.ctx.logger.info("call rejected");const e=new d.CallError("WS: Call Rejected",{reason:"rejected"});this.emit("error",e),t(e),this.close("call was rejected by websocket",!0).catch(this.ctx.logger.error)})),this.__wsTransport.on("callRejected",(()=>{this.ctx.logger.info("call rejected");const e=new d.CallError("WS: Call Rejected",{reason:"rejected"});t(e),this.close("call was rejected by websocket",!0)})),this.__wsTransport.on("call-ended",(()=>{this.ctx.logger.info("call ended"),this.close("call already ended on websocket",!0)})),this.__wsTransport.on("Forbidden",(()=>{this.ctx.logger.info("call ended - kicked"),this.emit("CALL_FORBIDDEN"),this.close("call ended - kicked (Forbidden)",!0)})),this.__wsTransport.on("call-refresh",(e=>{this.call=e})),this.__wsTransport.on("peerAtCapacity",(e=>{const t=Object.keys(e);this.emit("CALL_PEER_AT_CAPACITY",e[t[0]])})),this.__wsTransport.on("producersKicked",(()=>{this.ctx.logger.info("Call ended - producers kicked"),this.emit("CALL_PRODUCER_KICKED")})),this.__wsTransport.on("dominantSpeaker",(e=>{this.ctx.logger.debug("websocket transport dominantSpeaker",{dominantSpeaker:e}),this.emit("CALL_DOMINANT_SPEAKER",{userId:e.userId,displayName:e.displayName,peerId:e.peerId,streamName:e.streamName,producerId:e.producerId})}));const r=e=>{var t,r,i,n,s,a,o,c,l;null!=this._stable&&"video"===e.mediaType&&(null!==(i=null===(r=null===(t=this._serverOptions)||void 0===t?void 0:t.call)||void 0===r?void 0:r.defaultMinBitrate)&&void 0!==i?i:0)>0&&((null!==(n=e.consumerBitrate)&&void 0!==n?n:0)<(null!==(o=null===(a=null===(s=this._serverOptions)||void 0===s?void 0:s.call)||void 0===a?void 0:a.defaultMinBitrate)&&void 0!==o?o:0)?0===this._stable.consumerBitrate?this._stable.consumerBitrate=Date.now():Date.now()>(null!==(l=null===(c=this._stable)||void 0===c?void 0:c.consumerBitrate)&&void 0!==l?l:0)+1e3&&this._addMessage(m.TROUBLESHOOTING.UNSTABLE_NETWORK):delete this._stable.consumerBitrate)};this.__wsTransport.on("consumer-stats",(e=>{r(e),this.emit("CALL_SET_CONSUMER_STATS",{peerId:e.peerId,streamName:e.streamName,consumerId:e.id,stats:e})})),this.__wsTransport.on("producer-stats",(e=>{r(e),this.emit("CALL_SET_PRODUCER_STATS",{streamName:e.streamName,producerId:e.id,stats:e})})),this.__wsTransport.on("permissions",(e=>{this._permissions=e.permissions,this.emit("CALL_PERMISSIONS",{permissions:e.permissions})})),this.__wsTransport.on("options",(e=>{this.ctx.logger.debug("websocket transport options",{options:e}),this._serverOptions=e,this.emit("CALL_OPTIONS",{options:e})})),this.__wsTransport.on("ready",(e=>{var r,i,n,s,a;if(this.emit("CALL_SFU_CONNECTION"),this.__closed&&null!=this.__wsTransport)return this.ctx.logger.debug("call: ready event fired after call was closed"),void this.__wsTransport.close();this.ctx.logger.info("websocket transport ready",{readyData:e}),this._ip=e.ip,this._localPeerId=e.peerId,this.ctx.logger.setMessageAggregate("peerId",this._localPeerId),(null===(r=e.permissions)||void 0===r?void 0:r.length)>0&&(this._permissions=e.permissions,this.emit("CALL_PERMISSIONS",{permissions:e.permissions})),(null===(i=e.behaviours)||void 0===i?void 0:i.length)>0&&(this._behaviours=e.behaviours),"v3"===e.version&&(this.user.scope=e.scope,null!=e.userId&&(this.user.userId=e.userId),null!=e.displayName&&(this.user.displayName=e.displayName),this.clearLogData(),this.setLogData()),this.emit("CALL_ROOM_DATA",{scope:null!==(n=this.user.scope)&&void 0!==n?n:"no scope",peerId:e.peerId});const o=this._closed||(null===(s=this._peer)||void 0===s?void 0:s._closed);this._request("options",this.options).catch((e=>{var t;const r=this._closed||(null===(t=this._peer)||void 0===t?void 0:t._closed);if(o||!r){const t=e instanceof Error?e:null;this.emit("error",new d.WSRequestError("ws request error",{inner:t,request:"options",args:this.options,internalCall:this}))}})),null===(a=this._peer)||void 0===a||a.dispose("Create a new peer after ws reconnection"),this._peer=new g.Peer((0,h.extendContext)(this.ctx,g.Peer),this),this._peer.on("error",(e=>{e.critical?(this.ctx.logger.error(`Peer error: ${e.code}; ${e.message}`,{err:e,call:this}),this.close("peer error",!0),t(e)):this.ctx.logger.warn(`Peer error: ${e.code}; ${e.message}`,{err:e,call:this})})),this._peer._setup(e.rtpCapabilities).then((()=>{this.ctx.logger.debug("websocket ready",{rtpCapabilities:e.rtpCapabilities}),this.emit("CALL_READY")}))}))}createProducer(e,t,r){var n,a;return i.__awaiter(this,void 0,void 0,(function*(){if(null==this._peer){const e="creating a producer on a room which has not been set up";throw this.ctx.logger.warn(e),new Error(e)}const i=this._closed||(null===(n=this._peer)||void 0===n?void 0:n._closed);try{return yield this._peer.produce(e,t,r)}catch(e){const t=this._closed||(null===(a=this._peer)||void 0===a?void 0:a._closed);throw!i&&t||(e instanceof s.types.InvalidStateError&&"track ended"===e.message?this.ctx.logger.warn("createProducer: track ended"):this.ctx.logger.error(new d.MediasoupSetupError("createProducer: error creating producer",{inner:(0,d.wrapNativeError)(e)}))),e}}))}get _localSettings(){if(!c.device.isImplements(c.Feature.LOCAL_STORAGE))return{};const e=c.device.localStorage.getItem(`pvc:${this._ip}:settings`);if(null==e)return{};let t;try{t=JSON.parse(e)}catch(t){const r=t instanceof Error?t.message:"unknown error";return this.ctx.logger.error("unable to parse settings",{data:e,err:r}),{}}return t}set _localSettings(e){c.device.isImplements(c.Feature.LOCAL_STORAGE)&&"false"!==c.device.localStorage.getItem("debug")&&c.device.localStorage.setItem(`pvc:${this._ip}:settings`,JSON.stringify(e))}_request(e,t){return i.__awaiter(this,void 0,void 0,(function*(){if(null==this.__wsTransport){const e=new Error("_wsTransport is null");throw this.ctx.logger.warn("call _request",{err:null==e?void 0:e.message}),e}const r=yield this.__wsTransport.request(e,t);if(null==r){const e=new Error("response is null");throw this.ctx.logger.warn("call _request",{err:null==e?void 0:e.message}),e}return r}))}requestSources(e,t){return i.__awaiter(this,void 0,void 0,(function*(){const r={streamName:e,peerId:t};return this._request("consumerSources",r).catch((e=>{const t=e instanceof Error?e:null;return e instanceof Error&&"request error: peer-closed"!==e.message&&this.emit("error",new d.WSRequestError("ws request error",{inner:t,request:"consumerSources",args:r,internalCall:this})),e}))}))}setPreferredEncoding(e,t){var r;if(!(null===(r=this.peer)||void 0===r?void 0:r.hasConsumerId(e)))return void this.emit("error",new d.ConsumerNotFoundError("consumer not found for consumer event",{consumerId:e}));if(this.setPreferredEncodingProcessing)return void this.ctx.logger.warn("setPreferredEncoding already processing",{consumerId:e,id:t});const i={consumerId:e,id:t};this.setPreferredEncodingProcessing=!0,this._request("setPreferredEncoding",i).catch((t=>{var r;const n=t instanceof Error?t:null;this._consumerNotFoundError(e,n)?(null===(r=this.peer)||void 0===r?void 0:r.hasConsumerId(e))&&this.ctx.logger.warn("consumer does not exist on server, but still exists in videoclient",{err:null==t?void 0:t.message,consumerId:e}):this.emit("error",new d.WSRequestError("ws request error",{inner:n,request:"setPreferredEncoding",args:i,internalCall:this}))})).finally((()=>{this.setPreferredEncodingProcessing=!1}))}_consumerNotFoundError(e,t){return null!=t&&"request error: consumer not found"===(null==t?void 0:t.message)}setVideoStreamProvider(e,t,r,n,s=!1){return i.__awaiter(this,void 0,void 0,(function*(){if(null==this._streams[e]){const e="setVideoStreamRetriever on invalid stream";throw this.ctx.logger.error(e),new Error(e)}return this._streams[e].setVideoStreamProvider(t,r,n,s)}))}setAudioStreamProvider(e,t,r,n,s=!1){return i.__awaiter(this,void 0,void 0,(function*(){if(null==this._streams[e]){const e="setAudioStreamRetriever on invalid stream";throw this.ctx.logger.error(e),new Error(e)}return this._streams[e].setAudioStreamProvider(t,r,n,s)}))}muteAudio(e){if(null==this._streams[e]){const t="muteAudio on invalid stream";throw this.ctx.logger.error(t,{streamName:e}),new Error(t)}this._streams[e].pauseAudio()}unmuteAudio(e,t={}){return i.__awaiter(this,void 0,void 0,(function*(){if(null==this._streams[e]){const t="unmuteAudio on invalid stream";throw this.ctx.logger.error(t,{streamName:e}),new Error(t)}return this._streams[e].enableAudio(t,!1)}))}disableAudio(e){if(null==this._streams[e]){const t="disableAudio on invalid stream";throw this.ctx.logger.error(t,{streamName:e}),new Error(t)}this._streams[e].disableAudio()}enableAudio(e,t,r=!1,n={}){return i.__awaiter(this,void 0,void 0,(function*(){if(this.ctx.logger.debug("enable audio",{streamName:e,refresh:t}),null==this._streams[e]){const t="enableAudio on invalid stream";throw this.ctx.logger.error(t,{streamName:e}),new Error(t)}return this._streams[e].enableAudio(n,t,r)}))}enableVideo(e,t,r=!1,n={}){return i.__awaiter(this,void 0,void 0,(function*(){if(!n.audioOnly){if(this.ctx.logger.debug("enable video",{streamName:e,refresh:t}),null==this._streams[e]){const t="enableVideo on invalid stream";throw this.ctx.logger.error(t,{streamName:e}),new Error(t)}return this._streams[e].enableVideo(n,t,r)}this.ctx.logger.debug("enable video",{streamName:e,refresh:t})}))}disableVideo(e){if(null==this._streams[e]){const t="disableVideo on invalid stream";throw this.ctx.logger.error(t,{streamName:e}),new Error(t)}this._streams[e].disableVideo()}unpauseVideo(e,t={}){return i.__awaiter(this,void 0,void 0,(function*(){if(null==this._streams[e]){const t="unpauseVideo on invalid stream";throw this.ctx.logger.error(t,{streamName:e}),new Error(t)}return this._streams[e].enableVideo(t,!1)}))}pauseVideo(e){if(this.ctx.logger.debug("calls-core/call: pause video"),null==this._streams[e]){const t="pauseVideo on invalid stream";throw this.ctx.logger.error(t,{streamName:e}),new Error(t)}return this._streams[e].pauseVideo()}_pauseProducer(e,t){if(null==this.__wsTransport){const e=new Error("_wsTransport is null");throw this.ctx.logger.warn("call _pauseProducer",{err:null==e?void 0:e.message}),e}this.__wsTransport.request("pauseProducer",{producerId:e}).catch((e=>{this.ctx.logger.warn("call.pauseProducer: error pausing server producer",e)})),this.emit("CALL_SET_PRODUCER_PAUSED",{streamName:t,producerId:e,originator:"client"})}_resumeProducer(e,t){if(null==this.__wsTransport){const e=new Error("_wsTransport is null");throw this.ctx.logger.warn("call _pauseProducer",{err:null==e?void 0:e.message}),e}this.__wsTransport.request("resumeProducer",{producerId:e}).catch((e=>{this.ctx.logger.warn("call.resumeProducer: error resuming server producer",e)})),this.emit("CALL_SET_PRODUCER_RESUMED",{streamName:t,producerId:e,originator:"client"})}_closeProducer(e,t){null!=this.__wsTransport?(this.__wsTransport.request("closeProducer",{producerId:e}).catch((t=>{this.ctx.logger.warn("call.closeProducer: error closing server producer",{err:`${t}`,producerId:e})})),this.emit("CALL_REMOVE_PRODUCER",{streamName:t,producerId:e,originator:"client"})):this.ctx.logger.debug("_closeProducer was called when websocket was closed")}hotswapProducer(e,t,r){return i.__awaiter(this,void 0,void 0,(function*(){if(this.ctx.logger.debug("calls-core/call: hotswwap producer"),null==this._streams[t]){const e="hotswapProducer on invalid stream";throw this.ctx.logger.error(e,{streamName:t}),new Error(e)}yield this._streams[t].hotswapProducer(e,r)}))}toJSON(){var e;return{streamNames:this.streamNames,peer:this._peer,aggregates:{support:this.ctx.support.hash,url:this.call.callUri,callId:this.call.id,userId:this.user.userId,peerId:this.peerId,isConnected:null===(e=this._wsTransport)||void 0===e?void 0:e.connected}}}}t.Call=S,S.displayName="PvcCall";const w=(e,t,r,i)=>{const n={support:e.support.hash,client_name:E(),client_version:c.device.isImplements(c.Feature.BROWSER_TYPE)&&null!==(s=c.device.browserInfo.version)&&void 0!==s?s:""};var s;return!!c.device.isImplements(c.Feature.LOCAL_STORAGE)&&"true"===c.device.localStorage.getItem("pvc:debug")&&(n.debug=!0),"string"==typeof r&&r.length>0&&(n.t=r),i.test&&(n.t="test"),null!=i.displayName&&(n.displayName=i.displayName),!1===i.sendAudio&&!1!==i.sendVideo?n.videoOnly=!0:!1!==i.sendAudio&&!1===i.sendVideo&&(n.audioOnly=!0),null!=i.rsrc&&(n.rsrc=i.rsrc),null!=i.xkey&&(n.xkey=i.xkey),null!=i.bpeerId&&(n.bpeerId=i.bpeerId),i.suspendPlay&&(n.sp=!0),null!=i.user&&(n.udata=!0),`${t.sfu.uri}/v3/${t.id}?${a.default.stringify(n)}`};t.default=(e,t,r,n,s,a=null)=>i.__awaiter(void 0,void 0,void 0,(function*(){var o,c,l,d,u,f,m,g;e.logger.debug("joining call",{id:t,options:n});const v=Object.assign({},n),_={method:"post",callId:t,failoverUrls:n.failoverUrls};null!=v.auth&&(_.auth=v.auth),null!=v.authOptions&&(_.auth=new y.default(v.authOptions)),_.query={};const E=(0,b.contextId)();null!=E&&(_.query.contextId=E);const T=(0,b.instanceId)();null!=T&&(_.query.instanceId=T),null!=(null===(o=v.sfu)||void 0===o?void 0:o.id)&&(_.query.id=null===(c=v.sfu)||void 0===c?void 0:c.id),null!=(null===(l=v.sfu)||void 0===l?void 0:l.region)&&(_.query.region=null===(d=v.sfu)||void 0===d?void 0:d.region),null!=(null===(u=v.sfu)||void 0===u?void 0:u.version)&&(_.query.version=null===(f=v.sfu)||void 0===f?void 0:f.version),null!=(null===(m=v.sfu)||void 0===m?void 0:m.pool)&&(_.query.pool=null===(g=v.sfu)||void 0===g?void 0:g.pool);const R={sfu:{msVersion:[3]}};null!=v.sfu&&(R.sfu=Object.assign(Object.assign({},v.sfu),{msVersion:[3]})),_.body=JSON.stringify(R);const C=(n={})=>i.__awaiter(void 0,void 0,void 0,(function*(){var i;e.logger.debug("calls-core/call:joinCall");try{const t=yield(0,p.default)(e,r,Object.assign(Object.assign(Object.assign({},_),n),{warnStatuses:[404,422]}));if(null==(null===(i=null==t?void 0:t.body)||void 0===i?void 0:i.call))throw new Error("response is null or incorrect");return t.body.call.callUri=w(e,t.body.call,t.authToken,v),e.logger.debug("joinCall() response",{response:t}),s.emit("callJoinEndpoint"),t}catch(i){const n=i instanceof Error?i.message:"unknown error";throw i instanceof Response?404===i.status?e.logger.warn("sfu unavailable",{id:t,joinUrl:r,err:n}):503===i.status&&e.logger.error("unable to join a call - no sfus available",{id:t,joinUrl:r,err:n}):e.logger.warn("unable to get sfu uri",{id:t,joinUrl:r,err:n}),i}}));let A;return null!=(null==a?void 0:a.call)?(a.call.callUri=w(e,a.call,a.user.authorizeToken,v),A=a,setTimeout((()=>s.emit("callJoinEndpoint")),0)):A=(yield C()).body,new S((0,h.extendContext)(e,S),A,C,v)}))},2696:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CUSTOM_STREAM_TYPE=t.PERMISSIONS=void 0,t.PERMISSIONS={STREAM_VIDEO:"produceVideo",STREAM_AUDIO:"produceAudio",CHANGE_PEER_SCOPE:"changePeerScope"},t.CUSTOM_STREAM_TYPE="custom"},9906:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExtendedDevice=void 0;const i=r(960);class n extends i.types.Device{constructor(e,t={}){super(t),this.device=e,this.directionContext=null,this.originalRtpCapabilities=Reflect.get(this,"_extendedRtpCapabilities"),this.originalCreateTransport=Reflect.get(this,"createTransport"),Reflect.defineProperty(this,"_extendedRtpCapabilities",{get:this.getterRtpCapabilities.bind(this),set:this.setterRtpCapabilities.bind(this),enumerable:!0}),Reflect.defineProperty(this,"_createTransport",{value:this.wrapperCreateTransport.bind(this),enumerable:!1})}getterRtpCapabilities(){return null==this.directionContext||null==this.originalRtpCapabilities?this.originalRtpCapabilities:this.device.processRtpCapabilities(this.directionContext,this.originalRtpCapabilities)}setterRtpCapabilities(e){this.originalRtpCapabilities=e}wrapperCreateTransport(e){try{return this.directionContext=e.direction,this.originalCreateTransport(e)}finally{this.directionContext=null}}}t.ExtendedDevice=n},250:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(2045),n=r(4280),s=r(2834);class a extends i.EventEmitter{constructor(e){if(super(),this.total=0,this.echo=!1,this._history=[],this._currBucket=0,!n.device.isImplements(s.Feature.AUDIO_CONTEXT))throw new Error("Audio management is not supported");if(this._audioContext=new n.device.AudioContext,this._analyserNode=this._audioContext.createAnalyser(),this._processorNode=this._audioContext.createScriptProcessor(),this._dataArray=new n.device.Uint8Array(this._analyserNode.fftSize),this._analyserNode.smoothingTimeConstant=.4,this._analyserNode.fftSize=64,this._processorNode.onaudioprocess=()=>{var e;this._analyserNode.getByteTimeDomainData(this._dataArray);const t=Date.now(),r=Math.floor(t/1e3);this._currBucket!==r&&(this._history.length>2&&(this._history=this._history.slice(1,this._history.length),this.runAnalysis()),this._history.push([]),this._currBucket=r),null===(e=this._history[this._history.length-1])||void 0===e||e.push(this.dataResult()),this.total+=1},!n.device.isImplements(s.Feature.MEDIA_STREAM))throw new Error("media stream is not implemented");this._mediaStream=new n.device.MediaStream,this._mediaStream.addTrack(e),this._mediaStreamSource=this._audioContext.createMediaStreamSource(this._mediaStream),this._mediaStreamSource.connect(this._analyserNode),this._analyserNode.connect(this._processorNode)}close(){this._audioContext.close()}dataResult(){let e=null,t=null,r=0;for(let i=0;i<this._dataArray.length;i+=1){const n=this._dataArray[i];(null==e||n<e)&&(e=n),(null==t||n>t)&&(t=n),r+=n}return{lowest:e,highest:t,total:this._dataArray.length,sum:r,average:r/this._dataArray.length}}runAnalysis(){var e,t,r;let i=0,a=0,o=0;const c=[];for(const[n,s]of this._history.entries())for(const[l,d]of s.entries()){const u=this._history[n-1];if(null!=u){const n=null!==(e=s[l-1])&&void 0!==e?e:u[u.length-1];if(null!=n){const e=null!==(t=d.highest)&&void 0!==t?t:0,s=null!==(r=n.highest)&&void 0!==r?r:0;e>=s-.09*Math.abs(s)?e<=s+.09*Math.abs(s)?(o+=1,c.push("s")):(i+=1,c.push("i")):(a+=1,c.push("d"))}}}const l=i+a,d=l+o;l/d>.4?this.echo||(this.echo=!0,this.emit("echo")):this.echo&&(this.echo=!1,this.emit("noecho")),((...e)=>{!0===n.device.globals.get("printOutput")&&n.device.isImplements(s.Feature.DEBUGGING)&&n.device.console.log(...e)})(`${c.join("")} - (${i}/${a}/${o}) (${l})/${d})`)}}t.default=a,a.displayName="EchoDetector"},3611:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.disconnectedMessages=t.offlineMessages=t.PEER_MESSAGES=t.TROUBLESHOOTING=t.MessageList=void 0;class r{constructor(){this._messages={}}addMessage(e){this._messages[e.code]=e}removeMessage(e){delete this._messages[e.code]}get messages(){return Object.keys(this._messages).map((e=>this._messages[parseInt(e,10)])).sort(((e,t)=>e.code-t.code))}}t.MessageList=r,r.displayName="MessageList";const i=new r;t.offlineMessages=i,i.addMessage({code:1001,type:"network",level:"error",message:"Internet disconnected",explanation:"Check your internet connection and reconnect to the network"});const n=new r;t.disconnectedMessages=n,n.addMessage({code:1002,type:"network",level:"error",message:"Call disconnected",explanation:"Please wait while the call reconnects"}),t.TROUBLESHOOTING={NO_WEBCAM:{code:1003,type:"webcam",level:"warn",message:"No webcam found",explanation:"Make sure your webcam is connected and your browser has permission to use it"},NO_MIC:{code:1004,type:"microphone",level:"warn",message:"No microphone found",explanation:"Make sure your microphone is connected and your browser has permission to use it"},NETWORK_FIREWALLED:{code:1005,type:"network",level:"error",message:"Connection blocked by firewall",explanation:"Disable firewall"},UNSTABLE_NETWORK:{code:1006,type:"network",level:"warn",message:"Unstable connection",explanation:"If on wifi, try connecting to a stronger network"},WEBRTC_RECV_DISCONNECTED:{code:1007,type:"network",level:"error",message:"Unable to receive stream",explanation:"If on wifi, try connecting to a stronger network"},WEBRTC_SEND_DISCONNECTED:{code:1008,type:"network",level:"warn",message:"Unable to send stream",explanation:"If on wifi, try connecting to a stronger network"},ONE_TO_ONE_PEER_DISCONNECTED:{code:1009,type:"network",level:"error",message:"Peer disconnected",explanation:"Please wait for the other user to come back online"}},t.PEER_MESSAGES={UNSTABLE_PEER:{code:2001,type:"network",level:"error",message:"This user's connection is unstable"}}},735:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Peer=void 0;const i=r(7582),n=r(960),s=r(4280),a=r(2834),o=r(813),c=r(3199),l=r(5580),d=r(9182),u=r(644),h=r(327),p=r(2696),f=r(9906),m=r(3611);class g extends h.ObservableEventEmitter{constructor(e,t){if(super(),this._closed=!1,this._iceTimeouts=new Map,this._mediasoupDevice=null,this._sendTransport=null,this._recvTransport=null,this._producers=new Map,this._consumerStatIntervals=new Map,this._delayVideoStart=!1,this.peers=new Map,this.sendLock=null,this.recvLock=null,this.ctx=e,this.call=t,(0,u.onceCanceled)(e).then(this.dispose),null==this.call._wsTransport)throw new Error("Call._wsTransport is null");e.logger.attachObject(this),e.logger.trace("constructor()");const r=this.call._wsTransport;r.on("newPeers",this._handleNewPeers),r.on("consumerSources",this._handleConsumerSources),r.on("kicked",this._handleAccessDenied),this.addInnerDisposer((()=>{r.off("newPeers",this._handleNewPeers),r.off("consumerSources",this._handleConsumerSources),r.off("kicked",this._handleAccessDenied)})),this._peerEvent("newConsumer",this._onNewConsumer.bind(this),((e,t)=>{this.emitErrorDeprecated(new l.SFUNewConsumerEventError("unable to handle `newConsumer` peer event",{peer:this,request:{id:t.id,kind:t.kind,producerPaused:t.producerPaused,producerId:t.producerId,rtpParameters:t.rtpParameters},inner:e instanceof Error?e:null}))})),this._peerEvent("peerClosed",this._onPeerClosed.bind(this),((e,t)=>{this.emitErrorDeprecated(new l.SFUPeerClosedEventError("unable to handle `peerClosed` peer event",{peer:this,request:t,inner:e instanceof Error?e:null}))})),this._peerEvent("switchConsumerTrack",this._onSwitchConsumerTrack.bind(this),((e,t)=>{this.emitErrorDeprecated(new l.SFUSwitchConsumerTrackEventError("unable to handle `switchConsumerTrack` peer event",{peer:this,request:t,inner:e instanceof Error?e:null}))})),this._consumerEvent("consumerClosed",this._onConsumerClosed.bind(this),((e,t)=>{this.emitErrorDeprecated(new l.SFUConsumerClosedEventError("unable to handle `consumerClosed` consumer event",{peer:this,request:t,inner:e instanceof Error?e:null}))})),this._consumerEvent("consumerPaused",this._onConsumerPaused.bind(this),((e,t)=>{this.emitErrorDeprecated(new l.SFUConsumerPausedEventError("unable to handle `consumerPaused` consumer event",{peer:this,request:t,inner:e instanceof Error?e:null}))})),this._consumerEvent("consumerResumed",this._onConsumerResumed.bind(this),((e,t)=>{this.emitErrorDeprecated(new l.SFUConsumerResumedEventError("unable to handle `consumerResumed` consumer event",{peer:this,request:t,inner:e instanceof Error?e:null}))})),this._consumerEvent("consumerScore",this._onConsumerScore.bind(this),((e,t)=>{this.emitErrorDeprecated(new l.SFUConsumerScoreEventError("unable to handle `consumerScore` consumer event",{peer:this,request:t,inner:e instanceof Error?e:null}))})),this._consumerEvent("consumerLayersChanged",this._onConsumerLayersChanged.bind(this),((e,t)=>{this.emitErrorDeprecated(new l.SFUConsumerLayersChangedEventError("unable to handle `consumerLayersChanged` consumer event",{peer:this,request:t,inner:e instanceof Error?e:null}))})),this._producerEvent("producerClosed",this._onProducerClosed.bind(this),((e,t)=>{this.emitErrorDeprecated(new l.SFUProducerClosedEventError("unable to handle `producerClosed` producer event",{peer:this,request:t,inner:e instanceof Error?e:null}))})),this._producerEvent("producerPaused",this._onProducerPaused.bind(this),((e,t)=>{this.emitErrorDeprecated(new l.SFUProducerPausedEventError("unable to handle `producerPaused` producer event",{peer:this,request:t,inner:e instanceof Error?e:null}))})),this._producerEvent("producerResumed",this._onProducerResumed.bind(this),((e,t)=>{this.emitErrorDeprecated(new l.SFUProducerResumedEventError("unable to handle `producerResumed` producer event",{peer:this,request:t,inner:e instanceof Error?e:null}))})),this.addInnerDisposer(this.clear)}_handleConsumerSources(e){try{this._onConsumerSources(e)}catch(t){this.emitErrorDeprecated(new l.SFUConsumerSourcesEventError("unable to handle `newPeers` peer event",{peer:this,request:e,inner:t instanceof Error?t:null}))}}_handleAccessDenied(e){return i.__awaiter(this,void 0,void 0,(function*(){this.call.emit("CALL_ACCESS_DENIED",e)}))}_handleNewPeers(e){try{this._onNewPeers(e)}catch(t){this.emitErrorDeprecated(new l.SFUNewPeersEventError("unable to handle `newPeers` peer event",{peer:this,request:e,inner:t instanceof Error?t:null}))}}_setup(e){return i.__awaiter(this,void 0,void 0,(function*(){try{this._mediasoupDevice=new f.ExtendedDevice(s.device),yield this._mediasoupDevice.load({routerRtpCapabilities:e});let t=[];Object.keys(this.call.streams).length>0&&t.push(this._createSendTransport()),t.push(this._createReceiveTransport()),yield Promise.all(t),this.call.emit("CALL_SET_MEDIA_CAPABILITIES",{canSendMic:this._mediasoupDevice.canProduce("audio"),canSendWebcam:this._mediasoupDevice.canProduce("video")}),t=[];for(const e of this.call.streamsIterator())e.hasVideoStreamTrack&&!this._delayVideoStart&&this.call.hasPermission(p.PERMISSIONS.STREAM_VIDEO)&&t.push((()=>i.__awaiter(this,void 0,void 0,(function*(){var t;try{(null===(t=this._mediasoupDevice)||void 0===t?void 0:t.canProduce("video"))&&(yield e.enableVideo())}catch(e){const t=e instanceof Error?e.message:"unknown error";this.ctx.logger.warn("Unable to set video producer",{err:t}),this.call._addMessage(m.TROUBLESHOOTING.NO_WEBCAM)}})))()),e.hasAudioStreamTrack&&this.call.hasPermission(p.PERMISSIONS.STREAM_AUDIO)&&t.push((()=>i.__awaiter(this,void 0,void 0,(function*(){var t;try{(null===(t=this._mediasoupDevice)||void 0===t?void 0:t.canProduce("audio"))&&(yield e.enableAudio())}catch(e){const t=e instanceof Error?e.message:"unknown error";this.ctx.logger.warn("Unable to set audio producer",{err:t}),this.call._addMessage(m.TROUBLESHOOTING.NO_MIC)}})))());yield Promise.all(t)}catch(e){if(null!=this.sendLock)try{this.sendLock.reject()}catch(e){}if(null!=this.recvLock)try{this.recvLock.reject()}catch(e){}if(null!=this._recvTransport)try{this._recvTransport.close()}catch(e){}if(null!=this._sendTransport)try{this._sendTransport.close()}catch(e){}this.emitErrorDeprecated(new l.MediasoupSetupError("ms3._setup: error during setup",{critical:!0,inner:e instanceof Error?e:null}))}}))}_createSendTransport(){return i.__awaiter(this,void 0,void 0,(function*(){if(null==this._mediasoupDevice)throw new Error("Peer._mediasoupDevice is null");let e;this.sendLock=this._initLock();const t={producing:!0,consuming:!1,rtpCapabilities:this._mediasoupDevice.rtpCapabilities,maxBitrate:this.call.maxBitrate};try{e=yield this.call._request("createWebRtcTransport",t)}catch(e){const r=e instanceof Error?e:null,i=new l.WSRequestError("createSendTransport: ws request error",{inner:r,request:"createWebRtcTransport",args:t,internalCall:this.call});throw this.call.emit("error",i),i}this._sendTransport=this._mediasoupDevice.createSendTransport(Object.assign({id:e.id,iceParameters:e.iceParameters,iceCandidates:e.iceCandidates,dtlsParameters:e.dtlsParameters},this._transportOptions())),this.sendLock.resolve(),this.ctx.logger.debug("ms3._createSendTransport: created",{transportInfo:e,deviceCapabilities:this._mediasoupDevice.rtpCapabilities}),this._handleTransportEvents(this._sendTransport,"send")}))}_createReceiveTransport(){return i.__awaiter(this,void 0,void 0,(function*(){if(null==this._mediasoupDevice)throw new Error("Peer._mediasoupDevice is null");let e;this.recvLock=this._initLock();const t={forceTcp:this._forceRecvTcp,producing:!1,consuming:!0,rtpCapabilities:this._mediasoupDevice.rtpCapabilities},r=this._closed||this.call._closed;try{e=yield this.call._request("createWebRtcTransport",t)}catch(e){const i=this._closed||this.call._closed;if(!r&&i)return;const n=e instanceof Error?e:null,s=new l.WSRequestError("createReceiveTransport: ws request error",{inner:n,request:"createWebRtcTransport",args:t,internalCall:this.call});throw this.call.emit("error",s),s}e=Object.assign(Object.assign({},e),this._transportOptions()),this._recvTransport=this._mediasoupDevice.createRecvTransport(e),this.recvLock.resolve(),this.ctx.logger.debug("ms3._createReceiveTransport: created",{transportInfo:e}),this._handleTransportEvents(this._recvTransport,"recv")}))}_transportOptions(){var e,t,r;const i=s.device.isImplements(a.Feature.BROWSER_TYPE)&&"edge"===(null===(e=s.device.browserInfo)||void 0===e?void 0:e.name)?this.call._edgeIceServers():this.call._iceServers();return this.call._iceTransportPolicyUsed=null!==(r=null!==(t=this.call._iceTransportPolicy)&&void 0!==t?t:this.call._localSettings.iceTransportPolicy)&&void 0!==r?r:"all",{iceServers:i,iceTransportPolicy:this.call._iceTransportPolicyUsed}}_handleTransportEvents(e,t){let r;("send"===t&&this.call._requireSend||"recv"===t&&this.call._requireRecv)&&(r=s.device.setTimeout((()=>{"new"===e.connectionState&&this.emitErrorDeprecated(new l.TransportStateError("Transport failed to change connection state",{critical:!0}))}),2e4));const i=t.toUpperCase();let n=null;e.on("connectionstatechange",(o=>{s.device.clearTimeout(r),"SEND"===i?this.call.emit("CALL_SET_SENDING_ICE_STATE",{state:o}):this.call.emit("CALL_SET_RECEIVING_ICE_STATE",{state:o}),this.ctx.logger.setMessageAggregate(`${t}TransportId`,e.id),this.ctx.logger.setMessageAggregate(`${t}TransportState`,o);const c=s.device.isImplements(a.Feature.NETWORK_INFORMATION)?s.device.connection:null;switch(this.ctx.logger.info(`${t} transport connection state change`,{state:o,transportType:t,prevState:n,connection:c}),n=o,"completed"===o&&(o="connected"),o){case"connected":e.appData.onceConnected=!0,this.call._removeMessage(m.TROUBLESHOOTING.NETWORK_FIREWALLED),this.call._removeMessage(m.TROUBLESHOOTING["SEND"===i?"WEBRTC_SEND_DISCONNECTED":"WEBRTC_RECV_DISCONNECTED"]),s.device.clearTimeout(this._iceTimeouts.get(t)),this._iceTimeouts.delete(t),this.ctx.logger.info(`${t} transport entered connected state`),this.emit("webrtc-transport-connected",t);break;case"disconnected":this.call._addMessage(m.TROUBLESHOOTING["SEND"===i?"WEBRTC_SEND_DISCONNECTED":"WEBRTC_RECV_DISCONNECTED"]),this._restartIce(t),this.ctx.logger.warn(`${t} transport entered disconnected state`),this.emit("webrtc-transport-disconnected",t);break;case"failed":if(this.ctx.logger.warn(`${t} transport entered failed state`),this.emit("webrtc-transport-failed",t),"SEND"===i&&this.call._requireSend)this.emitErrorDeprecated(new l.TransportStateError("Send transport failed",{critical:!0}));else if("RECV"===i&&this.call._requireRecv){const e=new Error("Receive transport failed");null!=this.recvLock&&this.recvLock.reject(e),this.emitErrorDeprecated(new l.TransportStateError("Receive transport failed",{critical:!0}))}else this.call._removeMessage(m.TROUBLESHOOTING["SEND"===i?"WEBRTC_SEND_DISCONNECTED":"WEBRTC_RECV_DISCONNECTED"]),this._restartIce(t),e.appData.onceConnected||this.call._addMessage(m.TROUBLESHOOTING.NETWORK_FIREWALLED);break;case"closed":"send"===i?null!=this.sendLock&&this.sendLock.reject(new Error("send transport closed")):null!=this.recvLock&&this.recvLock.reject(new Error("recv transport closed")),this._closed||this.emitErrorDeprecated(new l.TransportStateError(`${t} transport closed prematurely`,{critical:!0})),this.ctx.logger.warn(`${t} transport entered closed state`),this.emit("webrtc-transport-closed",t)}})),e.observer.on("close",(()=>{this.ctx.logger.info(`${t} transport.observer.closed state`),this.emit("webrtc-transport-closed",t),this._closed||this.disposing||this._closed||"recv"!==t||(this.ctx.logger.warn(`${t} transport.observer.closed, but peer is still open. Trying to recreate recv transport`),this._createReceiveTransport().catch((e=>{const t=e instanceof Error?e:null;this.throwErrorDeprecated(new l.TransportStateError("unable to re-create recv transport",{inner:t,critical:!0}))})))}));const o=this._closed||this.call._closed;e.on("connect",(({dtlsParameters:r},i,n)=>{const s={transportId:e.id,dtlsParameters:r};this.call._request("connectWebRtcTransport",s).then((()=>{var e;i(),null===(e=this.recvLock)||void 0===e||e.resolve(),this.ctx.logger.debug("ms3._handleTransportEvents connected",{transportType:t})})).catch((e=>{const t=this._closed||this.call._closed;if(!o&&t)return;const r=e instanceof Error?e:null,i=new l.WSRequestError("handleTransportEvents: ws request error",{inner:r,request:"connectWebRtcTransport",args:s,internalCall:this.call});this.call.emit("error",i),n(i)}))})),e.on("produce",(({kind:t,rtpParameters:r,appData:i},n,s)=>{const a={transportId:e.id,kind:t,rtpParameters:r,appData:i};this.call._request("produce",a).then((e=>{n(e),this.ctx.logger.debug("ms3._handleTransportEvents: produce",{kind:t,appData:i})})).catch((e=>{const t=e instanceof Error?e:null,r=new l.WSRequestError("handleTransportEvents: ws request error",{inner:t,request:"produce",args:a,internalCall:this.call});this.call.emit("error",r),s(r)}))}))}_addPeers(e){e.forEach((e=>{null!=e.id?(this.peers.set(e.id,e),this.call.emit("CALL_ADD_PEER",{peer:e}),this.call.emit("PEER_CHANGE",{peer:e,action:"added"})):this.emitErrorDeprecated(new l.InternalError("peerId is undefined",{}))}))}_restartIce(e){if(null!=this._iceTimeouts.get(e))return;const t=()=>i.__awaiter(this,void 0,void 0,(function*(){if(!this._closed)if(null!=this.call._wsTransport){if(this.ctx.logger.throttledLog("debug",15e3,"ice restart",{online:this.call._wsTransport.online}),!this.call._wsTransport.online)return s.device.clearTimeout(this._iceTimeouts.get(e)),void this._iceTimeouts.set(e,s.device.setTimeout(t.bind(this),500));try{const t={dir:e};let r;try{r=yield this.call._request("restartIce",t)}catch(e){const r=e instanceof Error?e:null,i=new l.WSRequestError("restartIce: ws request error",{inner:r,request:"restartIce",args:t,internalCall:this.call});throw this.call.emit("error",i),i}if("send"===e){if(null==this._sendTransport)return void this.ctx.logger.error("call: restartIce error",{err:"_sendTransport is null"});yield this._sendTransport.restartIce(r)}else{if(null==this._recvTransport)return void this.ctx.logger.error("call: restartIce error",{err:"_recvTransport is null"});yield this._recvTransport.restartIce(r)}return void this._iceTimeouts.delete(e)}catch(e){const t=e instanceof Error?e.message:"unknown error";this.ctx.logger.warn("call: restartIce error",{err:t})}s.device.clearTimeout(this._iceTimeouts.get(e)),this._iceTimeouts.set(e,s.device.setTimeout(t.bind(this),5e3))}else this.ctx.logger.error("call: restartIce error",{err:"call._wsTransport is null"})}));t().catch(this.ctx.logger.error)}_onNewPeers(e){this._addPeers(e.peers)}_onConsumerSources(e){var t,r,i;const n={};for(const s of e.consumers){const e=null!==(t=n[`${s.peerId}-${s.streamName}`])&&void 0!==t?t:{peerId:s.peerId,streamName:s.streamName,layers:[]};for(const t of s.encodings)e.layers.push({id:t.id,bitrate:null!==(i=null!==(r=t.bitrate)&&void 0!==r?r:t.maxBitrate)&&void 0!==i?i:0,isSource:!s.xcode,appData:{consumerId:s.consumerId}});n[`${s.peerId}-${s.streamName}`]=e}for(const e of Object.values(n))this.call.emit("CALL_CONSUMER_SOURCES",e)}getLayers(e,t){var r,n;return i.__awaiter(this,void 0,void 0,(function*(){let i=[],s=null,a=null;const o=this._closed||this.call._closed;try{a=yield this.call.requestSources(e,t),this.ctx.logger.debug("request consumerSources from ws",{sources:a});for(const e of a.consumers)for(const t of e.encodings){const a={id:t.id,bitrate:null!==(n=null!==(r=t.bitrate)&&void 0!==r?r:t.maxBitrate)&&void 0!==n?n:0,isSource:!e.xcode,appData:{consumerId:e.consumerId}};i.push(a),t.active&&(s=a)}}catch(e){const t=this._closed||this.call._closed;if(!o&&t)return[null,[]];this.ctx.logger.error(`unable to get consumer sources: ${e}`,{sources:a})}return i=(0,d.sortEncodings)(i),[s,i]}))}_onNewConsumer(e,t,r){var s,a,o,c,d,u,h;return i.__awaiter(this,void 0,void 0,(function*(){if(this.ctx.logger.info("call: _onNewConsumer"),null!=this.recvLock?yield this.recvLock.ready():yield this._createReceiveTransport(),null==this._recvTransport)return this.ctx.logger.error("call: _onNewConsumer error",{err:"_recvTransport is null"}),void r(null,"_recvTransport is null");if(this._recvTransport.closed)return yield this._createReceiveTransport(),yield null===(s=this.recvLock)||void 0===s?void 0:s.ready(),void r(null,"_recvTransport closed");const i=yield this._recvTransport.consume(t);!1!==(null===(a=t.appData)||void 0===a?void 0:a.trackEnabled)&&!t.producerPaused||i.paused||i.pause(),null===(o=e.consumers)||void 0===o||o.push(i),i.on("transportclose",(()=>{this.ctx.logger.debug("consumer event",{event:"transportclose",kind:t.kind}),this._deleteConsumers(e,[i.id])})),i.on("trackended",(()=>{this.ctx.logger.debug("consumer event",{event:"trackended",kind:t.kind}),this._deleteConsumers(e,[i.id])}));const{encodings:p}=i.rtpParameters;if(null==p||0===(null==p?void 0:p.length))return this.ctx.logger.error("call: _onNewConsumer error",{err:"consumer doesn't have any encodings"}),void r(null,"consumer doesn't have any encodings");const{spatialLayers:f,temporalLayers:m}=(0,n.parseScalabilityMode)(null!==(d=null===(c=p[0])||void 0===c?void 0:c.scalabilityMode)&&void 0!==d?d:""),{streamName:g}=i.appData;if("string"!=typeof g)return this.ctx.logger.error("call: _onNewConsumer error",{err:"consumer.appData doesn't have a proper stream name"}),void r(null,"consumer.appData doesn't have a proper stream name");if(null==e.id)return this.ctx.logger.error("call: _onNewConsumer error",{err:"peer.id is null"}),void r(null,"peer.id is null");const v="object"==typeof t&&t.dontAdd;let[_,y]=[null,[]];if(!v){const t=this._closed||this.call._closed;if("video"===i.kind)try{[_,y]=yield this.getLayers(g,e.id)}catch(e){const r=this._closed||this.call._closed;if(!t&&r)return;throw e}}const b={peerId:e.id,streamName:g,consumer:{id:i.id,peerId:e.id,kind:i.kind,streamName:String(i.appData.streamName),supported:!0,locallyPaused:!1,paused:i.paused,track:i.track,codec:null!==(h=null===(u=i.rtpParameters.codecs[0])||void 0===u?void 0:u.mimeType.split("/")[1])&&void 0!==h?h:"",pause:()=>{i.pause();const e={consumerId:i.id};this.call._request("pauseConsumer",e).catch((t=>{const r=t instanceof Error?t:null,i=new l.WSRequestError("pause: ws request error",{inner:r,request:"pauseConsumer",args:e,internalCall:this.call});this.call.emit("error",i)}))},resume:()=>{i.resume();const e={consumerId:i.id};this.call._request("resumeConsumer",e).catch((t=>{const r=t instanceof Error?t:null,i=new l.WSRequestError("resume: ws request error",{inner:r,request:"resumeConsumer",args:e,internalCall:this.call});return this.call.emit("error",i),i}))},layers:y,activeLayer:_,preferredSpatialLayer:f-1,preferredTemporalLayer:m-1,rtpParameters:i.rtpParameters,dontAdd:v}};this.call.emit("CALL_ADD_CONSUMER",b),v||(this.call.emit("CALL_SET_CONSUMER_TRACK",{peerId:e.id,streamName:g,consumerId:i.id,track:i.track}),this.call.emit("PEER_CHANGE",{peer:e,action:"consumer_added"})),r({})}))}hasConsumerId(e){return Array.from(this.peers.values()).some((t=>{var r;return null===(r=t.consumers)||void 0===r?void 0:r.some((t=>t.id===e))}))}_peerEvent(e,t,r){const n=this.call._wsTransport;if(null==n)return void this.emitErrorDeprecated(new l.InternalError("call: peerEvent error: wsTransport is null",{}));const s=(n,s)=>i.__awaiter(this,void 0,void 0,(function*(){if(null==n.peerId||""===n.peerId)return this.ctx.logger.warn("invalid peer event request: no peerId",{event:e,req:n}),void s(null,"invalid peer event request: no peerId");const i=this.peers.get(n.peerId);if(null==i)return this.ctx.logger.warn("peer not found for peer event",{event:e,req:n}),void s(null,"peer not found for peer event");this.ctx.logger.debug("peer event",{event:e,req:n});try{yield t(i,n,s)}catch(t){r(t instanceof Error?t:null,n),"function"==typeof s?t instanceof Error?s(null,`peer event error: ${t.message}`):s(null,"peer event error: undefined error"):this.ctx.logger.debug(`BUG: check '${e}' event in PvcTransport, it doesn't provide 'resp' callback`,{aggregates:{bug:!0}})}}));n.on(e,s),this.addInnerDisposer((()=>{n.off(e,s)}))}_onPeerClosed(e){var t,r;return i.__awaiter(this,void 0,void 0,(function*(){if(null!=e.id){if(this.peers.has(e.id)){this.peers.delete(e.id);const i=null===(t=e.consumers)||void 0===t?void 0:t.map((e=>e.id));if(yield this._deleteConsumers(e,null!=i?i:[]),this.call._closed)return;this.call.emit("CALL_REMOVE_PEER",{peerId:null!==(r=e.id)&&void 0!==r?r:""}),this.call.emit("PEER_CHANGE",{peer:e,action:"removed"})}}else this.emitErrorDeprecated(new l.InternalError("peerId is undefined",{}))}))}_producerEvent(e,t,r){const n=this.call._wsTransport;if(null==n)return void this.ctx.logger.error("call: produceEvent error",{err:"call._wsTransport is null"});const s=n=>i.__awaiter(this,void 0,void 0,(function*(){if(n.peerId!==this.call.peerId)return void this.ctx.logger.debug("wrong peer ID for producer event",{event:e,req:n});const i=this._producers.get(n.producerId);if(null!=i)try{yield t(i,n)}catch(e){r(e instanceof Error?e:null,n)}else console.trace("producer not found for producer event",{event:e,req:n})}));n.on(e,s),this.addInnerDisposer((()=>{n.off(e,s)}))}_consumerEvent(e,t,r){const n=this.call._wsTransport;if(null==n)return void this.ctx.logger.error("call: consumerEvent error",{err:"call._wsTransport is null"});const s=n=>i.__awaiter(this,void 0,void 0,(function*(){var i;const s=this.peers.get(n.peerId);if(null==s)return void this.ctx.logger.debug("peer not found for consumer event",{event:e,req:n});const a=null===(i=s.consumers)||void 0===i?void 0:i.find((e=>e.id===n.consumerId));if(null!=a){this.ctx.logger.debug("consumer event",{event:e,req:n});try{yield t(a,s,n)}catch(e){r(e instanceof Error?e:null,n)}}else"consumerClosed"!==e&&this.ctx.logger.debug("consumer not found for consumer event",{event:e,req:n})}));n.on(e,s),this.addInnerDisposer((()=>{n.off(e,s)}))}_deleteConsumers(e,t){return t.forEach((t=>{var r,i,n,s;const a=null===(r=e.consumers)||void 0===r?void 0:r.find((e=>e.id===t));if(null==a)return;this.call.emit("CALL_REMOVE_CONSUMER",{peerId:null!==(i=e.id)&&void 0!==i?i:"",streamName:String(a.appData.streamName),consumerId:a.id}),this.call.emit("PEER_CHANGE",{peer:e,action:"consumer_removed"});const o=null===(n=e.consumers)||void 0===n?void 0:n.indexOf(a);null===(s=e.consumers)||void 0===s||s.splice(null!=o?o:0,1)})),Promise.resolve()}_onConsumerClosed(e,t){return i.__awaiter(this,void 0,void 0,(function*(){e.close();const r=this._consumerStatIntervals.get(e.id);clearInterval(r),this._consumerStatIntervals.delete(e.id),yield this._deleteConsumers(t,[e.id])}))}_onConsumerPaused(e,t){var r;return e.pause(),this.call.emit("CALL_SET_CONSUMER_PAUSED",{peerId:null!==(r=t.id)&&void 0!==r?r:"",streamName:String(e.appData.streamName),consumerId:e.id,originator:"peer"}),Promise.resolve()}_onConsumerResumed(e,t){var r;return e.resume(),this.call.emit("CALL_SET_CONSUMER_RESUMED",{peerId:null!==(r=t.id)&&void 0!==r?r:"",streamName:String(e.appData.streamName),consumerId:e.id,originator:"peer"}),Promise.resolve()}_onConsumerScore(e,t){return i.__awaiter(this,void 0,void 0,(function*(){}))}_onConsumerLayersChanged(e,t,r){return i.__awaiter(this,void 0,void 0,(function*(){return this.call.emit("CALL_CONSUMER_LAYER_CHANGED",r),Promise.resolve()}))}_onSwitchConsumerTrack(e,t,r){var n,s,a,o;return i.__awaiter(this,void 0,void 0,(function*(){const i=e.id;if(null==i)return;const c=new Map;for(const r of t.add){const i=null===(n=e.consumers)||void 0===n?void 0:n.find((e=>e.id===r.consumerId));if(!i){const e=new l.SFUSwitchConsumerTrackEventError("unable to switch tracks: consumer not found",{consumerId:r.consumerId,peer:this,request:t});return void this.emitErrorDeprecated(e)}const a=String(i.appData.streamName);c.has(a)||c.set(a,{add:[],remove:[]}),null===(s=c.get(a))||void 0===s||s.add.push(i.track)}for(const r of t.remove){const i=null===(a=e.consumers)||void 0===a?void 0:a.find((e=>e.id===r.consumerId));if(!i){const e=new l.SFUSwitchConsumerTrackEventError("unable to switch tracks: consumer not found",{consumerId:r.consumerId,peer:this,request:t});return void this.emitErrorDeprecated(e)}const n=String(i.appData.streamName);c.has(n)||c.set(n,{add:[],remove:[]}),null===(o=c.get(n))||void 0===o||o.remove.push(i.track)}for(const[e,r]of c.entries()){if(0===r.add.length||0===r.remove.length){const e=new l.SFUSwitchConsumerTrackEventError("unable to switch tracks: consumers have different stream names",{peer:this,request:t});return void this.emitErrorDeprecated(e)}this.call.emit("CALL_SWAP_CONSUMERS",{peerId:i,streamName:e,add:r.add,remove:r.remove})}r({})}))}_onProducerClosed(e,t){return e.closed||(this.call.emit("CALL_REMOVE_PRODUCER",{streamName:t.streamName,producerId:t.producerId,originator:"client"}),e.close()),Promise.resolve()}_onProducerPaused(e){return e.pause(),Promise.resolve()}_onProducerResumed(e){return e.resume(),Promise.resolve()}produce(e,t,r){return i.__awaiter(this,void 0,void 0,(function*(){if(null!=this.sendLock)try{yield this.sendLock.ready()}catch(e){throw new Error("unable to acquire a lock")}else try{yield this._createSendTransport()}catch(e){const t=e instanceof Error?e.message:"unknown error";throw this.ctx.logger.error("unable to create send transport",{err:t}),e}if(null==this._sendTransport){const e=new Error("_sendTransport is null");throw this.ctx.logger.error("ms3.produce error",{err:e.message}),e}let i;const{simulcast:{maxBitrates:n}={}}=t;if(n&&"video"===e.kind){const s=Object.assign(Object.assign({},t),{track:e,appData:r,encodings:[{maxBitrate:n[0],dtx:!0},{maxBitrate:n[1],dtx:!0}],stopTracks:!1});t.audioOnly&&(s.appData.audioOnly=t.audioOnly),t.videoOnly&&(s.appData.videoOnly=t.videoOnly),s.appData.trackEnabled=s.track.enabled,s.appData.userId=this.call.user.userId,s.appData.displayName=this.call.user.displayName,this.ctx.logger.debug("create maxBitrates producer",Object.assign(Object.assign({},s),{track:null,appData:null})),i=yield this._sendTransport.produce(s)}else{const n=Object.assign(Object.assign({},t),{track:e,appData:r,stopTracks:!1});t.audioOnly&&(n.appData.audioOnly=t.audioOnly),t.videoOnly&&(n.appData.videoOnly=t.videoOnly),n.appData.trackEnabled=n.track.enabled,n.appData.userId=this.call.user.userId,n.appData.displayName=this.call.user.displayName,this.ctx.logger.debug("create basic producer",Object.assign(Object.assign({},n),{track:null,appData:null})),n.encodings&&n.encodings.length>1&&s.device.isIosDevice&&s.device.isImplements(a.Feature.BROWSER_TYPE)&&"chrome"===s.device.browserInfo.name&&(n.encodings=[{maxBitrate:25e5}],this.emitError((0,c.createError)(o.ErrorCode.SimulcastDisabled,"simulcast is disabled due to ios chrome limitations",{}))),i=yield this._sendTransport.produce(n)}return this._producers.set(i.id,i),this.ctx.logger.debug("ms3.produce",{appData:r,trackLabel:e.label}),i.on("transportclose",(()=>{this.ctx.logger.debug("ms3.produce: transport closed",{trackLabel:e.label,appData:r})})),i.on("trackended",(()=>{this.ctx.logger.debug("ms3.produce: track ended",{trackLabel:e.label,appData:r})})),i}))}clear(e){this._iceTimeouts.forEach((e=>{s.device.clearTimeout(e)})),this._iceTimeouts.clear(),null!=this._recvTransport&&this._recvTransport.close(),null!=this._sendTransport&&this._sendTransport.close()}close(e="Implementer did not pass debugString",t=!1){return i.__awaiter(this,void 0,void 0,(function*(){if(!this._closed)if(this.clear(e),this._closed=!0,null!=this.call._wsTransport)try{yield this.call._wsTransport.request("closePeer",{internal:t})}catch(r){const i=r instanceof Error?r.toString():"unknown error";this.ctx.logger.info("ms3.close: error closing peer on the server",{aggregates:{err:i,internal:t,reason:e}})}else this.ctx.logger.debug("close error",{err:"call._wsTransport is null"})}))}_initLock(){const e={};return e.promise=new Promise(((t,r)=>{e.resolve=()=>{e.resolved=!0,t()},e.reject=t=>{e.resolved?e.promise=Promise.reject(t):r(t)}})),e.ready=()=>e.promise,e}toJSON(){return{peers:Array.from(this.peers.values()).map((e=>({id:e.id,name:e.name,peerId:e.peerId,userId:e.userId,displayName:e.displayName,scope:e.scope,permissions:e.permissions,behaviours:e.behaviours}))),aggregates:{support:this.ctx.support.hash,localPeerId:this.call._localPeerId}}}}t.Peer=g,g.displayName="PvcPeer"},1970:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(7582),n=r(4702),s=r(4280),a=r(2834),o=r(5580),c=r(644),l=r(327),d=r(2696),u=i.__importDefault(r(250)),h=r(3611);let p=null;s.onceDeviceReady.then((e=>{e.isImplements(a.Feature.AUDIO_CONTEXT)&&(p=new e.AudioContext)}));const f="video",m="audio";class g extends l.ObservableEventEmitter{constructor(e,t,r,i){var n,s,a,o,l,u,h,p;super(),(0,c.onceCanceled)(e).then((e=>this.dispose(`Stream Context Cancelled: ${e}`))),this.ctx=e,this.streamName=t,this.call=r;const f=null!=i?i:{};this._audioOptions=null!==(n=f.audio)&&void 0!==n?n:{},null!=this._audioOptions.streamProvider?(this._audioStreamProvider=null!==(s=this._audioOptions.streamProvider)&&void 0!==s?s:null,this._audioStreamProviderType=null!==(a=this._audioOptions.streamProviderType)&&void 0!==a?a:d.CUSTOM_STREAM_TYPE):(this._audioStreamProvider=null,this._audioStreamProviderType=null),this._useEchoDetection=null!==(o=this._audioOptions.echoDetection)&&void 0!==o&&o,this._videoOptions=null!==(l=f.video)&&void 0!==l?l:{},null!=this._videoOptions.streamProvider?(this._videoStreamProvider=null!==(u=this._videoOptions.streamProvider)&&void 0!==u?u:null,this._videoStreamProviderType=null!==(h=this._videoOptions.streamProviderType)&&void 0!==h?h:d.CUSTOM_STREAM_TYPE):(this._videoStreamProvider=null,this._videoStreamProviderType=null),this._videoProducer=null,this._audioProducer=null,this._statsInterval=null!==(p=f.statsInterval)&&void 0!==p?p:5e3,e.logger.attachObject(this),e.logger.trace("constructor()",this),this.addInnerDisposer((()=>{this.close()}))}get logData(){return{streamName:this.streamName}}get audioProducer(){return this._audioProducer}get videoProducer(){return this._videoProducer}get hasVideoStreamTrack(){var e;const t=null===(e=this._videoStreamProvider)||void 0===e?void 0:e.source;return null!=t&&t.getVideoTracks().length>0}get hasAudioStreamTrack(){var e;const t=null===(e=this._audioStreamProvider)||void 0===e?void 0:e.source;return null!=t&&t.getAudioTracks().length>0}setVideoStreamProvider(e,t,r,n){return i.__awaiter(this,void 0,void 0,(function*(){return this._setMediaStreamProvider(f,e,t,r,!1,n)}))}setAudioStreamProvider(e,t,r,n){return i.__awaiter(this,void 0,void 0,(function*(){return this._setMediaStreamProvider(m,e,t,r,!1,n)}))}checkPermissions(e){e&&!this.call.hasPermission(d.PERMISSIONS.STREAM_VIDEO)?this.throwErrorDeprecated(new o.PermissionsError("no permission to stream video",{stream:this,permissions:this.call.permissions})):e||this.call.hasPermission(d.PERMISSIONS.STREAM_AUDIO)||this.throwErrorDeprecated(new o.PermissionsError("no permission to stream audio",{stream:this,permissions:this.call.permissions}))}_setMediaStreamProvider(e,t,r,n,s,a){var c,l,u;return i.__awaiter(this,void 0,void 0,(function*(){this.ctx.logger.debug("setMediaStreamRetriever",Object.assign(Object.assign({},this.logData),{kind:e}));const i=e===f;let h,p=null,m=null;if(i?(m=this._videoStreamProvider,h=this._videoStreamProviderType,this._videoStreamProvider=t,this._videoStreamProviderType=null!==(c=r.streamType)&&void 0!==c?c:d.CUSTOM_STREAM_TYPE,p=this._videoProducer):(m=this._audioStreamProvider,h=this._audioStreamProviderType,this._audioStreamProvider=t,this._audioStreamProviderType=null!==(l=r.streamType)&&void 0!==l?l:d.CUSTOM_STREAM_TYPE,p=this._audioProducer),!n)return null;if(this.checkPermissions(i),null!=p&&!p.closed){let n,a;null!=p.track&&p.track.stop();try{if(n=t.source,null==n)return this.ctx.logger.error("Stream provider returned null",Object.assign(Object.assign({},this.logData),{kind:e})),null}catch(t){const i=t instanceof Error?t.message:"unknown error";if(this.ctx.logger.warn("Unable to get media stream",Object.assign(Object.assign({err:i},this.logData),{kind:e})),!s&&null!=m)try{const t=Object.assign(Object.assign({},r),{streamType:null!=h?h:d.CUSTOM_STREAM_TYPE});yield this._setMediaStreamProvider(e,m,t,!0,!0,!1)}catch(t){this.emitErrorDeprecated(new o.InternalError(`Unable to revert media stream: ${e}`,{}))}throw t}if([a]=i?n.getVideoTracks():n.getAudioTracks(),this.ctx.logger.info("replacing producer track",Object.assign(Object.assign({},this.logData),{kind:e,trackLabel:null==a?void 0:a.label,trackState:null==a?void 0:a.readyState,settings:null!=(null==a?void 0:a.getSettings)?a.getSettings():null,capabilities:null!=(null==a?void 0:a.getCapabilities)?a.getCapabilities():null,constraints:null!=(null==a?void 0:a.getConstraints)?a.getConstraints():null})),null==a)throw this.ctx.logger.error("stream has no tracks of this kind",Object.assign(Object.assign({},this.logData),{kind:e,stream:n})),new Error("Unable to get track");return yield p.replaceTrack({track:a}),p.paused&&(p.resume(),this.call._resumeProducer(p.id,this.streamName)),this.call.emit("CALL_SET_PRODUCER_TRACK",{streamName:this.streamName,streamType:null!==(u=r.streamType)&&void 0!==u?u:d.CUSTOM_STREAM_TYPE,producerId:p.id,track:a}),p}this.ctx.logger.info("cannot replaceTrack, so resetting producer",Object.assign({},this.logData));try{p=yield this._setProducer(e,r,a)}catch(t){this.ctx.logger.warn("unable to set new producer",Object.assign(Object.assign({},this.logData),{kind:e}))}return p}))}_setProducer(e,t,r=!1,n=!1){var c,l,g,v,_,y,b,E,S,w,T,R;return i.__awaiter(this,void 0,void 0,(function*(){const i=e===f;let C;this.checkPermissions(i);try{if(i){n||null==(null===(c=this._videoProducer)||void 0===c?void 0:c.track)||this._videoProducer.track.stop(),null==this._videoStreamProvider&&this.throwErrorDeprecated(new o.RetrievingMediaStreamError("videoStreamProvider is not provided",{streamName:this.logData.streamName,mediaKind:e}));const t=this._videoStreamProvider.source;null==t&&this.throwErrorDeprecated(new o.RetrievingMediaStreamError("videoStreamProvider returned null",{streamName:this.logData.streamName,mediaKind:e})),C=t,this.ctx.logger.debug("retrieve a new video stream",{stream:C})}else{n||null==(null===(l=this._audioProducer)||void 0===l?void 0:l.track)||this._audioProducer.track.stop(),null==this._audioStreamProvider&&this.throwErrorDeprecated(new o.RetrievingMediaStreamError("audioStreamProvider is not provided",{streamName:this.logData.streamName,mediaKind:e}));const t=this._audioStreamProvider.source;null==t&&this.throwErrorDeprecated(new o.RetrievingMediaStreamError("audioStreamProvider returned null",{streamName:this.logData.streamName,mediaKind:e})),C=t,this.ctx.logger.debug("retrieve a new audio stream",{stream:C})}}catch(t){const r=t instanceof Error?t.message:"unknown error";throw this.ctx.logger.warn("Unable to get media stream",Object.assign(Object.assign({err:r},this.logData),{kind:e})),t}let A,P,D=!1;if(i){[A]=C.getVideoTracks();const r={streamName:this.streamName,userId:this.call.user.userId,trackEnabled:null==A?void 0:A.enabled,displayName:this.call.user.displayName};if(i&&s.device.isImplements(a.Feature.SCREEN_ORIENTATION)&&(r.orientation=s.device.screenOrientation),null==A){const t=new Error("stream.getVideoTracks()[0] is undefined");throw this.ctx.logger.warn("Unable to get media track",Object.assign(Object.assign({err:null==t?void 0:t.message},this.logData),{kind:e})),t}if(this._videoProducer&&!n)try{yield this._videoProducer.replaceTrack({track:A}),P=this._videoProducer,D=!0}catch(i){const n=i instanceof Error?i.message:"unknown error";this.ctx.logger.warn("Unable to replace track",Object.assign(Object.assign({err:n},this.logData),{kind:e})),P=yield this.call.createProducer(A,t,r)}else P=yield this.call.createProducer(A,t,r)}else{const r={streamName:this.streamName,userId:this.call.user.userId,displayName:this.call.user.displayName};let i;if(this._useEchoDetection&&null!=(null==p?void 0:p.createMediaStreamSource)&&null!=(null==p?void 0:p.createMediaStreamDestination)&&null!=this._gainNode){p.createMediaStreamSource(C).connect(this._gainNode);const e=p.createMediaStreamDestination();this._gainNode.connect(e),[A]=e.stream.getAudioTracks(),[i]=C.getAudioTracks()}else[A]=C.getAudioTracks();if(null==A){const t=new Error("stream.getAudioTracks()[0] is undefined");throw this.ctx.logger.warn("Unable to get media track",Object.assign(Object.assign({err:null==t?void 0:t.message},this.logData),{kind:e})),t}if(this._audioProducer&&!n)try{yield this._audioProducer.replaceTrack({track:A}),P=this._audioProducer,D=!0}catch(n){const s=n instanceof Error?n.message:"unknown error";this.ctx.logger.warn("Unable to replace track",Object.assign(Object.assign({err:s},this.logData),{kind:e})),P=yield this.call.createProducer(A,t,r),P.appData.parallelTrack=i}else P=yield this.call.createProducer(A,t,r),P.appData.parallelTrack=i}let L=null;if(i)D||(L=this._videoProducer,this._videoProducer=P);else if(D||(L=this._audioProducer,this._audioProducer=P),this._useEchoDetection)try{this._echoDetector=new u.default(P.track),null===(g=this._echoDetector)||void 0===g||g.on("echo",(()=>{var e;this.ctx.logger.debug(`echo detected at ${Date.now()}. Gain at ${null===(e=this._gainNode)||void 0===e?void 0:e.gain.value}`,Object.assign({},this.logData)),this._reduceGain()})),null===(v=this._echoDetector)||void 0===v||v.on("noecho",(()=>{var e;this.ctx.logger.debug(`echo stopped at ${Date.now()}. Gain at ${null===(e=this._gainNode)||void 0===e?void 0:e.gain.value}`,Object.assign({},this.logData)),this._restoreGain()}))}catch(e){const t=e instanceof Error?e.message:"unknown error";this.ctx.logger.error("unable to set up echo detector",Object.assign({err:t},this.logData))}const k=e=>{this.ctx.logger.debug(e,Object.assign({},this.logData)),null!=P.appData.parallelTrack&&P.appData.parallelTrack.stop();let t="";i&&null!=this._videoProducer?(t=this._videoProducer.id,this._videoProducer=null):null!=this._audioProducer&&(t=this._audioProducer.id,this._audioProducer=null),this.call._closeProducer(t,this.streamName)};return P.once("transportclose",(()=>k("producer transportclose"))),P.once("trackended",(()=>k("producer trackended"))),this.call._closed||(i?(this.call._removeMessage(h.TROUBLESHOOTING.NO_WEBCAM),this.call.emit("CALL_ADD_PRODUCER",{streamerName:this.streamName,producer:{id:P.id,kind:f,streamName:this.streamName,streamType:null!==(_=t.streamType)&&void 0!==_?_:d.CUSTOM_STREAM_TYPE,paused:P.paused,track:P.track,codec:null!==(E=null===(b=null===(y=P.rtpParameters)||void 0===y?void 0:y.codecs[0])||void 0===b?void 0:b.mimeType.split("/")[1])&&void 0!==E?E:"",preview:r}})):(this.call._removeMessage(h.TROUBLESHOOTING.NO_MIC),this.call.emit("CALL_ADD_PRODUCER",{streamerName:this.streamName,producer:{id:P.id,kind:m,streamName:this.streamName,streamType:null!==(S=t.streamType)&&void 0!==S?S:d.CUSTOM_STREAM_TYPE,paused:P.paused,track:P.track,codec:null!==(R=null===(T=null===(w=P.rtpParameters)||void 0===w?void 0:w.codecs[0])||void 0===T?void 0:T.mimeType.split("/")[1])&&void 0!==R?R:"",preview:r}})),this.ctx.logger.debug("producer set",Object.assign(Object.assign({},this.logData),{kind:e,producerId:P.id}))),null==L||L.closed||(L.close(),this.call._closeProducer(L.id,this.streamName)),P}))}disableAudio(){if(null!=this._audioProducer){this.ctx.logger.debug("disableAudio",Object.assign({},this.logData));try{this._audioProducer.close()}catch(e){const t=e instanceof Error?e.message:"unknown error";throw this.ctx.logger.error("unable to close audio producer",Object.assign({err:t},this.logData)),e}this.call._closeProducer(this._audioProducer.id,this.streamName),this._audioProducer=null}else this.ctx.logger.warn("stream.disableAudio: calling disableAudio without an audio producer",Object.assign({},this.logData))}pauseAudio(){null!=this._audioProducer?(this.ctx.logger.debug("pauseAudio",Object.assign({},this.logData)),this._audioProducer.pause(),this.call._pauseProducer(this._audioProducer.id,this.streamName)):this.ctx.logger.warn("stream.pauseAudio: calling pauseAudio without an audio producer",Object.assign({},this.logData))}enableAudio(e={},t=!1,r=!1){var n,s,a;return i.__awaiter(this,void 0,void 0,(function*(){if(this.ctx.logger.debug("enableAudio",Object.assign({},this.logData)),null==this._audioProducer||this._audioProducer.closed||t){if(null==this._audioStreamProvider){const e="no default audio stream retriever";throw this.ctx.logger.error(e,Object.assign({},this.logData)),new Error(e)}try{const t=Object.assign(Object.assign({},e),{streamType:null!==(n=this._videoStreamProviderType)&&void 0!==n?n:d.CUSTOM_STREAM_TYPE});yield this._setProducer(m,t,r)}catch(e){const t=e instanceof Error?e.message:"unknown error";throw this.ctx.logger.warn("unable to set up audio producer",Object.assign({err:t},this.logData)),e}(null===(a=null===(s=this._audioProducer)||void 0===s?void 0:s.track)||void 0===a?void 0:a.enabled)||this.pauseAudio()}else this._audioProducer.resume(),this.call._resumeProducer(this._audioProducer.id,this.streamName)}))}enableVideo(e={},t=!1,r=!1){var n,s,a;return i.__awaiter(this,void 0,void 0,(function*(){if(this.ctx.logger.debug("enableVideo",Object.assign(Object.assign({},this.logData),{options:e,refresh:t,preview:r})),null==this._videoProducer||this._videoProducer.closed||t){if(null==this._videoStreamProvider){const e="no default video stream retriever";throw this.ctx.logger.error(e,Object.assign({},this.logData)),new Error(e)}try{const t=Object.assign(Object.assign({},e),{streamType:null!==(n=this._videoStreamProviderType)&&void 0!==n?n:d.CUSTOM_STREAM_TYPE});yield this._setProducer(f,t,r)}catch(e){const t=e instanceof Error?e.message:"unknown error";throw this.ctx.logger.warn("unable to set up video producer",Object.assign({err:t},this.logData)),e}(null===(a=null===(s=this._videoProducer)||void 0===s?void 0:s.track)||void 0===a?void 0:a.enabled)||this.pauseVideo()}else this._videoProducer.resume(),this.call._resumeProducer(this._videoProducer.id,this.streamName)}))}disableVideo(){if(null!=this._videoProducer){this.ctx.logger.debug("disableVideo",Object.assign({},this.logData));try{this._videoProducer.close()}catch(e){const t=e instanceof Error?e.message:"unknown error";throw this.ctx.logger.error("unable to close video producer",Object.assign({err:t},this.logData)),e}this.call._closeProducer(this._videoProducer.id,this.streamName),this._videoProducer=null}else this.ctx.logger.warn("stream.disableVideo: calling disable video without a video producer",Object.assign({},this.logData))}pauseVideo(){null!=this._videoProducer?(this.ctx.logger.debug("pauseVideo",Object.assign({},this.logData)),this._videoProducer.pause(),this.call._pauseProducer(this._videoProducer.id,this.streamName)):this.ctx.logger.warn("stream.pauseVideo: calling pause video without a video producer",Object.assign({},this.logData))}hotswapProducer(e,t){var r,n;return i.__awaiter(this,void 0,void 0,(function*(){try{null==t.streamType&&(t.streamType="video"===e?null!==(r=this._videoStreamProviderType)&&void 0!==r?r:d.CUSTOM_STREAM_TYPE:null!==(n=this._audioStreamProviderType)&&void 0!==n?n:d.CUSTOM_STREAM_TYPE),yield this._setProducer(f,t,!1,!0)}catch(r){const i=r instanceof Error?r.message:"unknown error";throw this.ctx.logger.warn("unable to hotswap producer",Object.assign({kind:e,producerOptions:t,err:i},this.logData)),r}}))}_reduceGain(){var e,t;null!=this._gainNode&&(this._gainNode.gain.cancelScheduledValues(null!==(e=null==p?void 0:p.currentTime)&&void 0!==e?e:0),this._gainNode.gain.exponentialRampToValueAtTime(.5,null!==(t=null==p?void 0:p.currentTime)&&void 0!==t?t:0))}_restoreGain(){var e,t;null!=this._gainNode&&null!=this._baseGainValue&&(this._gainNode.gain.cancelScheduledValues(null!==(e=null==p?void 0:p.currentTime)&&void 0!==e?e:0),this._gainNode.gain.exponentialRampToValueAtTime(this._baseGainValue,(null!==(t=null==p?void 0:p.currentTime)&&void 0!==t?t:0)+30))}close(e=!0){null!=this._audioProducer&&(e&&this.call._closeProducer(this._audioProducer.id,this.streamName),this._audioProducer.close(),this._audioProducer=null),null!=this._videoProducer&&(e&&this.call._closeProducer(this._videoProducer.id,this.streamName),this._videoProducer.close(),this._videoProducer=null),null!=this._echoDetector&&(this._echoDetector.close(),this._echoDetector=null)}toJSON(){var e,t;return{audioProducer:null==this.audioProducer?null:{id:this.audioProducer.id,closed:this.audioProducer.closed,paused:this.audioProducer.paused,trackId:null===(e=this.audioProducer.track)||void 0===e?void 0:e.id},videoProducer:null==this.videoProducer?null:{id:this.videoProducer.id,closed:this.videoProducer.closed,paused:this.videoProducer.paused,trackId:null===(t=this.videoProducer.track)||void 0===t?void 0:t.id},aggregates:Object.assign(Object.assign({support:this.ctx.support.hash},(0,n.extractAggregates)(this.call)),{streamName:this.streamName})}}}g.displayName="PvcStream",t.default=g},3935:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(4280),n=r(5580),s=r(6107),a=r(327);class o extends a.ObservableEventEmitter{constructor(e,t,r,n,s,a){super(),this.connected=!1,this.connecting=!1,this.closed=!1,this.closing=!1,this.online=i.device.onLine,this._ws=null,this._hasError=!1,this._retryCount=0,this._requestId=0,this._pingTimeout=void 0,this._retry=()=>{},this.wsMessageTime=null,this.wsMessageInterval=void 0,this.shouldReconnect=!1,this.wsMessageSent=!1,this._webpageInactive=!1,this.ctx=e,this.uri=t,this.joinCall=r,this._retries=null!=n?n:1/0,this._handleOffline=()=>{e.logger.debug("Transport: offline detected"),this.online=!1,this.shouldReconnect=!0},this._handleOnline=()=>{e.logger.debug("Transport: online detected",{connected:this.connected,connecting:this.connecting,hasError:this._hasError}),this.online=!0},this._handleVisibilityChange=()=>{i.device.hidden&&(this._webpageInactive=!0)},i.device.addEventListener("offline",this._handleOffline),i.device.addEventListener("online",this._handleOnline),i.device.addEventListener("visibilitychange",this._handleVisibilityChange),e.logger.attachObject(this),e.logger.trace("constructor()"),this._connect(),this.wsMessageInterval=i.device.setInterval((()=>{let e=0;const t=new Date;null!=this.wsMessageTime&&this.wsMessageTime.getSeconds()!==t.getSeconds()&&(e=t.getTime()-this.wsMessageTime.getTime()),e/=1e3,this.online&&!i.device.hidden&&(this.shouldReconnect||e>a)&&(s||this._webpageInactive?(this.wsMessageSent=!0,this.log.warn(`Message not received from websocket exceeding ${a} seconds, re-initializing websocket.`),this._emit("websocket-reconnect",this._webpageInactive),this.shouldReconnect=!1,this._webpageInactive=!1):this.wsMessageSent||(this.wsMessageSent=!0,this.log.warn(`Message not received from websocket exceeding ${a} seconds.`),this.shouldReconnect=!1,this._webpageInactive=!1))}),1e3),this.addInnerDisposer((e=>{this.close()}))}get log(){return this.ctx.logger}request(e,t){if(!this._sendReady())return Promise.resolve(null);this._requestId+=1;const r=this._requestId;return new Promise(((i,n)=>{this.once(`response-${r}`,(e=>{var t;if(null!=e.reasons&&e.reasons.length>0){const r=null===(t=e.reasons[0])||void 0===t?void 0:t.text,i=new Error(`request error: ${r}`);n(i)}else i(e)})),this.send("request",{requestId:r,type:e,request:null!=t?t:null})}))}send(e,t){if(!this._sendReady(!1,this._ws))return;let r;try{r=JSON.stringify({event:e,data:t})}catch(t){return void this.log.error("websocket send error: unable to serialize date",{event:e,err:(0,n.wrapNativeError)(t)})}try{this._ws.send(r)}catch(t){const i=t instanceof Error?t.message:"unknown error";this.log.error("websocket send error",{event:e,data:r,err:i})}}setClosing(){this.closing=!0}close(e=!0){this.closed=e,this.closed&&(i.device.removeEventListener("offline",this._handleOffline),i.device.removeEventListener("online",this._handleOnline),i.device.removeEventListener("visibilitychange",this._handleVisibilityChange),i.device.clearInterval(this.wsMessageInterval)),null!=this._ws&&(this.log.debug("Transport: close called - closing websocket"),this._ws.close(),s.InstanceCollector.disposeInstance("websocket",this._ws))}_sendReady(e=!1,t=this._ws){return null!=t&&1===(null==t?void 0:t.readyState)||(e||this.log.warn("Transport: trying to sending on a closed websocket",{uri:this.uri,ws:null==t?void 0:t.readyState}),!1)}_onServerRequest(e){const{method:t,requestId:r,request:i}=e.data;Number.isNaN(r)?this.log.error("transport: Invalid request from server",{json:e}):this.emit(t,i,((e={},t=null)=>{this.send("response",{requestId:r,response:e,error:t})}))}_connect(){this.connecting=!0,null!=this._ws&&(this._ws.onclose=()=>{},this._ws.close(),s.InstanceCollector.disposeInstance("websocket",this._ws),this._ws=null),this._ws=null,this._ws=new WebSocket(this.uri),s.InstanceCollector.reportNewInstance("websocket",this._ws,{file:"call/transport.ts"});const e=Math.random();this.log.debug("Transport: _connect",{id:e}),this._ws.onopen=()=>{this.connected=!0,this.connecting=!1,this._hasError=!1,this._retryCount=0,this.log.debug("Transport: onopen",{id:e}),this._emit("connect")},this._ws.onerror=e=>{this._hasError=!0,this.log.info("websocket error",{uri:this.uri,err:(0,n.wrapNativeError)(e)})},this._ws.onmessage=e=>{var t,r,n,s,a,o,c,l,d;if(this.wsMessageTime=new Date,"pong"===e.data)return void this._pong();if("ping"===e.data||"0"===e.data)return void(null===(t=this._ws)||void 0===t||t.send("pong"));let u;try{u=JSON.parse(e.data)}catch(t){const r=t instanceof Error?t.stack:"unknown error";return void this.log.error("websocket parse error",{data:null==e?void 0:e.data,uri:this.uri,err:r})}if("ping"===u.event)return null===(r=this._ws)||void 0===r||r.send("pong"),void(i.device.isImplements(i.Feature.DEBUGGING)&&i.device.console.debug("websocket pong sent"));if("request"!==u.event){if("callError"===u.event){let t={},r="unknown";try{t=JSON.parse(null==e?void 0:e.data),r=(null===(s=null===(n=null==t?void 0:t.data)||void 0===n?void 0:n.causes)||void 0===s?void 0:s.length)?(null!==(c=null===(o=null===(a=null==t?void 0:t.data)||void 0===a?void 0:a.causes)||void 0===o?void 0:o.map((e=>e.message)))&&void 0!==c?c:[]).join("; "):null!==(d=null===(l=null==t?void 0:t.data)||void 0===l?void 0:l.errorMessage)&&void 0!==d?d:"unknown"}catch(e){}this.log.error(`Call Error: ${r}`,{data:t,uri:this.uri,event:u.event}),this.close()}this._emit(u.event,u.data)}else this._onServerRequest(u)},this._ws.onclose=t=>{this.log.info("Transport: websocket close",{code:t.code,uri:this.uri,id:e}),this._emit("disconnect",t.code,"websocket-closed"),i.device.clearTimeout(this._pingTimeout)}}_canRetry(){return this.connecting||this.closed||this.closing?(this.log.debug("Transport: no retry",{online:this.online,connecting:this.connecting,closed:this.closed,closing:this.closing}),!1):!(this._retryCount>this._retries&&(this.log.warn("Transport: limited retries",{uri:this.uri}),this._emit("call-rejected"),1))}_retryTimeoutLength(){let e=500;return this._retryCount>5&&this._retryCount<15?e=1e3:this._retryCount>=15?e=1e4:this._retryCount>=100&&(e=6e5),e}_joinCall(){this.online||this.connecting||this.closed?this._canRetry()&&(this._retryCount+=1,this.log.debug("Transport: join call"),this.joinCall().then((e=>{var t;let r;if(this.log.debug("Transport: response from joinCall",{response:e}),null==(null===(t=e.body)||void 0===t?void 0:t.call))return this.log.warn("Transport: refreshCall error",{sfuUri:this.uri}),this._emit("join-call-error",{error:"invalid response, call was missing"}),void i.device.setTimeout(this._joinCall.bind(this),this._retryTimeoutLength());r=e.body.call,this._hasError=!1,null!=r.callUri&&this.uri!==r.callUri?(this.log.debug("Transport: call uri changed",{call:r}),this.uri=r.callUri):this.log.debug("Transport: join call did not update call uri"),this._emit("join-refresh",e),this._connect()})).catch((e=>{404!==e.status&&this.log.warn("Transport: refreshCall error",{error:e,sfuUri:this.uri}),this._emit("join-call-error",{error:e}),i.device.setTimeout(this._joinCall.bind(this),this._retryTimeoutLength())}))):i.device.setTimeout(this._joinCall.bind(this),500)}_ping(){this._sendReady(!0,this._ws)&&(this._ws.send("ping"),this._pingTimeout=i.device.setTimeout((()=>{this.log.error("Transport: failed ping to server - retry connection"),this._retry(!0)}),3e3))}_pong(){i.device.clearTimeout(this._pingTimeout),this.connected&&i.device.setTimeout(this._ping.bind(this),3e3)}_emit(e,...t){try{this.emit(e,...t)}catch(e){const r=e instanceof Error?e.stack:"unknown error";this.log.warn("unhandled event handler error",{event:`${t[0]}`,err:r,uri:this.uri})}}toJSON(){return{aggregates:{support:this.ctx.support.hash,uri:this.uri,online:this.online}}}}t.default=o,o.displayName="Transport"},816:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultOptions=void 0;const i=r(7582),n=i.__importDefault(r(7187)),s=i.__importDefault(r(9996)),a=r(7881),o=i.__importDefault(r(5856)),c=r(4280),l=r(2914);t.defaultOptions={timeout:3e4,headers:{Accept:"application/json"}};class d extends n.default{constructor(e){var r,i,n,u,h,p,f,m;super(),this._stopped=!1,this._fatalError=null,this._token=null,this._retry=0,this._retries=[0,200,1e3,3e3],this._autorefresh=null,this._url=null;const g=null!==(r=null==e?void 0:e.logger)&&void 0!==r?r:new a.LoggerCore("VDC-core");null==e||delete e.logger;const v=null!==(n=null===(i=null==e?void 0:e.loggerConfig)||void 0===i?void 0:i.clientName)&&void 0!==n?n:"VDC",_=g.getLoggerMeta("client"),y=g.getLoggerMeta("release"),b=g.getLoggerMeta("package");if(g.setLoggerMeta("package",null!=b&&"VDC-core"!==b?`${b}/VDC-core`:"VDC-core").setLoggerMeta("client",null!=_?`${_}/${v}`:v).setLoggerMeta("release",null!=y?`${y}/${o.default.version}`:o.default.version).setLoggerMeta("commitHash",o.default.commit).setLoggerMeta("contextId",null!==(u=(0,l.contextId)())&&void 0!==u?u:"").setLoggerMeta("instanceId",null!==(h=(0,l.instanceId)())&&void 0!==h?h:"").appendChain(d),this.logger=g,this.options=(0,s.default)(t.defaultOptions,e),null!=e.endpoint||null!=(null==e?void 0:e.bootstrap)){if(null!=(null===(p=this.options.bootstrap)||void 0===p?void 0:p.token)&&(this._token=this.options.bootstrap.token,this.logger.setMessageAggregate("token",null!==(f=this._token)&&void 0!==f?f:"undefined"),this.logger.info("auth token set from bootstrap value")),this._headers=this.options.headers,null==this._token)this._retryRequest();else if(null!=(null===(m=this.options.bootstrap)||void 0===m?void 0:m.expire)){const e=this.options.bootstrap.expire.getTime()-Date.now()-6e4;this._autorefresh=c.device.setTimeout((()=>{this._autorefresh=null,this._stopped||this._retryRequest()}),e)}}else this.validationError("endpoint or bootstrap must be configured for auth")}validationError(e){const t=new Error(e);this._fatalError=t,this._stopped=!0,this.logger.error(e,{errName:null==t?void 0:t.name,errStack:null==t?void 0:t.stack})}destroy(){this._stopped=!0}request(e){if(this._fatalError)return void e(this._fatalError);if(null!=this._token)return this.logger.debug("existing token returned on token request"),void e(null,this._token);const t=()=>{this.removeListener("fatal",r),c.device.clearTimeout(i),this.logger.debug("new token returned on token request"),e(null,this._token)},r=()=>{this.removeListener("token",t),c.device.clearTimeout(i),this.logger.debug("new token returned on token request"),e(this._fatalError)},i=c.device.setTimeout((()=>{this.removeListener("token",t),this.removeListener("fatal",r),this.logger.info("token request timeout"),e(new Error("authorization: timeout"))}),this.options.timeout);this.once("token",t),this.once("fatal",r)}refreshToken(e){var t;return this.logger.debug("refreshToken called",{token:e}),null==e&&null==this._token?(this.logger.debug("no token to refresh"),!1):null!=e?(this._token=e,this.logger.setMessageAggregate("token",null!==(t=this._token)&&void 0!==t?t:"undefined"),this.logger.info("token manually set from refreshToken"),this._fatalError=null,null!=this._autorefresh&&(c.device.clearTimeout(this._autorefresh),this._autorefresh=null),!0):!this._fatalError&&(null!=this._token&&(null!=this._autorefresh&&(c.device.clearTimeout(this._autorefresh),this._autorefresh=null),this._token=null,this.logger.removeMessageAggregate("token"),(()=>{this._retryRequest()})()),!0)}ensureToken(e){null!=this._token?e():this.once("token",(()=>{e()}))}_parseJSON(e){return e.text().then((e=>{if(e)try{return JSON.parse(e)}catch(e){}return{}}))}_retryRequest(){const e=this._retries[this._retry];e?setTimeout((()=>{this._makeRequest()}),e):this._makeRequest()}toJSON(){return{}}_tokenSuccess(e){this._token=e,this.logger.setMessageAggregate("token",this._token),this._retry=0,setTimeout((()=>{this.emit("token",{token:e})}))}_makeRequest(){var e,t,r;return i.__awaiter(this,void 0,void 0,(function*(){if(null!=(null===(t=null===(e=this.options)||void 0===e?void 0:e.bootstrap)||void 0===t?void 0:t.refreshToken))try{const e=yield this.options.bootstrap.refreshToken();return this._tokenSuccess(e),void this.logger.info("token set from async bootstrap refreshToken")}catch(e){return void(e instanceof Error&&(this._fatalError=e,this.logger.warn("unable to refresh token from bootstrap function",{errName:null==e?void 0:e.name,errStack:null==e?void 0:e.stack}),this.emit("fatal")))}if(null==(null===(r=this.options)||void 0===r?void 0:r.endpoint))throw new Error("authorization: no ability to refresh token (boostrap or endpoint)");-1===this.options.endpoint.uri.indexOf("?")?this._url=`${this.options.endpoint.uri}?scope=${this.options.endpoint.scope}`:this._url=`${this.options.endpoint.uri}&scope=${this.options.endpoint.scope}`,this._handleFetch()}))}_handleFetch(){return i.__awaiter(this,void 0,void 0,(function*(){if(null!=this._url)try{const e=yield c.device.fetch(this._url,{credentials:"same-origin",headers:this._headers});this._handleFetchResponse(e)}catch(e){if(this._token=null,this.logger.removeMessageAggregate("token"),e instanceof TypeError)return this._fatalError=e,this.logger.error(e.message,{errName:null==e?void 0:e.name,errStack:null==e?void 0:e.stack}),void this.emit("fatal");this.logger.network("unable to refresh token from endpoint",{}),this._retryRequest(),this._retry<this._retries.length-1&&this._retry++}}))}_handleFetchResponse(e){if(!(e.status>=200&&e.status<300)){var t;if(401===e.status)throw new Error("authorization: unauthorized");if(403===e.status)throw new Error("authorization: forbidden");throw new Error("authorization: non-200 response code from auth server")}{const r=this._parseJSON(e);if((void 0!==(t=r).token||void 0!==t.expire)&&(null!=(null==r?void 0:r.token)&&(this._tokenSuccess(r.token),this.logger.info("token set from request response")),null!=(null==r?void 0:r.expire))){const e=new Date(r.expire).getTime()-Date.now()-6e4;this._autorefresh=c.device.setTimeout((()=>{this._autorefresh=null,this._stopped||(this.logger.info("refreshing token before expiration"),this._retryRequest())}),e)}}}}d.displayName="Authorization",t.default=d},3757:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeBounded=void 0;const i=r(7582).__importStar(r(401)),n=r(5580),s=r(59),a=new WeakMap;function o(e,t){return function(...r){var i;if("object"==typeof e&&e.isDisposed){const r=a.get(e),o=null==r?"":(0,s.formatStacktrace)(r),c=new n.DisposedObjectError("call on the disposed object",{className:null!==(i=e.constructor.displayName)&&void 0!==i?i:e.constructor.name,method:t.name});if("object"!=typeof e.ctx||"object"!=typeof e.ctx.logger||"function"!=typeof e.ctx.logger.error)throw c;e.ctx.logger.error(c.message,{err:c,target:e.name,method:t.name,stacktrace:o})}return t.apply(e,r)}}function c(e,t){return function(...r){return i.get().then((t=>{a.set(e,t)})),t.apply(e,r)}}t.makeBounded=function(e,t=[],r=!1){var i,n,s;if(null==e||"object"!=typeof e)throw new Error("bindMethods works only on objects");const a=function(e){let t={},r=e;for(;null!=r&&r!==Object.prototype;)t=Object.assign(Object.assign({},Object.getOwnPropertyDescriptors(r)),t),r=Object.getPrototypeOf(r);return t}(e),l=Object.keys(a).filter((e=>!t.includes(e)));for(const t of l){const l=Object.getOwnPropertyDescriptor(e,t),d=a[t].value;if("function"==typeof d&&"constructor"!==t&&(null==l||l.configurable)){let a=d.bind(e);r&&(a="dispose"===t?c(e,d):o(e,d)),Object.defineProperty(e,t,{value:a,configurable:null===(i=null==l?void 0:l.configurable)||void 0===i||i,enumerable:null!==(n=null==l?void 0:l.writable)&&void 0!==n&&n,writable:null!==(s=null==l?void 0:l.writable)&&void 0!==s&&s})}}return e}},5904:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getNetworkConnectionType=t.isMobileDevice=t.isIosDevice=t.isChrome=t.isSafari=t.isFirefox=t.supportsMediasoupWebrtc=t.supportsFlvHttp=t.supportsNativeHls=t.supportsMp4=t.supportsHlsjs=t.H264_CAPABILITY=t.OPUS_CAPABILITY=t.VP8_CAPABILITY=void 0;const i=r(7582),n=r(7881),s=r(960),a=r(4280),o=r(5488);t.VP8_CAPABILITY={clockRate:9e4,kind:"video",mimeType:"video/VP8"},t.OPUS_CAPABILITY={channels:2,clockRate:48e3,kind:"audio",mimeType:"audio/opus"},t.H264_CAPABILITY={clockRate:9e4,kind:"video",mimeType:"video/H264",parameters:{"packetization-mode":1}},t.supportsHlsjs=e=>{var r,i;if(!a.device.isImplements(a.Feature.HLSJS))return null==e||e.info("HlsJsPlayer is NOT supported"),!1;if(a.device.isImplements(a.Feature.BROWSER_TYPE)){if((0,t.isSafari)(a.device.browserInfo))return null==e||e.info("HlsJsPlayer is NOT supported in Safari, use Native Hls player instead",Object.assign(Object.assign({},a.device.browserInfo),{platform:a.device.platform})),!1;if("windows"===a.device.browserInfo.osname&&"chrome"===a.device.browserInfo.name&&parseInt(null!==(r=a.device.browserInfo.version)&&void 0!==r?r:"0",10)<52)return null==e||e.info("HlsJsPlayer is NOT supported",Object.assign(Object.assign({},a.device.browserInfo),{platform:a.device.platform})),!1;if(!a.device.isImplements(a.Feature.MEDIA_SOURCE)||!(null===(i=a.device.MediaSource)||void 0===i?void 0:i.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')))return null==e||e.info("HlsJsPlayer is NOT supported",Object.assign(Object.assign({},a.device.browserInfo),{platform:a.device.platform})),!1;null==e||e.debug("HlsJsPlayer is supported",Object.assign(Object.assign({},a.device.browserInfo),{platform:a.device.platform}))}return!0},t.supportsMp4=e=>{var t,r,i;return a.device.isImplements(a.Feature.BROWSER_TYPE)?"safari"===a.device.browserInfo.name&&parseInt(null!==(t=a.device.browserInfo.version)&&void 0!==t?t:"0",10)<10||"ie"===a.device.browserInfo.name?(null==e||e.info("MP4Player is NOT supported",Object.assign(Object.assign({},a.device.browserInfo),{platform:a.device.platform})),!1):("chrome"!==a.device.browserInfo.name||parseInt(null!==(r=a.device.browserInfo.version)&&void 0!==r?r:"0",10)>49)&&a.device.isImplements(a.Feature.WEB_SOCKET)&&a.device.isImplements(a.Feature.MEDIA_SOURCE)&&a.device.isImplements(a.Feature.MEDIA_DEVICE)&&a.device.isImplements(a.Feature.LOCAL_STORAGE)&&a.device.isImplements(a.Feature.DEBUGGING)&&a.device.isImplements(a.Feature.BROWSER_TYPE)&&(null===(i=a.device.MediaSource)||void 0===i?void 0:i.isTypeSupported('video/mp4; codecs="avc1.4d4028,mp4a.40.2"'))?(null==e||e.debug("MP4Player is supported",Object.assign(Object.assign({},a.device.browserInfo),{platform:a.device.platform})),!0):(null==e||e.info("MP4Player is NOT supported",Object.assign(Object.assign({},a.device.browserInfo),{platform:a.device.platform})),!1):(null==e||e.debug("MP4Player is NOT supported."),!1)},t.supportsNativeHls=e=>{if(!a.device.isImplements(a.Feature.BROWSER_TYPE))return null==e||e.debug("NativeHlsPlayer is NOT supported."),!1;if(!a.device.isIosDevice&&!a.device.isSafari)return null==e||e.debug("NativeHlsPlayer is NOT supported on non Safari browsers outside of iOS"),!1;if(!a.device.isImplements(a.Feature.CREATE_VIDEO_ELEMENT))return null==e||e.info("NativeHlsPlayer is NOT supported"),!1;const t=a.device.createVideoElement();return!(e=>"canPlayType"in e&&"function"==typeof e.canPlayType)(t)||"probably"!==t.canPlayType("application/vnd.apple.mpegURL")&&"maybe"!==t.canPlayType("application/vnd.apple.mpegURL")?(null==e||e.info("NativeHlsPlayer is NOT supported",Object.assign(Object.assign({},a.device.browserInfo),{platform:a.device.platform})),!1):(null==e||e.debug("NativeHlsPlayer is supported",Object.assign(Object.assign({},a.device.browserInfo),{platform:a.device.platform})),!0)},t.supportsFlvHttp=e=>i.__awaiter(void 0,void 0,void 0,(function*(){var t,r;if(!a.device.isImplements(a.Feature.BROWSER_TYPE))return null==e||e.debug("FlvHttpPlayer is NOT supported."),!1;if(a.device.isSafari)return null==e||e.debug("FlvHttpPlayer is NOT supported on non Safari browsers"),!1;if(a.device.isImplements(a.Feature.MPEGTS)){yield a.device.loadMpegtsScript();const i=null!==(r=null===(t=a.device.mpegts)||void 0===t?void 0:t.isSupported())&&void 0!==r&&r;return i||null==e||e.info("FlvHttpPlayer is NOT supported"),i}return null==e||e.debug("NativeHlsPlayer is supported",Object.assign(Object.assign({},a.device.browserInfo),{platform:a.device.platform})),!0})),t.supportsMediasoupWebrtc=(e,r)=>i.__awaiter(void 0,void 0,void 0,(function*(){const i=new o.Support(r?new n.LoggerCore("VDC-core").extend(r):new n.LoggerCore("VDC-core"));if(yield i.ready,!i.supports("h264"))return!1;if(!a.device.isImplements(a.Feature.MEDIA_STREAM))return null==r||r.info(`${e} is NOT supported`),!1;const c=[t.OPUS_CAPABILITY];a.device.isAndroidDevice?c.push(t.VP8_CAPABILITY):c.push(t.H264_CAPABILITY);try{let t;t=new s.Device,yield t.load({routerRtpCapabilities:{codecs:c}});const i={audio:t.canProduce("audio"),video:t.canProduce("video")};if(a.device.isImplements(a.Feature.BROWSER_TYPE)){if(!t.canProduce("audio")||!t.canProduce("video"))return null==r||r.info(`${e} is NOT supported`,Object.assign({browserInfo:a.device.browserInfo,avSupport:i,platform:a.device.platform})),!1;null==r||r.debug(`${e} is supported`,Object.assign({browserInfo:a.device.browserInfo,avSupport:i,platform:a.device.platform}))}return!0}catch(t){return a.device.isImplements(a.Feature.BROWSER_TYPE)?null==r||r.info(`${e} is NOT supported`,Object.assign(Object.assign({},a.device.browserInfo),{platform:a.device.platform})):null==r||r.info(`${e} is NOT supported`,{platform:a.device.platform}),!1}})),t.isFirefox=e=>a.device.isImplements(a.Feature.BROWSER_TYPE)&&"firefox"===a.device.browserInfo.name,t.isSafari=e=>a.device.isImplements(a.Feature.BROWSER_TYPE)&&"safari"===a.device.browserInfo.name,t.isChrome=e=>a.device.isImplements(a.Feature.BROWSER_TYPE)&&"chrome"===a.device.browserInfo.name,t.isIosDevice=()=>a.device.isIosDevice,t.isMobileDevice=()=>a.device.isMobileDevice,t.getNetworkConnectionType=function(){var e,t;let r="information unavailable",i="information unavailable";return a.device.isImplements(a.Feature.NETWORK_INFORMATION)&&((null===(e=null===a.device||void 0===a.device?void 0:a.device.connection)||void 0===e?void 0:e.type)&&(r=a.device.connection.type),(null===(t=null===a.device||void 0===a.device?void 0:a.device.connection)||void 0===t?void 0:t.effectiveType)&&(i=a.device.connection.effectiveType)),[r,i]}},2843:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r(7582).__exportStar(r(5904),t)},644:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.onceCanceled=t.cancel=t.walk=t.context=t.NullContext=t.cancelFuncKey=t.cancelPromiseKey=t.canceledKey=t.childrenKey=t.idKey=void 0;const i=r(4280);t.idKey=Symbol("id"),t.childrenKey=Symbol("children"),t.canceledKey=Symbol("canceled"),t.cancelPromiseKey=Symbol("cancelPromise"),t.cancelFuncKey=Symbol("cancelFunc");let n=1;function s(e,r=[],i=!1){for(const n of e[t.childrenKey])s(n,r,i);return i&&e[t.childrenKey].splice(0,e[t.childrenKey].length),r.push(e),r}t.NullContext={[t.idKey]:0,[t.childrenKey]:[],[t.canceledKey]:!1,[t.cancelPromiseKey]:Promise.resolve("null context"),[t.cancelFuncKey]:()=>{}},t.context=function(e,r=t.NullContext){const i=r===t.NullContext?{}:r,s=Object.assign(Object.assign(Object.assign({},i),e),{[t.idKey]:n++,[t.childrenKey]:[],[t.canceledKey]:!1,[t.cancelFuncKey]:()=>{}});return s[t.cancelPromiseKey]=new Promise((e=>{s[t.cancelFuncKey]=e})).then((e=>(s[t.canceledKey]=!0,e))),null!=i[t.childrenKey]&&(i[t.childrenKey].push(s),i[t.canceledKey]&&s[t.cancelFuncKey]("parent context is canceled")),s},t.walk=s,t.cancel=function(e,r="not specified"){if(e[t.canceledKey])return;const n=s(e,[],!0);for(const e of n)i.device.setTimeout((()=>{e[t.cancelFuncKey](r),e[t.canceledKey]=!0}),0)},t.onceCanceled=function(e){return e[t.cancelPromiseKey]}},9279:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hasVcContext=void 0,t.hasVcContext=function(e){if("object"!=typeof e||!("ctx"in e))return!1;const t=e.ctx;return"object"==typeof t&&"object"==typeof t.logger&&"object"==typeof t.support&&"object"==typeof t.videoClient}},59:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.startMobxDebugging=t.formatStacktrace=t.filterStacktrace=void 0;const i=r(8949),n=r(4280),s=/.*(bootstrap.*|node_modules.*|disposable\.ts)$/;function a(e){var t;const r=e.split("/");let i=null;for(;"src"!==i&&r.length>1;)i=null!==(t=r.shift())&&void 0!==t?t:null;return"src"===i&&r.unshift(i),`/${r.join("/")}`}function o(e){return e.filter((e=>{var t;return!s.test(null!==(t=e.fileName)&&void 0!==t?t:"")})).map((e=>{var t;return Object.assign(Object.assign({},e),{fileName:a(null!==(t=e.fileName)&&void 0!==t?t:"<unknown>")})}))}t.filterStacktrace=o,t.formatStacktrace=function(e,t=!0){return t?o(e).map((e=>`\tat ${e.functionName} (${e.fileName}:${e.lineNumber})`)).join("\n"):e.map((e=>`\tat ${e.functionName}`)).join("\n")};const c=["name","type","spyReportStart","debugObjectName","observableKind"];t.startMobxDebugging=function(){const e=n.device.isImplements(n.Feature.LOCAL_STORAGE)?n.device.localStorage.getItem("mobxDebug"):"";if("true"===e||"flat"===e){const t="flat"!==e,r=n.device.globals.get("mobxSpyDisposer");"function"==typeof r&&r();const s=(0,i.spy)((e=>{var r,i;let n=e.type,s=null!==(r=e.name)&&void 0!==r?r:"";switch(n){case"action":"object"==typeof e.object&&(s=`${e.object.constructor.name}.${s}`);break;case"add":case"delete":case"create":case"remove":case"splice":case"update":s=null!==(i=null==e.name?e.debugObjectName:`${e.debugObjectName}.${e.name}`)&&void 0!==i?i:""}s.startsWith("event:")&&(n=`event ${n}`,s=s.slice(6)),e.observableKind&&(s=`${e.observableKind} ${s}`);const a=Object.entries(e).filter((([e,t])=>!c.includes(e)));if(e.spyReportStart)t?(console.groupCollapsed(n,s),console.groupCollapsed("stacktrace"),console.trace(),console.groupEnd()):console.log(`%c${e.type}`,"font-weight: bold",s,Object.fromEntries(a));else{if("report-end"===e.type)return void(t&&console.groupEnd());console.log(`%c${e.type}`,"font-weight: bold",s)}t&&a.length>0&&console.log(Object.fromEntries(a))}));n.device.globals.set("mobxSpyDisposer",s)}}},6107:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InstanceCollector=void 0;const i=r(2045);class n extends i.EventEmitter{constructor(e){super(),this.options=e,this.objects=new Map,this.metas=new WeakMap,this.isDisposed=!1,n.instances.add(this);for(const t of e.classes)this.objects.set(t,new Set)}doesCollect(e){return this.options.classes.includes(e)}insertObject(e,t,r){this.objects.get(e).add(t),null!=r&&this.metas.set(t,r),t instanceof i.EventEmitter&&t.once("disposed",(()=>this.objects.get(e).delete(t)))}removeObject(e,t){var r;null===(r=this.objects.get(e))||void 0===r||r.delete(t),this.metas.delete(t)}static reportNewInstance(e,t,r){for(const i of n.instances.values())i.doesCollect(e)&&i.insertObject(e,t,r)}static disposeInstance(e,t){for(const r of n.instances.values())r.removeObject(e,t)}getObjects(e){return this.objects.has(e)?Array.from(this.objects.get(e).values()).map((e=>{var t;return[e,null!==(t=this.metas.get(e))&&void 0!==t?t:{}]})):[]}dispose(e){this.isDisposed=!0,n.instances.delete(this),this.emit("disposed")}}t.InstanceCollector=n,n.instances=new Set,"object"==typeof r.g&&null!=r.g&&(r.g._VDC_InstanceCollector=n)},3676:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dumpVideoElement=void 0;const i=r(4508);t.dumpVideoElement=function(e){var t,r,n,s;if(null==e)return{};const a={playDebugHasSrcObject:null!=e.srcObject,playDebugMuted:e.muted,playDebugPaused:e.paused,playDebugHeight:e.videoHeight,playDebugWidth:e.videoWidth,playDebugAutoplay:e.autoplay,playDebugReadyState:e.readyState,playDebugPlaysInLineAttr:null!==(t=e.getAttribute("playsinline"))&&void 0!==t?t:"undefined",playDebugWebkitPlaysInLineAttr:null!==(r=e.getAttribute("webkit-playsinline"))&&void 0!==r?r:"undefined"};return(0,i.isMediaStream)(e.srcObject)&&(a.playDebugHasAudioTrack=(null===(n=e.srcObject)||void 0===n?void 0:n.getAudioTracks().length)>0,a.playDebugHasVideoTrack=(null===(s=e.srcObject)||void 0===s?void 0:s.getVideoTracks().length)>0),a}},854:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.disposeObjects=void 0;const i=r(4702),n=r(644),s=r(9279);t.disposeObjects=function(e,t,r){var a;const o=e.constructor,c=null!==(a=null==o?void 0:o.displayName)&&void 0!==a?a:o.name;e.isDisposed||((0,s.hasVcContext)(e)&&(e.ctx.logger.trace(`dispose() ${r}`,{aggregates:{reason:r}}),(0,n.cancel)(e.ctx,`${c} disposed: ${r}`)),t.forEach((t=>{try{t(`${c} inner disposer: ${r}`)}catch(t){(0,s.hasVcContext)(e)&&e.ctx.logger.error("error in dispose logic",{object:(0,i.isSerializableObject)(e)?e:`${e}`,className:c,err:`${t}`,reason:r})}})),t.splice(0,t.length))}},327:(e,t,r)=>{"use strict";var i,n;Object.defineProperty(t,"__esModule",{value:!0}),t.ObservableEventEmitter=void 0;const s=r(2045),a=r(8949),o=r(4280),c=r(5580),l=r(3757),d=r(644),u=r(9279),h=r(854);function p(e,t){return(0,a.isObservableProp)(e,t)||(0,a.isComputedProp)(e,t)}const f=Symbol("Emitter"),m=Symbol("Observers");t.ObservableEventEmitter=class{constructor(e=!0){this[i]=new s.EventEmitter,this[n]=new Map,this.disposers=[],this.disposed=!1,this.disposing=!1,e&&(0,l.makeBounded)(this,[],!1)}startEmitting(e){if(this[m].has(e))return;const t=this[f].emit.bind(this[f],e),r=(0,a.reaction)(function(e,t){return()=>e[t]}(this,e),t,{name:`event:${this.constructor.name}.${String(e)}`});this[m].set(e,r)}stopEmitting(e){var t;null===(t=this[m].get(e))||void 0===t||t(),this[m].delete(e)}setMaxListeners(e){return this[f].setMaxListeners(e),this}getMaxListeners(){return this[f].getMaxListeners()}addListener(e,t){return this[f].addListener(e,t),p(this,e)&&this.startEmitting(e),this}emit(e,t,...r){return this[f].emit(e,t,...r)}off(e,t){return this[f].off(e,t),0===s.EventEmitter.listenerCount(this[f],e)&&this.stopEmitting(e),this}on(e,t){return this[f].on(e,t),p(this,e)&&this.startEmitting(e),this}once(e,t){return this[f].once(e,t),p(this,e)&&this.startEmitting(e),this}prependListener(e,t){return this[f].prependListener(e,t),p(this,e)&&this.startEmitting(e),this}prependOnceListener(e,t){return this[f].prependOnceListener(e,t),p(this,e)&&this.startEmitting(e),this}removeAllListeners(e){this[f].removeAllListeners(e);for(const e of this[m].keys())this.stopEmitting(e);return this}removeListener(e,t){return this[f].removeListener(e,t),0===s.EventEmitter.listenerCount(this[f],e)&&this.stopEmitting(e),this}addInnerDisposer(...e){for(const t of e)"function"==typeof t?this.disposers.unshift(t):this.disposers.unshift(t.dispose.bind(t))}autorun(e){this.addInnerDisposer((0,a.autorun)(e))}get isDisposed(){return this.disposed}emitError(e){this[f].emit("error",e),!e.isMuted&&(0,u.hasVcContext)(this)&&c.VideoClientErrorDeprecated.log(e,this.ctx.logger)}throwError(e){throw this.emitError(e),e}throwErrorDeprecated(e){throw this.emitErrorDeprecated(e),e}emitErrorDeprecated(e){try{this[f].emit("error",e),e.critical&&this.dispose(`due error: ${e.code}`)}catch(t){(0,u.hasVcContext)(this)?this.ctx.logger.error("error handler throws another error",{err:e,handlerErr:(0,c.wrapNativeError)(t)}):o.device.isImplements(o.Feature.DEBUGGING)&&o.device.console.error("error handler throws another error",{err:e,handlerErr:t})}}dispose(e="not provided"){this.disposed||this.disposing||(this.disposing=!0,(0,h.disposeObjects)(this,this.disposers,e),this.removeAllListeners(),(0,u.hasVcContext)(this)&&(0,d.cancel)(this.ctx),this.disposed=!0,this.emit("disposed"))}},i=f,n=m},5423:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createSilentAudioTrack=t.uuidv4=void 0;var i=r(4851);Object.defineProperty(t,"uuidv4",{enumerable:!0,get:function(){return i.uuidv4}});var n=r(5183);Object.defineProperty(t,"createSilentAudioTrack",{enumerable:!0,get:function(){return n.createSilentAudioTrack}})},2149:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extendContext=t.isNamedClass=void 0;const i=r(7881),n=r(2914),s=r(644);t.isNamedClass=function(e){return"string"==typeof Reflect.get(e,"displayName")},t.extendContext=function(e,t){return(0,s.context)({logger:new i.LoggerCore(n.PACKAGE_NAME).extend(e.logger).appendChain(t),chain:`${e.chain}:${t.displayName}`},e)}},791:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventsHandler=t.originalTarget=t.removeProxy=t.addProxy=t.emitterMethods=void 0;const r=["disposed"];function i(e){return"setMaxListeners"in e&&"getMaxListeners"in e}t.emitterMethods=new Map(Object.entries({addListener:"addListener",on:"addListener",prependListener:"prependListener",removeListener:"removeListener",off:"removeListener"})),t.addProxy=Symbol("AddProxy"),t.removeProxy=Symbol("RemoveProxy"),t.originalTarget=Symbol("originalTarget"),t.EventsHandler=class{constructor(){this.proxies=new WeakMap,this.proxyEvents=new WeakMap}getOrCreateEvent(e){let t=this.proxyEvents.get(e);return null==t&&(t=[],this.proxyEvents.set(e,t)),t}addProxy(e,t){var r,n;if(i(e)&&i(t)){const r=e.getMaxListeners();t.getMaxListeners()<r&&t.setMaxListeners(r)}for(const i of null!==(r=this.proxyEvents.get(e))&&void 0!==r?r:[])t.addListener(i.type,i.listener);t.once("disposed",this.removeProxy.bind(this,e,t)),this.proxies.has(e)||this.proxies.set(e,new Set),null===(n=this.proxies.get(e))||void 0===n||n.add(t)}removeProxy(e,t){var r;for(const i of null!==(r=this.proxyEvents.get(e))&&void 0!==r?r:[])t.removeListener(i.type,i.listener);const i=this.proxies.get(e);null!=i&&i.delete(t)}addListener(e,t,i){var n;const s=null!==(n=this.proxies.get(e))&&void 0!==n?n:[];if(this.getOrCreateEvent(e).push({type:t,listener:i}),e.addListener(t,i),!r.includes(t))for(const e of s)e.addListener(t,i)}prependListener(e,t,i){var n;const s=null!==(n=this.proxies.get(e))&&void 0!==n?n:[];if(this.getOrCreateEvent(e).unshift({type:t,listener:i}),e.prependListener(t,i),!r.includes(t))for(const e of s)e.prependListener(t,i)}removeListener(e,t,i){var n;const s=null!==(n=this.proxies.get(e))&&void 0!==n?n:[],a=this.getOrCreateEvent(e);for(let e=0;e<a.length;e++)t===a[e].type&&i===a[e].listener&&a.splice(e,1);if(e.removeListener(t,i),!r.includes(t))for(const e of s)e.removeListener(t,i)}get(e,r,i){if(r===t.originalTarget)return e;if(r===t.addProxy)return this.addProxy.bind(this,e);if(r===t.removeProxy)return this.removeProxy.bind(this,e);if(t.emitterMethods.has(r)){const i=t.emitterMethods.get(r);if(null!=i)return this[i].bind(this,e)}return Reflect.get(e,r,i)}}},3772:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncHandler=t.implementation=void 0;const i=r(2045),n=r(7881),s=r(8949),a=r(2149),o=r(791);class c{constructor(e,t){this.key=e,this._fn=t,this.stack=[]}get wrapper(){const e=this,t=function(...t){return e.apply(this,t)};return Object.defineProperty(t,"name",{value:`${String(this.key)}SyncWrapper`}),t}get fn(){return this._fn}set fn(e){this._fn=e,null!=e&&(this.stack.forEach((([t,r,i,n])=>{e.apply(t,r).then(i,n)})),this.stack.splice(0,this.stack.length))}postpone(e,t){return new Promise(((r,i)=>{this.stack.push([e,t,r,i])}))}apply(e,t){return null!=this.fn?this.fn.apply(e,t):this.postpone(e,t)}}t.implementation=Symbol("implementation");class l extends o.EventsHandler{constructor(e={}){var t;super(),this.options=e,this.implementation=new WeakMap,this.syncProperties=new WeakMap,this.logger=null!==(t=e.logger)&&void 0!==t?t:new n.LoggerCore("SyncHandler")}sync(e,t,r,i){var n;if(null!=i&&"postpone"===Reflect.get(null!==(n=this.options.methods)&&void 0!==n?n:{},r))return void(t.method.fn=Reflect.get(i,r));null!=i&&t.changed&&Reflect.set(i,r,t.val),this.updateReaction(e,t,r,i);const s=null==i?void 0:Reflect.get(i,r);t.changed||t.val===s||(t.val=s,t.atom.reportChanged())}updateReaction(e,t,r,i){var n;null===(n=t.disposer)||void 0===n||n.call(t),delete t.disposer,null!=i&&(t.disposer=(0,s.reaction)((()=>Reflect.get(i,r)),(e=>{t.val=e,t.atom.reportChanged()}),{name:`proxy:${String(r)}`}))}propBecomeObservable(e,t){var r,i;const n=this.getOrCrateMeta(e,t);this.updateReaction(e,n,t,null!==(i=null===(r=this.implementation.get(e))||void 0===r?void 0:r.impl)&&void 0!==i?i:null)}propBecomeUnobservable(e,t){var r;const i=this.getOrCrateMeta(e,t);null===(r=i.disposer)||void 0===r||r.call(i),delete i.disposer}getOrCrateMeta(e,t){var r,i,n;this.syncProperties.has(e)||this.syncProperties.set(e,new Map);let a=null===(r=this.syncProperties.get(e))||void 0===r?void 0:r.get(t);if(null==a){const r=null===(i=this.implementation.get(e))||void 0===i?void 0:i.impl,o=null==r?void 0:(0,s.untracked)((()=>Reflect.get(r,t)));a={val:o,atom:(0,s.createAtom)(`proxy:${String(t)}`,this.propBecomeObservable.bind(this,e,t),this.propBecomeUnobservable.bind(this,e,t)),changed:!1,method:new c(t,null!=o?o:null)},null===(n=this.syncProperties.get(e))||void 0===n||n.set(t,a)}return a}getObservedProp(e,t){const r=this.getOrCrateMeta(e,t);return r.atom.reportObserved(),r.val}deleteObservedProp(e,t){var r;const i=this.getOrCrateMeta(e,t),n=null===(r=this.implementation.get(e))||void 0===r?void 0:r.impl;return i.val=null==n?void 0:Reflect.get(n,t),i.changed=!1,i.atom.reportObserved(),i.val}reportObservedProp(e,t,r){const i=this.getOrCrateMeta(e,t);i.val=r,i.changed=!0,i.atom.reportChanged()}getObservableImplementation(e){let t=this.implementation.get(e);return null==t&&(t={atom:(0,s.createAtom)("proxy:implementation"),impl:null,sentWarn:!1},this.implementation.set(e,t)),t.atom.reportObserved()||0!==i.EventEmitter.listenerCount(e,"implementation")||t.sentWarn||(t.sentWarn=!0),t.impl}setImplementation(e,t){var r,i,n;for(const[n,s]of null!==(i=null===(r=this.syncProperties.get(e))||void 0===r?void 0:r.entries())&&void 0!==i?i:[])this.sync(e,s,n,t);let a=this.implementation.get(e);null==a&&(a={impl:null,atom:(0,s.createAtom)("proxy:implementation"),sentWarn:!1},this.implementation.set(e,a)),null!=a.impl&&(null===(n=a.impl)||void 0===n||n.emit("detached"),super.removeProxy(e,a.impl)),null!=t&&super.addProxy(e,t),a.impl=t,a.atom.reportChanged(),e.emit("implementation"),null!=t&&(null==t||t.emit("attached"))}getImplMethod(e,t){var r;const i=null===(r=this.implementation.get(e))||void 0===r?void 0:r.impl;if(null!=i){const e=Reflect.get(i,t);if(null!=e&&"function"==typeof e)return e}}get(e,r,i){if(r===o.originalTarget)return e;if(r===t.implementation)return this.getObservableImplementation(e);if(o.emitterMethods.has(r)){const t=o.emitterMethods.get(r);if(null!=t)return this[t].bind(this,e)}if(null!=this.options.methods&&r in this.options.methods){const t=this.getImplMethod(e,r);switch(this.options.methods[r]){case"stub":return null!=t?t:()=>{};case"optional":return t;case"strict":if(null==t)throw new Error(`No implementations of method '${String(r)}' found`);return t;case"postpone":return this.getOrCrateMeta(e,r).method.wrapper}}return Reflect.has(e,r)?Reflect.get(e,r,i):this.getObservedProp(e,r)}set(e,r,i,n){if(r===t.implementation)return(0,s.runInAction)((()=>{this.setImplementation(e,i)})),!0;if(Reflect.has(e,r)){if(!Reflect.set(e,r,i,n)){const t=(0,a.isNamedClass)(e.constructor)?e.constructor.displayName:e.constructor.name;this.logger.warn(`Property '${String(r)}' of class '${t}' is not writable`)}return!0}this.reportObservedProp(e,r,i);const o=this.implementation.get(e);if(null!=(null==o?void 0:o.impl)){if(!Reflect.set(o.impl,r,i)){const e=(0,a.isNamedClass)(o.impl.constructor)?o.impl.constructor.displayName:o.impl.constructor.name;this.logger.warn(`Property '${String(r)}' of class '${e}' is not writable`)}return!0}return!0}deleteProperty(e,r){return r===t.implementation?(this.setImplementation(e,null),!0):Reflect.has(e,r)?Reflect.deleteProperty(e,r):(this.deleteObservedProp(e,r),!0)}}t.SyncHandler=l},8253:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>new Promise(((t,r)=>{e.request(((e,i)=>{null==e&&null!=i?t(i):r(e)}))}))},711:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(7582),n=i.__importDefault(r(129)),s=r(5580),a=i.__importDefault(r(8253)),o=r(4280),c={Accept:"application/json","Content-Type":"application/json"},l={headers:{},failoverUrls:[],reauth:!1,method:"get",warnStatuses:[],callId:""};t.default=(e,t,r)=>i.__awaiter(void 0,void 0,void 0,(function*(){var d,u,h,p;const f=Object.assign(Object.assign({},l),r);if(null!=r.auth&&"function"!=typeof r.auth.refreshToken)throw e.logger.error("auth must be a Authorization object"),new Error("auth must be a Authorization object");const m=null!==(d=f.auth)&&void 0!==d?d:null,g=null!==(u=f.headers)&&void 0!==u?u:{},v=Object.assign(Object.assign({},c),g);let _=t,y=null!==(p=null===(h=f.failoverUrls)||void 0===h?void 0:h.slice())&&void 0!==p?p:[],b=y.length>0;const E=()=>{if(null==y[0])throw new Error("Failover URL is undefined");[_]=y,y=y.slice(1),b=y.length>0},S=(t=!1)=>i.__awaiter(void 0,void 0,void 0,(function*(){var i,c;let l=null;if(null!=m){r.reauth&&m.refreshToken();try{l=yield(0,a.default)(m)}catch(t){const r=t instanceof Error?t.message:"unknown error";throw e.logger.warn("Authorization error",{err:r}),t}}const d={method:null!==(i=r.method)&&void 0!==i?i:"get",headers:null!=l?Object.assign(Object.assign({},v),{Authorization:`bearer ${l}`}):v};if(null!=r.body&&(d.body=r.body),null!=r.query){const e=n.default.stringify(r.query);_=_.includes("?")?`${_}&${e}`:`${_}?${e}`}let u,h;try{u=yield o.device.fetch(_,d)}catch(r){const i=r instanceof Error?r.message:"unknown error";if(e.logger.warn("Unable to reach server",{useUrl:_,err:i}),!t&&b)return E(),S(0===y.length);throw r}if(204===u.status)return null;try{h=yield u.json()}catch(r){let i;try{i=yield u.text()}catch(e){}if(e.logger.warn("Unexpected non-json response from server",{useUrl:_,body:i,statusCode:u.status}),!t&&b)return E(),S(0===y.length);throw r}if(401===u.status||403===u.status){if(null!=m&&!t&&m.refreshToken())return S(!0);throw e.logger.warn("Authorization error from server",{useUrl:_,status:u.status,reasons:null==h?void 0:h.reasons}),new s.NetworkError("Authorization error from server",{status:u.status})}if(null!=r.expectedStatus&&u.status!==r.expectedStatus||200!==u.status){b||(null===(c=r.warnStatuses)||void 0===c?void 0:c.includes(u.status))?e.logger.warn("Unexpected response code from server",{useUrl:_,status:u.status,reasons:null==h?void 0:h.reasons}):e.logger.error("Unexpected response code from server",{useUrl:_,status:u.status,reasons:null==h?void 0:h.reasons});const i=new s.NetworkError("Unexpected response code from server",{status:u.status});if(!t&&b)return E(),S(0===y.length);throw i}return{authToken:l,body:h}}));return S()}))},8705:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.retry=void 0;const i=r(4280),n=r(5580);t.retry=function(e,t,r,s){return new Promise(((a,o)=>{let c=0;const l=()=>{r(c).then(a).catch((r=>{++c<e?(null==s||s.warn(`retrying ${c} time(s)`,{err:(0,n.wrapNativeError)(r)}),i.device.setTimeout(l,t)):o(r)}))};l()}))}},5183:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createSilentAudioTrack=void 0,t.createSilentAudioTrack=function(e){const t=function(e){const t=e.createBufferSource(),r=e.createBuffer(1,1,e.sampleRate),i=r.getChannelData(0);for(let e=0;e<i.length;e++)i[e]=2*Math.random()-1;return t.buffer=r,t.loop=!0,t}(e),r=e.createGain();return r.gain.value=.001,t.connect(r),r.connect(e.destination),t.start(),e.createMediaStreamDestination().stream.getAudioTracks()[0]}},3668:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={AUTOPLAY_PROGRESS:"autoplay-first-progress",FIRST_LOAD:"first-load",MANIFEST_LOAD:"manifest-load",HLSJS_INIT:"hlsjs-init",M3U8_MANIFEST_LOAD:"m3u8-manifest-load",INDEX_MANIFEST_LOAD:"index-manifest-load",INITIAL_FRAGMENT_LOAD:"initial-fragment-load",JOIN_CALL_ENDPOINT:"join-call-endpoint",SFU_CONNECTION:"sfu-connection",VIDEO_CONSUMER:"video-consumer",FIRST_TIME_UPDATE:"first-time-update"}},3078:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STATS_EVENTS=t.stats=void 0;const i=r(7582).__importDefault(r(3668));t.STATS_EVENTS=i.default;const n=new(r(8623).Stats);t.stats=n},8623:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Stats=void 0,t.Stats=class{constructor(){this.eventCounter=0,this.timings={}}start(e){this.eventCounter+=1;const t=this.eventCounter;return this.timings[t]={ms:Date.now(),name:e},t}stop(e,t){var r,i;const n=null===(r=this.timings[e])||void 0===r?void 0:r.ms;if(null==n)return{};const s=null!==(i=Object.assign({},t))&&void 0!==i?i:{};return s.ms=Date.now()-n,delete this.timings[e],s}}},721:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hasH264=t.hasVP8=t.getGlobalDocument=t.hasOpus=t.hasH264Capability=t.hasVP8Capability=t.hasOpusCapability=t.checkCapabilitiesForRoom=void 0;const i=r(7582),n=r(960),s=r(4280),a=r(2834),o=r(2843);function c(e){return i.__awaiter(this,void 0,void 0,(function*(){try{let t;return t=new n.Device,yield t.load({routerRtpCapabilities:e}),{audio:t.canProduce("audio"),video:t.canProduce("video")}}catch(e){throw new Error(`current browser/device not supported: ${e}`)}}))}t.checkCapabilitiesForRoom=c,t.hasOpusCapability=e=>i.__awaiter(void 0,void 0,void 0,(function*(){console.log("!!--!! device, opus",s.device);const t=s.device.isImplements(a.Feature.BROWSER_TYPE)?Object.assign(Object.assign({},s.device.browserInfo),{platform:s.device.platform}):{platform:s.device.platform};let r;try{r=yield c({codecs:[o.OPUS_CAPABILITY]}),console.log("!!--!! device capabilities",r)}catch(r){const i=r instanceof Error?r.message:"unknown error";return null==e||e.warn("support: no opus capabilities support",{logInfo:t,err:i}),!1}return r.audio?(null==e||e.debug("support: have opus capabilities support",{logInfo:t}),!0):(null==e||e.warn("support: no opus capabilities support",{logInfo:t}),!1)})),t.hasVP8Capability=e=>i.__awaiter(void 0,void 0,void 0,(function*(){const t=s.device.isImplements(a.Feature.BROWSER_TYPE)?Object.assign(Object.assign({},s.device.browserInfo),{platform:s.device.platform}):{platform:s.device.platform};let r;try{r=yield c({codecs:[o.VP8_CAPABILITY]})}catch(r){const i=r instanceof Error?r.message:"unknown error";return null==e||e.warn("support: no vp8 capabilities support",{logInfo:t,err:i}),!1}return r.video?(null==e||e.debug("support: have vp8 capabilities support",{logInfo:t}),!0):(null==e||e.warn("support: no vp8 capabilities support",{logInfo:t}),!1)})),t.hasH264Capability=e=>i.__awaiter(void 0,void 0,void 0,(function*(){const t=s.device.isImplements(a.Feature.BROWSER_TYPE)?Object.assign(Object.assign({},s.device.browserInfo),{platform:s.device.platform}):{platform:s.device.platform};let r;try{r=yield c({codecs:[o.H264_CAPABILITY]})}catch(r){const i=r instanceof Error?r.message:"unknown error";return null==e||e.warn("support: no h264 capabilities support",{logInfo:t,err:i}),!1}return r.video?(null==e||e.debug("support: have h264 capabilities support",{logInfo:t}),!0):(null==e||e.warn("support: no h264 capabilities support",{logInfo:t}),!1)})),t.hasOpus=()=>!0,t.getGlobalDocument=()=>globalThis.document,t.hasVP8=()=>{try{if(null==(0,t.getGlobalDocument)())return!0}catch(e){return!0}return!s.device.isImplements(a.Feature.BROWSER_TYPE)||"ios"!==s.device.browserInfo.osname&&"safari"!==s.device.browserInfo.name&&"edge"!==s.device.browserInfo.name&&"microsoft edge"!==s.device.browserInfo.name},t.hasH264=e=>{try{if(null==(0,t.getGlobalDocument)())return!0}catch(e){return!0}if(s.device.isImplements(a.Feature.BROWSER_TYPE)&&"chrome"===s.device.browserInfo.name){if(!s.device.isImplements(a.Feature.MEDIA_RECORDER))return null==e||e.flush(),!1;if(s.device.MediaRecorder.isTypeSupported("video/webm; codecs=h264"))return null==e||e.debug("support: h264 support: chrome"),!0;null==e||e.warn("support: no h264 support",Object.assign(Object.assign({reason:"chrome without h264"},s.device.browserInfo),{platform:s.device.platform}))}return s.device.isAndroidDevice?(s.device.isImplements(a.Feature.BROWSER_TYPE)?null==e||e.warn("support: no h264 support",Object.assign(Object.assign({reason:"android device"},s.device.browserInfo),{platform:s.device.platform})):null==e||e.warn("support: no h264 support",{reason:"android device",platform:s.device.platform}),!1):s.device.isImplements(a.Feature.MEDIA_DEVICE)&&s.device.isCodecSupported("h264")}},5488:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.videoSupported=t.Support=t.supportsChromeiOSCheck=t.iosVersion=void 0;const i=r(7582),n=r(960),s=r(4280),a=r(2834),o=i.__importStar(r(721));function c(){const e=(0,t.iosVersion)();return!(!s.device.isImplements(a.Feature.BROWSER_TYPE)||null==s.device.browserInfo.version||"ios"!==s.device.browserInfo.osname||"chrome"!==s.device.browserInfo.name)&&null!=e&&(e[0]>14||14===e[0]&&e[1]>=3)}t.iosVersion=()=>{if(null!=s.device.platform&&/iP(hone|od|ad)/.test(s.device.platform)&&null!=s.device.appVersion){const e=s.device.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);if(e)return[parseInt(e[1],10),parseInt(e[2],10)]}return null},t.supportsChromeiOSCheck=c;class l{constructor(e,t){this.log=e,null!=t&&this.log.setMessageAggregate("create",t),this.supportTags={opus:!1,vp8:!1,h264:!1};const r=null!=t?t:this.buildLocalSupportHashSync();r.includes("o")&&(this.supportTags.opus=!0),r.includes("v")&&(this.supportTags.vp8=!0),r.includes("h")&&(this.supportTags.h264=!0),this.ready=this.buildLocalSupportHashAsync().then((e=>{e.includes("o")&&(this.supportTags.opus=!0),e.includes("v")&&(this.supportTags.vp8=!0),e.includes("h")&&(this.supportTags.h264=!0)}))}supports(e){return!!this.supportTags[e]}get any(){return Object.keys(this.supportTags).some((e=>this.supportTags[e]))}get audio(){return this.supportTags.opus}get video(){return this.supportTags.vp8||this.supportTags.h264}get hash(){let e="";return this.supportTags.opus&&(e+="o"),this.supportTags.vp8&&(e+="v"),this.supportTags.h264&&(e+="h"),e}shared(e){if(!this.any)return this;if(!e.any)return e;const t=this.hash;let r="";return e.hash.split("").forEach((e=>{t.includes(e)&&(r+=e)})),new l(this.log,r)}basicSupport(){var e,t;if("ReactNative"===s.device.platform)return!0;const r=s.device.isImplements(a.Feature.BROWSER_TYPE)?Object.assign(Object.assign({},s.device.browserInfo),{platform:s.device.platform}):{platform:s.device.platform};if(null==(0,n.detectDevice)())return this.log.warn("support: mediasoups says device is unsupported",{logInfo:r}),this.log.flush(),!1;if(!s.device.isImplements(a.Feature.MEDIA_DEVICE))return this.log.warn("support: no RTCPeerConnection",{logInfo:r}),this.log.flush(),!1;if(s.device.isImplements(a.Feature.BROWSER_TYPE)){const r=c();if("ios"===s.device.browserInfo.osname&&!["safari","ios"].includes(null!==(e=s.device.browserInfo.name)&&void 0!==e?e:"")&&!r)return"chrome"===s.device.browserInfo.name?this.log.warn("support: ios chrome support is only available on versions >= 14.3",Object.assign({},s.device.browserInfo)):this.log.warn("support: non-safari ios",Object.assign({},s.device.browserInfo)),this.log.flush(),!1;if(null!=s.device.browserInfo.name&&/edge/.test(s.device.browserInfo.name)&&!s.device.isImplements(a.Feature.WEBRTC))return this.log.warn("support: msedge with missing webrtc api",Object.assign({hasRTCRtpReceiver:null==(null===s.device||void 0===s.device?void 0:s.device.RTCRtpReceiver)?"false":"true",hasRTCRtpSender:null==(null===s.device||void 0===s.device?void 0:s.device.RTCRtpSender)?"false":"true",hasRTCRtpReceiverGetCapabilities:null!=(null===(t=null===s.device||void 0===s.device?void 0:s.device.RTCRtpReceiver)||void 0===t?void 0:t.getCapabilities)?"true":"false"},s.device.browserInfo)),this.log.flush(),!1}return s.device.isImplements(a.Feature.MEDIA_DEVICE)}buildLocalSupportHashSync(){const e=s.device.isImplements(a.Feature.BROWSER_TYPE)?Object.assign(Object.assign({},s.device.browserInfo),{platform:s.device.platform}):{platform:s.device.platform};if(!this.basicSupport())return"";let t="";return o.hasOpus()&&(t=t.concat("o")),o.hasVP8()&&(t=t.concat("v")),o.hasH264(this.log)&&(t=t.concat("h")),this.log.setLoggerAggregate("supportHash",t),this.log.debug("support: support hash generated",{logInfo:e}),t}buildLocalSupportHashAsync(){return i.__awaiter(this,void 0,void 0,(function*(){const e=s.device.isImplements(a.Feature.BROWSER_TYPE)?Object.assign(Object.assign({},s.device.browserInfo),{platform:s.device.platform}):{platform:s.device.platform};if(!this.basicSupport())return"";let t="";return(yield o.hasOpusCapability(this.log))&&(t=t.concat("o")),(yield o.hasVP8Capability(this.log))&&(t=t.concat("v")),(yield o.hasH264Capability(this.log))&&(t=t.concat("h")),""!==t&&this.log.setLoggerAggregate("supportHash",t),this.log.debug("support: support hash generated",{logInfo:e}),t}))}}t.Support=l,l.displayName="Support",t.videoSupported=function(){return s.device.isImplements(a.Feature.MEDIA_DEVICE)}},5184:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TimeupdateWrapper=void 0,t.TimeupdateWrapper=class{constructor(){this.paused=!1,this.handlersMap=new WeakMap,this.pauseUpdates=()=>{this.paused=!0},this.resumeUpdates=()=>{this.paused=!1}}wrap(e,t){var r;null==this.handlersMap.get(e)&&this.handlersMap.set(e,[]);const i=this.handle.bind(this,t);null===(r=this.handlersMap.get(e))||void 0===r||r.push(i),e.addEventListener("timeupdate",i),e.addEventListener("vdc:timeupdatePause",this.pauseUpdates),e.addEventListener("vdc:timeupdateResume",this.resumeUpdates)}handle(e){this.paused||e()}unwrap(e){var t;for(const r of null!==(t=this.handlersMap.get(e))&&void 0!==t?t:[])e.removeEventListener("timeupdate",r),e.removeEventListener("vdc:timeupdatePause",this.pauseUpdates),e.removeEventListener("vdc:timeupdateResume",this.resumeUpdates)}}},7029:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserInteraction=void 0;const i=r(7582),n=r(8949),s=r(7881),a=r(327),o=r(4280),c=r(1149),l=r(5423);class d extends a.ObservableEventEmitter{constructor(e){super(),this.hadInteraction=!1,this.audioCtx=null,this.audioEl=null,this.audioTrack=null,this.logError=e=>{var t,r;null===(r=(t=this.logger).info)||void 0===r||r.call(t,`silentAudio: ${e}`)},(0,n.makeObservable)(this,{hadInteraction:n.observable}),this.logger=new s.LoggerCore("VDC-core").setLoggerMeta("client","VDC").appendChain(d),this.logger.info("constructor()",e),this.options=e,this.options.silentAudio.playSilentAudio&&this.once("hadInteraction",this.playSilentAudio),this.init(),this.addInnerDisposer((()=>{this.stopSilentAudio(),c.userActivationEvents.forEach((e=>{o.device.isImplements(o.Feature.DOCUMENT)&&o.device.document.body.removeEventListener(e,this.handleUserInteractionDOMEvent)}))}))}init(){return i.__awaiter(this,void 0,void 0,(function*(){if(this.logger.info("init()"),o.device.isImplements(o.Feature.DOCUMENT)){if(o.device.isImplements(o.Feature.USER_ACTIVATION)&&o.device.userActivation.hasBeenActive)return this.hadInteraction=o.device.userActivation.hasBeenActive,void this.logger.info(`hasBeenActive: ${o.device.userActivation.hasBeenActive}`);try{this.logger.info("trying to play audio to determine if user has interacted with page"),yield this.playSilentAudio(),this.hadInteraction=!0}catch(e){this.stopSilentAudio(),this.logger.info("unable to play audio, attaching userActivation event listeners"),c.userActivationEvents.forEach((e=>{o.device.isImplements(o.Feature.DOCUMENT)&&o.device.document.body.addEventListener(e,this.handleUserInteractionDOMEvent)})),this.once("hadInteraction",(()=>{c.userActivationEvents.forEach((e=>{o.device.isImplements(o.Feature.DOCUMENT)&&o.device.document.body.removeEventListener(e,this.handleUserInteractionDOMEvent)}))}))}}else this.logger.warn("device does not support UserActivationFeature")}))}playSilentAudio(){var e,t;return i.__awaiter(this,void 0,void 0,(function*(){if(this.logger.info("playSilentAudio()",this.options),!(o.device.isImplements(o.Feature.AUDIO_CONTEXT)&&o.device.isImplements(o.Feature.MEDIA_STREAM)&&o.device.isImplements(o.Feature.CREATE_AUDIO_ELEMENT)&&o.device.isImplements(o.Feature.DOCUMENT)))return;this.audioCtx=new o.device.AudioContext,this.audioTrack=(0,l.createSilentAudioTrack)(this.audioCtx);const r=new o.device.MediaStream([this.audioTrack]),i=o.device.createAudioElement();i.srcObject=r,this.audioEl=o.device.document.body.appendChild(i),null===(e=this.audioEl)||void 0===e||e.setAttribute("data-silent","true");try{yield null===(t=this.audioEl)||void 0===t?void 0:t.play(),!1!==this.options.silentAudio.infiniteLoop&&!1!==this.options.silentAudio.playSilentAudio||setTimeout((()=>{this.stopSilentAudio()}),100)}catch(e){throw this.logError(e),e}}))}stopSilentAudio(){var e,t,r;this.logger.info("stopSilentAudio()",this.options),null===(e=this.audioTrack)||void 0===e||e.stop(),null===(t=this.audioCtx)||void 0===t||t.close().catch(this.logError),null===(r=this.audioEl)||void 0===r||r.remove(),this.audioCtx=null,this.audioEl=null,this.audioTrack=null}isValidInteractionEvent(e){return!((0,c.isKeyboardEvent)(e)&&"keydown"===e.type&&27===e.keyCode||(0,c.isPointerEvent)(e)&&"pointerup"===e.type&&"mouse"===e.pointerType||(0,c.isPointerEvent)(e)&&"pointerdown"===e.type&&"mouse"!==e.pointerType||"touchend"===e.type)}handleUserInteractionDOMEvent(e){this.isValidInteractionEvent(e)&&!this.hadInteraction&&(this.hadInteraction=!0,this.logger.info(`user interacted with page via ${e.type}`))}}t.UserInteraction=d,d.displayName="UserInteraction"},4851:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uuidv4=void 0,t.uuidv4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}},2122:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VideoClient=void 0;const i=r(7582),n=r(7881),s=r(8949),a=r(4280),o=r(6639),c=i.__importDefault(r(5856)),l=r(2914),d=r(1536),u=r(3199),h=r(5580),p=r(7170),f=i.__importDefault(r(6772)),m=r(8101),g=r(9354),v=r(6395),_=r(3757),y=r(644),b=r(327),E=r(2149),S=r(791),w=r(5488),T=r(2843),R={autoPlay:!0,refetch:!1,displayPoster:"preview",players:[{id:"webrtc"},{id:"native-hls"},{id:"hlsjs"}],muted:!1,volume:.5,driverFailoverSeconds:10,pollingInterval:5e3,unauthorizedPollingInterval:2e3,notFoundPollingInterval:1e4,unauthorizedRecoveryDuration:1e4,retryCall:!0,urlParams:{vdc:!0,substitute:!1}},C=new S.EventsHandler;class A extends b.ObservableEventEmitter{constructor(e){var t,r,i,o,d,u;super(!1),this.options={backendEndpoints:[],userId:""},this.setMaxListeners(20);const h=null!==(t=null==e?void 0:e.logger)&&void 0!==t?t:new n.LoggerCore("VDC-core");null==e||delete e.logger;const p=null!==(i=null===(r=null==e?void 0:e.loggerConfig)||void 0===r?void 0:r.clientName)&&void 0!==i?i:"VDC",f=h.getLoggerMeta("client"),m=h.getLoggerMeta("release"),g=h.getLoggerMeta("package"),v=a.device.isImplements(a.Feature.NETWORK_INFORMATION)?null===(o=null===a.device||void 0===a.device?void 0:a.device.connection)||void 0===o?void 0:o.type:"information unavailable",[b,E]=(0,T.getNetworkConnectionType)();h.setLoggerMeta("package",null!=g&&"VDC-core"!==g?`${g}/VDC-core`:"VDC-core").setLoggerMeta("client",null!=f?`${f}/${p}`:p).setLoggerMeta("release",null!=m?`${m}/${c.default.version}`:c.default.version).setLoggerMeta("commitHash",c.default.commit).setLoggerMeta("contextId",null!==(d=(0,l.contextId)())&&void 0!==d?d:"").setLoggerMeta("instanceId",null!==(u=(0,l.instanceId)())&&void 0!==u?u:"").appendChain(A).setMessageAggregate("displayName",null==e?void 0:e.displayName).setMessageAggregate("networkConnection",v).setMessageAggregate("networkConnectionType",b).setMessageAggregate("networkConnectionEffectiveType",E);const S=new w.Support(new n.LoggerCore("VDC-core").extend(h).appendChain(w.Support));this.ctx=(0,y.context)({logger:h,videoClient:this,support:S,chain:A.displayName}),(0,s.makeObservable)(this,{requestPlayer:s.action});const R=(0,_.makeBounded)(new Proxy(this,C));return R.init(e),h.trace("constructor()",{backendEndpoints:null==e?void 0:e.backendEndpoints}),R}init(e){var t;null!=(null==e?void 0:e.autoPlay)&&null!=(null==e?void 0:e.playerOptions)&&null==(null===(t=null==e?void 0:e.playerOptions)||void 0===t?void 0:t.autoPlay)&&(e.playerOptions.autoPlay=e.autoPlay),this.updateOptions(e),this.on("error",(e=>{u.VideoClientError.log(e,this.ctx.logger)}))}static validateOptions(e){return e}updateOptions(e){if(null==e)return;const t=A.validateOptions(e);null!=t.logger&&(this.ctx.logger.warn("using `logger` in updateOptions() is not allowed"),delete t.logger),this.options=Object.assign(Object.assign({},this.options),t)}callSupported(){return i.__awaiter(this,void 0,void 0,(function*(){return yield this.ctx.support.ready,this.ctx.support.supports("h264")||this.ctx.support.supports("vp8")}))}createCall(e){var t;return i.__awaiter(this,void 0,void 0,(function*(){yield this.ctx.support.ready;const{backendEndpoints:r,token:i}=this.options;yield this.validateCallOptions();const n={token:i,backendEndpoints:r,sfu:Object.assign({},null!==(t=e.sfu)&&void 0!==t?t:{}),playerOptions:this.options.playerOptions,clientReferrer:e.clientReferrer,streamKey:e.streamKey},s=this.createSFUJoinParams(),a=new d.Call((0,E.extendContext)(this.ctx,d.Call),!0,n,s);return this[S.addProxy](a),a.ready()}))}joinCall(e,t={}){return i.__awaiter(this,void 0,void 0,(function*(){const r=this.createSFUJoinParams();return this.internalJoinCall(e,r,t,this.ctx)}))}internalJoinCall(e,t,r={},n=this.ctx){return i.__awaiter(this,void 0,void 0,(function*(){const{playerOptions:s,token:a}=r,o=i.__rest(r,["playerOptions","token"]),{backendEndpoints:c,displayName:l,userId:u}=this.options,{onCallJoinEndpoint:h,onSFUConnection:p}=r;yield this.validateCallOptions();const f={token:null!=a?a:this.options.token,backendEndpoints:c,callId:e,sfu:o,playerOptions:null!=s?s:this.options.playerOptions},m=Object.assign(Object.assign({},t),{user:Object.assign({displayName:null!=l?l:u,userId:u},null==t?void 0:t.user)}),g=new d.Call((0,E.extendContext)(n,d.Call),!1,f,m);return g.on("callJoinEndpoint",(()=>{h&&h()})),g.on("sfuConnection",(()=>{p&&p()})),this[S.addProxy](g),g.ready()}))}requestPlayer(e,t=R){const r={autoPlay:null!=t.autoPlay?t.autoPlay:R.autoPlay,displayPoster:null!=t.displayPoster?t.displayPoster:R.displayPoster,players:null!=t.players?t.players:R.players,refetch:null!=t.refetch?t.refetch:R.refetch,muted:null!=t.muted?t.muted:R.muted,pollingInterval:null!=t.pollingInterval?t.pollingInterval:R.pollingInterval,unauthorizedPollingInterval:null!=t.unauthorizedPollingInterval?t.unauthorizedPollingInterval:R.unauthorizedPollingInterval,notFoundPollingInterval:null!=t.notFoundPollingInterval?t.notFoundPollingInterval:R.notFoundPollingInterval,unauthorizedRecoveryDuration:null!=t.unauthorizedRecoveryDuration?t.unauthorizedRecoveryDuration:R.unauthorizedRecoveryDuration,volume:null!=t.volume?t.volume:R.volume,driverFailoverSeconds:null!=t.driverFailoverSeconds?t.driverFailoverSeconds:R.driverFailoverSeconds,retryCall:null!=t.retryCall?t.retryCall:R.retryCall,urlParams:null!=t.urlParams?t.urlParams:R.urlParams,requestHeaders:null!=t.requestHeaders?t.requestHeaders:R.requestHeaders},i={muted:t.muted,autoPlay:t.autoPlay,refetch:t.refetch,volume:t.volume};this.ctx.logger.debug("requestPlayer()",{manifest:e,mergedPlayerOptions:r,options:i});let n=null,s=null;try{s=this.internalRequestPlayer(e,r)}catch(e){e instanceof Error&&(n=e)}return null==s&&this.throwError((0,u.createError)(u.ErrorCode.NoPlayersAvailable,"No supported players",{},n)),this[S.addProxy](s),s}createSFUJoinParams(){const{displayName:e,userId:t}=this.options;return{user:{displayName:null!=e?e:t,userId:t}}}validateCallOptions(){return i.__awaiter(this,void 0,void 0,(function*(){const{backendEndpoints:e,userId:t}=this.options;(yield this.callSupported())||this.throwError((0,u.createError)(u.ErrorCode.H264NotSupported,"h264 is not supported",{})),null==e&&this.throwError((0,u.createError)(u.ErrorCode.NoBackendEndpoints,"backendEndpoints is not provided",{})),null==t&&this.throwError((0,u.createError)(u.ErrorCode.NoUserId,"userId is not provided",{}))}))}internalRequestPlayer(e,t){if((0,o.isManifest)(e)){const r=(0,E.extendContext)(this.ctx,g.ManifestPlayer),i=new f.default((0,E.extendContext)(r,f.default),e,{pollingInterval:t.pollingInterval,notFoundPollingInterval:t.notFoundPollingInterval,unauthorizedPollingInterval:t.unauthorizedPollingInterval,unauthorizedRecoveryDuration:t.unauthorizedRecoveryDuration,urlParams:t.urlParams,requestHeaders:t.requestHeaders});i.on("error",(e=>{this.emit("error",e)}));const n=t.players.filter((e=>"mediasoup"===e||"string"!=typeof e&&"mediasoup"!==e.id)),s={autoPlay:t.autoPlay,muted:t.muted,volume:t.volume,blurred:t.blurred,retryCall:t.retryCall,requestHeaders:t.requestHeaders};n.forEach((e=>{"string"!=typeof e&&(e.options=Object.assign(Object.assign({},s),e.options))}));const a=new g.ManifestPlayer(r,i,Object.assign(Object.assign({},t),{players:n}));return null!=t.preferredScoreLevel&&(a.preferredLevel=t.preferredScoreLevel),a}if(e instanceof m.MediasoupSource)return new v.MediasoupPlayer((0,E.extendContext)(this.ctx,v.MediasoupPlayer),e,{});if(e instanceof p.MediaStreamController)return new v.MediasoupPlayer((0,E.extendContext)(this.ctx,v.MediasoupPlayer),e,{});throw new h.NotSupportedError("source not supported",{})}}t.VideoClient=A,A.displayName="VideoClient"},5856:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"@video/video-client-core",version:"10.3.1",commit:"79615b341115c03d606156a855aa924412b1ecd7"}},3013:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Recorder=void 0;const i=r(7582),n=r(5923),s=r(4280),a=r(5580),o=r(327),c=i.__importDefault(r(5856)),l=r(2914);class d extends o.ObservableEventEmitter{constructor(e,t){var r,i,o,u,h,p,f,m,g,v;super(),this.recorder=null,this.locked=!1,this.destroyed=!1,this.localFilePath=null,this.writable=null,this.totalStorageAvailable=0,this.maxRecordingLength=0,this.dataWritten=!1,this.closing=!1,this.saving=!1,this.storageAlertSent=!1,this.userClosedSave=!1,this.dataAggregate=[],s.device.isImplements(s.Feature.MEDIA_RECORDER)||this.throwErrorDeprecated(new a.NotSupportedError("MediaRecorder is not supported",{})),s.device.isImplements(s.Feature.MEDIA_STREAM)&&s.device.isImplements(s.Feature.MEDIA_DEVICE)||this.throwErrorDeprecated(new a.NotSupportedError("MediaStream is not supported",{})),s.device.isImplements(s.Feature.AUDIO_CONTEXT)||this.throwErrorDeprecated(new a.NotSupportedError("AudioContext is not supported",{})),this.device=s.device,this.logger=null!==(r=t.logger)&&void 0!==r?r:new n.LoggerCore(l.PACKAGE_NAME).setLoggerMeta("client","VDC").setLoggerMeta("release",c.default.version).appendChain(d),this.on("error",(e=>{a.VideoClientErrorDeprecated.log(e,this.logger)})),this.stream=null!=e?e:null,this.options=null!=t?t:{},this.options.mimetype=null!==(i=this.options.mimetype)&&void 0!==i?i:s.device.isIosDevice?"video/mp4":"video/webm;codecs=VP8",this.options.startRecordingWhenClicked=null===(o=this.options.startRecordingWhenClicked)||void 0===o||o;const _=null!==(u=this.options.audioBitsPerSecond)&&void 0!==u?u:128e3;this.options.audioBitsPerSecond=_;const y=null!==(h=this.options.videoBitsPerSecond)&&void 0!==h?h:5e6;this.options.videoBitsPerSecond=y,this.options.cursor=null!==(p=this.options.cursor)&&void 0!==p?p:"motion",this.options.displaySurface=null!==(f=this.options.displaySurface)&&void 0!==f?f:"all",this.options.frameRate=null!==(m=this.options.frameRate)&&void 0!==m?m:24,this.options.height=1920,s.device.MediaRecorder.isTypeSupported(this.options.mimetype)||this.throwErrorDeprecated(new a.MediaRecorderError("mimeType is not supported",{mimeType:this.options.mimetype})),null===(v=(g=this.device).storageEstimate)||void 0===v||v.call(g).then((({usage:e,quota:t})=>{const r=Math.round(e/1048576),i=Math.round(t/1048576)-r;this.totalStorageAvailable=i;const n=(_+y)/8/1e6;this.maxRecordingLength=i/(60*n)-1}))}static isSupported(e){return s.device.isImplements(s.Feature.MEDIA_RECORDER)&&s.device.MediaRecorder.isTypeSupported(e)}newMediaRecorder(e,t){const r=new this.device.MediaRecorder(e,t);r.addEventListener("error",(e=>{this.emitErrorDeprecated(new a.MediaRecorderError("media recorder error",{}))}));const i=e.getVideoTracks();return 0!==i.length&&i[0].enabled&&"ended"!==i[0].readyState||this.throwErrorDeprecated(new a.MediaRecorderError("no active video tracks",{})),i[0].addEventListener("ended",(()=>{this.emit("browser-stop")})),r.addEventListener("pause",this.handlePause),r.addEventListener("resume",this.handleResume),r.addEventListener("start",this.handleStart),r.addEventListener("stop",this.handleStop),r.addEventListener("dataavailable",this.handleNewData),r}handlePause(){this.emit("pause")}handleResume(){this.emit("resume")}handleStart(){this.emit("start")}handleStop(){this.emit("stop")}handleNewData(e){var t,r;return i.__awaiter(this,void 0,void 0,(function*(){if(!this.closing)if(this.saving){const i={suggestedName:`recording.${Date.now()}`,types:[{description:"Video Recording",accept:{"video/x-matroska":[".webm"]},"-use_wallclock_as_timestamps":!0}]};try{this.localFilePath=yield this.device.showSaveFilePicker(i),this.writable=yield this.localFilePath.createWritable()}catch(t){const r=t instanceof Error?t:null;return this.emitErrorDeprecated(new a.MediaRecorderError("an error occurred on save record",{inner:r})),this.saving=!1,this.dataAggregate.push(e.data),void this.emit("save-canceled")}this.emit("data",e.data);let n=null;this.dataAggregate.length>0?(this.dataAggregate.push(e.data),n=new Blob(this.dataAggregate)):n=new Blob([e.data]);try{yield null===(t=this.writable)||void 0===t?void 0:t.write(n),this.dataWritten=!0,null===(r=this.writable)||void 0===r||r.close(),this.dataAggregate=[],yield this.close()}catch(e){const t=e instanceof Error?e:null;this.emitErrorDeprecated(new a.MediaRecorderError("failed to write to file",{inner:t}))}}else this.dataWritten||this.storageAlertSent||(this.storageAlertSent=!0,this.pause(),this.dataAggregate.push(e.data),this.device.confirmMessage("Your device is nearing its storage capacity. Please return to the app to save your recording."),yield this.record())}))}lock(){this.locked=!0,this.emit("lock")}unlock(){this.locked=!1,this.emit("unlock")}apply(e){if(null!=this.stream){if(this.locked)return this.logger.debug("recorder apply locked"),void s.device.setTimeout((()=>{this.apply(e)}),50);this.lock(),this.logger.info("applying recorder options",{options:e})}}get state(){var e,t;return null!==(t=null===(e=this.recorder)||void 0===e?void 0:e.state)&&void 0!==t?t:"inactive"}get recorderOptions(){return{audioBitsPerSecond:this.options.audioBitsPerSecond,videoBitsPerSecond:this.options.videoBitsPerSecond,mimetype:this.options.mimetype,startRecordingWhenClicked:this.options.startRecordingWhenClicked,frameRate:this.options.frameRate,displaySurface:this.options.displaySurface,cursor:this.options.cursor,height:this.options.height}}setupRecorder(){return i.__awaiter(this,void 0,void 0,(function*(){let e;return e=null==this.stream?yield this.createStream():this.stream,this.dataWritten=!1,this.closing=!1,this.saving=!1,null==this.recorder&&(this.recorder=yield this.newMediaRecorder(e,this.recorderOptions)),this.options.startRecordingWhenClicked&&(yield this.record()),{status:"success"}}))}record(){var e,t;return i.__awaiter(this,void 0,void 0,(function*(){return null==this.stream?(this.emitErrorDeprecated(new a.MediaRecorderError("attempting to record without a local stream",{})),{status:"error",message:"No stream provided or created"}):0===this.stream.getTracks().length?(this.emit("stream",null),this.emitErrorDeprecated(new a.MediaRecorderError("attempting to start to record with a local stream that has no tracks",{})),{status:"error",message:"No video tracks from the stream found"}):("inactive"===this.state?null===(e=this.recorder)||void 0===e||e.start(6e4*this.maxRecordingLength):"paused"===this.state&&(null===(t=this.recorder)||void 0===t||t.resume()),{status:"success"})}))}save(){return i.__awaiter(this,void 0,void 0,(function*(){return null==this.recorder?(this.emitErrorDeprecated(new a.MediaRecorderError("attempting to pause recorder with no recorder",{})),{status:"error",message:"No recorder found"}):(this.saving=!0,this.pause(),yield this.recorder.requestData(),{status:"success"})}))}pause(){return null==this.recorder?(this.emitErrorDeprecated(new a.MediaRecorderError("attempting to pause recorder with no recorder",{})),{status:"error",message:"No recorder found"}):(this.recorder.pause(),{status:"success"})}close(){var e;return i.__awaiter(this,void 0,void 0,(function*(){if(null==this.recorder)return this.emitErrorDeprecated(new a.MediaRecorderError("attempting to stop recorder with no recorder",{})),{status:"error",message:"No recorder found"};if("inactive"!==this.recorder.state){this.closing=!0;try{const t=null===(e=this.stream)||void 0===e?void 0:e.getTracks();null==t||t.forEach((e=>{e.stop()})),this.recorder.stop(),this.recorder=null,this.destroyed=!0,this.stream=null,this.localFilePath=null,this.writable=null}catch(e){const t=e instanceof Error?e:null;return this.emitErrorDeprecated(new a.MediaRecorderError("failed to close",{inner:t})),{status:"error",message:"Failed to close"}}}return{status:"success"}}))}createStream(){return i.__awaiter(this,void 0,void 0,(function*(){const e={video:{frameRate:this.options.frameRate,height:this.options.height,resizeMode:"crop-and-scale",cursor:this.options.cursor,displaySurface:this.options.displaySurface,logicalSurface:!0},audio:{autoGainControl:!1,echoCancellation:!1,googAutoGainControl:!1,noiseSuppression:!1}},t=yield this.device.mediaDevices.getDisplayMedia(e),r=yield this.device.mediaDevices.getUserMedia({audio:!0}),i=t.getAudioTracks(),n=t.getVideoTracks(),s=new this.device.AudioContext;let a,o,c;const l=new this.device.MediaStream;let d;return i.length>0?(o=t.getAudioTracks()[0],c=s.createMediaStreamDestination(),d=new this.device.MediaStream([o]),s.createMediaStreamSource(d).connect(c),s.createMediaStreamSource(r).connect(c),l.addTrack(c.stream.getTracks()[0]),l.addTrack(n[0])):(a=r.getAudioTracks(),l.addTrack(a[0]),l.addTrack(n[0])),this.stream=l,l}))}addAudioTrack(e){var t;null===(t=this.stream)||void 0===t||t.addTrack(e)}removeAudioTrack(e){var t;const r=null===(t=this.stream)||void 0===t?void 0:t.getAudioTracks();null==r||r.forEach((t=>{var r;t.id===e.id&&(null===(r=this.stream)||void 0===r||r.removeTrack(t))}))}}t.Recorder=d,d.displayName="Recorder"},2914:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removeSearchParameterFromUrl=t.applyUserInteractionHook=t.contextId=t.instanceId=t.CONTEXT_ID_KEY=t.INSTANCE_ID_KEY=t.PACKAGE_NAME=void 0;const i=r(4280),n=r(5423);t.PACKAGE_NAME="VDC-core",t.INSTANCE_ID_KEY="vdc:instanceId",t.CONTEXT_ID_KEY="vdc:contextId",t.instanceId=function(){return i.device.isImplements(i.Feature.LOCAL_STORAGE)?(null==i.device.localStorage.getItem(t.INSTANCE_ID_KEY)&&i.device.localStorage.setItem(t.INSTANCE_ID_KEY,(0,n.uuidv4)()),i.device.localStorage.getItem(t.INSTANCE_ID_KEY)):null},t.contextId=function(){i.device.globals.has(t.CONTEXT_ID_KEY)||i.device.globals.set(t.CONTEXT_ID_KEY,(0,n.uuidv4)());const e=i.device.globals.get(t.CONTEXT_ID_KEY);return"string"==typeof e?e:null},t.applyUserInteractionHook=function(){i.device.applyUserInteractionHook()},t.removeSearchParameterFromUrl=function(e,t){const r=new RegExp(`([?&])${t}=[^&]*`,"g");return e.replace(r,"")}},7329:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;const n=i(r(1227)),s="awaitqueue";t.Logger=class{constructor(e){e?(this._debug=(0,n.default)(`${s}:${e}`),this._warn=(0,n.default)(`${s}:WARN:${e}`),this._error=(0,n.default)(`${s}:ERROR:${e}`)):(this._debug=(0,n.default)(s),this._warn=(0,n.default)(`${s}:WARN`),this._error=(0,n.default)(`${s}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}},2186:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AwaitQueue=t.AwaitQueueRemovedTaskError=t.AwaitQueueStoppedError=void 0;const i=new(r(7329).Logger);class n extends Error{constructor(e){super(null!=e?e:"AwaitQueue stopped"),this.name="AwaitQueueStoppedError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,n)}}t.AwaitQueueStoppedError=n;class s extends Error{constructor(e){super(null!=e?e:"AwaitQueue task removed"),this.name="AwaitQueueRemovedTaskError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,s)}}t.AwaitQueueRemovedTaskError=s,t.AwaitQueue=class{constructor(){this.pendingTasks=new Map,this.nextTaskId=0,this.stopping=!1}get size(){return this.pendingTasks.size}async push(e,t){if(t=null!=t?t:e.name,i.debug(`push() [name:${t}]`),"function"!=typeof e)throw new TypeError("given task is not a function");if(t)try{Object.defineProperty(e,"name",{value:t})}catch(e){}return new Promise(((r,n)=>{const s={id:this.nextTaskId++,task:e,name:t,enqueuedAt:Date.now(),executedAt:void 0,completed:!1,resolve:e=>{if(s.completed)return;s.completed=!0,this.pendingTasks.delete(s.id),i.debug(`resolving task [name:${s.name}]`),r(e);const[t]=this.pendingTasks.values();t&&!t.executedAt&&this.execute(t)},reject:e=>{if(!s.completed&&(s.completed=!0,this.pendingTasks.delete(s.id),i.debug(`rejecting task [name:${s.name}]: %s`,String(e)),n(e),!this.stopping)){const[e]=this.pendingTasks.values();e&&!e.executedAt&&this.execute(e)}}};this.pendingTasks.set(s.id,s),1===this.pendingTasks.size&&this.execute(s)}))}stop(){i.debug("stop()"),this.stopping=!0;for(const e of this.pendingTasks.values())i.debug(`stop() | stopping task [name:${e.name}]`),e.reject(new n);this.stopping=!1}remove(e){i.debug(`remove() [taskIdx:${e}]`);const t=Array.from(this.pendingTasks.values())[e];t?t.reject(new s):i.debug(`stop() | no task with given idx [taskIdx:${e}]`)}dump(){const e=Date.now();let t=0;return Array.from(this.pendingTasks.values()).map((r=>({idx:t++,task:r.task,name:r.name,enqueuedTime:r.executedAt?r.executedAt-r.enqueuedAt:e-r.enqueuedAt,executionTime:r.executedAt?e-r.executedAt:0})))}async execute(e){if(i.debug(`execute() [name:${e.name}]`),e.executedAt)throw new Error("task already being executed");e.executedAt=Date.now();try{const t=await e.task();e.resolve(t)}catch(t){e.reject(t)}}}},1206:function(e){e.exports=function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=90)}({17:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var i=r(18),n=function(){function e(){}return e.getFirstMatch=function(e,t){var r=t.match(e);return r&&r.length>0&&r[1]||""},e.getSecondMatch=function(e,t){var r=t.match(e);return r&&r.length>1&&r[2]||""},e.matchAndReturnConst=function(e,t,r){if(e.test(t))return r},e.getWindowsVersionName=function(e){switch(e){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},e.getMacOSVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),10===t[0])switch(t[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},e.getAndroidVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),!(1===t[0]&&t[1]<5))return 1===t[0]&&t[1]<6?"Cupcake":1===t[0]&&t[1]>=6?"Donut":2===t[0]&&t[1]<2?"Eclair":2===t[0]&&2===t[1]?"Froyo":2===t[0]&&t[1]>2?"Gingerbread":3===t[0]?"Honeycomb":4===t[0]&&t[1]<1?"Ice Cream Sandwich":4===t[0]&&t[1]<4?"Jelly Bean":4===t[0]&&t[1]>=4?"KitKat":5===t[0]?"Lollipop":6===t[0]?"Marshmallow":7===t[0]?"Nougat":8===t[0]?"Oreo":9===t[0]?"Pie":void 0},e.getVersionPrecision=function(e){return e.split(".").length},e.compareVersions=function(t,r,i){void 0===i&&(i=!1);var n=e.getVersionPrecision(t),s=e.getVersionPrecision(r),a=Math.max(n,s),o=0,c=e.map([t,r],(function(t){var r=a-e.getVersionPrecision(t),i=t+new Array(r+1).join(".0");return e.map(i.split("."),(function(e){return new Array(20-e.length).join("0")+e})).reverse()}));for(i&&(o=a-Math.min(n,s)),a-=1;a>=o;){if(c[0][a]>c[1][a])return 1;if(c[0][a]===c[1][a]){if(a===o)return 0;a-=1}else if(c[0][a]<c[1][a])return-1}},e.map=function(e,t){var r,i=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;r<e.length;r+=1)i.push(t(e[r]));return i},e.find=function(e,t){var r,i;if(Array.prototype.find)return Array.prototype.find.call(e,t);for(r=0,i=e.length;r<i;r+=1){var n=e[r];if(t(n,r))return n}},e.assign=function(e){for(var t,r,i=e,n=arguments.length,s=new Array(n>1?n-1:0),a=1;a<n;a++)s[a-1]=arguments[a];if(Object.assign)return Object.assign.apply(Object,[e].concat(s));var o=function(){var e=s[t];"object"==typeof e&&null!==e&&Object.keys(e).forEach((function(t){i[t]=e[t]}))};for(t=0,r=s.length;t<r;t+=1)o();return e},e.getBrowserAlias=function(e){return i.BROWSER_ALIASES_MAP[e]},e.getBrowserTypeByAlias=function(e){return i.BROWSER_MAP[e]||""},e}();t.default=n,e.exports=t.default},18:function(e,t,r){"use strict";t.__esModule=!0,t.ENGINE_MAP=t.OS_MAP=t.PLATFORMS_MAP=t.BROWSER_MAP=t.BROWSER_ALIASES_MAP=void 0,t.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},t.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},t.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},t.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},t.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var i,n=(i=r(91))&&i.__esModule?i:{default:i},s=r(18);function a(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var o=function(){function e(){}var t,r;return e.getParser=function(e,t){if(void 0===t&&(t=!1),"string"!=typeof e)throw new Error("UserAgent should be a string");return new n.default(e,t)},e.parse=function(e){return new n.default(e).getResult()},t=e,r=[{key:"BROWSER_MAP",get:function(){return s.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return s.ENGINE_MAP}},{key:"OS_MAP",get:function(){return s.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return s.PLATFORMS_MAP}}],null&&a(t.prototype,null),r&&a(t,r),e}();t.default=o,e.exports=t.default},91:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var i=c(r(92)),n=c(r(93)),s=c(r(94)),a=c(r(95)),o=c(r(17));function c(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(e,t){if(void 0===t&&(t=!1),null==e||""===e)throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},!0!==t&&this.parse()}var t=e.prototype;return t.getUA=function(){return this._ua},t.test=function(e){return e.test(this._ua)},t.parseBrowser=function(){var e=this;this.parsedResult.browser={};var t=o.default.find(i.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.browser=t.describe(this.getUA())),this.parsedResult.browser},t.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},t.getBrowserName=function(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},t.getBrowserVersion=function(){return this.getBrowser().version},t.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},t.parseOS=function(){var e=this;this.parsedResult.os={};var t=o.default.find(n.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.os=t.describe(this.getUA())),this.parsedResult.os},t.getOSName=function(e){var t=this.getOS().name;return e?String(t).toLowerCase()||"":t||""},t.getOSVersion=function(){return this.getOS().version},t.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},t.getPlatformType=function(e){void 0===e&&(e=!1);var t=this.getPlatform().type;return e?String(t).toLowerCase()||"":t||""},t.parsePlatform=function(){var e=this;this.parsedResult.platform={};var t=o.default.find(s.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.platform=t.describe(this.getUA())),this.parsedResult.platform},t.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},t.getEngineName=function(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},t.parseEngine=function(){var e=this;this.parsedResult.engine={};var t=o.default.find(a.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.engine=t.describe(this.getUA())),this.parsedResult.engine},t.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},t.getResult=function(){return o.default.assign({},this.parsedResult)},t.satisfies=function(e){var t=this,r={},i=0,n={},s=0;if(Object.keys(e).forEach((function(t){var a=e[t];"string"==typeof a?(n[t]=a,s+=1):"object"==typeof a&&(r[t]=a,i+=1)})),i>0){var a=Object.keys(r),c=o.default.find(a,(function(e){return t.isOS(e)}));if(c){var l=this.satisfies(r[c]);if(void 0!==l)return l}var d=o.default.find(a,(function(e){return t.isPlatform(e)}));if(d){var u=this.satisfies(r[d]);if(void 0!==u)return u}}if(s>0){var h=Object.keys(n),p=o.default.find(h,(function(e){return t.isBrowser(e,!0)}));if(void 0!==p)return this.compareVersion(n[p])}},t.isBrowser=function(e,t){void 0===t&&(t=!1);var r=this.getBrowserName().toLowerCase(),i=e.toLowerCase(),n=o.default.getBrowserTypeByAlias(i);return t&&n&&(i=n.toLowerCase()),i===r},t.compareVersion=function(e){var t=[0],r=e,i=!1,n=this.getBrowserVersion();if("string"==typeof n)return">"===e[0]||"<"===e[0]?(r=e.substr(1),"="===e[1]?(i=!0,r=e.substr(2)):t=[],">"===e[0]?t.push(1):t.push(-1)):"="===e[0]?r=e.substr(1):"~"===e[0]&&(i=!0,r=e.substr(1)),t.indexOf(o.default.compareVersions(n,r,i))>-1},t.isOS=function(e){return this.getOSName(!0)===String(e).toLowerCase()},t.isPlatform=function(e){return this.getPlatformType(!0)===String(e).toLowerCase()},t.isEngine=function(e){return this.getEngineName(!0)===String(e).toLowerCase()},t.is=function(e,t){return void 0===t&&(t=!1),this.isBrowser(e,t)||this.isOS(e)||this.isPlatform(e)},t.some=function(e){var t=this;return void 0===e&&(e=[]),e.some((function(e){return t.is(e)}))},e}();t.default=l,e.exports=t.default},92:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var i,n=(i=r(17))&&i.__esModule?i:{default:i},s=/version\/(\d+(\.?_?\d+)+)/i,a=[{test:[/googlebot/i],describe:function(e){var t={name:"Googlebot"},r=n.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/opera/i],describe:function(e){var t={name:"Opera"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opr\/|opios/i],describe:function(e){var t={name:"Opera"},r=n.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/SamsungBrowser/i],describe:function(e){var t={name:"Samsung Internet for Android"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Whale/i],describe:function(e){var t={name:"NAVER Whale Browser"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MZBrowser/i],describe:function(e){var t={name:"MZ Browser"},r=n.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/focus/i],describe:function(e){var t={name:"Focus"},r=n.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/swing/i],describe:function(e){var t={name:"Swing"},r=n.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/coast/i],describe:function(e){var t={name:"Opera Coast"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(e){var t={name:"Opera Touch"},r=n.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/yabrowser/i],describe:function(e){var t={name:"Yandex Browser"},r=n.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/ucbrowser/i],describe:function(e){var t={name:"UC Browser"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Maxthon|mxios/i],describe:function(e){var t={name:"Maxthon"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/epiphany/i],describe:function(e){var t={name:"Epiphany"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/puffin/i],describe:function(e){var t={name:"Puffin"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sleipnir/i],describe:function(e){var t={name:"Sleipnir"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/k-meleon/i],describe:function(e){var t={name:"K-Meleon"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/micromessenger/i],describe:function(e){var t={name:"WeChat"},r=n.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/qqbrowser/i],describe:function(e){var t={name:/qqbrowserlite/i.test(e)?"QQ Browser Lite":"QQ Browser"},r=n.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/msie|trident/i],describe:function(e){var t={name:"Internet Explorer"},r=n.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/\sedg\//i],describe:function(e){var t={name:"Microsoft Edge"},r=n.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/edg([ea]|ios)/i],describe:function(e){var t={name:"Microsoft Edge"},r=n.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/vivaldi/i],describe:function(e){var t={name:"Vivaldi"},r=n.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/seamonkey/i],describe:function(e){var t={name:"SeaMonkey"},r=n.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sailfish/i],describe:function(e){var t={name:"Sailfish"},r=n.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,e);return r&&(t.version=r),t}},{test:[/silk/i],describe:function(e){var t={name:"Amazon Silk"},r=n.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/phantom/i],describe:function(e){var t={name:"PhantomJS"},r=n.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/slimerjs/i],describe:function(e){var t={name:"SlimerJS"},r=n.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t={name:"BlackBerry"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t={name:"WebOS Browser"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/bada/i],describe:function(e){var t={name:"Bada"},r=n.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/tizen/i],describe:function(e){var t={name:"Tizen"},r=n.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/qupzilla/i],describe:function(e){var t={name:"QupZilla"},r=n.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/firefox|iceweasel|fxios/i],describe:function(e){var t={name:"Firefox"},r=n.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/electron/i],describe:function(e){var t={name:"Electron"},r=n.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MiuiBrowser/i],describe:function(e){var t={name:"Miui"},r=n.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/chromium/i],describe:function(e){var t={name:"Chromium"},r=n.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/chrome|crios|crmo/i],describe:function(e){var t={name:"Chrome"},r=n.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/GSA/i],describe:function(e){var t={name:"Google Search"},r=n.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t={name:"Android Browser"},r=n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/playstation 4/i],describe:function(e){var t={name:"PlayStation 4"},r=n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/safari|applewebkit/i],describe:function(e){var t={name:"Safari"},r=n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/.*/i],describe:function(e){var t=-1!==e.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:n.default.getFirstMatch(t,e),version:n.default.getSecondMatch(t,e)}}}];t.default=a,e.exports=t.default},93:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var i,n=(i=r(17))&&i.__esModule?i:{default:i},s=r(18),a=[{test:[/Roku\/DVP/],describe:function(e){var t=n.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,e);return{name:s.OS_MAP.Roku,version:t}}},{test:[/windows phone/i],describe:function(e){var t=n.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.WindowsPhone,version:t}}},{test:[/windows /i],describe:function(e){var t=n.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,e),r=n.default.getWindowsVersionName(t);return{name:s.OS_MAP.Windows,version:t,versionName:r}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(e){var t={name:s.OS_MAP.iOS},r=n.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,e);return r&&(t.version=r),t}},{test:[/macintosh/i],describe:function(e){var t=n.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,"."),r=n.default.getMacOSVersionName(t),i={name:s.OS_MAP.MacOS,version:t};return r&&(i.versionName=r),i}},{test:[/(ipod|iphone|ipad)/i],describe:function(e){var t=n.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".");return{name:s.OS_MAP.iOS,version:t}}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t=n.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,e),r=n.default.getAndroidVersionName(t),i={name:s.OS_MAP.Android,version:t};return r&&(i.versionName=r),i}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t=n.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,e),r={name:s.OS_MAP.WebOS};return t&&t.length&&(r.version=t),r}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t=n.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,e)||n.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,e)||n.default.getFirstMatch(/\bbb(\d+)/i,e);return{name:s.OS_MAP.BlackBerry,version:t}}},{test:[/bada/i],describe:function(e){var t=n.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.Bada,version:t}}},{test:[/tizen/i],describe:function(e){var t=n.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.Tizen,version:t}}},{test:[/linux/i],describe:function(){return{name:s.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:s.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(e){var t=n.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.PlayStation4,version:t}}}];t.default=a,e.exports=t.default},94:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var i,n=(i=r(17))&&i.__esModule?i:{default:i},s=r(18),a=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(e){var t=n.default.getFirstMatch(/(can-l01)/i,e)&&"Nova",r={type:s.PLATFORMS_MAP.mobile,vendor:"Huawei"};return t&&(r.model=t),r}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet}}},{test:function(e){var t=e.test(/ipod|iphone/i),r=e.test(/like (ipod|iphone)/i);return t&&!r},describe:function(e){var t=n.default.getFirstMatch(/(ipod|iphone)/i,e);return{type:s.PLATFORMS_MAP.mobile,vendor:"Apple",model:t}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"blackberry"===e.getBrowserName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(e){return"bada"===e.getBrowserName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"windows phone"===e.getBrowserName()},describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(e){var t=Number(String(e.getOSVersion()).split(".")[0]);return"android"===e.getOSName(!0)&&t>=3},describe:function(){return{type:s.PLATFORMS_MAP.tablet}}},{test:function(e){return"android"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"macos"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(e){return"windows"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop}}},{test:function(e){return"linux"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop}}},{test:function(e){return"playstation 4"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.tv}}},{test:function(e){return"roku"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.tv}}}];t.default=a,e.exports=t.default},95:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var i,n=(i=r(17))&&i.__esModule?i:{default:i},s=r(18),a=[{test:function(e){return"microsoft edge"===e.getBrowserName(!0)},describe:function(e){if(/\sedg\//i.test(e))return{name:s.ENGINE_MAP.Blink};var t=n.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,e);return{name:s.ENGINE_MAP.EdgeHTML,version:t}}},{test:[/trident/i],describe:function(e){var t={name:s.ENGINE_MAP.Trident},r=n.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){return e.test(/presto/i)},describe:function(e){var t={name:s.ENGINE_MAP.Presto},r=n.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=e.test(/gecko/i),r=e.test(/like gecko/i);return t&&!r},describe:function(e){var t={name:s.ENGINE_MAP.Gecko},r=n.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:s.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(e){var t={name:s.ENGINE_MAP.WebKit},r=n.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}}];t.default=a,e.exports=t.default}})},9435:e=>{var t=1e3,r=60*t,i=60*r,n=24*i;function s(e,t,r,i){var n=t>=1.5*r;return Math.round(e/r)+" "+i+(n?"s":"")}e.exports=function(e,a){a=a||{};var o,c,l=typeof e;if("string"===l&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var s=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(s){var a=parseFloat(s[1]);switch((s[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*a;case"weeks":case"week":case"w":return 6048e5*a;case"days":case"day":case"d":return a*n;case"hours":case"hour":case"hrs":case"hr":case"h":return a*i;case"minutes":case"minute":case"mins":case"min":case"m":return a*r;case"seconds":case"second":case"secs":case"sec":case"s":return a*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}}}(e);if("number"===l&&isFinite(e))return a.long?(o=e,(c=Math.abs(o))>=n?s(o,c,n,"day"):c>=i?s(o,c,i,"hour"):c>=r?s(o,c,r,"minute"):c>=t?s(o,c,t,"second"):o+" ms"):function(e){var s=Math.abs(e);return s>=n?Math.round(e/n)+"d":s>=i?Math.round(e/i)+"h":s>=r?Math.round(e/r)+"m":s>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},1227:(e,t,r)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let i=0,n=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(i++,"%c"===e&&(n=i))})),t.splice(n,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=!1),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=r(2447)(t);const{formatters:i}=e.exports;i.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},2447:(e,t,r)=>{e.exports=function(e){function t(e){let r,n,s,a=null;function o(...e){if(!o.enabled)return;const i=o,n=Number(new Date),s=n-(r||n);i.diff=s,i.prev=r,i.curr=n,r=n,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let a=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((r,n)=>{if("%%"===r)return"%";a++;const s=t.formatters[n];if("function"==typeof s){const t=e[a];r=s.call(i,t),e.splice(a,1),a--}return r})),t.formatArgs.call(i,e),(i.log||t.log).apply(i,e)}return o.namespace=e,o.useColors=t.useColors(),o.color=t.selectColor(e),o.extend=i,o.destroy=t.destroy,Object.defineProperty(o,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==a?a:(n!==t.namespaces&&(n=t.namespaces,s=t.enabled(e)),s),set:e=>{a=e}}),"function"==typeof t.init&&t.init(o),o}function i(e,r){const i=t(this.namespace+(void 0===r?":":r)+e);return i.log=this.log,i}function n(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(n),...t.skips.map(n).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const i=("string"==typeof e?e:"").split(/[\s,]+/),n=i.length;for(r=0;r<n;r++)i[r]&&("-"===(e=i[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let r,i;for(r=0,i=t.skips.length;r<i;r++)if(t.skips[r].test(e))return!1;for(r=0,i=t.names.length;r<i;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(9435),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((r=>{t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}},9996:e=>{"use strict";var t=function(e){return function(e){return!!e&&"object"==typeof e}(e)&&!function(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||function(e){return e.$$typeof===r}(e)}(e)},r="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function i(e,t){return!1!==t.clone&&t.isMergeableObject(e)?o((r=e,Array.isArray(r)?[]:{}),e,t):e;var r}function n(e,t,r){return e.concat(t).map((function(e){return i(e,r)}))}function s(e){return Object.keys(e).concat(function(e){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e).filter((function(t){return Object.propertyIsEnumerable.call(e,t)})):[]}(e))}function a(e,t){try{return t in e}catch(e){return!1}}function o(e,r,c){(c=c||{}).arrayMerge=c.arrayMerge||n,c.isMergeableObject=c.isMergeableObject||t,c.cloneUnlessOtherwiseSpecified=i;var l=Array.isArray(r);return l===Array.isArray(e)?l?c.arrayMerge(e,r,c):function(e,t,r){var n={};return r.isMergeableObject(e)&&s(e).forEach((function(t){n[t]=i(e[t],r)})),s(t).forEach((function(s){(function(e,t){return a(e,t)&&!(Object.hasOwnProperty.call(e,t)&&Object.propertyIsEnumerable.call(e,t))})(e,s)||(a(e,s)&&r.isMergeableObject(t[s])?n[s]=function(e,t){if(!t.customMerge)return o;var r=t.customMerge(e);return"function"==typeof r?r:o}(s,r)(e[s],t[s],r):n[s]=i(t[s],r))})),n}(e,r,c):i(r,c)}o.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce((function(e,r){return o(e,r,t)}),{})};var c=o;e.exports=c},9180:function(e,t,r){var i,n,s;!function(a,o){"use strict";n=[r(9829)],void 0===(s="function"==typeof(i=function(e){var t=/(^|@)\S+:\d+/,r=/^\s*at .*(\S+:\d+|\(native\))/m,i=/^(eval@)?(\[native code])?$/;return{parse:function(e){if(void 0!==e.stacktrace||void 0!==e["opera#sourceloc"])return this.parseOpera(e);if(e.stack&&e.stack.match(r))return this.parseV8OrIE(e);if(e.stack)return this.parseFFOrSafari(e);throw new Error("Cannot parse given Error object")},extractLocation:function(e){if(-1===e.indexOf(":"))return[e];var t=/(.+?)(?::(\d+))?(?::(\d+))?$/.exec(e.replace(/[()]/g,""));return[t[1],t[2]||void 0,t[3]||void 0]},parseV8OrIE:function(t){return t.stack.split("\n").filter((function(e){return!!e.match(r)}),this).map((function(t){t.indexOf("(eval ")>-1&&(t=t.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var r=t.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),i=r.match(/ (\(.+\)$)/);r=i?r.replace(i[0],""):r;var n=this.extractLocation(i?i[1]:r),s=i&&r||void 0,a=["eval","<anonymous>"].indexOf(n[0])>-1?void 0:n[0];return new e({functionName:s,fileName:a,lineNumber:n[1],columnNumber:n[2],source:t})}),this)},parseFFOrSafari:function(t){return t.stack.split("\n").filter((function(e){return!e.match(i)}),this).map((function(t){if(t.indexOf(" > eval")>-1&&(t=t.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),-1===t.indexOf("@")&&-1===t.indexOf(":"))return new e({functionName:t});var r=/((.*".+"[^@]*)?[^@]*)(?:@)/,i=t.match(r),n=i&&i[1]?i[1]:void 0,s=this.extractLocation(t.replace(r,""));return new e({functionName:n,fileName:s[0],lineNumber:s[1],columnNumber:s[2],source:t})}),this)},parseOpera:function(e){return!e.stacktrace||e.message.indexOf("\n")>-1&&e.message.split("\n").length>e.stacktrace.split("\n").length?this.parseOpera9(e):e.stack?this.parseOpera11(e):this.parseOpera10(e)},parseOpera9:function(t){for(var r=/Line (\d+).*script (?:in )?(\S+)/i,i=t.message.split("\n"),n=[],s=2,a=i.length;s<a;s+=2){var o=r.exec(i[s]);o&&n.push(new e({fileName:o[2],lineNumber:o[1],source:i[s]}))}return n},parseOpera10:function(t){for(var r=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,i=t.stacktrace.split("\n"),n=[],s=0,a=i.length;s<a;s+=2){var o=r.exec(i[s]);o&&n.push(new e({functionName:o[3]||void 0,fileName:o[2],lineNumber:o[1],source:i[s]}))}return n},parseOpera11:function(r){return r.stack.split("\n").filter((function(e){return!!e.match(t)&&!e.match(/^Error created at/)}),this).map((function(t){var r,i=t.split("@"),n=this.extractLocation(i.pop()),s=i.shift()||"",a=s.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0;s.match(/\(([^)]*)\)/)&&(r=s.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var o=void 0===r||"[arguments not available]"===r?void 0:r.split(",");return new e({functionName:a,args:o,fileName:n[0],lineNumber:n[1],columnNumber:n[2],source:t})}),this)}}})?i.apply(t,n):i)||(e.exports=s)}()},7187:e=>{"use strict";var t,r="object"==typeof Reflect?Reflect:null,i=r&&"function"==typeof r.apply?r.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};t=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var n=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise((function(r,i){function n(r){e.removeListener(t,s),i(r)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",n),r([].slice.call(arguments))}m(e,t,s,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&m(e,"error",t,{once:!0})}(e,n)}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var a=10;function o(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function l(e,t,r,i){var n,s,a,l;if(o(r),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),s=e._events),a=s[t]),void 0===a)a=s[t]=r,++e._eventsCount;else if("function"==typeof a?a=s[t]=i?[r,a]:[a,r]:i?a.unshift(r):a.push(r),(n=c(e))>0&&a.length>n&&!a.warned){a.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=e,d.type=t,d.count=a.length,l=d,console&&console.warn&&console.warn(l)}return e}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(e,t,r){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},n=d.bind(i);return n.listener=r,i.wrapFn=n,n}function h(e,t,r){var i=e._events;if(void 0===i)return[];var n=i[t];return void 0===n?[]:"function"==typeof n?r?[n.listener||n]:[n]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(n):f(n,n.length)}function p(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function f(e,t){for(var r=new Array(t),i=0;i<t;++i)r[i]=e[i];return r}function m(e,t,r,i){if("function"==typeof e.on)i.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function n(s){i.once&&e.removeEventListener(t,n),r(s)}))}}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||n(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||n(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,s=this._events;if(void 0!==s)n=n&&void 0===s.error;else if(!n)return!1;if(n){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var c=s[e];if(void 0===c)return!1;if("function"==typeof c)i(c,this,t);else{var l=c.length,d=f(c,l);for(r=0;r<l;++r)i(d[r],this,t)}return!0},s.prototype.addListener=function(e,t){return l(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return l(this,e,t,!0)},s.prototype.once=function(e,t){return o(t),this.on(e,u(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return o(t),this.prependListener(e,u(this,e,t)),this},s.prototype.removeListener=function(e,t){var r,i,n,s,a;if(o(t),void 0===(i=this._events))return this;if(void 0===(r=i[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(n=-1,s=r.length-1;s>=0;s--)if(r[s]===t||r[s].listener===t){a=r[s].listener,n=s;break}if(n<0)return this;0===n?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,n),1===r.length&&(i[e]=r[0]),void 0!==i.removeListener&&this.emit("removeListener",e,a||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,r,i;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var n,s=Object.keys(r);for(i=0;i<s.length;++i)"removeListener"!==(n=s[i])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},s.prototype.listeners=function(e){return h(this,e,!0)},s.prototype.rawListeners=function(e){return h(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},s.prototype.listenerCount=p,s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},7855:(e,t,r)=>{const i=r(1227)("h264-profile-level-id");i.log=console.info.bind(console),t.ProfileConstrainedBaseline=1,t.ProfileBaseline=2,t.ProfileMain=3,t.ProfileConstrainedHigh=4,t.ProfileHigh=5;t.Level1_b=0,t.Level1=10,t.Level1_1=11,t.Level1_2=12,t.Level1_3=13,t.Level2=20,t.Level2_1=21,t.Level2_2=22,t.Level3=30,t.Level3_1=31,t.Level3_2=32,t.Level4=40,t.Level4_1=41,t.Level4_2=42,t.Level5=50,t.Level5_1=51,t.Level5_2=52;class n{constructor(e,t){this.profile=e,this.level=t}}t.ProfileLevelId=n;const s=new n(1,31);class a{constructor(e){this._mask=~l("x",e),this._maskedValue=l("1",e)}isMatch(e){return this._maskedValue===(e&this._mask)}}class o{constructor(e,t,r){this.profile_idc=e,this.profile_iop=t,this.profile=r}}const c=[new o(66,new a("x1xx0000"),1),new o(77,new a("1xxx0000"),1),new o(88,new a("11xx0000"),1),new o(66,new a("x0xx0000"),2),new o(88,new a("10xx0000"),2),new o(77,new a("0x0x0000"),3),new o(100,new a("00000000"),5),new o(100,new a("00001100"),4)];function l(e,t){return(t[0]===e)<<7|(t[1]===e)<<6|(t[2]===e)<<5|(t[3]===e)<<4|(t[4]===e)<<3|(t[5]===e)<<2|(t[6]===e)<<1|(t[7]===e)<<0}function d(e={}){const t=e["level-asymmetry-allowed"];return 1===t||"1"===t}t.parseProfileLevelId=function(e){if("string"!=typeof e||6!==e.length)return null;const t=parseInt(e,16);if(0===t)return null;const r=255&t,s=t>>8&255,a=t>>16&255;let o;switch(r){case 11:o=0!=(16&s)?0:11;break;case 10:case 12:case 13:case 20:case 21:case 22:case 30:case 31:case 32:case 40:case 41:case 42:case 50:case 51:case 52:o=r;break;default:return i("parseProfileLevelId() | unrecognized level_idc:%s",r),null}for(const e of c)if(a===e.profile_idc&&e.profile_iop.isMatch(s))return new n(e.profile,o);return i("parseProfileLevelId() | unrecognized profile_idc/profile_iop combination"),null},t.profileLevelIdToString=function(e){if(0==e.level)switch(e.profile){case 1:return"42f00b";case 2:return"42100b";case 3:return"4d100b";default:return i("profileLevelIdToString() | Level 1_b not is allowed for profile:%s",e.profile),null}let t;switch(e.profile){case 1:t="42e0";break;case 2:t="4200";break;case 3:t="4d00";break;case 4:t="640c";break;case 5:t="6400";break;default:return i("profileLevelIdToString() | unrecognized profile:%s",e.profile),null}let r=e.level.toString(16);return 1===r.length&&(r=`0${r}`),`${t}${r}`},t.parseSdpProfileLevelId=function(e={}){const r=e["profile-level-id"];return r?t.parseProfileLevelId(r):s},t.isSameProfile=function(e={},r={}){const i=t.parseSdpProfileLevelId(e),n=t.parseSdpProfileLevelId(r);return Boolean(i&&n&&i.profile===n.profile)},t.generateProfileLevelIdForAnswer=function(e={},r={}){if(!e["profile-level-id"]&&!r["profile-level-id"])return i("generateProfileLevelIdForAnswer() | no profile-level-id in local and remote params"),null;const s=t.parseSdpProfileLevelId(e),a=t.parseSdpProfileLevelId(r);if(!s)throw new TypeError("invalid local_profile_level_id");if(!a)throw new TypeError("invalid remote_profile_level_id");if(s.profile!==a.profile)throw new TypeError("H264 Profile mismatch");const o=d(e)&&d(r),c=s.level,l=function(e,t){return 0===e?10!==t&&0!==t:0===t?10!==e:e<t}(u=c,h=a.level)?u:h;var u,h;const p=o?c:l;return i("generateProfileLevelIdForAnswer() | result: [profile:%s, level:%s]",s.profile,p),t.profileLevelIdToString(new n(s.profile,p))}},7631:e=>{!function t(r){e.exports=function(){"use strict";function e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function i(t){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?e(Object(i),!0).forEach((function(e){a(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,m(i.key),i)}}function s(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(e,t,r){return(t=m(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},o.apply(this,arguments)}function c(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,d(e,t)}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}function d(e,t){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},d(e,t)}function u(e,t,r){return u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct.bind():function(e,t,r){var i=[null];i.push.apply(i,t);var n=new(Function.bind.apply(e,i));return r&&d(n,r.prototype),n},u.apply(null,arguments)}function h(e){var t="function"==typeof Map?new Map:void 0;return h=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return u(e,arguments,l(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),d(i,e)},h(e)}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function f(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return p(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?p(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function m(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function g(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var v={exports:{}};!function(e,t){var r,i,n,s,a;r=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,i=/^(?=([^\/?#]*))\1([^]*)$/,n=/(?:\/|^)\.(?=\/)/g,s=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(e,t,r){if(r=r||{},e=e.trim(),!(t=t.trim())){if(!r.alwaysNormalize)return e;var n=a.parseURL(e);if(!n)throw new Error("Error trying to parse base URL.");return n.path=a.normalizePath(n.path),a.buildURLFromParts(n)}var s=a.parseURL(t);if(!s)throw new Error("Error trying to parse relative URL.");if(s.scheme)return r.alwaysNormalize?(s.path=a.normalizePath(s.path),a.buildURLFromParts(s)):t;var o=a.parseURL(e);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var c=i.exec(o.path);o.netLoc=c[1],o.path=c[2]}o.netLoc&&!o.path&&(o.path="/");var l={scheme:o.scheme,netLoc:s.netLoc,path:null,params:s.params,query:s.query,fragment:s.fragment};if(!s.netLoc&&(l.netLoc=o.netLoc,"/"!==s.path[0]))if(s.path){var d=o.path,u=d.substring(0,d.lastIndexOf("/")+1)+s.path;l.path=a.normalizePath(u)}else l.path=o.path,s.params||(l.params=o.params,s.query||(l.query=o.query));return null===l.path&&(l.path=r.alwaysNormalize?a.normalizePath(s.path):s.path),a.buildURLFromParts(l)},parseURL:function(e){var t=r.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(n,"");e.length!==(e=e.replace(s,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=a}(v);var _=v.exports,y=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},b=function(e){return e.MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.BUFFER_RESET="hlsBufferReset",e.BUFFER_CODECS="hlsBufferCodecs",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_EOS="hlsBufferEos",e.BUFFER_FLUSHING="hlsBufferFlushing",e.BUFFER_FLUSHED="hlsBufferFlushed",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_UPDATED="hlsLevelsUpdated",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.CUES_PARSED="hlsCuesParsed",e.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_LOADING="hlsKeyLoading",e.KEY_LOADED="hlsKeyLoaded",e.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",e.BACK_BUFFER_REACHED="hlsBackBufferReached",e}({}),E=function(e){return e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError",e}({}),S=function(e){return e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",e.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",e.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",e.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_PARSING_ERROR="levelParsingError",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",e.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.FRAG_GAP="fragGap",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.INTERNAL_EXCEPTION="internalException",e.INTERNAL_ABORTED="aborted",e.UNKNOWN="unknown",e}({}),w=function(){},T={trace:w,debug:w,log:w,warn:w,info:w,error:w},R=T;function C(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];r.forEach((function(t){R[t]=e[t]?e[t].bind(e):function(e){var t=self.console[e];return t?t.bind(self.console,"["+e+"] >"):w}(t)}))}function A(e,t){if(self.console&&!0===e||"object"==typeof e){C(e,"debug","log","info","warn","error");try{R.log('Debug logs enabled for "'+t+'" in hls.js version 1.4.5')}catch(e){R=T}}else R=T}var P=R,D=/^(\d+)x(\d+)$/,L=/(.+?)=(".*?"|.*?)(?:,|$)/g,k=function(){function e(t){for(var r in"string"==typeof t&&(t=e.parseAttrList(t)),t)t.hasOwnProperty(r)&&("X-"===r.substring(0,2)&&(this.clientAttrs=this.clientAttrs||[],this.clientAttrs.push(r)),this[r]=t[r])}var t=e.prototype;return t.decimalInteger=function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var r=new Uint8Array(t.length/2),i=0;i<t.length/2;i++)r[i]=parseInt(t.slice(2*i,2*i+2),16);return r}return null},t.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.decimalFloatingPoint=function(e){return parseFloat(this[e])},t.optionalFloat=function(e,t){var r=this[e];return r?parseFloat(r):t},t.enumeratedString=function(e){return this[e]},t.bool=function(e){return"YES"===this[e]},t.decimalResolution=function(e){var t=D.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},e.parseAttrList=function(e){var t,r={};for(L.lastIndex=0;null!==(t=L.exec(e));){var i=t[2];0===i.indexOf('"')&&i.lastIndexOf('"')===i.length-1&&(i=i.slice(1,-1)),r[t[1].trim()]=i}return r},e}();function I(e){return"SCTE35-OUT"===e||"SCTE35-IN"===e}var O=function(){function e(e,t){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,t){var r=t.attr;for(var i in r)if(Object.prototype.hasOwnProperty.call(e,i)&&e[i]!==r[i]){P.warn('DATERANGE tag attribute: "'+i+'" does not match for tags with ID: "'+e.ID+'"'),this._badValueForSameId=i;break}e=o(new k({}),r,e)}if(this.attr=e,this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){var n=new Date(this.attr["END-DATE"]);y(n.getTime())&&(this._endDate=n)}}return s(e,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var e=this.duration;return null!==e?new Date(this._startDate.getTime()+1e3*e):null}},{key:"duration",get:function(){if("DURATION"in this.attr){var e=this.attr.decimalFloatingPoint("DURATION");if(y(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}},{key:"endOnNext",get:function(){return this.attr.bool("END-ON-NEXT")}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&y(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),e}(),M=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}},x="audio",N="video",F="audiovideo",B=function(){function e(e){var t;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((t={})[x]=null,t[N]=null,t[F]=null,t),this.baseurl=e}return e.prototype.setByteRange=function(e,t){var r=e.split("@",2),i=[];1===r.length?i[0]=t?t.byteRangeEndOffset:0:i[0]=parseInt(r[1]),i[1]=parseInt(r[0])+i[0],this._byteRange=i},s(e,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=_.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(e){this._url=e}}]),e}(),j=function(e){function t(t,r){var i;return(i=e.call(this,r)||this)._decryptdata=null,i.rawProgramDateTime=null,i.programDateTime=null,i.tagList=[],i.duration=0,i.sn=0,i.levelkeys=void 0,i.type=void 0,i.loader=null,i.keyLoader=null,i.level=-1,i.cc=0,i.startPTS=void 0,i.endPTS=void 0,i.startDTS=void 0,i.endDTS=void 0,i.start=0,i.deltaPTS=void 0,i.maxStartPTS=void 0,i.minEndPTS=void 0,i.stats=new M,i.urlId=0,i.data=void 0,i.bitrateTest=!1,i.title=null,i.initSegment=null,i.endList=void 0,i.gap=void 0,i.type=t,i}c(t,e);var r=t.prototype;return r.setKeyFormat=function(e){if(this.levelkeys){var t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}},r.abortRequests=function(){var e,t;null==(e=this.loader)||e.abort(),null==(t=this.keyLoader)||t.abort()},r.setElementaryStreamInfo=function(e,t,r,i,n,s){void 0===s&&(s=!1);var a=this.elementaryStreams,o=a[e];o?(o.startPTS=Math.min(o.startPTS,t),o.endPTS=Math.max(o.endPTS,r),o.startDTS=Math.min(o.startDTS,i),o.endDTS=Math.max(o.endDTS,n)):a[e]={startPTS:t,endPTS:r,startDTS:i,endDTS:n,partial:s}},r.clearElementaryStreamInfo=function(){var e=this.elementaryStreams;e[x]=null,e[N]=null,e[F]=null},s(t,[{key:"decryptdata",get:function(){if(!this.levelkeys&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var e=this.levelkeys.identity;if(e)this._decryptdata=e.getDecryptData(this.sn);else{var t=Object.keys(this.levelkeys);if(1===t.length)return this._decryptdata=this.levelkeys[t[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!y(this.programDateTime))return null;var e=y(this.duration)?this.duration:0;return this.programDateTime+1e3*e}},{key:"encrypted",get:function(){var e;if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){var t=Object.keys(this.levelkeys),r=t.length;if(r>1||1===r&&this.levelkeys[t[0]].encrypted)return!0}return!1}}]),t}(B),U=function(e){function t(t,r,i,n,s){var a;(a=e.call(this,i)||this).fragOffset=0,a.duration=0,a.gap=!1,a.independent=!1,a.relurl=void 0,a.fragment=void 0,a.index=void 0,a.stats=new M,a.duration=t.decimalFloatingPoint("DURATION"),a.gap=t.bool("GAP"),a.independent=t.bool("INDEPENDENT"),a.relurl=t.enumeratedString("URI"),a.fragment=r,a.index=n;var o=t.enumeratedString("BYTERANGE");return o&&a.setByteRange(o,s),s&&(a.fragOffset=s.fragOffset+s.duration),a}return c(t,e),s(t,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var e=this.elementaryStreams;return!!(e.audio||e.video||e.audiovideo)}}]),t}(B),V=function(){function e(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}return e.prototype.reloaded=function(e){if(!e)return this.advanced=!0,void(this.updated=!0);var t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t,this.advanced=this.endSN>e.endSN||t>0||0===t&&r>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay},s(e,[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&y(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var e=this.driftEndTime-this.driftStartTime;return e>0?1e3*(this.driftEnd-this.driftStart)/e:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var e;return null!=(e=this.fragments)&&e.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),e}();function G(e){return Uint8Array.from(atob(e),(function(e){return e.charCodeAt(0)}))}function H(e){var t,r,i=e.split(":"),n=null;if("data"===i[0]&&2===i.length){var s=i[1].split(";"),a=s[s.length-1].split(",");if(2===a.length){var o="base64"===a[0],c=a[1];o?(s.splice(-1,1),n=G(c)):(t=K(c).subarray(0,16),(r=new Uint8Array(16)).set(t,16-t.length),n=r)}}return n}function K(e){return Uint8Array.from(unescape(encodeURIComponent(e)),(function(e){return e.charCodeAt(0)}))}var q={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},W="org.w3.clearkey",z="com.apple.streamingkeydelivery",$="com.microsoft.playready",Y="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";function Q(e){switch(e){case z:return q.FAIRPLAY;case $:return q.PLAYREADY;case Y:return q.WIDEVINE;case W:return q.CLEARKEY}}var J="edef8ba979d64acea3c827dcd51d21ed";function X(e){switch(e){case q.FAIRPLAY:return z;case q.PLAYREADY:return $;case q.WIDEVINE:return Y;case q.CLEARKEY:return W}}function Z(e){var t=e.drmSystems,r=e.widevineLicenseUrl,i=t?[q.FAIRPLAY,q.WIDEVINE,q.PLAYREADY,q.CLEARKEY].filter((function(e){return!!t[e]})):[];return!i[q.WIDEVINE]&&r&&i.push(q.WIDEVINE),i}var ee="undefined"!=typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;function te(e,t,r){return Uint8Array.prototype.slice?e.slice(t,r):new Uint8Array(Array.prototype.slice.call(e,t,r))}var re,ie=function(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},ne=function(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},se=function(e,t){for(var r=t,i=0;ie(e,t);)i+=10,i+=ae(e,t+6),ne(e,t+10)&&(i+=10),t+=i;if(i>0)return e.subarray(r,r+i)},ae=function(e,t){var r=0;return r=(127&e[t])<<21,r|=(127&e[t+1])<<14,(r|=(127&e[t+2])<<7)|127&e[t+3]},oe=function(e,t){return ie(e,t)&&ae(e,t+6)+10<=e.length-t},ce=function(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info},le=function(e){var t=String.fromCharCode(e[0],e[1],e[2],e[3]),r=ae(e,4);return{type:t,size:r,data:e.subarray(10,10+r)}},de=function(e){for(var t=0,r=[];ie(e,t);){for(var i=ae(e,t+6),n=(t+=10)+i;t+8<n;){var s=le(e.subarray(t)),a=ue(s);a&&r.push(a),t+=s.size+10}ne(e,t)&&(t+=10)}return r},ue=function(e){return"PRIV"===e.type?he(e):"W"===e.type[0]?fe(e):pe(e)},he=function(e){if(!(e.size<2)){var t=ge(e.data,!0),r=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:r.buffer}}},pe=function(e){if(!(e.size<2)){if("TXXX"===e.type){var t=1,r=ge(e.data.subarray(t),!0);t+=r.length+1;var i=ge(e.data.subarray(t));return{key:e.type,info:r,data:i}}var n=ge(e.data.subarray(1));return{key:e.type,data:n}}},fe=function(e){if("WXXX"===e.type){if(e.size<2)return;var t=1,r=ge(e.data.subarray(t),!0);t+=r.length+1;var i=ge(e.data.subarray(t));return{key:e.type,info:r,data:i}}var n=ge(e.data);return{key:e.type,data:n}},me=function(e){if(8===e.data.byteLength){var t=new Uint8Array(e.data),r=1&t[3],i=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return i/=45,r&&(i+=47721858.84),Math.round(i)}},ge=function(e,t){void 0===t&&(t=!1);var r=ve();if(r){var i=r.decode(e);if(t){var n=i.indexOf("\0");return-1!==n?i.substring(0,n):i}return i.replace(/\0/g,"")}for(var s,a,o,c=e.length,l="",d=0;d<c;){if(0===(s=e[d++])&&t)return l;if(0!==s&&3!==s)switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:l+=String.fromCharCode(s);break;case 12:case 13:a=e[d++],l+=String.fromCharCode((31&s)<<6|63&a);break;case 14:a=e[d++],o=e[d++],l+=String.fromCharCode((15&s)<<12|(63&a)<<6|(63&o)<<0)}}return l};function ve(){return re||void 0===self.TextDecoder||(re=new self.TextDecoder("utf-8")),re}var _e=function(e){for(var t="",r=0;r<e.length;r++){var i=e[r].toString(16);i.length<2&&(i="0"+i),t+=i}return t},ye=Math.pow(2,32)-1,be=[].push,Ee={video:1,audio:2,id3:3,text:4};function Se(e){return String.fromCharCode.apply(null,e)}function we(e,t){var r=e[t]<<8|e[t+1];return r<0?65536+r:r}function Te(e,t){var r=Re(e,t);return r<0?4294967296+r:r}function Re(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function Ce(e,t,r){e[t]=r>>24,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r}function Ae(e,t){var r=[];if(!t.length)return r;for(var i=e.byteLength,n=0;n<i;){var s=Te(e,n),a=s>1?n+s:i;if(Se(e.subarray(n+4,n+8))===t[0])if(1===t.length)r.push(e.subarray(n+8,a));else{var o=Ae(e.subarray(n+8,a),t.slice(1));o.length&&be.apply(r,o)}n=a}return r}function Pe(e){var t=[],r=e[0],i=8,n=Te(e,i);i+=4;i+=0===r?8:16,i+=2;var s=e.length+0,a=we(e,i);i+=2;for(var o=0;o<a;o++){var c=i,l=Te(e,c);c+=4;var d=2147483647&l;if(1==(2147483648&l)>>>31)return P.warn("SIDX has hierarchical references (not supported)"),null;var u=Te(e,c);c+=4,t.push({referenceSize:d,subsegmentDuration:u,info:{duration:u/n,start:s,end:s+d-1}}),s+=d,i=c+=4}return{earliestPresentationTime:0,timescale:n,version:r,referencesCount:a,references:t}}function De(e){for(var t=[],r=Ae(e,["moov","trak"]),i=0;i<r.length;i++){var n=r[i],s=Ae(n,["tkhd"])[0];if(s){var a=s[0],o=0===a?12:20,c=Te(s,o),l=Ae(n,["mdia","mdhd"])[0];if(l){var d=Te(l,o=0===(a=l[0])?12:20),u=Ae(n,["mdia","hdlr"])[0];if(u){var h=Se(u.subarray(8,12)),p={soun:x,vide:N}[h];if(p){var f=Ae(n,["mdia","minf","stbl","stsd"])[0],m=void 0;f&&(m=Se(f.subarray(12,16))),t[c]={timescale:d,type:p},t[p]={timescale:d,id:c,codec:m}}}}}}return Ae(e,["moov","mvex","trex"]).forEach((function(e){var r=Te(e,4),i=t[r];i&&(i.default={duration:Te(e,12),flags:Te(e,20)})})),t}function Le(e){var t=Ae(e,["schm"])[0];if(t){var r=Se(t.subarray(4,8));if("cbcs"===r||"cenc"===r)return Ae(e,["schi","tenc"])[0]}return P.error("[eme] missing 'schm' box"),null}function ke(e){var t=Te(e,0),r=8;1&t&&(r+=4),4&t&&(r+=4);for(var i=0,n=Te(e,4),s=0;s<n;s++)256&t&&(i+=Te(e,r),r+=4),512&t&&(r+=4),1024&t&&(r+=4),2048&t&&(r+=4);return i}function Ie(e,t){var r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}function Oe(e,t){var r=[],i=t.samples,n=t.timescale,s=t.id,a=!1;return Ae(i,["moof"]).map((function(o){var c=o.byteOffset-8;Ae(o,["traf"]).map((function(o){var l=Ae(o,["tfdt"]).map((function(e){var t=e[0],r=Te(e,4);return 1===t&&(r*=Math.pow(2,32),r+=Te(e,8)),r/n}))[0];return void 0!==l&&(e=l),Ae(o,["tfhd"]).map((function(l){var d=Te(l,4),u=16777215&Te(l,0),h=0,p=0!=(16&u),f=0,m=0!=(32&u),g=8;d===s&&(0!=(1&u)&&(g+=8),0!=(2&u)&&(g+=4),0!=(8&u)&&(h=Te(l,g),g+=4),p&&(f=Te(l,g),g+=4),m&&(g+=4),"video"===t.type&&(a=function(e){if(!e)return!1;var t=e.indexOf("."),r=t<0?e:e.substring(0,t);return"hvc1"===r||"hev1"===r||"dvh1"===r||"dvhe"===r}(t.codec)),Ae(o,["trun"]).map((function(s){var o=s[0],l=16777215&Te(s,0),d=0!=(1&l),u=0,p=0!=(4&l),m=0!=(256&l),g=0,v=0!=(512&l),_=0,y=0!=(1024&l),b=0!=(2048&l),E=0,S=Te(s,4),w=8;d&&(u=Te(s,w),w+=4),p&&(w+=4);for(var T=u+c,R=0;R<S;R++){if(m?(g=Te(s,w),w+=4):g=h,v?(_=Te(s,w),w+=4):_=f,y&&(w+=4),b&&(E=0===o?Te(s,w):Re(s,w),w+=4),t.type===N)for(var C=0;C<_;){var A=Te(i,T);Me(a,i[T+=4])&&xe(i.subarray(T,T+A),a?2:1,e+E/n,r),T+=A,C+=A+4}e+=g/n}})))}))}))})),r}function Me(e,t){if(e){var r=t>>1&63;return 39===r||40===r}return 6==(31&t)}function xe(e,t,r,i){var n=Ne(e),s=0;s+=t;for(var a=0,o=0,c=!1,l=0;s<n.length;){a=0;do{if(s>=n.length)break;a+=l=n[s++]}while(255===l);o=0;do{if(s>=n.length)break;o+=l=n[s++]}while(255===l);var d=n.length-s;if(!c&&4===a&&s<n.length){if(c=!0,181===n[s++]){var u=we(n,s);if(s+=2,49===u){var h=Te(n,s);if(s+=4,1195456820===h){var p=n[s++];if(3===p){var f=n[s++],m=64&f,g=m?2+3*(31&f):0,v=new Uint8Array(g);if(m){v[0]=f;for(var _=1;_<g;_++)v[_]=n[s++]}i.push({type:p,payloadType:a,pts:r,bytes:v})}}}}}else if(5===a&&o<d){if(c=!0,o>16){for(var y=[],b=0;b<16;b++){var E=n[s++].toString(16);y.push(1==E.length?"0"+E:E),3!==b&&5!==b&&7!==b&&9!==b||y.push("-")}for(var S=o-16,w=new Uint8Array(S),T=0;T<S;T++)w[T]=n[s++];i.push({payloadType:a,pts:r,uuid:y.join(""),userData:ge(w),userDataBytes:w})}}else if(o<d)s+=o;else if(o>d)break}}function Ne(e){for(var t=e.byteLength,r=[],i=1;i<t-2;)0===e[i]&&0===e[i+1]&&3===e[i+2]?(r.push(i+2),i+=2):i++;if(0===r.length)return e;var n=t-r.length,s=new Uint8Array(n),a=0;for(i=0;i<n;a++,i++)a===r[0]&&(a++,r.shift()),s[i]=e[a];return s}function Fe(e,t,r){if(16!==e.byteLength)throw new RangeError("Invalid system id");var i,n,s;if(t){i=1,n=new Uint8Array(16*t.length);for(var a=0;a<t.length;a++){var o=t[a];if(16!==o.byteLength)throw new RangeError("Invalid key");n.set(o,16*a)}}else i=0,n=new Uint8Array;i>0?(s=new Uint8Array(4),t.length>0&&new DataView(s.buffer).setUint32(0,t.length,!1)):s=new Uint8Array;var c=new Uint8Array(4);return r&&r.byteLength>0&&new DataView(c.buffer).setUint32(0,r.byteLength,!1),function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];for(var n=r.length,s=8,a=n;a--;)s+=r[a].byteLength;var o=new Uint8Array(s);for(o[0]=s>>24&255,o[1]=s>>16&255,o[2]=s>>8&255,o[3]=255&s,o.set(e,4),a=0,s=8;a<n;a++)o.set(r[a],s),s+=r[a].byteLength;return o}([112,115,115,104],new Uint8Array([i,0,0,0]),e,s,n,c,r||new Uint8Array)}var Be={},je=function(){function e(e,t,r,i,n){void 0===i&&(i=[1]),void 0===n&&(n=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=i,this.iv=n,this.encrypted=!!e&&"NONE"!==e,this.isCommonEncryption=this.encrypted&&"AES-128"!==e}e.clearKeyUriToKeyIdMap=function(){Be={}};var t=e.prototype;return t.isSupported=function(){if(this.method){if("AES-128"===this.method||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case z:case Y:case $:case W:return-1!==["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1},t.getDecryptData=function(t){if(!this.encrypted||!this.uri)return null;if("AES-128"===this.method&&this.uri&&!this.iv){"number"!=typeof t&&("AES-128"!==this.method||this.iv||P.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),t=0);var r=function(e){for(var t=new Uint8Array(16),r=12;r<16;r++)t[r]=e>>8*(15-r)&255;return t}(t);return new e(this.method,this.uri,"identity",this.keyFormatVersions,r)}var i=H(this.uri);if(i)switch(this.keyFormat){case Y:this.pssh=i,i.length>=22&&(this.keyId=i.subarray(i.length-22,i.length-6));break;case $:var n=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=Fe(n,null,i);var s=new Uint16Array(i.buffer,i.byteOffset,i.byteLength/2),a=String.fromCharCode.apply(null,Array.from(s)),o=a.substring(a.indexOf("<"),a.length),c=(new DOMParser).parseFromString(o,"text/xml").getElementsByTagName("KID")[0];if(c){var l=c.childNodes[0]?c.childNodes[0].nodeValue:c.getAttribute("VALUE");if(l){var d=G(l).subarray(0,16);(function(e){var t=function(e,t,r){var i=e[t];e[t]=e[r],e[r]=i};t(e,0,3),t(e,1,2),t(e,4,5),t(e,6,7)})(d),this.keyId=d}}break;default:var u=i.subarray(0,16);if(16!==u.length){var h=new Uint8Array(16);h.set(u,16-u.length),u=h}this.keyId=u}if(!this.keyId||16!==this.keyId.byteLength){var p=Be[this.uri];if(!p){var f=Object.keys(Be).length%Number.MAX_SAFE_INTEGER;p=new Uint8Array(16),new DataView(p.buffer,12,4).setUint32(0,f),Be[this.uri]=p}this.keyId=p}return this},e}();var Ue=/\{\$([a-zA-Z0-9-_]+)\}/g;function Ve(e){return Ue.test(e)}function Ge(e,t,r){if(null!==e.variableList||e.hasVariableRefs)for(var i=r.length;i--;){var n=r[i],s=t[n];s&&(t[n]=He(e,s))}}function He(e,t){if(null!==e.variableList||e.hasVariableRefs){var r=e.variableList;return t.replace(Ue,(function(t){var i=t.substring(2,t.length-1),n=null==r?void 0:r[i];return void 0===n?(e.playlistParsingError||(e.playlistParsingError=new Error('Missing preceding EXT-X-DEFINE tag for Variable Reference: "'+i+'"')),t):n}))}return t}function Ke(e,t,r){var i,n,s=e.variableList;if(s||(e.variableList=s={}),"QUERYPARAM"in t){i=t.QUERYPARAM;try{var a=new self.URL(r).searchParams;if(!a.has(i))throw new Error('"'+i+'" does not match any query parameter in URI: "'+r+'"');n=a.get(i)}catch(t){e.playlistParsingError||(e.playlistParsingError=new Error("EXT-X-DEFINE QUERYPARAM: "+t.message))}}else i=t.NAME,n=t.VALUE;i in s?e.playlistParsingError||(e.playlistParsingError=new Error('EXT-X-DEFINE duplicate Variable Name declarations: "'+i+'"')):s[i]=n||""}function qe(e,t,r){var i=t.IMPORT;if(r&&i in r){var n=e.variableList;n||(e.variableList=n={}),n[i]=r[i]}else e.playlistParsingError||(e.playlistParsingError=new Error('EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "'+i+'"'))}function We(){if("undefined"!=typeof self)return self.MediaSource||self.WebKitMediaSource}var ze={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}},$e=We();function Ye(e,t){var r;return null!=(r=null==$e?void 0:$e.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"'))&&r}var Qe=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Je=/#EXT-X-MEDIA:(.*)/g,Xe=/^#EXT(?:INF|-X-TARGETDURATION):/m,Ze=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),et=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),tt=function(){function e(){}return e.findGroup=function(e,t){for(var r=0;r<e.length;r++){var i=e[r];if(i.id===t)return i}},e.convertAVC1ToAVCOTI=function(e){var t=e.split(".");if(t.length>2){var r=t.shift()+".";return(r+=parseInt(t.shift()).toString(16))+("000"+parseInt(t.shift()).toString(16)).slice(-4)}return e},e.resolve=function(e,t){return _.buildAbsoluteURL(t,e,{alwaysNormalize:!0})},e.isMediaPlaylist=function(e){return Xe.test(e)},e.parseMasterPlaylist=function(t,r){var i,n={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:Ve(t)},s=[];for(Qe.lastIndex=0;null!=(i=Qe.exec(t));)if(i[1]){var a,o=new k(i[1]);Ge(n,o,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);var c=He(n,i[2]),l={attrs:o,bitrate:o.decimalInteger("AVERAGE-BANDWIDTH")||o.decimalInteger("BANDWIDTH"),name:o.NAME,url:e.resolve(c,r)},d=o.decimalResolution("RESOLUTION");d&&(l.width=d.width,l.height=d.height),nt((o.CODECS||"").split(/[ ,]+/).filter((function(e){return e})),l),l.videoCodec&&-1!==l.videoCodec.indexOf("avc1")&&(l.videoCodec=e.convertAVC1ToAVCOTI(l.videoCodec)),null!=(a=l.unknownCodecs)&&a.length||s.push(l),n.levels.push(l)}else if(i[3]){var u=i[3],h=i[4];switch(u){case"SESSION-DATA":var p=new k(h);Ge(n,p,["DATA-ID","LANGUAGE","VALUE","URI"]);var f=p["DATA-ID"];f&&(null===n.sessionData&&(n.sessionData={}),n.sessionData[f]=p);break;case"SESSION-KEY":var m=rt(h,r,n);m.encrypted&&m.isSupported()?(null===n.sessionKeys&&(n.sessionKeys=[]),n.sessionKeys.push(m)):P.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+h+'"');break;case"DEFINE":var g=new k(h);Ge(n,g,["NAME","VALUE","QUERYPARAM"]),Ke(n,g,r);break;case"CONTENT-STEERING":var v=new k(h);Ge(n,v,["SERVER-URI","PATHWAY-ID"]),n.contentSteering={uri:e.resolve(v["SERVER-URI"],r),pathwayId:v["PATHWAY-ID"]||"."};break;case"START":n.startTimeOffset=it(h)}}var _=s.length>0&&s.length<n.levels.length;return n.levels=_?s:n.levels,0===n.levels.length&&(n.playlistParsingError=new Error("no levels found in manifest")),n},e.parseMasterPlaylistMedia=function(t,r,i){var n,s={},a=i.levels,o={AUDIO:a.map((function(e){return{id:e.attrs.AUDIO,audioCodec:e.audioCodec}})),SUBTITLES:a.map((function(e){return{id:e.attrs.SUBTITLES,textCodec:e.textCodec}})),"CLOSED-CAPTIONS":[]},c=0;for(Je.lastIndex=0;null!==(n=Je.exec(t));){var l=new k(n[1]),d=l.TYPE;if(d){var u=o[d],h=s[d]||[];s[d]=h,Ge(i,l,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);var p={attrs:l,bitrate:0,id:c++,groupId:l["GROUP-ID"]||"",instreamId:l["INSTREAM-ID"],name:l.NAME||l.LANGUAGE||"",type:d,default:l.bool("DEFAULT"),autoselect:l.bool("AUTOSELECT"),forced:l.bool("FORCED"),lang:l.LANGUAGE,url:l.URI?e.resolve(l.URI,r):""};if(null!=u&&u.length){var f=e.findGroup(u,p.groupId)||u[0];st(p,f,"audioCodec"),st(p,f,"textCodec")}h.push(p)}}return s},e.parseLevelPlaylist=function(e,t,r,i,n,s){var a,c,l,d=new V(t),u=d.fragments,h=null,p=0,f=0,m=0,g=0,v=null,_=new j(i,t),b=-1,E=!1;for(Ze.lastIndex=0,d.m3u8=e,d.hasVariableRefs=Ve(e);null!==(a=Ze.exec(e));){E&&(E=!1,(_=new j(i,t)).start=m,_.sn=p,_.cc=g,_.level=r,h&&(_.initSegment=h,_.rawProgramDateTime=h.rawProgramDateTime,h.rawProgramDateTime=null));var S=a[1];if(S){_.duration=parseFloat(S);var w=(" "+a[2]).slice(1);_.title=w||null,_.tagList.push(w?["INF",S,w]:["INF",S])}else if(a[3]){if(y(_.duration)){_.start=m,l&&ct(_,l,d),_.sn=p,_.level=r,_.cc=g,_.urlId=n,u.push(_);var T=(" "+a[3]).slice(1);_.relurl=He(d,T),at(_,v),v=_,m+=_.duration,p++,f=0,E=!0}}else if(a[4]){var R=(" "+a[4]).slice(1);v?_.setByteRange(R,v):_.setByteRange(R)}else if(a[5])_.rawProgramDateTime=(" "+a[5]).slice(1),_.tagList.push(["PROGRAM-DATE-TIME",_.rawProgramDateTime]),-1===b&&(b=u.length);else{if(!(a=a[0].match(et))){P.warn("No matches on slow regex match for level playlist!");continue}for(c=1;c<a.length&&void 0===a[c];c++);var C=(" "+a[c]).slice(1),A=(" "+a[c+1]).slice(1),D=a[c+2]?(" "+a[c+2]).slice(1):"";switch(C){case"PLAYLIST-TYPE":d.type=A.toUpperCase();break;case"MEDIA-SEQUENCE":p=d.startSN=parseInt(A);break;case"SKIP":var L=new k(A);Ge(d,L,["RECENTLY-REMOVED-DATERANGES"]);var I=L.decimalInteger("SKIPPED-SEGMENTS");if(y(I)){d.skippedSegments=I;for(var M=I;M--;)u.unshift(null);p+=I}var x=L.enumeratedString("RECENTLY-REMOVED-DATERANGES");x&&(d.recentlyRemovedDateranges=x.split("\t"));break;case"TARGETDURATION":d.targetduration=Math.max(parseInt(A),1);break;case"VERSION":d.version=parseInt(A);break;case"EXTM3U":break;case"ENDLIST":d.live=!1;break;case"#":(A||D)&&_.tagList.push(D?[A,D]:[A]);break;case"DISCONTINUITY":g++,_.tagList.push(["DIS"]);break;case"GAP":_.gap=!0,_.tagList.push([C]);break;case"BITRATE":_.tagList.push([C,A]);break;case"DATERANGE":var N=new k(A);Ge(d,N,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),Ge(d,N,N.clientAttrs);var F=new O(N,d.dateRanges[N.ID]);F.isValid||d.skippedSegments?d.dateRanges[F.id]=F:P.warn('Ignoring invalid DATERANGE tag: "'+A+'"'),_.tagList.push(["EXT-X-DATERANGE",A]);break;case"DEFINE":var B=new k(A);Ge(d,B,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in B?qe(d,B,s):Ke(d,B,t);break;case"DISCONTINUITY-SEQUENCE":g=parseInt(A);break;case"KEY":var G=rt(A,t,d);if(G.isSupported()){if("NONE"===G.method){l=void 0;break}l||(l={}),l[G.keyFormat]&&(l=o({},l)),l[G.keyFormat]=G}else P.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'+A+'"');break;case"START":d.startTimeOffset=it(A);break;case"MAP":var H=new k(A);if(Ge(d,H,["BYTERANGE","URI"]),_.duration){var K=new j(i,t);ot(K,H,r,l),h=K,_.initSegment=h,h.rawProgramDateTime&&!_.rawProgramDateTime&&(_.rawProgramDateTime=h.rawProgramDateTime)}else ot(_,H,r,l),h=_,E=!0;break;case"SERVER-CONTROL":var q=new k(A);d.canBlockReload=q.bool("CAN-BLOCK-RELOAD"),d.canSkipUntil=q.optionalFloat("CAN-SKIP-UNTIL",0),d.canSkipDateRanges=d.canSkipUntil>0&&q.bool("CAN-SKIP-DATERANGES"),d.partHoldBack=q.optionalFloat("PART-HOLD-BACK",0),d.holdBack=q.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var W=new k(A);d.partTarget=W.decimalFloatingPoint("PART-TARGET");break;case"PART":var z=d.partList;z||(z=d.partList=[]);var $=f>0?z[z.length-1]:void 0,Y=f++,Q=new k(A);Ge(d,Q,["BYTERANGE","URI"]);var J=new U(Q,_,t,Y,$);z.push(J),_.duration+=J.duration;break;case"PRELOAD-HINT":var X=new k(A);Ge(d,X,["URI"]),d.preloadHint=X;break;case"RENDITION-REPORT":var Z=new k(A);Ge(d,Z,["URI"]),d.renditionReports=d.renditionReports||[],d.renditionReports.push(Z);break;default:P.warn("line parsed but not handled: "+a)}}}v&&!v.relurl?(u.pop(),m-=v.duration,d.partList&&(d.fragmentHint=v)):d.partList&&(at(_,v),_.cc=g,d.fragmentHint=_,l&&ct(_,l,d));var ee=u.length,te=u[0],re=u[ee-1];if((m+=d.skippedSegments*d.targetduration)>0&&ee&&re){d.averagetargetduration=m/ee;var ie=re.sn;d.endSN="initSegment"!==ie?ie:0,d.live||(re.endList=!0),te&&(d.startCC=te.cc)}else d.endSN=0,d.startCC=0;return d.fragmentHint&&(m+=d.fragmentHint.duration),d.totalduration=m,d.endCC=g,b>0&&function(e,t){for(var r=e[t],i=t;i--;){var n=e[i];if(!n)return;n.programDateTime=r.programDateTime-1e3*n.duration,r=n}}(u,b),d},e}();function rt(e,t,r){var i,n,s=new k(e);Ge(r,s,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);var a=null!=(i=s.METHOD)?i:"",o=s.URI,c=s.hexadecimalInteger("IV"),l=s.KEYFORMATVERSIONS,d=null!=(n=s.KEYFORMAT)?n:"identity";o&&s.IV&&!c&&P.error("Invalid IV: "+s.IV);var u=o?tt.resolve(o,t):"",h=(l||"1").split("/").map(Number).filter(Number.isFinite);return new je(a,u,d,h,c)}function it(e){var t=new k(e).decimalFloatingPoint("TIME-OFFSET");return y(t)?t:null}function nt(e,t){["video","audio","text"].forEach((function(r){var i=e.filter((function(e){return function(e,t){var r=ze[t];return!!r&&!0===r[e.slice(0,4)]}(e,r)}));if(i.length){var n=i.filter((function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)}));t[r+"Codec"]=n.length>0?n[0]:i[0],e=e.filter((function(e){return-1===i.indexOf(e)}))}})),t.unknownCodecs=e}function st(e,t,r){var i=t[r];i&&(e[r]=i)}function at(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),y(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}function ot(e,t,r,i){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=r,e.sn="initSegment",i&&(e.levelkeys=i),e.initSegment=null}function ct(e,t,r){e.levelkeys=t;var i=r.encryptedFragments;i.length&&i[i.length-1].levelkeys===t||!Object.keys(t).some((function(e){return t[e].isCommonEncryption}))||i.push(e)}var lt="manifest",dt="level",ut="audioTrack",ht="subtitleTrack",pt="main",ft="audio",mt="subtitle";function gt(e){switch(e.type){case ut:return ft;case ht:return mt;default:return pt}}function vt(e,t){var r=e.url;return void 0!==r&&0!==r.indexOf("data:")||(r=t.url),r}var _t=function(){function e(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}var t=e.prototype;return t.startLoad=function(e){},t.stopLoad=function(){this.destroyInternalLoaders()},t.registerListeners=function(){var e=this.hls;e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.LEVEL_LOADING,this.onLevelLoading,this),e.on(b.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(b.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},t.unregisterListeners=function(){var e=this.hls;e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.LEVEL_LOADING,this.onLevelLoading,this),e.off(b.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(b.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},t.createInternalLoader=function(e){var t=this.hls.config,r=t.pLoader,i=t.loader,n=new(r||i)(t);return this.loaders[e.type]=n,n},t.getInternalLoader=function(e){return this.loaders[e.type]},t.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},t.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},t.destroy=function(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()},t.onManifestLoading=function(e,t){var r=t.url;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:lt,url:r,deliveryDirectives:null})},t.onLevelLoading=function(e,t){var r=t.id,i=t.level,n=t.url,s=t.deliveryDirectives;this.load({id:r,level:i,responseType:"text",type:dt,url:n,deliveryDirectives:s})},t.onAudioTrackLoading=function(e,t){var r=t.id,i=t.groupId,n=t.url,s=t.deliveryDirectives;this.load({id:r,groupId:i,level:null,responseType:"text",type:ut,url:n,deliveryDirectives:s})},t.onSubtitleTrackLoading=function(e,t){var r=t.id,i=t.groupId,n=t.url,s=t.deliveryDirectives;this.load({id:r,groupId:i,level:null,responseType:"text",type:ht,url:n,deliveryDirectives:s})},t.load=function(e){var t,r,i,n=this,s=this.hls.config,a=this.getInternalLoader(e);if(a){var c=a.context;if(c&&c.url===e.url)return void P.trace("[playlist-loader]: playlist request ongoing");P.log("[playlist-loader]: aborting previous loader for type: "+e.type),a.abort()}if(r=e.type===lt?s.manifestLoadPolicy.default:o({},s.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),a=this.createInternalLoader(e),null!=(t=e.deliveryDirectives)&&t.part&&(e.type===dt&&null!==e.level?i=this.hls.levels[e.level].details:e.type===ut&&null!==e.id?i=this.hls.audioTracks[e.id].details:e.type===ht&&null!==e.id&&(i=this.hls.subtitleTracks[e.id].details),i)){var l=i.partTarget,d=i.targetduration;if(l&&d){var u=1e3*Math.max(3*l,.8*d);r=o({},r,{maxTimeToFirstByteMs:Math.min(u,r.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(u,r.maxTimeToFirstByteMs)})}}var h=r.errorRetry||r.timeoutRetry||{},p={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:h.maxNumRetry||0,retryDelay:h.retryDelayMs||0,maxRetryDelay:h.maxRetryDelayMs||0},f={onSuccess:function(e,t,r,i){var s=n.getInternalLoader(r);n.resetInternalLoader(r.type);var a=e.data;0===a.indexOf("#EXTM3U")?(t.parsing.start=performance.now(),tt.isMediaPlaylist(a)?n.handleTrackOrLevelPlaylist(e,t,r,i||null,s):n.handleMasterPlaylist(e,t,r,i)):n.handleManifestParsingError(e,r,new Error("no EXTM3U delimiter"),i||null,t)},onError:function(e,t,r,i){n.handleNetworkError(t,r,!1,e,i)},onTimeout:function(e,t,r){n.handleNetworkError(t,r,!0,void 0,e)}};a.load(e,p,f)},t.handleMasterPlaylist=function(e,t,r,i){var n=this.hls,s=e.data,a=vt(e,r),o=tt.parseMasterPlaylist(s,a);if(o.playlistParsingError)this.handleManifestParsingError(e,r,o.playlistParsingError,i,t);else{var c=o.contentSteering,l=o.levels,d=o.sessionData,u=o.sessionKeys,h=o.startTimeOffset,p=o.variableList;this.variableList=p;var f=tt.parseMasterPlaylistMedia(s,a,o),m=f.AUDIO,g=void 0===m?[]:m,v=f.SUBTITLES,_=f["CLOSED-CAPTIONS"];g.length&&(g.some((function(e){return!e.url}))||!l[0].audioCodec||l[0].attrs.AUDIO||(P.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),g.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new k({}),bitrate:0,url:""}))),n.trigger(b.MANIFEST_LOADED,{levels:l,audioTracks:g,subtitles:v,captions:_,contentSteering:c,url:a,stats:t,networkDetails:i,sessionData:d,sessionKeys:u,startTimeOffset:h,variableList:p})}},t.handleTrackOrLevelPlaylist=function(e,t,r,i,n){var s=this.hls,a=r.id,o=r.level,c=r.type,l=vt(e,r),d=y(a)?a:0,u=y(o)?o:d,h=gt(r),p=tt.parseLevelPlaylist(e.data,l,u,h,d,this.variableList);if(c===lt){var f={attrs:new k({}),bitrate:0,details:p,name:"",url:l};s.trigger(b.MANIFEST_LOADED,{levels:[f],audioTracks:[],url:l,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=p,this.handlePlaylistLoaded(p,e,t,r,i,n)},t.handleManifestParsingError=function(e,t,r,i,n){this.hls.trigger(b.ERROR,{type:E.NETWORK_ERROR,details:S.MANIFEST_PARSING_ERROR,fatal:t.type===lt,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:i,stats:n})},t.handleNetworkError=function(e,t,r,n,s){void 0===r&&(r=!1);var a="A network "+(r?"timeout":"error"+(n?" (status "+n.code+")":""))+" occurred while loading "+e.type;e.type===dt?a+=": "+e.level+" id: "+e.id:e.type!==ut&&e.type!==ht||(a+=" id: "+e.id+' group-id: "'+e.groupId+'"');var o=new Error(a);P.warn("[playlist-loader]: "+a);var c=S.UNKNOWN,l=!1,d=this.getInternalLoader(e);switch(e.type){case lt:c=r?S.MANIFEST_LOAD_TIMEOUT:S.MANIFEST_LOAD_ERROR,l=!0;break;case dt:c=r?S.LEVEL_LOAD_TIMEOUT:S.LEVEL_LOAD_ERROR,l=!1;break;case ut:c=r?S.AUDIO_TRACK_LOAD_TIMEOUT:S.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case ht:c=r?S.SUBTITLE_TRACK_LOAD_TIMEOUT:S.SUBTITLE_LOAD_ERROR,l=!1}d&&this.resetInternalLoader(e.type);var u={type:E.NETWORK_ERROR,details:c,fatal:l,url:e.url,loader:d,context:e,error:o,networkDetails:t,stats:s};if(n){var h=(null==t?void 0:t.url)||e.url;u.response=i({url:h,data:void 0},n)}this.hls.trigger(b.ERROR,u)},t.handlePlaylistLoaded=function(e,t,r,i,n,s){var a=this.hls,o=i.type,c=i.level,l=i.id,d=i.groupId,u=i.deliveryDirectives,h=vt(t,i),p=gt(i),f="number"==typeof i.level&&p===pt?c:void 0;if(e.fragments.length){e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));var m=e.playlistParsingError;if(m)a.trigger(b.ERROR,{type:E.NETWORK_ERROR,details:S.LEVEL_PARSING_ERROR,fatal:!1,url:h,error:m,reason:m.message,response:t,context:i,level:f,parent:p,networkDetails:n,stats:r});else switch(e.live&&s&&(s.getCacheAge&&(e.ageHeader=s.getCacheAge()||0),s.getCacheAge&&!isNaN(e.ageHeader)||(e.ageHeader=0)),o){case lt:case dt:a.trigger(b.LEVEL_LOADED,{details:e,level:f||0,id:l||0,stats:r,networkDetails:n,deliveryDirectives:u});break;case ut:a.trigger(b.AUDIO_TRACK_LOADED,{details:e,id:l||0,groupId:d||"",stats:r,networkDetails:n,deliveryDirectives:u});break;case ht:a.trigger(b.SUBTITLE_TRACK_LOADED,{details:e,id:l||0,groupId:d||"",stats:r,networkDetails:n,deliveryDirectives:u})}}else{var g=new Error("No Segments found in Playlist");a.trigger(b.ERROR,{type:E.NETWORK_ERROR,details:S.LEVEL_EMPTY_ERROR,fatal:!1,url:h,error:g,reason:g.message,response:t,context:i,level:f,parent:p,networkDetails:n,stats:r})}},e}();function yt(e,t){var r;try{r=new Event("addtrack")}catch(e){(r=document.createEvent("Event")).initEvent("addtrack",!1,!1)}r.track=e,t.dispatchEvent(r)}function bt(e,t){var r=e.mode;if("disabled"===r&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw new Error("addCue is failed for: "+t)}catch(r){P.debug("[texttrack-utils]: "+r);var i=new self.TextTrackCue(t.startTime,t.endTime,t.text);i.id=t.id,e.addCue(i)}"disabled"===r&&(e.mode=r)}function Et(e){var t=e.mode;if("disabled"===t&&(e.mode="hidden"),e.cues)for(var r=e.cues.length;r--;)e.removeCue(e.cues[r]);"disabled"===t&&(e.mode=t)}function St(e,t,r,i){var n=e.mode;if("disabled"===n&&(e.mode="hidden"),e.cues&&e.cues.length>0)for(var s=function(e,t,r){var i=[],n=function(e,t){if(t<e[0].startTime)return 0;var r=e.length-1;if(t>e[r].endTime)return-1;for(var i=0,n=r;i<=n;){var s=Math.floor((n+i)/2);if(t<e[s].startTime)n=s-1;else{if(!(t>e[s].startTime&&i<r))return s;i=s+1}}return e[i].startTime-t<t-e[n].startTime?i:n}(e,t);if(n>-1)for(var s=n,a=e.length;s<a;s++){var o=e[s];if(o.startTime>=t&&o.endTime<=r)i.push(o);else if(o.startTime>r)return i}return i}(e.cues,t,r),a=0;a<s.length;a++)i&&!i(s[a])||e.removeCue(s[a]);"disabled"===n&&(e.mode=n)}var wt="org.id3",Tt="com.apple.quicktime.HLS",Rt="https://aomedia.org/emsg/ID3";function Ct(){if("undefined"!=typeof self)return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var At=function(){var e=Ct();try{new e(0,Number.POSITIVE_INFINITY,"")}catch(e){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function Pt(e,t){return e.getTime()/1e3-t}var Dt=function(){function e(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}var t=e.prototype;return t.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},t._registerListeners=function(){var e=this.hls;e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(b.LEVEL_UPDATED,this.onLevelUpdated,this)},t._unregisterListeners=function(){var e=this.hls;e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(b.LEVEL_UPDATED,this.onLevelUpdated,this)},t.onMediaAttached=function(e,t){this.media=t.media},t.onMediaDetaching=function(){this.id3Track&&(Et(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},t.onManifestLoading=function(){this.dateRangeCuesAppended={}},t.createTrack=function(e){var t=this.getID3Track(e.textTracks);return t.mode="hidden",t},t.getID3Track=function(e){if(this.media){for(var t=0;t<e.length;t++){var r=e[t];if("metadata"===r.kind&&"id3"===r.label)return yt(r,this.media),r}return this.media.addTextTrack("metadata","id3")}},t.onFragParsingMetadata=function(e,t){if(this.media){var r=this.hls.config,i=r.enableEmsgMetadataCues,n=r.enableID3MetadataCues;if(i||n){var s=t.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var a=Ct(),o=0;o<s.length;o++){var c=s[o].type;if((c!==Rt||i)&&n){var l=de(s[o].data);if(l){var d=s[o].pts,u=d+s[o].duration;u>At&&(u=At),u-d<=0&&(u=d+.25);for(var h=0;h<l.length;h++){var p=l[h];if(!ce(p)){this.updateId3CueEnds(d,c);var f=new a(d,u,"");f.value=p,c&&(f.type=c),this.id3Track.addCue(f)}}}}}}}},t.updateId3CueEnds=function(e,t){var r,i=null==(r=this.id3Track)?void 0:r.cues;if(i)for(var n=i.length;n--;){var s=i[n];s.type===t&&s.startTime<e&&s.endTime===At&&(s.endTime=e)}},t.onBufferFlushing=function(e,t){var r=t.startOffset,i=t.endOffset,n=t.type,s=this.id3Track,a=this.hls;if(a){var o=a.config,c=o.enableEmsgMetadataCues,l=o.enableID3MetadataCues;s&&(c||l)&&St(s,r,i,"audio"===n?function(e){return e.type===wt&&l}:"video"===n?function(e){return e.type===Rt&&c}:function(e){return e.type===wt&&l||e.type===Rt&&c})}},t.onLevelUpdated=function(e,t){var r=this,i=t.details;if(this.media&&i.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var n=this.dateRangeCuesAppended,s=this.id3Track,a=i.dateRanges,o=Object.keys(a);if(s)for(var c=Object.keys(n).filter((function(e){return!o.includes(e)})),l=function(){var e=c[d];Object.keys(n[e].cues).forEach((function(t){s.removeCue(n[e].cues[t])})),delete n[e]},d=c.length;d--;)l();var u=i.fragments[i.fragments.length-1];if(0!==o.length&&y(null==u?void 0:u.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var h=u.programDateTime/1e3-u.start,p=Ct(),f=function(){var e,t,i=o[m],s=a[i],c=n[i],l=(null==c?void 0:c.cues)||{},d=(null==c?void 0:c.durationKnown)||!1,u=Pt(s.startDate,h),f=At,g=s.endDate;if(g)f=Pt(g,h),d=!0;else if(s.endOnNext&&!d){var v=o.reduce((function(e,t){var r=a[t];return r.class===s.class&&r.id!==t&&r.startDate>s.startDate&&e.push(r),e}),[]).sort((function(e,t){return e.startDate.getTime()-t.startDate.getTime()}))[0];v&&(f=Pt(v.startDate,h),d=!0)}for(var _=Object.keys(s.attr),y=0;y<_.length;y++){var b=_[y];if("ID"!==(t=b)&&"CLASS"!==t&&"START-DATE"!==t&&"DURATION"!==t&&"END-DATE"!==t&&"END-ON-NEXT"!==t){var E=l[b];if(E)d&&!c.durationKnown&&(E.endTime=f);else{var S=s.attr[b];E=new p(u,f,""),I(b)&&(e=S,S=Uint8Array.from(e.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer),E.value={key:b,data:S},E.type=Tt,E.id=i,r.id3Track.addCue(E),l[b]=E}}}n[i]={cues:l,dateRange:s,durationKnown:d}},m=0;m<o.length;m++)f()}}},e}(),Lt=function(){function e(e){var t=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return t.timeupdate()},this.hls=e,this.config=e.config,this.registerListeners()}var t=e.prototype;return t.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},t.registerListeners=function(){this.hls.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(b.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(b.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(b.ERROR,this.onError,this)},t.unregisterListeners=function(){this.hls.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(b.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(b.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(b.ERROR,this.onError,this)},t.onMediaAttached=function(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},t.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},t.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},t.onLevelUpdated=function(e,t){var r=t.details;this.levelDetails=r,r.advanced&&this.timeupdate(),!r.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},t.onError=function(e,t){var r;t.details===S.BUFFER_STALLED_ERROR&&(this.stallCount++,null!=(r=this.levelDetails)&&r.live&&P.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},t.timeupdate=function(){var e=this.media,t=this.levelDetails;if(e&&t){this.currentTime=e.currentTime;var r=this.computeLatency();if(null!==r){this._latency=r;var i=this.config,n=i.lowLatencyMode,s=i.maxLiveSyncPlaybackRate;if(n&&1!==s){var a=this.targetLatency;if(null!==a){var o=r-a,c=o<Math.min(this.maxLatency,a+t.targetduration);if(t.live&&c&&o>.05&&this.forwardBufferLength>1){var l=Math.min(2,Math.max(1,s)),d=Math.round(2/(1+Math.exp(-.75*o-this.edgeStalled))*20)/20;e.playbackRate=Math.min(l,Math.max(1,d))}else 1!==e.playbackRate&&0!==e.playbackRate&&(e.playbackRate=1)}}}}},t.estimateLiveEdge=function(){var e=this.levelDetails;return null===e?null:e.edge+e.age},t.computeLatency=function(){var e=this.estimateLiveEdge();return null===e?null:e-this.currentTime},s(e,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var e=this.config,t=this.levelDetails;return void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}},{key:"targetLatency",get:function(){var e=this.levelDetails;if(null===e)return null;var t=e.holdBack,r=e.partHoldBack,i=e.targetduration,n=this.config,s=n.liveSyncDuration,a=n.liveSyncDurationCount,o=n.lowLatencyMode,c=this.hls.userConfig,l=o&&r||t;(c.liveSyncDuration||c.liveSyncDurationCount||0===l)&&(l=void 0!==s?s:a*i);var d=i;return l+Math.min(1*this.stallCount,d)}},{key:"liveSyncPosition",get:function(){var e=this.estimateLiveEdge(),t=this.targetLatency,r=this.levelDetails;if(null===e||null===t||null===r)return null;var i=r.edge,n=e-t-this.edgeStalled,s=i-r.totalduration,a=i-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(s,n),a)}},{key:"drift",get:function(){var e=this.levelDetails;return null===e?1:e.drift}},{key:"edgeStalled",get:function(){var e=this.levelDetails;if(null===e)return 0;var t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}},{key:"forwardBufferLength",get:function(){var e=this.media,t=this.levelDetails;if(!e||!t)return 0;var r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}}]),e}(),kt=["NONE","TYPE-0","TYPE-1",null],It="",Ot="YES",Mt="v2";var xt=function(){function e(e,t,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=r}return e.prototype.addDirectives=function(e){var t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href},e}(),Nt=function(){function e(e){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.unknownCodecs=e.unknownCodecs,this.codecSet=[e.videoCodec,e.audioCodec].filter((function(e){return e})).join(",").replace(/\.[^.,]+/g,"")}return e.prototype.addFallback=function(e){this.url.push(e.url),this._attrs.push(e.attrs)},s(e,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"attrs",get:function(){return this._attrs[this._urlId]}},{key:"pathwayId",get:function(){return this.attrs["PATHWAY-ID"]||"."}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(e){var t=e%this.url.length;this._urlId!==t&&(this.fragmentError=0,this.loadError=0,this.details=void 0,this._urlId=t)}},{key:"audioGroupId",get:function(){var e;return null==(e=this.audioGroupIds)?void 0:e[this.urlId]}},{key:"textGroupId",get:function(){var e;return null==(e=this.textGroupIds)?void 0:e[this.urlId]}}]),e}();function Ft(e,t){var r=t.startPTS;if(y(r)){var i,n=0;t.sn>e.sn?(n=r-e.start,i=e):(n=e.start-r,i=t),i.duration!==n&&(i.duration=n)}else t.sn>e.sn?e.cc===t.cc&&e.minEndPTS?t.start=e.start+(e.minEndPTS-e.start):t.start=e.start+e.duration:t.start=Math.max(e.start-t.duration,0)}function Bt(e,t,r,i,n,s){i-r<=0&&(P.warn("Fragment should have a positive duration",t),i=r+t.duration,s=n+t.duration);var a=r,o=i,c=t.startPTS,l=t.endPTS;if(y(c)){var d=Math.abs(c-r);y(t.deltaPTS)?t.deltaPTS=Math.max(d,t.deltaPTS):t.deltaPTS=d,a=Math.max(r,c),r=Math.min(r,c),n=Math.min(n,t.startDTS),o=Math.min(i,l),i=Math.max(i,l),s=Math.max(s,t.endDTS)}var u=r-t.start;0!==t.start&&(t.start=r),t.duration=i-t.start,t.startPTS=r,t.maxStartPTS=a,t.startDTS=n,t.endPTS=i,t.minEndPTS=o,t.endDTS=s;var h,p=t.sn;if(!e||p<e.startSN||p>e.endSN)return 0;var f=p-e.startSN,m=e.fragments;for(m[f]=t,h=f;h>0;h--)Ft(m[h],m[h-1]);for(h=f;h<m.length-1;h++)Ft(m[h],m[h+1]);return e.fragmentHint&&Ft(m[m.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,u}function jt(e,t){for(var r=null,i=e.fragments,n=i.length-1;n>=0;n--){var s=i[n].initSegment;if(s){r=s;break}}e.fragmentHint&&delete e.fragmentHint.endPTS;var a,c,l,d,u,h=0;if(function(e,t,r){for(var i=t.skippedSegments,n=Math.max(e.startSN,t.startSN)-t.startSN,s=(e.fragmentHint?1:0)+(i?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,a=t.startSN-e.startSN,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,c=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=n;l<=s;l++){var d=c[a+l],u=o[l];i&&!u&&l<i&&(u=t.fragments[l]=d),d&&u&&r(d,u)}}(e,t,(function(e,i){e.relurl&&(h=e.cc-i.cc),y(e.startPTS)&&y(e.endPTS)&&(i.start=i.startPTS=e.startPTS,i.startDTS=e.startDTS,i.maxStartPTS=e.maxStartPTS,i.endPTS=e.endPTS,i.endDTS=e.endDTS,i.minEndPTS=e.minEndPTS,i.duration=e.endPTS-e.startPTS,i.duration&&(a=i),t.PTSKnown=t.alignedSliding=!0),i.elementaryStreams=e.elementaryStreams,i.loader=e.loader,i.stats=e.stats,i.urlId=e.urlId,e.initSegment&&(i.initSegment=e.initSegment,r=e.initSegment)})),r&&(t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments).forEach((function(e){var t;e.initSegment&&e.initSegment.relurl!==(null==(t=r)?void 0:t.relurl)||(e.initSegment=r)})),t.skippedSegments)if(t.deltaUpdateFailed=t.fragments.some((function(e){return!e})),t.deltaUpdateFailed){P.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var p=t.skippedSegments;p--;)t.fragments.shift();t.startSN=t.fragments[0].sn,t.startCC=t.fragments[0].cc}else t.canSkipDateRanges&&(t.dateRanges=(c=e.dateRanges,l=t.dateRanges,d=t.recentlyRemovedDateranges,u=o({},c),d&&d.forEach((function(e){delete u[e]})),Object.keys(l).forEach((function(e){var t=new O(l[e].attr,u[e]);t.isValid?u[e]=t:P.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(l[e].attr)+'"')})),u));var f=t.fragments;if(h){P.warn("discontinuity sliding from playlist, take drift into account");for(var m=0;m<f.length;m++)f[m].cc+=h}t.skippedSegments&&(t.startCC=t.fragments[0].cc),function(e,t,r){if(e&&t)for(var i=0,n=0,s=e.length;n<=s;n++){var a=e[n],o=t[n+i];a&&o&&a.index===o.index&&a.fragment.sn===o.fragment.sn?r(a,o):i--}}(e.partList,t.partList,(function(e,t){t.elementaryStreams=e.elementaryStreams,t.stats=e.stats})),a?Bt(t,a,a.startPTS,a.endPTS,a.startDTS,a.endDTS):Ut(e,t),f.length&&(t.totalduration=t.edge-f[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;var g=t.advancedDateTime;if(t.advanced&&g){var v=t.edge;t.driftStart||(t.driftStartTime=g,t.driftStart=v),t.driftEndTime=g,t.driftEnd=v}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime}function Ut(e,t){var r=t.startSN+t.skippedSegments-e.startSN,i=e.fragments;r<0||r>=i.length||Vt(t,i[r].start)}function Vt(e,t){if(t){for(var r=e.fragments,i=e.skippedSegments;i<r.length;i++)r[i].start+=t;e.fragmentHint&&(e.fragmentHint.start+=t)}}function Gt(e,t,r){var i;return null!=e&&e.details?Ht(null==(i=e.details)?void 0:i.partList,t,r):null}function Ht(e,t,r){if(e)for(var i=e.length;i--;){var n=e[i];if(n.index===r&&n.fragment.sn===t)return n}return null}function Kt(e){switch(e.details){case S.FRAG_LOAD_TIMEOUT:case S.KEY_LOAD_TIMEOUT:case S.LEVEL_LOAD_TIMEOUT:case S.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function qt(e,t){var r=Kt(t);return e.default[(r?"timeout":"error")+"Retry"]}function Wt(e,t){var r="linear"===e.backoff?1:Math.pow(2,t);return Math.min(r*e.retryDelayMs,e.maxRetryDelayMs)}function zt(e){return i(i({},e),{errorRetry:null,timeoutRetry:null})}function $t(e,t,r,i){return!!e&&t<e.maxNumRetry&&(function(e){return 0===e&&!1===navigator.onLine||!!e&&(e<400||e>499)}(i)||!!r)}var Yt={search:function(e,t){for(var r=0,i=e.length-1,n=null,s=null;r<=i;){var a=t(s=e[n=(r+i)/2|0]);if(a>0)r=n+1;else{if(!(a<0))return s;i=n-1}}return null}};function Qt(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=0);var n=null;if(e?n=t[e.sn-t[0].sn+1]||null:0===r&&0===t[0].start&&(n=t[0]),n&&0===Jt(r,i,n))return n;var s=Yt.search(t,Jt.bind(null,r,i));return!s||s===e&&n?n:s}function Jt(e,t,r){if(void 0===e&&(e=0),void 0===t&&(t=0),r.start<=e&&r.start+r.duration>e)return 0;var i=Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0));return r.start+r.duration-i<=e?1:r.start-i>e&&r.start?-1:0}function Xt(e,t,r){var i=1e3*Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0));return(r.endProgramDateTime||0)-i>e}var Zt=3e5,er=0,tr=2,rr=5,ir=0,nr=1,sr=2,ar=function(){function e(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=P.log.bind(P,"[info]:"),this.warn=P.warn.bind(P,"[warning]:"),this.error=P.error.bind(P,"[error]:"),this.registerListeners()}var t=e.prototype;return t.registerListeners=function(){var e=this.hls;e.on(b.ERROR,this.onError,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.LEVEL_UPDATED,this.onLevelUpdated,this)},t.unregisterListeners=function(){var e=this.hls;e&&(e.off(b.ERROR,this.onError,this),e.off(b.ERROR,this.onErrorOut,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.LEVEL_UPDATED,this.onLevelUpdated,this))},t.destroy=function(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}},t.startLoad=function(e){this.playlistError=0},t.stopLoad=function(){},t.getVariantLevelIndex=function(e){return(null==e?void 0:e.type)===pt?e.level:this.hls.loadLevel},t.onManifestLoading=function(){this.playlistError=0,this.penalizedRenditions={}},t.onLevelUpdated=function(){this.playlistError=0},t.onError=function(e,t){var r;if(!t.fatal){var i=this.hls,n=t.context;switch(t.details){case S.FRAG_LOAD_ERROR:case S.FRAG_LOAD_TIMEOUT:case S.KEY_LOAD_ERROR:case S.KEY_LOAD_TIMEOUT:return void(t.errorAction=this.getFragRetryOrSwitchAction(t));case S.FRAG_GAP:case S.FRAG_PARSING_ERROR:case S.FRAG_DECRYPT_ERROR:return t.errorAction=this.getFragRetryOrSwitchAction(t),void(t.errorAction.action=tr);case S.LEVEL_EMPTY_ERROR:case S.LEVEL_PARSING_ERROR:var s,a,o=t.parent===pt?t.level:i.loadLevel;return void(t.details===S.LEVEL_EMPTY_ERROR&&null!=(s=t.context)&&null!=(a=s.levelDetails)&&a.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,o):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,o)));case S.LEVEL_LOAD_ERROR:case S.LEVEL_LOAD_TIMEOUT:return void("number"==typeof(null==n?void 0:n.level)&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,n.level)));case S.AUDIO_TRACK_LOAD_ERROR:case S.AUDIO_TRACK_LOAD_TIMEOUT:case S.SUBTITLE_LOAD_ERROR:case S.SUBTITLE_TRACK_LOAD_TIMEOUT:if(n){var c=i.levels[i.loadLevel];if(c&&(n.type===ut&&n.groupId===c.audioGroupId||n.type===ht&&n.groupId===c.textGroupId))return t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.loadLevel),t.errorAction.action=tr,void(t.errorAction.flags=nr)}return;case S.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:var l=i.levels[i.loadLevel],d=null==l?void 0:l.attrs["HDCP-LEVEL"];return void(d&&(t.errorAction={action:tr,flags:sr,hdcpLevel:d}));case S.BUFFER_ADD_CODEC_ERROR:case S.REMUX_ALLOC_ERROR:return void(t.errorAction=this.getLevelSwitchAction(t,null!=(r=t.level)?r:i.loadLevel));case S.INTERNAL_EXCEPTION:case S.BUFFER_APPENDING_ERROR:case S.BUFFER_APPEND_ERROR:case S.BUFFER_FULL_ERROR:case S.LEVEL_SWITCH_ERROR:case S.BUFFER_STALLED_ERROR:case S.BUFFER_SEEK_OVER_HOLE:case S.BUFFER_NUDGE_ON_STALL:return void(t.errorAction={action:er,flags:ir})}if(t.type===E.KEY_SYSTEM_ERROR){var u=this.getVariantLevelIndex(t.frag);return t.levelRetry=!1,void(t.errorAction=this.getLevelSwitchAction(t,u))}}},t.getPlaylistRetryOrSwitchAction=function(e,t){var r,i=qt(this.hls.config.playlistLoadPolicy,e),n=this.playlistError++,s=null==(r=e.response)?void 0:r.code;if($t(i,n,Kt(e),s))return{action:rr,flags:ir,retryConfig:i,retryCount:n};var a=this.getLevelSwitchAction(e,t);return i&&(a.retryConfig=i,a.retryCount=n),a},t.getFragRetryOrSwitchAction=function(e){var t=this.hls,r=this.getVariantLevelIndex(e.frag),i=t.levels[r],n=t.config,s=n.fragLoadPolicy,a=n.keyLoadPolicy,o=qt(e.details.startsWith("key")?a:s,e),c=t.levels.reduce((function(e,t){return e+t.fragmentError}),0);if(i){var l;e.details!==S.FRAG_GAP&&i.fragmentError++;var d=null==(l=e.response)?void 0:l.code;if($t(o,c,Kt(e),d))return{action:rr,flags:ir,retryConfig:o,retryCount:c}}var u=this.getLevelSwitchAction(e,r);return o&&(u.retryConfig=o,u.retryCount=c),u},t.getLevelSwitchAction=function(e,t){var r=this.hls;null==t&&(t=r.loadLevel);var i=this.hls.levels[t];if(i&&(i.loadError++,r.autoLevelEnabled)){for(var n,s,a=-1,o=r.levels,c=null==(n=e.frag)?void 0:n.type,l=null!=(s=e.context)?s:{},d=l.type,u=l.groupId,h=o.length;h--;){var p=(h+r.loadLevel)%o.length;if(p!==r.loadLevel&&0===o[p].loadError){var f=o[p];if(e.details===S.FRAG_GAP&&e.frag){var m=o[p].details;if(m){var g=Qt(e.frag,m.fragments,e.frag.start);if(null!=g&&g.gap)continue}}else{if(d===ut&&u===f.audioGroupId||d===ht&&u===f.textGroupId)continue;if(c===ft&&i.audioGroupId===f.audioGroupId||c===mt&&i.textGroupId===f.textGroupId)continue}a=p;break}}if(a>-1&&r.loadLevel!==a)return e.levelRetry=!0,this.playlistError=0,{action:tr,flags:ir,nextAutoLevel:a}}return{action:tr,flags:nr}},t.onErrorOut=function(e,t){var r;switch(null==(r=t.errorAction)?void 0:r.action){case er:break;case tr:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===S.FRAG_GAP||(t.fatal=!0)}t.fatal&&this.hls.stopLoad()},t.sendAlternateToPenaltyBox=function(e){var t=this.hls,r=e.errorAction;if(r){var i=r.flags,n=r.hdcpLevel,s=r.nextAutoLevel;switch(i){case ir:this.switchLevel(e,s);break;case nr:r.resolved||(r.resolved=this.redundantFailover(e));break;case sr:n&&(t.maxHdcpLevel=kt[kt.indexOf(n)-1],r.resolved=!0),this.warn('Restricting playback to HDCP-LEVEL of "'+t.maxHdcpLevel+'" or lower')}r.resolved||this.switchLevel(e,s)}},t.switchLevel=function(e,t){void 0!==t&&e.errorAction&&(this.warn("switching to level "+t+" after "+e.details),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)},t.redundantFailover=function(e){var t=this,r=this.hls,i=this.penalizedRenditions,n=e.parent===pt?e.level:r.loadLevel,s=r.levels[n],a=s.url.length,o=e.frag?e.frag.urlId:s.urlId;s.urlId!==o||e.frag&&!s.details||this.penalizeRendition(s,e);for(var c=function(){var c=(o+l)%a,d=i[c];if(!d||function(e,t,r){if(performance.now()-e.lastErrorPerfMs>Zt)return!0;var i=e.details;if(t.details===S.FRAG_GAP&&i&&t.frag){var n=t.frag.start,s=Qt(null,i.fragments,n);if(s&&!s.gap)return!0}if(r&&e.errors.length<r.errors.length){var a=e.errors[e.errors.length-1];if(i&&a.frag&&t.frag&&Math.abs(a.frag.start-t.frag.start)>3*i.targetduration)return!0}return!1}(d,e,i[o]))return t.warn("Switching to Redundant Stream "+(c+1)+"/"+a+': "'+s.url[c]+'" after '+e.details),t.playlistError=0,r.levels.forEach((function(e){e.urlId=c})),r.nextLoadLevel=n,{v:!0}},l=1;l<a;l++){var d=c();if("object"==typeof d)return d.v}return!1},t.penalizeRendition=function(e,t){var r=this.penalizedRenditions,i=r[e.urlId]||{lastErrorPerfMs:0,errors:[],details:void 0};i.lastErrorPerfMs=performance.now(),i.errors.push(t),i.details=e.details,r[e.urlId]=i},e}();var or,cr=function(){function e(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=P.log.bind(P,t+":"),this.warn=P.warn.bind(P,t+":"),this.hls=e}var t=e.prototype;return t.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},t.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},t.startLoad=function(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()},t.stopLoad=function(){this.canLoad=!1,this.clearTimer()},t.switchParams=function(e,t){var r=null==t?void 0:t.renditionReports;if(r){for(var i=-1,n=0;n<r.length;n++){var s=r[n],a=void 0;try{a=new self.URL(s.URI,t.url).href}catch(e){P.warn("Could not construct new URL for Rendition Report: "+e),a=s.URI||""}if(a===e){i=n;break}a===e.substring(0,a.length)&&(i=n)}if(-1!==i){var o=r[i],c=parseInt(o["LAST-MSN"])||(null==t?void 0:t.lastPartSn),l=parseInt(o["LAST-PART"])||(null==t?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){var d=Math.min(t.age-t.partTarget,t.targetduration);l>=0&&d>t.partTarget&&(l+=1)}return new xt(c,l>=0?l:void 0,It)}}},t.loadPlaylist=function(e){-1===this.requestScheduled&&(this.requestScheduled=self.performance.now())},t.shouldLoadPlaylist=function(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)},t.shouldReloadPlaylist=function(e){return-1===this.timer&&-1===this.requestScheduled&&this.shouldLoadPlaylist(e)},t.playlistLoaded=function(e,t,r){var i=this,n=t.details,s=t.stats,a=self.performance.now(),o=s.loading.first?Math.max(0,a-s.loading.first):0;if(n.advancedDateTime=Date.now()-o,n.live||null!=r&&r.live){if(n.reloaded(r),r&&this.log("live playlist "+e+" "+(n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:"MISSED")),r&&n.fragments.length>0&&jt(r,n),!this.canLoad||!n.live)return;var c,l=void 0,d=void 0;if(n.canBlockReload&&n.endSN&&n.advanced){var u=this.hls.config.lowLatencyMode,h=n.lastPartSn,p=n.endSN,f=n.lastPartIndex,m=h===p;-1!==f?(l=m?p+1:h,d=m?u?0:f:f+1):l=p+1;var g=n.age,v=g+n.ageHeader,_=Math.min(v-n.partTarget,1.5*n.targetduration);if(_>0){if(r&&_>r.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+r.tuneInGoal+" to: "+_+" with playlist age: "+n.age),_=0;else{var y=Math.floor(_/n.targetduration);l+=y,void 0!==d&&(d+=Math.round(_%n.targetduration/n.partTarget)),this.log("CDN Tune-in age: "+n.ageHeader+"s last advanced "+g.toFixed(2)+"s goal: "+_+" skip sn "+y+" to part "+d)}n.tuneInGoal=_}if(c=this.getDeliveryDirectives(n,t.deliveryDirectives,l,d),u||!m)return void this.loadPlaylist(c)}else n.canBlockReload&&(c=this.getDeliveryDirectives(n,t.deliveryDirectives,l,d));var b=this.hls.mainForwardBufferInfo,E=b?b.end-b.len:0,S=function(e,t){void 0===t&&(t=1/0);var r=1e3*e.targetduration;if(e.updated){var i=e.fragments;if(i.length&&4*r>t){var n=1e3*i[i.length-1].duration;n<r&&(r=n)}}else r/=2;return Math.round(r)}(n,1e3*(n.edge-E));n.updated&&a>this.requestScheduled+S&&(this.requestScheduled=s.loading.start),void 0!==l&&n.canBlockReload?this.requestScheduled=s.loading.first+S-(1e3*n.partTarget||1e3):-1===this.requestScheduled||this.requestScheduled+S<a?this.requestScheduled=a:this.requestScheduled-a<=0&&(this.requestScheduled+=S);var w=this.requestScheduled-a;w=Math.max(0,w),this.log("reload live playlist "+e+" in "+Math.round(w)+" ms"),this.timer=self.setTimeout((function(){return i.loadPlaylist(c)}),w)}else this.clearTimer()},t.getDeliveryDirectives=function(e,t,r,i){var n=function(e,t){var r=e.canSkipUntil,i=e.canSkipDateRanges,n=e.endSN;return r&&(void 0!==t?t-n:0)<r?i?Mt:Ot:It}(e,r);return null!=t&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,i=t.part,n=It),new xt(r,i,n)},t.checkRetry=function(e){var t=this,r=e.details,i=Kt(e),n=e.errorAction,s=n||{},a=s.action,o=s.retryCount,c=void 0===o?0:o,l=s.retryConfig,d=!!n&&!!l&&(a===rr||!n.resolved&&a===tr);if(d){var u;if(this.requestScheduled=-1,c>=l.maxNumRetry)return!1;if(i&&null!=(u=e.context)&&u.deliveryDirectives)this.warn("Retrying playlist loading "+(c+1)+"/"+l.maxNumRetry+' after "'+r+'" without delivery-directives'),this.loadPlaylist();else{var h=Wt(l,c);this.timer=self.setTimeout((function(){return t.loadPlaylist()}),h),this.warn("Retrying playlist loading "+(c+1)+"/"+l.maxNumRetry+' after "'+r+'" in '+h+"ms")}e.levelRetry=!0,n.resolved=!0}return d},e}(),lr=function(e){function t(t,r){var i;return(i=e.call(this,t,"[level-controller]")||this)._levels=[],i._firstLevel=-1,i._startLevel=void 0,i.currentLevel=null,i.currentLevelIndex=-1,i.manualLevelIndex=-1,i.steering=void 0,i.onParsedComplete=void 0,i.steering=r,i._registerListeners(),i}c(t,e);var r=t.prototype;return r._registerListeners=function(){var e=this.hls;e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(b.LEVEL_LOADED,this.onLevelLoaded,this),e.on(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(b.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(b.FRAG_LOADED,this.onFragLoaded,this),e.on(b.ERROR,this.onError,this)},r._unregisterListeners=function(){var e=this.hls;e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(b.LEVEL_LOADED,this.onLevelLoaded,this),e.off(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(b.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(b.FRAG_LOADED,this.onFragLoaded,this),e.off(b.ERROR,this.onError,this)},r.destroy=function(){this._unregisterListeners(),this.steering=null,this.resetLevels(),e.prototype.destroy.call(this)},r.startLoad=function(){this._levels.forEach((function(e){e.loadError=0,e.fragmentError=0})),e.prototype.startLoad.call(this)},r.resetLevels=function(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[]},r.onManifestLoading=function(e,t){this.resetLevels()},r.onManifestLoaded=function(e,t){var r,i=[],n={};t.levels.forEach((function(e){var t,s=e.attrs;-1!==(null==(t=e.audioCodec)?void 0:t.indexOf("mp4a.40.34"))&&(or||(or=/chrome|firefox/i.test(navigator.userAgent)),or&&(e.audioCodec=void 0));var a=s.AUDIO,o=s.CODECS,c=s["FRAME-RATE"],l=s["PATHWAY-ID"],d=s.RESOLUTION,u=s.SUBTITLES,h=(l||".")+"-"+e.bitrate+"-"+d+"-"+c+"-"+o;(r=n[h])?r.addFallback(e):(r=new Nt(e),n[h]=r,i.push(r)),dr(r,"audio",a),dr(r,"text",u)})),this.filterAndSortMediaOptions(i,t)},r.filterAndSortMediaOptions=function(e,t){var r=this,i=[],n=[],s=!1,a=!1,o=!1,c=e.filter((function(e){var t=e.audioCodec,r=e.videoCodec,i=e.width,n=e.height,c=e.unknownCodecs;return s||(s=!(!i||!n)),a||(a=!!r),o||(o=!!t),!(null!=c&&c.length)&&(!t||Ye(t,"audio"))&&(!r||Ye(r,"video"))}));if((s||a)&&o&&(c=c.filter((function(e){var t=e.videoCodec,r=e.width,i=e.height;return!!t||!(!r||!i)}))),0!==c.length){t.audioTracks&&ur(i=t.audioTracks.filter((function(e){return!e.audioCodec||Ye(e.audioCodec,"audio")}))),t.subtitles&&ur(n=t.subtitles);var l=c.slice(0);c.sort((function(e,t){return e.attrs["HDCP-LEVEL"]!==t.attrs["HDCP-LEVEL"]?(e.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1:e.bitrate!==t.bitrate?e.bitrate-t.bitrate:e.attrs["FRAME-RATE"]!==t.attrs["FRAME-RATE"]?e.attrs.decimalFloatingPoint("FRAME-RATE")-t.attrs.decimalFloatingPoint("FRAME-RATE"):e.attrs.SCORE!==t.attrs.SCORE?e.attrs.decimalFloatingPoint("SCORE")-t.attrs.decimalFloatingPoint("SCORE"):s&&e.height!==t.height?e.height-t.height:0}));var d=l[0];if(this.steering&&(c=this.steering.filterParsedLevels(c)).length!==l.length)for(var u=0;u<l.length;u++)if(l[u].pathwayId===c[0].pathwayId){d=l[u];break}this._levels=c;for(var h=0;h<c.length;h++)if(c[h]===d){this._firstLevel=h,this.log("manifest loaded, "+c.length+" level(s) found, first bitrate: "+d.bitrate);break}var p=o&&!a,f={levels:c,audioTracks:i,subtitleTracks:n,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:o,video:a,altAudio:!p&&i.some((function(e){return!!e.url}))};this.hls.trigger(b.MANIFEST_PARSED,f),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else Promise.resolve().then((function(){if(r.hls){var e=new Error("no level with compatible codecs found in manifest");r.hls.trigger(b.ERROR,{type:E.MEDIA_ERROR,details:S.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:e,reason:e.message})}}))},r.onError=function(e,t){!t.fatal&&t.context&&t.context.type===dt&&t.context.level===this.level&&this.checkRetry(t)},r.onFragLoaded=function(e,t){var r=t.frag;if(void 0!==r&&r.type===pt){var i=this._levels[r.level];void 0!==i&&(i.loadError=0)}},r.onLevelLoaded=function(e,t){var r,i,n=t.level,s=t.details,a=this._levels[n];if(!a)return this.warn("Invalid level index "+n),void(null!=(i=t.deliveryDirectives)&&i.skip&&(s.deltaUpdateFailed=!0));n===this.currentLevelIndex?(0===a.fragmentError&&(a.loadError=0),this.playlistLoaded(n,t,a.details)):null!=(r=t.deliveryDirectives)&&r.skip&&(s.deltaUpdateFailed=!0)},r.onAudioTrackSwitched=function(e,t){var r=this.currentLevel;if(r){var i=this.hls.audioTracks[t.id].groupId;if(r.audioGroupIds&&r.audioGroupId!==i){for(var n=-1,s=0;s<r.audioGroupIds.length;s++)if(r.audioGroupIds[s]===i){n=s;break}-1!==n&&n!==r.urlId&&(r.urlId=n,this.canLoad&&this.startLoad())}}},r.loadPlaylist=function(t){e.prototype.loadPlaylist.call(this);var r=this.currentLevelIndex,i=this.currentLevel;if(i&&this.shouldLoadPlaylist(i)){var n=i.urlId,s=i.uri;if(t)try{s=t.addDirectives(s)}catch(e){this.warn("Could not construct new URL with HLS Delivery Directives: "+e)}var a=i.attrs["PATHWAY-ID"];this.log("Loading level index "+r+(void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:"")+" with"+(a?" Pathway "+a:"")+" URI "+(n+1)+"/"+i.url.length+" "+s),this.clearTimer(),this.hls.trigger(b.LEVEL_LOADING,{url:s,level:r,id:n,deliveryDirectives:t||null})}},r.removeLevel=function(e,t){var r=this,i=function(e,r){return r!==t},n=this._levels.filter((function(n,s){return s!==e||(n.url.length>1&&void 0!==t?(n.url=n.url.filter(i),n.audioGroupIds&&(n.audioGroupIds=n.audioGroupIds.filter(i)),n.textGroupIds&&(n.textGroupIds=n.textGroupIds.filter(i)),n.urlId=0,!0):(r.steering&&r.steering.removeLevel(n),!1))}));this.hls.trigger(b.LEVELS_UPDATED,{levels:n})},r.onLevelsUpdated=function(e,t){var r=t.levels;r.forEach((function(e,t){var r=e.details;null!=r&&r.fragments&&r.fragments.forEach((function(e){e.level=t}))})),this._levels=r},s(t,[{key:"levels",get:function(){return 0===this._levels.length?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t=this._levels;if(0!==t.length){if(e<0||e>=t.length){var r=new Error("invalid level idx"),i=e<0;if(this.hls.trigger(b.ERROR,{type:E.OTHER_ERROR,details:S.LEVEL_SWITCH_ERROR,level:e,fatal:i,error:r,reason:r.message}),i)return;e=Math.min(e,t.length-1)}var n=this.currentLevelIndex,s=this.currentLevel,a=s?s.attrs["PATHWAY-ID"]:void 0,c=t[e],l=c.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=c,n!==e||!c.details||!s||a!==l){this.log("Switching to level "+e+(l?" with Pathway "+l:"")+" from level "+n+(a?" with Pathway "+a:""));var d=o({},c,{level:e,maxBitrate:c.maxBitrate,attrs:c.attrs,uri:c.uri,urlId:c.urlId});delete d._attrs,delete d._urlId,this.hls.trigger(b.LEVEL_SWITCHING,d);var u=c.details;if(!u||u.live){var h=this.switchParams(c.uri,null==s?void 0:s.details);this.loadPlaylist(h)}}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}}]),t}(cr);function dr(e,t,r){r&&("audio"===t?(e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds[e.url.length-1]=r):"text"===t&&(e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds[e.url.length-1]=r))}function ur(e){var t={};e.forEach((function(e){var r=e.groupId||"";e.id=t[r]=t[r]||0,t[r]++}))}var hr="NOT_LOADED",pr="APPENDING",fr="PARTIAL",mr="OK",gr=function(){function e(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}var t=e.prototype;return t._registerListeners=function(){var e=this.hls;e.on(b.BUFFER_APPENDED,this.onBufferAppended,this),e.on(b.FRAG_BUFFERED,this.onFragBuffered,this),e.on(b.FRAG_LOADED,this.onFragLoaded,this)},t._unregisterListeners=function(){var e=this.hls;e.off(b.BUFFER_APPENDED,this.onBufferAppended,this),e.off(b.FRAG_BUFFERED,this.onFragBuffered,this),e.off(b.FRAG_LOADED,this.onFragLoaded,this)},t.destroy=function(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null},t.getAppendedFrag=function(e,t){var r=this.activePartLists[t];if(r)for(var i=r.length;i--;){var n=r[i];if(!n)break;var s=n.end;if(n.start<=e&&null!==s&&e<=s)return n}return this.getBufferedFrag(e,t)},t.getBufferedFrag=function(e,t){for(var r=this.fragments,i=Object.keys(r),n=i.length;n--;){var s=r[i[n]];if((null==s?void 0:s.body.type)===t&&s.buffered){var a=s.body;if(a.start<=e&&e<=a.end)return a}}return null},t.detectEvictedFragments=function(e,t,r,i){var n=this;this.timeRanges&&(this.timeRanges[e]=t);var s=(null==i?void 0:i.fragment.sn)||-1;Object.keys(this.fragments).forEach((function(i){var a=n.fragments[i];if(a&&!(s>=a.body.sn))if(a.buffered||a.loaded){var o=a.range[e];o&&o.time.some((function(e){var r=!n.isTimeBuffered(e.startPTS,e.endPTS,t);return r&&n.removeFragment(a.body),r}))}else a.body.type===r&&n.removeFragment(a.body)}))},t.detectPartialFragments=function(e){var t=this,r=this.timeRanges,i=e.frag,n=e.part;if(r&&"initSegment"!==i.sn){var s=_r(i),a=this.fragments[s];if(a){var o=!i.relurl;Object.keys(r).forEach((function(e){var s=i.elementaryStreams[e];if(s){var c=r[e],l=o||!0===s.partial;a.range[e]=t.getBufferedTimes(i,n,l,c)}})),a.loaded=null,Object.keys(a.range).length?(a.buffered=!0,a.body.endList&&(this.endListFragments[a.body.type]=a),vr(a)||this.removeParts(i.sn-1,i.type)):this.removeFragment(a.body)}}},t.removeParts=function(e,t){var r=this.activePartLists[t];r&&(this.activePartLists[t]=r.filter((function(t){return t.fragment.sn>=e})))},t.fragBuffered=function(e,t){var r=_r(e),i=this.fragments[r];!i&&t&&(i=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)},t.getBufferedTimes=function(e,t,r,i){for(var n={time:[],partial:r},s=e.start,a=e.end,o=e.minEndPTS||a,c=e.maxStartPTS||s,l=0;l<i.length;l++){var d=i.start(l)-this.bufferPadding,u=i.end(l)+this.bufferPadding;if(c>=d&&o<=u){n.time.push({startPTS:Math.max(s,i.start(l)),endPTS:Math.min(a,i.end(l))});break}if(s<u&&a>d)n.partial=!0,n.time.push({startPTS:Math.max(s,i.start(l)),endPTS:Math.min(a,i.end(l))});else if(a<=d)break}return n},t.getPartialFragment=function(e){var t,r,i,n=null,s=0,a=this.bufferPadding,o=this.fragments;return Object.keys(o).forEach((function(c){var l=o[c];l&&vr(l)&&(r=l.body.start-a,i=l.body.end+a,e>=r&&e<=i&&(t=Math.min(e-r,i-e),s<=t&&(n=l.body,s=t)))})),n},t.isEndListAppended=function(e){var t=this.endListFragments[e];return void 0!==t&&(t.buffered||vr(t))},t.getState=function(e){var t=_r(e),r=this.fragments[t];return r?r.buffered?vr(r)?fr:mr:pr:hr},t.isTimeBuffered=function(e,t,r){for(var i,n,s=0;s<r.length;s++){if(i=r.start(s)-this.bufferPadding,n=r.end(s)+this.bufferPadding,e>=i&&t<=n)return!0;if(t<=i)return!1}return!1},t.onFragLoaded=function(e,t){var r=t.frag,i=t.part;if("initSegment"!==r.sn&&!r.bitrateTest){var n=i?null:t,s=_r(r);this.fragments[s]={body:r,appendedPTS:null,loaded:n,buffered:!1,range:Object.create(null)}}},t.onBufferAppended=function(e,t){var r=this,i=t.frag,n=t.part,s=t.timeRanges;if("initSegment"!==i.sn){var a=i.type;if(n){var o=this.activePartLists[a];o||(this.activePartLists[a]=o=[]),o.push(n)}this.timeRanges=s,Object.keys(s).forEach((function(e){var t=s[e];r.detectEvictedFragments(e,t,a,n)}))}},t.onFragBuffered=function(e,t){this.detectPartialFragments(t)},t.hasFragment=function(e){var t=_r(e);return!!this.fragments[t]},t.hasParts=function(e){var t;return!(null==(t=this.activePartLists[e])||!t.length)},t.removeFragmentsInRange=function(e,t,r,i,n){var s=this;i&&!this.hasGaps||Object.keys(this.fragments).forEach((function(a){var o=s.fragments[a];if(o){var c=o.body;c.type!==r||i&&!c.gap||c.start<t&&c.end>e&&(o.buffered||n)&&s.removeFragment(c)}}))},t.removeFragment=function(e){var t=_r(e);e.stats.loaded=0,e.clearElementaryStreamInfo();var r=this.activePartLists[e.type];if(r){var i=e.sn;this.activePartLists[e.type]=r.filter((function(e){return e.fragment.sn!==i}))}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]},t.removeAllFragments=function(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1},e}();function vr(e){var t,r,i;return e.buffered&&(e.body.gap||(null==(t=e.range.video)?void 0:t.partial)||(null==(r=e.range.audio)?void 0:r.partial)||(null==(i=e.range.audiovideo)?void 0:i.partial))}function _r(e){return e.type+"_"+e.level+"_"+e.urlId+"_"+e.sn}var yr=Math.pow(2,17),br=function(){function e(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}var t=e.prototype;return t.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},t.abort=function(){this.loader&&this.loader.abort()},t.load=function(e,t){var r=this,n=e.url;if(!n)return Promise.reject(new wr({type:E.NETWORK_ERROR,details:S.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error("Fragment does not have a "+(n?"part list":"url")),networkDetails:null}));this.abort();var s=this.config,a=s.fLoader,o=s.loader;return new Promise((function(c,l){if(r.loader&&r.loader.destroy(),e.gap)l(Sr(e));else{var d=r.loader=e.loader=a?new a(s):new o(s),u=Er(e),h=zt(s.fragLoadPolicy.default),p={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===e.sn?1/0:yr};e.stats=d.stats,d.load(u,p,{onSuccess:function(t,i,n,s){r.resetLoader(e,d);var a=t.data;n.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(a.slice(0,16)),a=a.slice(16)),c({frag:e,part:null,payload:a,networkDetails:s})},onError:function(t,s,a,o){r.resetLoader(e,d),l(new wr({type:E.NETWORK_ERROR,details:S.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:i({url:n,data:void 0},t),error:new Error("HTTP Error "+t.code+" "+t.text),networkDetails:a,stats:o}))},onAbort:function(t,i,n){r.resetLoader(e,d),l(new wr({type:E.NETWORK_ERROR,details:S.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:n,stats:t}))},onTimeout:function(t,i,n){r.resetLoader(e,d),l(new wr({type:E.NETWORK_ERROR,details:S.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error("Timeout after "+p.timeout+"ms"),networkDetails:n,stats:t}))},onProgress:function(r,i,n,s){t&&t({frag:e,part:null,payload:n,networkDetails:s})}})}}))},t.loadPart=function(e,t,r){var n=this;this.abort();var s=this.config,a=s.fLoader,o=s.loader;return new Promise((function(c,l){if(n.loader&&n.loader.destroy(),e.gap||t.gap)l(Sr(e,t));else{var d=n.loader=e.loader=a?new a(s):new o(s),u=Er(e,t),h=zt(s.fragLoadPolicy.default),p={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:yr};t.stats=d.stats,d.load(u,p,{onSuccess:function(i,s,a,o){n.resetLoader(e,d),n.updateStatsFromPart(e,t);var l={frag:e,part:t,payload:i.data,networkDetails:o};r(l),c(l)},onError:function(r,s,a,o){n.resetLoader(e,d),l(new wr({type:E.NETWORK_ERROR,details:S.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:i({url:u.url,data:void 0},r),error:new Error("HTTP Error "+r.code+" "+r.text),networkDetails:a,stats:o}))},onAbort:function(r,i,s){e.stats.aborted=t.stats.aborted,n.resetLoader(e,d),l(new wr({type:E.NETWORK_ERROR,details:S.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:s,stats:r}))},onTimeout:function(r,i,s){n.resetLoader(e,d),l(new wr({type:E.NETWORK_ERROR,details:S.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error("Timeout after "+p.timeout+"ms"),networkDetails:s,stats:r}))}})}}))},t.updateStatsFromPart=function(e,t){var r=e.stats,i=t.stats,n=i.total;if(r.loaded+=i.loaded,n){var s=Math.round(e.duration/t.duration),a=Math.min(Math.round(r.loaded/n),s),o=(s-a)*Math.round(r.loaded/a);r.total=r.loaded+o}else r.total=Math.max(r.loaded,r.total);var c=r.loading,l=i.loading;c.start?c.first+=l.first-l.start:(c.start=l.start,c.first=l.first),c.end=l.end},t.resetLoader=function(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()},e}();function Er(e,t){void 0===t&&(t=null);var r=t||e,i={frag:e,part:t,responseType:"arraybuffer",url:r.url,headers:{},rangeStart:0,rangeEnd:0},n=r.byteRangeStartOffset,s=r.byteRangeEndOffset;if(y(n)&&y(s)){var a,o=n,c=s;if("initSegment"===e.sn&&"AES-128"===(null==(a=e.decryptdata)?void 0:a.method)){var l=s-n;l%16&&(c=s+(16-l%16)),0!==n&&(i.resetIV=!0,o=n-16)}i.rangeStart=o,i.rangeEnd=c}return i}function Sr(e,t){var r=new Error("GAP "+(e.gap?"tag":"attribute")+" found"),i={type:E.MEDIA_ERROR,details:S.FRAG_GAP,fatal:!1,frag:e,error:r,networkDetails:null};return t&&(i.part=t),(t||e).stats.aborted=!0,new wr(i)}var wr=function(e){function t(t){var r;return(r=e.call(this,t.error.message)||this).data=void 0,r.data=t,r}return c(t,e),t}(h(Error)),Tr=function(){function e(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}var t=e.prototype;return t.abort=function(e){for(var t in this.keyUriToKeyInfo){var r=this.keyUriToKeyInfo[t].loader;if(r){if(e&&e!==r.context.frag.type)return;r.abort()}}},t.detach=function(){for(var e in this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}},t.destroy=function(){for(var e in this.detach(),this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}},t.createKeyLoadError=function(e,t,r,i,n){return void 0===t&&(t=S.KEY_LOAD_ERROR),new wr({type:E.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:n,error:r,networkDetails:i})},t.loadClear=function(e,t){var r=this;if(this.emeController&&this.config.emeEnabled)for(var i=e.sn,n=e.cc,s=function(){var e=t[a];if(n<=e.cc&&("initSegment"===i||"initSegment"===e.sn||i<e.sn))return r.emeController.selectKeySystemFormat(e).then((function(t){e.setKeyFormat(t)})),"break"},a=0;a<t.length&&"break"!==s();a++);},t.load=function(e){var t=this;return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then((function(r){return t.loadInternal(e,r)})):this.loadInternal(e)},t.loadInternal=function(e,t){var r,i;t&&e.setKeyFormat(t);var n=e.decryptdata;if(!n){var s=new Error(t?"Expected frag.decryptdata to be defined after setting format "+t:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,S.KEY_LOAD_ERROR,s))}var a=n.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,S.KEY_LOAD_ERROR,new Error('Invalid key URI: "'+a+'"')));var o,c=this.keyUriToKeyInfo[a];if(null!=(r=c)&&r.decryptdata.key)return n.key=c.decryptdata.key,Promise.resolve({frag:e,keyInfo:c});if(null!=(i=c)&&i.keyLoadPromise)switch(null==(o=c.mediaKeySessionContext)?void 0:o.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return c.keyLoadPromise.then((function(t){return n.key=t.keyInfo.decryptdata.key,{frag:e,keyInfo:c}}))}switch(c=this.keyUriToKeyInfo[a]={decryptdata:n,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},n.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===n.keyFormat?this.loadKeyHTTP(c,e):this.loadKeyEME(c,e);case"AES-128":return this.loadKeyHTTP(c,e);default:return Promise.reject(this.createKeyLoadError(e,S.KEY_LOAD_ERROR,new Error('Key supplied with unsupported METHOD: "'+n.method+'"')))}},t.loadKeyEME=function(e,t){var r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var i=this.emeController.loadKey(r);if(i)return(e.keyLoadPromise=i.then((function(t){return e.mediaKeySessionContext=t,r}))).catch((function(t){throw e.keyLoadPromise=null,t}))}return Promise.resolve(r)},t.loadKeyHTTP=function(e,t){var r=this,n=this.config,s=new(0,n.loader)(n);return t.keyLoader=e.loader=s,e.keyLoadPromise=new Promise((function(a,o){var c={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},l=n.keyLoadPolicy.default,d={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},u={onSuccess:function(e,t,i,n){var s=i.frag,c=i.keyInfo,l=i.url;if(!s.decryptdata||c!==r.keyUriToKeyInfo[l])return o(r.createKeyLoadError(s,S.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),n));c.decryptdata.key=s.decryptdata.key=new Uint8Array(e.data),s.keyLoader=null,c.loader=null,a({frag:s,keyInfo:c})},onError:function(e,n,s,a){r.resetLoader(n),o(r.createKeyLoadError(t,S.KEY_LOAD_ERROR,new Error("HTTP Error "+e.code+" loading key "+e.text),s,i({url:c.url,data:void 0},e)))},onTimeout:function(e,i,n){r.resetLoader(i),o(r.createKeyLoadError(t,S.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),n))},onAbort:function(e,i,n){r.resetLoader(i),o(r.createKeyLoadError(t,S.INTERNAL_ABORTED,new Error("key loading aborted"),n))}};s.load(c,d,u)}))},t.resetLoader=function(e){var t=e.frag,r=e.keyInfo,i=e.url,n=r.loader;t.keyLoader===n&&(t.keyLoader=null,r.loader=null),delete this.keyUriToKeyInfo[i],n&&n.destroy()},e}(),Rr=function(){function e(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var t=e.prototype;return t.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},t.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},t.onHandlerDestroyed=function(){},t.hasInterval=function(){return!!this._tickInterval},t.hasNextTick=function(){return!!this._tickTimer},t.setInterval=function(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)},t.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},t.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},t.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},t.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},t.doTick=function(){},e}(),Cr={length:0,start:function(){return 0},end:function(){return 0}},Ar=function(){function e(){}return e.isBuffered=function(t,r){try{if(t)for(var i=e.getBuffered(t),n=0;n<i.length;n++)if(r>=i.start(n)&&r<=i.end(n))return!0}catch(e){}return!1},e.bufferInfo=function(t,r,i){try{if(t){var n,s=e.getBuffered(t),a=[];for(n=0;n<s.length;n++)a.push({start:s.start(n),end:s.end(n)});return this.bufferedInfo(a,r,i)}}catch(e){}return{len:0,start:r,end:r,nextStart:void 0}},e.bufferedInfo=function(e,t,r){t=Math.max(0,t),e.sort((function(e,t){return e.start-t.start||t.end-e.end}));var i=[];if(r)for(var n=0;n<e.length;n++){var s=i.length;if(s){var a=i[s-1].end;e[n].start-a<r?e[n].end>a&&(i[s-1].end=e[n].end):i.push(e[n])}else i.push(e[n])}else i=e;for(var o,c=0,l=t,d=t,u=0;u<i.length;u++){var h=i[u].start,p=i[u].end;if(t+r>=h&&t<p)l=h,c=(d=p)-t;else if(t+r<h){o=h;break}}return{len:c,start:l||0,end:d||0,nextStart:o}},e.getBuffered=function(e){try{return e.buffered}catch(e){return P.log("failed to get media.buffered",e),Cr}},e}(),Pr=function(e,t,r,i,n,s){void 0===i&&(i=0),void 0===n&&(n=-1),void 0===s&&(s=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=e,this.sn=t,this.id=r,this.size=i,this.part=n,this.partial=s};function Dr(e,t){for(var r=null,i=0,n=e.length;i<n;i++){var s=e[i];if(s&&s.cc===t){r=s;break}}return r}function Lr(e,t){if(e){var r=e.start+t;e.start=e.startPTS=r,e.endPTS=r+e.duration}}function kr(e,t){for(var r=t.fragments,i=0,n=r.length;i<n;i++)Lr(r[i],e);t.fragmentHint&&Lr(t.fragmentHint,e),t.alignedSliding=!0}function Ir(e,t,r){t&&(function(e,t,r){if(function(e,t,r){return!(!t.details||!(r.endCC>r.startCC||e&&e.cc<r.startCC))}(e,r,t)){var i=function(e,t,r){var i=e.fragments,n=t.fragments;if(n.length&&i.length){var s=Dr(i,n[0].cc);if(s&&(!s||s.startPTS))return s;P.log("No frag in previous level to align on")}else P.log("No fragments to align")}(r.details,t);i&&y(i.start)&&(P.log("Adjusting PTS using last level due to CC increase within current level "+t.url),kr(i.start,t))}}(e,r,t),!r.alignedSliding&&t.details&&function(e,t){if(t.fragments.length&&e.hasProgramDateTime&&t.hasProgramDateTime){var r=t.fragments[0].programDateTime,i=e.fragments[0].programDateTime,n=(i-r)/1e3+t.fragments[0].start;n&&y(n)&&(P.log("Adjusting PTS using programDateTime delta "+(i-r)+"ms, sliding:"+n.toFixed(3)+" "+e.url+" "),kr(n,e))}}(r,t.details),r.alignedSliding||!t.details||r.skippedSegments||Ut(t.details,r))}function Or(e,t){if(e.hasProgramDateTime&&t.hasProgramDateTime){var r=e.fragments,i=t.fragments;if(r.length&&i.length){var n=i[Math.round(i.length/2)-1],s=Dr(r,n.cc)||r[Math.round(r.length/2)-1],a=n.programDateTime,o=s.programDateTime;null!==a&&null!==o&&kr((o-a)/1e3-(s.start-n.start),e)}}}var Mr=function(){function e(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}return e.prototype.decrypt=function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)},e}(),xr=function(){function e(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}return e.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},e}();var Nr=function(){function e(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var t=e.prototype;return t.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),r=new Uint32Array(4),i=0;i<4;i++)r[i]=t.getUint32(4*i);return r},t.initTable=function(){var e=this.sBox,t=this.invSBox,r=this.subMix,i=r[0],n=r[1],s=r[2],a=r[3],o=this.invSubMix,c=o[0],l=o[1],d=o[2],u=o[3],h=new Uint32Array(256),p=0,f=0,m=0;for(m=0;m<256;m++)h[m]=m<128?m<<1:m<<1^283;for(m=0;m<256;m++){var g=f^f<<1^f<<2^f<<3^f<<4;g=g>>>8^255&g^99,e[p]=g,t[g]=p;var v=h[p],_=h[v],y=h[_],b=257*h[g]^16843008*g;i[p]=b<<24|b>>>8,n[p]=b<<16|b>>>16,s[p]=b<<8|b>>>24,a[p]=b,b=16843009*y^65537*_^257*v^16843008*p,c[g]=b<<24|b>>>8,l[g]=b<<16|b>>>16,d[g]=b<<8|b>>>24,u[g]=b,p?(p=v^h[h[h[y^v]]],f^=h[h[f]]):p=f=1}},t.expandKey=function(e){for(var t=this.uint8ArrayToUint32Array_(e),r=!0,i=0;i<t.length&&r;)r=t[i]===this.key[i],i++;if(!r){this.key=t;var n=this.keySize=t.length;if(4!==n&&6!==n&&8!==n)throw new Error("Invalid aes key size="+n);var s,a,o,c,l=this.ksRows=4*(n+6+1),d=this.keySchedule=new Uint32Array(l),u=this.invKeySchedule=new Uint32Array(l),h=this.sBox,p=this.rcon,f=this.invSubMix,m=f[0],g=f[1],v=f[2],_=f[3];for(s=0;s<l;s++)s<n?o=d[s]=t[s]:(c=o,s%n==0?(c=h[(c=c<<8|c>>>24)>>>24]<<24|h[c>>>16&255]<<16|h[c>>>8&255]<<8|h[255&c],c^=p[s/n|0]<<24):n>6&&s%n==4&&(c=h[c>>>24]<<24|h[c>>>16&255]<<16|h[c>>>8&255]<<8|h[255&c]),d[s]=o=(d[s-n]^c)>>>0);for(a=0;a<l;a++)s=l-a,c=3&a?d[s]:d[s-4],u[a]=a<4||s<=4?c:m[h[c>>>24]]^g[h[c>>>16&255]]^v[h[c>>>8&255]]^_[h[255&c]],u[a]=u[a]>>>0}},t.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},t.decrypt=function(e,t,r){for(var i,n,s,a,o,c,l,d,u,h,p,f,m,g,v=this.keySize+6,_=this.invKeySchedule,y=this.invSBox,b=this.invSubMix,E=b[0],S=b[1],w=b[2],T=b[3],R=this.uint8ArrayToUint32Array_(r),C=R[0],A=R[1],P=R[2],D=R[3],L=new Int32Array(e),k=new Int32Array(L.length),I=this.networkToHostOrderSwap;t<L.length;){for(u=I(L[t]),h=I(L[t+1]),p=I(L[t+2]),f=I(L[t+3]),o=u^_[0],c=f^_[1],l=p^_[2],d=h^_[3],m=4,g=1;g<v;g++)i=E[o>>>24]^S[c>>16&255]^w[l>>8&255]^T[255&d]^_[m],n=E[c>>>24]^S[l>>16&255]^w[d>>8&255]^T[255&o]^_[m+1],s=E[l>>>24]^S[d>>16&255]^w[o>>8&255]^T[255&c]^_[m+2],a=E[d>>>24]^S[o>>16&255]^w[c>>8&255]^T[255&l]^_[m+3],o=i,c=n,l=s,d=a,m+=4;i=y[o>>>24]<<24^y[c>>16&255]<<16^y[l>>8&255]<<8^y[255&d]^_[m],n=y[c>>>24]<<24^y[l>>16&255]<<16^y[d>>8&255]<<8^y[255&o]^_[m+1],s=y[l>>>24]<<24^y[d>>16&255]<<16^y[o>>8&255]<<8^y[255&c]^_[m+2],a=y[d>>>24]<<24^y[o>>16&255]<<16^y[c>>8&255]<<8^y[255&l]^_[m+3],k[t]=I(i^C),k[t+1]=I(a^A),k[t+2]=I(s^P),k[t+3]=I(n^D),C=u,A=h,P=p,D=f,t+=4}return k.buffer},e}(),Fr=function(){function e(e,t){var r=(void 0===t?{}:t).removePKCS7Padding,i=void 0===r||r;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=i,i)try{var n=self.crypto;n&&(this.subtle=n.subtle||n.webkitSubtle)}catch(e){}null===this.subtle&&(this.useSoftware=!0)}var t=e.prototype;return t.destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},t.isSync=function(){return this.useSoftware},t.flush=function(){var e=this.currentResult,t=this.remainderData;if(!e||t)return this.reset(),null;var r,i,n,s=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?(i=(r=s).byteLength,(n=i&&new DataView(r.buffer).getUint8(i-1))?te(r,0,i-n):r):s},t.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},t.decrypt=function(e,t,r){var i=this;return this.useSoftware?new Promise((function(n,s){i.softwareDecrypt(new Uint8Array(e),t,r);var a=i.flush();a?n(a.buffer):s(new Error("[softwareDecrypt] Failed to decrypt data"))})):this.webCryptoDecrypt(new Uint8Array(e),t,r)},t.softwareDecrypt=function(e,t,r){var i=this.currentIV,n=this.currentResult,s=this.remainderData;this.logOnce("JS AES decrypt"),s&&(e=Ie(s,e),this.remainderData=null);var a=this.getValidChunk(e);if(!a.length)return null;i&&(r=i);var o=this.softwareDecrypter;o||(o=this.softwareDecrypter=new Nr),o.expandKey(t);var c=n;return this.currentResult=o.decrypt(a.buffer,0,r),this.currentIV=te(a,-16).buffer,c||null},t.webCryptoDecrypt=function(e,t,r){var i=this,n=this.subtle;return this.key===t&&this.fastAesKey||(this.key=t,this.fastAesKey=new xr(n,t)),this.fastAesKey.expandKey().then((function(t){return n?(i.logOnce("WebCrypto AES decrypt"),new Mr(n,new Uint8Array(r)).decrypt(e.buffer,t)):Promise.reject(new Error("web crypto not initialized"))})).catch((function(n){return P.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+n.name+": "+n.message),i.onWebCryptoError(e,t,r)}))},t.onWebCryptoError=function(e,t,r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r);var i=this.flush();if(i)return i.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")},t.getValidChunk=function(e){var t=e,r=e.length-e.length%16;return r!==e.length&&(t=te(e,0,r),this.remainderData=te(e,r)),t},t.logOnce=function(e){this.logEnabled&&(P.log("[decrypter]: "+e),this.logEnabled=!1)},e}(),Br=function(e){for(var t="",r=e.length,i=0;i<r;i++)t+="["+e.start(i).toFixed(3)+"-"+e.end(i).toFixed(3)+"]";return t},jr="STOPPED",Ur="IDLE",Vr="KEY_LOADING",Gr="FRAG_LOADING",Hr="FRAG_LOADING_WAITING_RETRY",Kr="WAITING_TRACK",qr="PARSING",Wr="PARSED",zr="ENDED",$r="ERROR",Yr="WAITING_INIT_PTS",Qr="WAITING_LEVEL",Jr=function(e){function t(t,r,i,n,s){var a;return(a=e.call(this)||this).hls=void 0,a.fragPrevious=null,a.fragCurrent=null,a.fragmentTracker=void 0,a.transmuxer=null,a._state=jr,a.playlistType=void 0,a.media=null,a.mediaBuffer=null,a.config=void 0,a.bitrateTest=!1,a.lastCurrentTime=0,a.nextLoadPosition=0,a.startPosition=0,a.startTimeOffset=null,a.loadedmetadata=!1,a.retryDate=0,a.levels=null,a.fragmentLoader=void 0,a.keyLoader=void 0,a.levelLastLoaded=null,a.startFragRequested=!1,a.decrypter=void 0,a.initPTS=[],a.onvseeking=null,a.onvended=null,a.logPrefix="",a.log=void 0,a.warn=void 0,a.playlistType=s,a.logPrefix=n,a.log=P.log.bind(P,n+":"),a.warn=P.warn.bind(P,n+":"),a.hls=t,a.fragmentLoader=new br(t.config),a.keyLoader=i,a.fragmentTracker=r,a.config=t.config,a.decrypter=new Fr(t.config),t.on(b.MANIFEST_LOADED,a.onManifestLoaded,function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(a)),a}c(t,e);var r=t.prototype;return r.doTick=function(){this.onTickEnd()},r.onTickEnd=function(){},r.startLoad=function(e){},r.stopLoad=function(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);var e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=jr},r._streamEnded=function(e,t){if(t.live||e.nextStart||!e.end||!this.media)return!1;var r=t.partList;if(null!=r&&r.length){var i=r[r.length-1];return Ar.isBuffered(this.media,i.start+i.duration/2)}var n=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(n)},r.getLevelDetails=function(){var e;if(this.levels&&null!==this.levelLastLoaded)return null==(e=this.levels[this.levelLastLoaded])?void 0:e.details},r.onMediaAttached=function(e,t){var r=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),r.addEventListener("seeking",this.onvseeking),r.addEventListener("ended",this.onvended);var i=this.config;this.levels&&i.autoStartLoad&&this.state===jr&&this.startLoad(i.startPosition)},r.onMediaDetaching=function(){var e=this.media;null!=e&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},r.onMediaSeeking=function(){var e=this.config,t=this.fragCurrent,r=this.media,i=this.mediaBuffer,n=this.state,s=r?r.currentTime:0,a=Ar.bufferInfo(i||r,s,e.maxBufferHole);if(this.log("media seeking to "+(y(s)?s.toFixed(3):s)+", state: "+n),this.state===zr)this.resetLoadingState();else if(t){var o=e.maxFragLookUpTolerance,c=t.start-o,l=t.start+t.duration+o;if(!a.len||l<a.start||c>a.end){var d=s>l;(s<c||d)&&(d&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}r&&(this.fragmentTracker.removeFragmentsInRange(s,1/0,this.playlistType,!0),this.lastCurrentTime=s),this.loadedmetadata||a.len||(this.nextLoadPosition=this.startPosition=s),this.tickImmediate()},r.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},r.onManifestLoaded=function(e,t){this.startTimeOffset=t.startTimeOffset,this.initPTS=[]},r.onHandlerDestroying=function(){this.stopLoad(),e.prototype.onHandlerDestroying.call(this)},r.onHandlerDestroyed=function(){this.state=jr,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,e.prototype.onHandlerDestroyed.call(this)},r.loadFragment=function(e,t,r){this._loadFragForPlayback(e,t,r)},r._loadFragForPlayback=function(e,t,r){var i=this;this._doFragLoad(e,t,r,(function(t){if(i.fragContextChanged(e))return i.warn("Fragment "+e.sn+(t.part?" p: "+t.part.index:"")+" of level "+e.level+" was dropped during download."),void i.fragmentTracker.removeFragment(e);e.stats.chunkCount++,i._handleFragmentLoadProgress(t)})).then((function(t){if(t){var r=i.state;i.fragContextChanged(e)?(r===Gr||!i.fragCurrent&&r===qr)&&(i.fragmentTracker.removeFragment(e),i.state=Ur):("payload"in t&&(i.log("Loaded fragment "+e.sn+" of level "+e.level),i.hls.trigger(b.FRAG_LOADED,t)),i._handleFragmentLoadComplete(t))}})).catch((function(t){i.state!==jr&&i.state!==$r&&(i.warn(t),i.resetFragmentLoading(e))}))},r.clearTrackerIfNeeded=function(e){var t,r=this.fragmentTracker;if(r.getState(e)===pr){var i=e.type,n=this.getFwdBufferInfo(this.mediaBuffer,i),s=Math.max(e.duration,n?n.len:this.config.maxBufferLength);this.reduceMaxBufferLength(s)&&r.removeFragment(e)}else 0===(null==(t=this.mediaBuffer)?void 0:t.buffered.length)?r.removeAllFragments():r.hasParts(e.type)&&(r.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),r.getState(e)===fr&&r.removeFragment(e))},r.flushMainBuffer=function(e,t,r){if(void 0===r&&(r=null),e-t){var i={startOffset:e,endOffset:t,type:r};this.hls.trigger(b.BUFFER_FLUSHING,i)}},r._loadInitSegment=function(e,t){var r=this;this._doFragLoad(e,t).then((function(t){if(!t||r.fragContextChanged(e)||!r.levels)throw new Error("init load aborted");return t})).then((function(t){var i=r.hls,n=t.payload,s=e.decryptdata;if(n&&n.byteLength>0&&s&&s.key&&s.iv&&"AES-128"===s.method){var a=self.performance.now();return r.decrypter.decrypt(new Uint8Array(n),s.key.buffer,s.iv.buffer).catch((function(t){throw i.trigger(b.ERROR,{type:E.MEDIA_ERROR,details:S.FRAG_DECRYPT_ERROR,fatal:!1,error:t,reason:t.message,frag:e}),t})).then((function(r){var n=self.performance.now();return i.trigger(b.FRAG_DECRYPTED,{frag:e,payload:r,stats:{tstart:a,tdecrypt:n}}),t.payload=r,t}))}return t})).then((function(i){var n=r.fragCurrent,s=r.hls;if(!r.levels)throw new Error("init load aborted, missing levels");var a=e.stats;r.state=Ur,t.fragmentError=0,e.data=new Uint8Array(i.payload),a.parsing.start=a.buffering.start=self.performance.now(),a.parsing.end=a.buffering.end=self.performance.now(),i.frag===n&&s.trigger(b.FRAG_BUFFERED,{stats:a,frag:n,part:null,id:e.type}),r.tick()})).catch((function(t){r.state!==jr&&r.state!==$r&&(r.warn(t),r.resetFragmentLoading(e))}))},r.fragContextChanged=function(e){var t=this.fragCurrent;return!e||!t||e.level!==t.level||e.sn!==t.sn||e.urlId!==t.urlId},r.fragBufferedComplete=function(e,t){var r,i,n,s,a=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+e.type+" sn: "+e.sn+(t?" part: "+t.index:"")+" of "+(this.playlistType===pt?"level":"track")+" "+e.level+" (frag:["+(null!=(r=e.startPTS)?r:NaN).toFixed(3)+"-"+(null!=(i=e.endPTS)?i:NaN).toFixed(3)+"] > buffer:"+(a?Br(Ar.getBuffered(a)):"(detached)")+")"),this.state=Ur,a&&(!this.loadedmetadata&&e.type==pt&&a.buffered.length&&(null==(n=this.fragCurrent)?void 0:n.sn)===(null==(s=this.fragPrevious)?void 0:s.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},r.seekToStartPos=function(){},r._handleFragmentLoadComplete=function(e){var t=this.transmuxer;if(t){var r=e.frag,i=e.part,n=e.partsLoaded,s=!n||0===n.length||n.some((function(e){return!e})),a=new Pr(r.level,r.sn,r.stats.chunkCount+1,0,i?i.index:-1,!s);t.flush(a)}},r._handleFragmentLoadProgress=function(e){},r._doFragLoad=function(e,t,r,i){var n,s=this;void 0===r&&(r=null);var a=null==t?void 0:t.details;if(!this.levels||!a)throw new Error("frag load aborted, missing level"+(a?"":" detail")+"s");var o=null;if(!e.encrypted||null!=(n=e.decryptdata)&&n.key?!e.encrypted&&a.encryptedFragments.length&&this.keyLoader.loadClear(e,a.encryptedFragments):(this.log("Loading key for "+e.sn+" of ["+a.startSN+"-"+a.endSN+"], "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+e.level),this.state=Vr,this.fragCurrent=e,o=this.keyLoader.load(e).then((function(e){if(!s.fragContextChanged(e.frag))return s.hls.trigger(b.KEY_LOADED,e),s.state===Vr&&(s.state=Ur),e})),this.hls.trigger(b.KEY_LOADING,{frag:e}),null===this.fragCurrent&&(o=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))),r=Math.max(e.start,r||0),this.config.lowLatencyMode&&"initSegment"!==e.sn){var c=a.partList;if(c&&i){r>e.end&&a.fragmentHint&&(e=a.fragmentHint);var l=this.getNextPart(c,e,r);if(l>-1){var d,u=c[l];return this.log("Loading part sn: "+e.sn+" p: "+u.index+" cc: "+e.cc+" of playlist ["+a.startSN+"-"+a.endSN+"] parts [0-"+l+"-"+(c.length-1)+"] "+("[stream-controller]"===this.logPrefix?"level":"track")+": "+e.level+", target: "+parseFloat(r.toFixed(3))),this.nextLoadPosition=u.start+u.duration,this.state=Gr,d=o?o.then((function(r){return!r||s.fragContextChanged(r.frag)?null:s.doFragPartsLoad(e,u,t,i)})).catch((function(e){return s.handleFragLoadError(e)})):this.doFragPartsLoad(e,u,t,i).catch((function(e){return s.handleFragLoadError(e)})),this.hls.trigger(b.FRAG_LOADING,{frag:e,part:u,targetBufferTime:r}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):d}if(!e.url||this.loadedEndOfParts(c,r))return Promise.resolve(null)}}this.log("Loading fragment "+e.sn+" cc: "+e.cc+" "+(a?"of ["+a.startSN+"-"+a.endSN+"] ":"")+("[stream-controller]"===this.logPrefix?"level":"track")+": "+e.level+", target: "+parseFloat(r.toFixed(3))),y(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=Gr;var h,p=this.config.progressive;return h=p&&o?o.then((function(t){return!t||s.fragContextChanged(null==t?void 0:t.frag)?null:s.fragmentLoader.load(e,i)})).catch((function(e){return s.handleFragLoadError(e)})):Promise.all([this.fragmentLoader.load(e,p?i:void 0),o]).then((function(e){var t=e[0];return!p&&t&&i&&i(t),t})).catch((function(e){return s.handleFragLoadError(e)})),this.hls.trigger(b.FRAG_LOADING,{frag:e,targetBufferTime:r}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):h},r.doFragPartsLoad=function(e,t,r,i){var n=this;return new Promise((function(s,a){var o,c=[],l=null==(o=r.details)?void 0:o.partList;!function t(o){n.fragmentLoader.loadPart(e,o,i).then((function(i){c[o.index]=i;var a=i.part;n.hls.trigger(b.FRAG_LOADED,i);var d=Gt(r,e.sn,o.index+1)||Ht(l,e.sn,o.index+1);if(!d)return s({frag:e,part:a,partsLoaded:c});t(d)})).catch(a)}(t)}))},r.handleFragLoadError=function(e){if("data"in e){var t=e.data;e.data&&t.details===S.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(b.ERROR,t)}else this.hls.trigger(b.ERROR,{type:E.OTHER_ERROR,details:S.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null},r._handleTransmuxerFlush=function(e){var t=this.getCurrentContext(e);if(t&&this.state===qr){var r=t.frag,i=t.part,n=t.level,s=self.performance.now();r.stats.parsing.end=s,i&&(i.stats.parsing.end=s),this.updateLevelTiming(r,i,n,e.partial)}else this.fragCurrent||this.state===jr||this.state===$r||(this.state=Ur)},r.getCurrentContext=function(e){var t=this.levels,r=this.fragCurrent,i=e.level,n=e.sn,s=e.part;if(null==t||!t[i])return this.warn("Levels object was unset while buffering fragment "+n+" of level "+i+". The current chunk will not be buffered."),null;var a=t[i],o=s>-1?Gt(a,n,s):null,c=o?o.fragment:function(e,t,r){if(null==e||!e.details)return null;var i=e.details,n=i.fragments[t-i.startSN];return n||((n=i.fragmentHint)&&n.sn===t?n:t<i.startSN&&r&&r.sn===t?r:null)}(a,n,r);return c?(r&&r!==c&&(c.stats=r.stats),{frag:c,part:o,level:a}):null},r.bufferFragmentData=function(e,t,r,i){var n;if(e&&this.state===qr){var s=e.data1,a=e.data2,o=s;if(s&&a&&(o=Ie(s,a)),null!=(n=o)&&n.length){var c={type:e.type,frag:t,part:r,chunkMeta:i,parent:t.type,data:o};this.hls.trigger(b.BUFFER_APPENDING,c),e.dropped&&e.independent&&!r&&this.flushBufferGap(t)}}},r.flushBufferGap=function(e){var t=this.media;if(t)if(Ar.isBuffered(t,t.currentTime)){var r=t.currentTime,i=Ar.bufferInfo(t,r,0),n=e.duration,s=Math.min(2*this.config.maxFragLookUpTolerance,.25*n),a=Math.max(Math.min(e.start-s,i.end-s),r+s);e.start-a>s&&this.flushMainBuffer(a,e.start)}else this.flushMainBuffer(0,e.start)},r.getFwdBufferInfo=function(e,t){var r=this.getLoadPosition();return y(r)?this.getFwdBufferInfoAtPos(e,r,t):null},r.getFwdBufferInfoAtPos=function(e,t,r){var i=this.config.maxBufferHole,n=Ar.bufferInfo(e,t,i);if(0===n.len&&void 0!==n.nextStart){var s=this.fragmentTracker.getBufferedFrag(t,r);if(s&&n.nextStart<s.end)return Ar.bufferInfo(e,t,Math.max(n.nextStart,i))}return n},r.getMaxBufferLength=function(e){var t,r=this.config;return t=e?Math.max(8*r.maxBufferSize/e,r.maxBufferLength):r.maxBufferLength,Math.min(t,r.maxMaxBufferLength)},r.reduceMaxBufferLength=function(e){var t=this.config,r=e||t.maxBufferLength;return t.maxMaxBufferLength>=r&&(t.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+t.maxMaxBufferLength+"s"),!0)},r.getAppendedFrag=function(e,t){var r=this.fragmentTracker.getAppendedFrag(e,pt);return r&&"fragment"in r?r.fragment:r},r.getNextFragment=function(e,t){var r=t.fragments,i=r.length;if(!i)return null;var n,s=this.config,a=r[0].start;if(t.live){var o=s.initialLiveManifestSize;if(i<o)return this.warn("Not enough fragments to start playback (have: "+i+", need: "+o+")"),null;t.PTSKnown||this.startFragRequested||-1!==this.startPosition||(n=this.getInitialLiveFragment(t,r),this.startPosition=n?this.hls.liveSyncPosition||n.start:e)}else e<=a&&(n=r[0]);if(!n){var c=s.lowLatencyMode?t.partEnd:t.fragmentEnd;n=this.getFragmentAtPosition(e,c,t)}return this.mapToInitFragWhenRequired(n)},r.isLoopLoading=function(e,t){var r=this.fragmentTracker.getState(e);return(r===mr||r===fr&&!!e.gap)&&this.nextLoadPosition>t},r.getNextFragmentLoopLoading=function(e,t,r,i,n){var s=e.gap,a=this.getNextFragment(this.nextLoadPosition,t);if(null===a)return a;if(e=a,s&&e&&!e.gap&&r.nextStart){var o=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,r.nextStart,i);if(null!==o&&r.len+o.len>=n)return this.log('buffer full after gaps in "'+i+'" playlist starting at sn: '+e.sn),null}return e},r.mapToInitFragWhenRequired=function(e){return null==e||!e.initSegment||null!=e&&e.initSegment.data||this.bitrateTest?e:e.initSegment},r.getNextPart=function(e,t,r){for(var i=-1,n=!1,s=!0,a=0,o=e.length;a<o;a++){var c=e[a];if(s=s&&!c.independent,i>-1&&r<c.start)break;var l=c.loaded;l?i=-1:(n||c.independent||s)&&c.fragment===t&&(i=a),n=l}return i},r.loadedEndOfParts=function(e,t){var r=e[e.length-1];return r&&t>r.start&&r.loaded},r.getInitialLiveFragment=function(e,t){var r=this.fragPrevious,i=null;if(r){if(e.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+r.programDateTime),i=function(e,t,r){if(null===t||!Array.isArray(e)||!e.length||!y(t))return null;if(t<(e[0].programDateTime||0))return null;if(t>=(e[e.length-1].endProgramDateTime||0))return null;r=r||0;for(var i=0;i<e.length;++i){var n=e[i];if(Xt(t,r,n))return n}return null}(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){var n=r.sn+1;if(n>=e.startSN&&n<=e.endSN){var s=t[n-e.startSN];r.cc===s.cc&&(i=s,this.log("Live playlist, switching playlist, load frag with next SN: "+i.sn))}i||(i=function(e,t){return Yt.search(e,(function(e){return e.cc<t?1:e.cc>t?-1:0}))}(t,r.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+i.sn)}}else{var a=this.hls.liveSyncPosition;null!==a&&(i=this.getFragmentAtPosition(a,this.bitrateTest?e.fragmentEnd:e.edge,e))}return i},r.getFragmentAtPosition=function(e,t,r){var i,n=this.config,s=this.fragPrevious,a=r.fragments,o=r.endSN,c=r.fragmentHint,l=n.maxFragLookUpTolerance,d=r.partList,u=!!(n.lowLatencyMode&&null!=d&&d.length&&c);if(u&&c&&!this.bitrateTest&&(a=a.concat(c),o=c.sn),i=e<t?Qt(s,a,e,e>t-l?0:l):a[a.length-1]){var h=i.sn-r.startSN,p=this.fragmentTracker.getState(i);if((p===mr||p===fr&&i.gap)&&(s=i),s&&i.sn===s.sn&&(!u||d[0].fragment.sn>i.sn)&&s&&i.level===s.level){var f=a[h+1];i=i.sn<o&&this.fragmentTracker.getState(f)!==mr?f:null}}return i},r.synchronizeToLiveEdge=function(e){var t=this.config,r=this.media;if(r){var i=this.hls.liveSyncPosition,n=r.currentTime,s=e.fragments[0].start,a=e.edge,o=n>=s-t.maxFragLookUpTolerance&&n<=a;if(null!==i&&r.duration>i&&(n<i||!o)){var c=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!o&&r.readyState<4||n<a-c)&&(this.loadedmetadata||(this.nextLoadPosition=i),r.readyState&&(this.warn("Playback: "+n.toFixed(3)+" is located too far from the end of live sliding playlist: "+a+", reset currentTime to : "+i.toFixed(3)),r.currentTime=i))}}},r.alignPlaylists=function(e,t){var r=this.levels,i=this.levelLastLoaded,n=this.fragPrevious,s=null!==i?r[i]:null,a=e.fragments.length;if(!a)return this.warn("No fragments in live playlist"),0;var o=e.fragments[0].start,c=!t,l=e.alignedSliding&&y(o);if(c||!l&&!o){Ir(n,s,e);var d=e.fragments[0].start;return this.log("Live playlist sliding: "+d.toFixed(2)+" start-sn: "+(t?t.startSN:"na")+"->"+e.startSN+" prev-sn: "+(n?n.sn:"na")+" fragments: "+a),d}return o},r.waitForCdnTuneIn=function(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)},r.setStartPosition=function(e,t){var r=this.startPosition;if(r<t&&(r=-1),-1===r||-1===this.lastCurrentTime){var i=null!==this.startTimeOffset,n=i?this.startTimeOffset:e.startTimeOffset;null!==n&&y(n)?(r=t+n,n<0&&(r+=e.totalduration),r=Math.min(Math.max(t,r),t+e.totalduration),this.log("Start time offset "+n+" found in "+(i?"multivariant":"media")+" playlist, adjust startPosition to "+r),this.startPosition=r):e.live?r=this.hls.liveSyncPosition||t:this.startPosition=r=0,this.lastCurrentTime=r}this.nextLoadPosition=r},r.getLoadPosition=function(){var e=this.media,t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t},r.handleFragLoadAborted=function(e,t){this.transmuxer&&"initSegment"!==e.sn&&e.stats.aborted&&(this.warn("Fragment "+e.sn+(t?" part "+t.index:"")+" of level "+e.level+" was aborted"),this.resetFragmentLoading(e))},r.resetFragmentLoading=function(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===Hr)||(this.state=Ur)},r.onFragmentOrKeyLoadError=function(e,t){if(t.chunkMeta&&!t.frag){var r=this.getCurrentContext(t.chunkMeta);r&&(t.frag=r.frag)}var i=t.frag;if(i&&i.type===e&&this.levels)if(this.fragContextChanged(i)){var n;this.warn("Frag load error must match current frag to retry "+i.url+" > "+(null==(n=this.fragCurrent)?void 0:n.url))}else{var s=t.details===S.FRAG_GAP;s&&this.fragmentTracker.fragBuffered(i,!0);var a=t.errorAction,o=a||{},c=o.action,l=o.retryCount,d=void 0===l?0:l,u=o.retryConfig;if(a&&c===rr&&u){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var h=Wt(u,d);this.warn("Fragment "+i.sn+" of "+e+" "+i.level+" errored with "+t.details+", retrying loading "+(d+1)+"/"+u.maxNumRetry+" in "+h+"ms"),a.resolved=!0,this.retryDate=self.performance.now()+h,this.state=Hr}else u&&a?(this.resetFragmentErrors(e),d<u.maxNumRetry?s||(a.resolved=!0):P.warn(t.details+" reached or exceeded max retry ("+d+")")):this.state=$r;this.tickImmediate()}},r.reduceLengthAndFlushBuffer=function(e){if(this.state===qr||this.state===Wr){var t=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,t),i=r&&r.len>.5;i&&this.reduceMaxBufferLength(r.len);var n=!i;return n&&this.warn("Buffer full error while media.currentTime is not buffered, flush "+t+" buffer"),e.frag&&(this.fragmentTracker.removeFragment(e.frag),this.nextLoadPosition=e.frag.start),this.resetLoadingState(),n}return!1},r.resetFragmentErrors=function(e){e===ft&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==jr&&(this.state=Ur)},r.afterBufferFlushed=function(e,t,r){if(e){var i=Ar.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,i,r),this.state===zr&&this.resetLoadingState()}},r.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=Ur},r.resetStartWhenNotLoaded=function(e){if(!this.loadedmetadata){this.startFragRequested=!1;var t=this.levels?this.levels[e].details:null;null!=t&&t.live?(this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},r.resetWhenMissingContext=function(e){this.warn("The loading context changed while buffering fragment "+e.sn+" of level "+e.level+". This chunk will not be buffered."),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(e.level),this.resetLoadingState()},r.removeUnbufferedFrags=function(e){void 0===e&&(e=0),this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)},r.updateLevelTiming=function(e,t,r,i){var n,s=this,a=r.details;if(a){if(Object.keys(e.elementaryStreams).reduce((function(t,n){var o=e.elementaryStreams[n];if(o){var c=o.endPTS-o.startPTS;if(c<=0)return s.warn("Could not parse fragment "+e.sn+" "+n+" duration reliably ("+c+")"),t||!1;var l=i?0:Bt(a,e,o.startPTS,o.endPTS,o.startDTS,o.endDTS);return s.hls.trigger(b.LEVEL_PTS_UPDATED,{details:a,level:r,drift:l,type:n,frag:e,start:o.startPTS,end:o.endPTS}),!0}return t}),!1))r.fragmentError=0;else if(null===(null==(n=this.transmuxer)?void 0:n.error)){var o=new Error("Found no media in fragment "+e.sn+" of level "+r.id+" resetting transmuxer to fallback to playlist timing");if(this.warn(o.message),this.hls.trigger(b.ERROR,{type:E.MEDIA_ERROR,details:S.FRAG_PARSING_ERROR,fatal:!1,error:o,frag:e,reason:"Found no media in msn "+e.sn+' of level "'+r.url+'"'}),!this.hls)return;this.resetTransmuxer()}this.state=Wr,this.hls.trigger(b.FRAG_PARSED,{frag:e,part:t})}else this.warn("level.details undefined")},r.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},r.recoverWorkerError=function(e){"demuxerWorker"===e.event&&(this.resetTransmuxer(),this.resetLoadingState())},s(t,[{key:"state",get:function(){return this._state},set:function(e){var t=this._state;t!==e&&(this._state=e,this.log(t+"->"+e))}}]),t}(Rr);function Xr(){return self.SourceBuffer||self.WebKitSourceBuffer}function Zr(e,t){return void 0===e&&(e=""),void 0===t&&(t=9e4),{type:e,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}var ei=function(){function e(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var t=e.prototype;return t.resetInitSegment=function(e,t,r,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},t.resetTimeStamp=function(e){this.initPTS=e,this.resetContiguity()},t.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},t.canParse=function(e,t){return!1},t.appendFrame=function(e,t,r){},t.demux=function(e,t){this.cachedData&&(e=Ie(this.cachedData,e),this.cachedData=null);var r,i=se(e,0),n=i?i.length:0,s=this._audioTrack,a=this._id3Track,o=i?function(e){for(var t=de(e),r=0;r<t.length;r++){var i=t[r];if(ce(i))return me(i)}}(i):void 0,c=e.length;for((null===this.basePTS||0===this.frameIndex&&y(o))&&(this.basePTS=ti(o,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),i&&i.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:wt,duration:Number.POSITIVE_INFINITY});n<c;){if(this.canParse(e,n)){var l=this.appendFrame(s,e,n);l?(this.frameIndex++,this.lastPTS=l.sample.pts,r=n+=l.length):n=c}else oe(e,n)?(i=se(e,n),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:wt,duration:Number.POSITIVE_INFINITY}),r=n+=i.length):n++;if(n===c&&r!==c){var d=te(e,r);this.cachedData?this.cachedData=Ie(this.cachedData,d):this.cachedData=d}}return{audioTrack:s,videoTrack:Zr(),id3Track:a,textTrack:Zr()}},t.demuxSampleAes=function(e,t,r){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},t.flush=function(e){var t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Zr(),id3Track:this._id3Track,textTrack:Zr()}},t.destroy=function(){},e}(),ti=function(e,t,r){return y(e)?90*e:9e4*t+(r?9e4*r.baseTime/r.timescale:0)};function ri(e,t){return 255===e[t]&&240==(246&e[t+1])}function ii(e,t){return 1&e[t+1]?7:9}function ni(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function si(e,t){return t+1<e.length&&ri(e,t)}function ai(e,t){if(si(e,t)){var r=ii(e,t);if(t+r>=e.length)return!1;var i=ni(e,t);if(i<=r)return!1;var n=t+i;return n===e.length||si(e,n)}return!1}function oi(e,t,r,i,n){if(!e.samplerate){var s=function(e,t,r,i){var n,s,a,o,c=navigator.userAgent.toLowerCase(),l=i,d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];n=1+((192&t[r+2])>>>6);var u=(60&t[r+2])>>>2;if(!(u>d.length-1))return a=(1&t[r+2])<<2,a|=(192&t[r+3])>>>6,P.log("manifest codec:"+i+", ADTS type:"+n+", samplingIndex:"+u),/firefox/i.test(c)?u>=6?(n=5,o=new Array(4),s=u-3):(n=2,o=new Array(2),s=u):-1!==c.indexOf("android")?(n=2,o=new Array(2),s=u):(n=5,o=new Array(4),i&&(-1!==i.indexOf("mp4a.40.29")||-1!==i.indexOf("mp4a.40.5"))||!i&&u>=6?s=u-3:((i&&-1!==i.indexOf("mp4a.40.2")&&(u>=6&&1===a||/vivaldi/i.test(c))||!i&&1===a)&&(n=2,o=new Array(2)),s=u)),o[0]=n<<3,o[0]|=(14&u)>>1,o[1]|=(1&u)<<7,o[1]|=a<<3,5===n&&(o[1]|=(14&s)>>1,o[2]=(1&s)<<7,o[2]|=8,o[3]=0),{config:o,samplerate:d[u],channelCount:a,codec:"mp4a.40."+n,manifestCodec:l};e.trigger(b.ERROR,{type:E.MEDIA_ERROR,details:S.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+u})}(t,r,i,n);if(!s)return;e.config=s.config,e.samplerate=s.samplerate,e.channelCount=s.channelCount,e.codec=s.codec,e.manifestCodec=s.manifestCodec,P.log("parsed codec:"+e.codec+", rate:"+s.samplerate+", channels:"+s.channelCount)}}function ci(e){return 9216e4/e}function li(e,t,r,i,n){var s,a=i+n*ci(e.samplerate),o=function(e,t){var r=ii(e,t);if(t+r<=e.length){var i=ni(e,t)-r;if(i>0)return{headerLength:r,frameLength:i}}}(t,r);if(o){var c=o.frameLength,l=o.headerLength,d=l+c,u=Math.max(0,r+d-t.length);u?(s=new Uint8Array(d-l)).set(t.subarray(r+l,t.length),0):s=t.subarray(r+l,r+d);var h={unit:s,pts:a};return u||e.samples.push(h),{sample:h,length:d,missing:u}}var p=t.length-r;return(s=new Uint8Array(p)).set(t.subarray(r,t.length),0),{sample:{unit:s,pts:a},length:p,missing:-1}}var di=function(e){function t(t,r){var i;return(i=e.call(this)||this).observer=void 0,i.config=void 0,i.observer=t,i.config=r,i}c(t,e);var r=t.prototype;return r.resetInitSegment=function(t,r,i,n){e.prototype.resetInitSegment.call(this,t,r,i,n),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:r,duration:n,inputTimeScale:9e4,dropped:0}},t.probe=function(e){if(!e)return!1;for(var t=(se(e,0)||[]).length,r=e.length;t<r;t++)if(ai(e,t))return P.log("ADTS sync word found !"),!0;return!1},r.canParse=function(e,t){return function(e,t){return function(e,t){return t+5<e.length}(e,t)&&ri(e,t)&&ni(e,t)<=e.length-t}(e,t)},r.appendFrame=function(e,t,r){oi(e,this.observer,t,r,e.manifestCodec);var i=li(e,t,r,this.basePTS,this.frameIndex);if(i&&0===i.missing)return i},t}(ei),ui=/\/emsg[-/]ID3/i,hi=function(){function e(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}var t=e.prototype;return t.resetTimeStamp=function(){},t.resetInitSegment=function(e,t,r,i){var n=this.videoTrack=Zr("video",1),s=this.audioTrack=Zr("audio",1),a=this.txtTrack=Zr("text",1);if(this.id3Track=Zr("id3",1),this.timeOffset=0,null!=e&&e.byteLength){var o=De(e);if(o.video){var c=o.video,l=c.id,d=c.timescale,u=c.codec;n.id=l,n.timescale=a.timescale=d,n.codec=u}if(o.audio){var h=o.audio,p=h.id,f=h.timescale,m=h.codec;s.id=p,s.timescale=f,s.codec=m}a.id=Ee.text,n.sampleDuration=0,n.duration=s.duration=i}},t.resetContiguity=function(){this.remainderData=null},e.probe=function(e){return Ae(e=e.length>16384?e.subarray(0,16384):e,["moof"]).length>0},t.demux=function(e,t){this.timeOffset=t;var r=e,i=this.videoTrack,n=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=Ie(this.remainderData,e));var s=function(e){var t={valid:null,remainder:null},r=Ae(e,["moof"]);if(!r)return t;if(r.length<2)return t.remainder=e,t;var i=r[r.length-1];return t.valid=te(e,0,i.byteOffset-8),t.remainder=te(e,i.byteOffset-8),t}(r);this.remainderData=s.remainder,i.samples=s.valid||new Uint8Array}else i.samples=r;var a=this.extractID3Track(i,t);return n.samples=Oe(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}},t.flush=function(){var e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;var i=this.extractID3Track(t,this.timeOffset);return r.samples=Oe(e,t),{videoTrack:t,audioTrack:Zr(),id3Track:i,textTrack:Zr()}},t.extractID3Track=function(e,t){var r=this.id3Track;if(e.samples.length){var i=Ae(e.samples,["emsg"]);i&&i.forEach((function(e){var i=function(e){var t=e[0],r="",i="",n=0,s=0,a=0,o=0,c=0,l=0;if(0===t){for(;"\0"!==Se(e.subarray(l,l+1));)r+=Se(e.subarray(l,l+1)),l+=1;for(r+=Se(e.subarray(l,l+1)),l+=1;"\0"!==Se(e.subarray(l,l+1));)i+=Se(e.subarray(l,l+1)),l+=1;i+=Se(e.subarray(l,l+1)),l+=1,n=Te(e,12),s=Te(e,16),o=Te(e,20),c=Te(e,24),l=28}else if(1===t){n=Te(e,l+=4);var d=Te(e,l+=4),u=Te(e,l+=4);for(l+=4,a=Math.pow(2,32)*d+u,Number.isSafeInteger(a)||(a=Number.MAX_SAFE_INTEGER,P.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=Te(e,l),c=Te(e,l+=4),l+=4;"\0"!==Se(e.subarray(l,l+1));)r+=Se(e.subarray(l,l+1)),l+=1;for(r+=Se(e.subarray(l,l+1)),l+=1;"\0"!==Se(e.subarray(l,l+1));)i+=Se(e.subarray(l,l+1)),l+=1;i+=Se(e.subarray(l,l+1)),l+=1}return{schemeIdUri:r,value:i,timeScale:n,presentationTime:a,presentationTimeDelta:s,eventDuration:o,id:c,payload:e.subarray(l,e.byteLength)}}(e);if(ui.test(i.schemeIdUri)){var n=y(i.presentationTime)?i.presentationTime/i.timeScale:t+i.presentationTimeDelta/i.timeScale,s=4294967295===i.eventDuration?Number.POSITIVE_INFINITY:i.eventDuration/i.timeScale;s<=.001&&(s=Number.POSITIVE_INFINITY);var a=i.payload;r.samples.push({data:a,len:a.byteLength,dts:n,pts:n,type:Rt,duration:s})}}))}return r},t.demuxSampleAes=function(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},t.destroy=function(){},e}(),pi=null,fi=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],mi=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],gi=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],vi=[0,1,1,4];function _i(e,t,r,i,n){if(!(r+24>t.length)){var s=yi(t,r);if(s&&r+s.frameLength<=t.length){var a=i+n*(9e4*s.samplesPerFrame/s.sampleRate),o={unit:t.subarray(r,r+s.frameLength),pts:a,dts:a};return e.config=[],e.channelCount=s.channelCount,e.samplerate=s.sampleRate,e.samples.push(o),{sample:o,length:s.frameLength,missing:0}}}}function yi(e,t){var r=e[t+1]>>3&3,i=e[t+1]>>1&3,n=e[t+2]>>4&15,s=e[t+2]>>2&3;if(1!==r&&0!==n&&15!==n&&3!==s){var a=e[t+2]>>1&1,o=e[t+3]>>6,c=1e3*fi[14*(3===r?3-i:3===i?3:4)+n-1],l=mi[3*(3===r?0:2===r?1:2)+s],d=3===o?1:2,u=gi[r][i],h=vi[i],p=8*u*h,f=Math.floor(u*c/l+a)*h;if(null===pi){var m=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);pi=m?parseInt(m[1]):0}return!!pi&&pi<=87&&2===i&&c>=224e3&&0===o&&(e[t+3]=128|e[t+3]),{sampleRate:l,channelCount:d,frameLength:f,samplesPerFrame:p}}}function bi(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])}function Ei(e,t){return t+1<e.length&&bi(e,t)}function Si(e,t){if(t+1<e.length&&bi(e,t)){var r=yi(e,t),i=4;null!=r&&r.frameLength&&(i=r.frameLength);var n=t+i;return n===e.length||Ei(e,n)}return!1}var wi=function(){function e(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}var t=e.prototype;return t.loadWord=function(){var e=this.data,t=this.bytesAvailable,r=e.byteLength-t,i=new Uint8Array(4),n=Math.min(4,t);if(0===n)throw new Error("no bytes available");i.set(e.subarray(r,r+n)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*n,this.bytesAvailable-=n},t.skipBits=function(e){var t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,e-=(t=e>>3)<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)},t.readBits=function(e){var t=Math.min(this.bitsAvailable,e),r=this.word>>>32-t;if(e>32&&P.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return(t=e-t)>0&&this.bitsAvailable?r<<t|this.readBits(t):r},t.skipLZ=function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},t.skipUEG=function(){this.skipBits(1+this.skipLZ())},t.skipEG=function(){this.skipBits(1+this.skipLZ())},t.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},t.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},t.readBoolean=function(){return 1===this.readBits(1)},t.readUByte=function(){return this.readBits(8)},t.readUShort=function(){return this.readBits(16)},t.readUInt=function(){return this.readBits(32)},t.skipScalingList=function(e){for(var t=8,r=8,i=0;i<e;i++)0!==r&&(r=(t+this.readEG()+256)%256),t=0===r?t:r},t.readSPS=function(){var e,t,r,i=0,n=0,s=0,a=0,o=this.readUByte.bind(this),c=this.readBits.bind(this),l=this.readUEG.bind(this),d=this.readBoolean.bind(this),u=this.skipBits.bind(this),h=this.skipEG.bind(this),p=this.skipUEG.bind(this),f=this.skipScalingList.bind(this);o();var m=o();if(c(5),u(3),o(),p(),100===m||110===m||122===m||244===m||44===m||83===m||86===m||118===m||128===m){var g=l();if(3===g&&u(1),p(),p(),u(1),d())for(t=3!==g?8:12,r=0;r<t;r++)d()&&f(r<6?16:64)}p();var v=l();if(0===v)l();else if(1===v)for(u(1),h(),h(),e=l(),r=0;r<e;r++)h();p(),u(1);var _=l(),y=l(),b=c(1);0===b&&u(1),u(1),d()&&(i=l(),n=l(),s=l(),a=l());var E=[1,1];if(d()&&d())switch(o()){case 1:E=[1,1];break;case 2:E=[12,11];break;case 3:E=[10,11];break;case 4:E=[16,11];break;case 5:E=[40,33];break;case 6:E=[24,11];break;case 7:E=[20,11];break;case 8:E=[32,11];break;case 9:E=[80,33];break;case 10:E=[18,11];break;case 11:E=[15,11];break;case 12:E=[64,33];break;case 13:E=[160,99];break;case 14:E=[4,3];break;case 15:E=[3,2];break;case 16:E=[2,1];break;case 255:E=[o()<<8|o(),o()<<8|o()]}return{width:Math.ceil(16*(_+1)-2*i-2*n),height:(2-b)*(y+1)*16-(b?2:4)*(s+a),pixelRatio:E}},t.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},e}(),Ti=function(){function e(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new Fr(t,{removePKCS7Padding:!1})}var t=e.prototype;return t.decryptBuffer=function(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)},t.decryptAacSample=function(e,t,r){var i=this,n=e[t].unit;if(!(n.length<=16)){var s=n.subarray(16,n.length-n.length%16),a=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(a).then((function(s){var a=new Uint8Array(s);n.set(a,16),i.decrypter.isSync()||i.decryptAacSamples(e,t+1,r)}))}},t.decryptAacSamples=function(e,t,r){for(;;t++){if(t>=e.length)return void r();if(!(e[t].unit.length<32||(this.decryptAacSample(e,t,r),this.decrypter.isSync())))return}},t.getAvcEncryptedData=function(e){for(var t=16*Math.floor((e.length-48)/160)+16,r=new Int8Array(t),i=0,n=32;n<e.length-16;n+=160,i+=16)r.set(e.subarray(n,n+16),i);return r},t.getAvcDecryptedUnit=function(e,t){for(var r=new Uint8Array(t),i=0,n=32;n<e.length-16;n+=160,i+=16)e.set(r.subarray(i,i+16),n);return e},t.decryptAvcSample=function(e,t,r,i,n){var s=this,a=Ne(n.data),o=this.getAvcEncryptedData(a);this.decryptBuffer(o.buffer).then((function(o){n.data=s.getAvcDecryptedUnit(a,o),s.decrypter.isSync()||s.decryptAvcSamples(e,t,r+1,i)}))},t.decryptAvcSamples=function(e,t,r,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length)return void i();for(var n=e[t].units;!(r>=n.length);r++){var s=n[r];if(!(s.data.length<=48||1!==s.type&&5!==s.type||(this.decryptAvcSample(e,t,r,i,s),this.decrypter.isSync())))return}}},e}(),Ri=188,Ci=function(){function e(e,t,r){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=e,this.config=t,this.typeSupported=r}e.probe=function(t){var r=e.syncOffset(t);return r>0&&P.warn("MPEG2-TS detected but first sync word found @ offset "+r),-1!==r},e.syncOffset=function(e){for(var t=e.length,r=Math.min(940,e.length-Ri)+1,i=0;i<r;){for(var n=!1,s=-1,a=0,o=i;o<t;o+=Ri){if(71!==e[o]){if(a)return-1;break}if(a++,-1===s&&0!==(s=o)&&(r=Math.min(s+18612,e.length-Ri)+1),n||(n=0===Pi(e,o)),n&&a>1&&(0===s&&a>2||o+Ri>r))return s}i++}return-1},e.createTrack=function(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:Ee[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}};var t=e.prototype;return t.resetInitSegment=function(t,r,i,n){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=e.createTrack("video"),this._audioTrack=e.createTrack("audio",n),this._id3Track=e.createTrack("id3"),this._txtTrack=e.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=r,this.videoCodec=i,this._duration=n},t.resetTimeStamp=function(){},t.resetContiguity=function(){var e=this._audioTrack,t=this._avcTrack,r=this._id3Track;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},t.demux=function(t,r,i,n){var s;void 0===i&&(i=!1),void 0===n&&(n=!1),i||(this.sampleAes=null);var a=this._avcTrack,o=this._audioTrack,c=this._id3Track,l=this._txtTrack,d=a.pid,u=a.pesData,h=o.pid,p=c.pid,f=o.pesData,m=c.pesData,g=null,v=this.pmtParsed,_=this._pmtId,y=t.length;if(this.remainderData&&(y=(t=Ie(this.remainderData,t)).length,this.remainderData=null),y<Ri&&!n)return this.remainderData=t,{audioTrack:o,videoTrack:a,id3Track:c,textTrack:l};var w=Math.max(0,e.syncOffset(t));(y-=(y-w)%Ri)<t.byteLength&&!n&&(this.remainderData=new Uint8Array(t.buffer,y,t.buffer.byteLength-y));for(var T=0,R=w;R<y;R+=Ri)if(71===t[R]){var C=!!(64&t[R+1]),A=Pi(t,R),D=void 0;if((48&t[R+3])>>4>1){if((D=R+5+t[R+4])===R+Ri)continue}else D=R+4;switch(A){case d:C&&(u&&(s=ki(u))&&this.parseAVCPES(a,l,s,!1),u={data:[],size:0}),u&&(u.data.push(t.subarray(D,R+Ri)),u.size+=R+Ri-D);break;case h:if(C){if(f&&(s=ki(f)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,s);break;case"mp3":this.parseMPEGPES(o,s)}f={data:[],size:0}}f&&(f.data.push(t.subarray(D,R+Ri)),f.size+=R+Ri-D);break;case p:C&&(m&&(s=ki(m))&&this.parseID3PES(c,s),m={data:[],size:0}),m&&(m.data.push(t.subarray(D,R+Ri)),m.size+=R+Ri-D);break;case 0:C&&(D+=t[D]+1),_=this._pmtId=Di(t,D);break;case _:C&&(D+=t[D]+1);var L=Li(t,D,this.typeSupported,i);(d=L.avc)>0&&(a.pid=d),(h=L.audio)>0&&(o.pid=h,o.segmentCodec=L.segmentCodec),(p=L.id3)>0&&(c.pid=p),null===g||v||(P.warn("MPEG-TS PMT found at "+R+" after unknown PID '"+g+"'. Backtracking to sync byte @"+w+" to parse all TS packets."),g=null,R=w-188),v=this.pmtParsed=!0;break;case 17:case 8191:break;default:g=A}}else T++;if(T>0){var k=new Error("Found "+T+" TS packet/s that do not start with 0x47");this.observer.emit(b.ERROR,b.ERROR,{type:E.MEDIA_ERROR,details:S.FRAG_PARSING_ERROR,fatal:!1,error:k,reason:k.message})}a.pesData=u,o.pesData=f,c.pesData=m;var I={audioTrack:o,videoTrack:a,id3Track:c,textTrack:l};return n&&this.extractRemainingSamples(I),I},t.flush=function(){var e,t=this.remainderData;return this.remainderData=null,e=t?this.demux(t,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e},t.extractRemainingSamples=function(e){var t,r=e.audioTrack,i=e.videoTrack,n=e.id3Track,s=e.textTrack,a=i.pesData,o=r.pesData,c=n.pesData;if(a&&(t=ki(a))?(this.parseAVCPES(i,s,t,!0),i.pesData=null):i.pesData=a,o&&(t=ki(o))){switch(r.segmentCodec){case"aac":this.parseAACPES(r,t);break;case"mp3":this.parseMPEGPES(r,t)}r.pesData=null}else null!=o&&o.size&&P.log("last AAC PES packet truncated,might overlap between fragments"),r.pesData=o;c&&(t=ki(c))?(this.parseID3PES(n,t),n.pesData=null):n.pesData=c},t.demuxSampleAes=function(e,t,r){var i=this.demux(e,r,!0,!this.config.progressive),n=this.sampleAes=new Ti(this.observer,this.config,t);return this.decrypt(i,n)},t.decrypt=function(e,t){return new Promise((function(r){var i=e.audioTrack,n=e.videoTrack;i.samples&&"aac"===i.segmentCodec?t.decryptAacSamples(i.samples,0,(function(){n.samples?t.decryptAvcSamples(n.samples,0,0,(function(){r(e)})):r(e)})):n.samples&&t.decryptAvcSamples(n.samples,0,0,(function(){r(e)}))}))},t.destroy=function(){this._duration=0},t.parseAVCPES=function(e,t,r,i){var n,s=this,a=this.parseAVCNALu(e,r.data),o=this.avcSample,c=!1;r.data=null,o&&a.length&&!e.audFound&&(Ii(o,e),o=this.avcSample=Ai(!1,r.pts,r.dts,"")),a.forEach((function(i){switch(i.type){case 1:n=!0,o||(o=s.avcSample=Ai(!0,r.pts,r.dts,"")),o.frame=!0;var a=i.data;if(c&&a.length>4){var l=new wi(a).readSliceType();2!==l&&4!==l&&7!==l&&9!==l||(o.key=!0)}break;case 5:n=!0,o||(o=s.avcSample=Ai(!0,r.pts,r.dts,"")),o.key=!0,o.frame=!0;break;case 6:n=!0,xe(i.data,1,r.pts,t.samples);break;case 7:if(n=!0,c=!0,!e.sps){var d=i.data,u=new wi(d).readSPS();e.width=u.width,e.height=u.height,e.pixelRatio=u.pixelRatio,e.sps=[d],e.duration=s._duration;for(var h=d.subarray(1,4),p="avc1.",f=0;f<3;f++){var m=h[f].toString(16);m.length<2&&(m="0"+m),p+=m}e.codec=p}break;case 8:n=!0,e.pps||(e.pps=[i.data]);break;case 9:n=!1,e.audFound=!0,o&&Ii(o,e),o=s.avcSample=Ai(!1,r.pts,r.dts,"");break;case 12:n=!0;break;default:n=!1,o&&(o.debug+="unknown NAL "+i.type+" ")}o&&n&&o.units.push(i)})),i&&o&&(Ii(o,e),this.avcSample=null)},t.getLastNalUnit=function(e){var t,r,i=this.avcSample;if(i&&0!==i.units.length||(i=e[e.length-1]),null!=(t=i)&&t.units){var n=i.units;r=n[n.length-1]}return r},t.parseAVCNALu=function(e,t){var r,i,n=t.byteLength,s=e.naluState||0,a=s,o=[],c=0,l=-1,d=0;for(-1===s&&(l=0,d=31&t[0],s=0,c=1);c<n;)if(r=t[c++],s)if(1!==s)if(r)if(1===r){if(l>=0){var u={data:t.subarray(l,c-s-1),type:d};o.push(u)}else{var h=this.getLastNalUnit(e.samples);if(h&&(a&&c<=4-a&&h.state&&(h.data=h.data.subarray(0,h.data.byteLength-a)),(i=c-s-1)>0)){var p=new Uint8Array(h.data.byteLength+i);p.set(h.data,0),p.set(t.subarray(0,i),h.data.byteLength),h.data=p,h.state=0}}c<n?(l=c,d=31&t[c],s=0):s=-1}else s=0;else s=3;else s=r?0:2;else s=r?0:1;if(l>=0&&s>=0){var f={data:t.subarray(l,n),type:d,state:s};o.push(f)}if(0===o.length){var m=this.getLastNalUnit(e.samples);if(m){var g=new Uint8Array(m.data.byteLength+t.byteLength);g.set(m.data,0),g.set(t,m.data.byteLength),m.data=g}}return e.naluState=s,o},t.parseAACPES=function(e,t){var r,i,n,s=0,a=this.aacOverFlow,o=t.data;if(a){this.aacOverFlow=null;var c=a.missing,l=a.sample.unit.byteLength;if(-1===c){var d=new Uint8Array(l+o.byteLength);d.set(a.sample.unit,0),d.set(o,l),o=d}else{var u=l-c;a.sample.unit.set(o.subarray(0,c),u),e.samples.push(a.sample),s=a.missing}}for(r=s,i=o.length;r<i-1&&!si(o,r);r++);if(r!==s){var h,p=r<i-1;h=p?"AAC PES did not start with ADTS header,offset:"+r:"No ADTS header found in AAC PES";var f=new Error(h);if(P.warn("parsing error: "+h),this.observer.emit(b.ERROR,b.ERROR,{type:E.MEDIA_ERROR,details:S.FRAG_PARSING_ERROR,fatal:!1,levelRetry:p,error:f,reason:h}),!p)return}if(oi(e,this.observer,o,r,this.audioCodec),void 0!==t.pts)n=t.pts;else{if(!a)return void P.warn("[tsdemuxer]: AAC PES unknown PTS");var m=ci(e.samplerate);n=a.sample.pts+m}for(var g,v=0;r<i;){if(r+=(g=li(e,o,r,n,v)).length,g.missing){this.aacOverFlow=g;break}for(v++;r<i-1&&!si(o,r);r++);}},t.parseMPEGPES=function(e,t){var r=t.data,i=r.length,n=0,s=0,a=t.pts;if(void 0!==a)for(;s<i;)if(Ei(r,s)){var o=_i(e,r,s,a,n);if(!o)break;s+=o.length,n++}else s++;else P.warn("[tsdemuxer]: MPEG PES unknown PTS")},t.parseID3PES=function(e,t){if(void 0!==t.pts){var r=o({},t,{type:this._avcTrack?Rt:wt,duration:Number.POSITIVE_INFINITY});e.samples.push(r)}else P.warn("[tsdemuxer]: ID3 PES unknown PTS")},e}();function Ai(e,t,r,i){return{key:e,frame:!1,pts:t,dts:r,units:[],debug:i,length:0}}function Pi(e,t){return((31&e[t+1])<<8)+e[t+2]}function Di(e,t){return(31&e[t+10])<<8|e[t+11]}function Li(e,t,r,i){var n={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},s=t+3+((15&e[t+1])<<8|e[t+2])-4;for(t+=12+((15&e[t+10])<<8|e[t+11]);t<s;){var a=Pi(e,t);switch(e[t]){case 207:if(!i){P.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===n.audio&&(n.audio=a);break;case 21:-1===n.id3&&(n.id3=a);break;case 219:if(!i){P.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===n.avc&&(n.avc=a);break;case 3:case 4:!0!==r.mpeg&&!0!==r.mp3?P.log("MPEG audio found, not supported in this browser"):-1===n.audio&&(n.audio=a,n.segmentCodec="mp3");break;case 36:P.warn("Unsupported HEVC stream type found")}t+=5+((15&e[t+3])<<8|e[t+4])}return n}function ki(e){var t,r,i,n,s,a=0,o=e.data;if(!e||0===e.size)return null;for(;o[0].length<19&&o.length>1;){var c=new Uint8Array(o[0].length+o[1].length);c.set(o[0]),c.set(o[1],o[0].length),o[0]=c,o.splice(1,1)}if(1===((t=o[0])[0]<<16)+(t[1]<<8)+t[2]){if((r=(t[4]<<8)+t[5])&&r>e.size-6)return null;var l=t[7];192&l&&(n=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,64&l?n-(s=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2)>54e5&&(P.warn(Math.round((n-s)/9e4)+"s delta between PTS and DTS, align them"),n=s):s=n);var d=(i=t[8])+9;if(e.size<=d)return null;e.size-=d;for(var u=new Uint8Array(e.size),h=0,p=o.length;h<p;h++){var f=(t=o[h]).byteLength;if(d){if(d>f){d-=f;continue}t=t.subarray(d),f-=d,d=0}u.set(t,a),a+=f}return r&&(r-=i+3),{data:u,pts:n,dts:s,len:r}}return null}function Ii(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){var r=t.samples,i=r.length;if(!i)return void t.dropped++;var n=r[i-1];e.pts=n.pts,e.dts=n.dts}t.samples.push(e)}e.debug.length&&P.log(e.pts+"/"+e.dts+":"+e.debug)}var Oi=function(e){function t(){return e.apply(this,arguments)||this}c(t,e);var r=t.prototype;return r.resetInitSegment=function(t,r,i,n){e.prototype.resetInitSegment.call(this,t,r,i,n),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:r,duration:n,inputTimeScale:9e4,dropped:0}},t.probe=function(e){if(!e)return!1;for(var t=(se(e,0)||[]).length,r=e.length;t<r;t++)if(Si(e,t))return P.log("MPEG Audio sync word found !"),!0;return!1},r.canParse=function(e,t){return function(e,t){return bi(e,t)&&4<=e.length-t}(e,t)},r.appendFrame=function(e,t,r){if(null!==this.basePTS)return _i(e,t,r,this.basePTS,this.frameIndex)},t}(ei),Mi=function(){function e(){}return e.getSilentFrame=function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},e}(),xi=Math.pow(2,32)-1,Ni=function(){function e(){}return e.init=function(){var t;for(t in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:r,audio:i};var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=s,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),c=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,a,c,a,o),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,n))},e.box=function(e){for(var t=8,r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];for(var s=i.length,a=s;s--;)t+=i[s].byteLength;var o=new Uint8Array(t);for(o[0]=t>>24&255,o[1]=t>>16&255,o[2]=t>>8&255,o[3]=255&t,o.set(e,4),s=0,t=8;s<a;s++)o.set(i[s],t),t+=i[s].byteLength;return o},e.hdlr=function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])},e.mdat=function(t){return e.box(e.types.mdat,t)},e.mdhd=function(t,r){r*=t;var i=Math.floor(r/(xi+1)),n=Math.floor(r%(xi+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,n>>24,n>>16&255,n>>8&255,255&n,85,196,0,0]))},e.mdia=function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))},e.mfhd=function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))},e.minf=function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))},e.moof=function(t,r,i){return e.box(e.types.moof,e.mfhd(t),e.traf(i,r))},e.moov=function(t){for(var r=t.length,i=[];r--;)i[r]=e.trak(t[r]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(i).concat(e.mvex(t)))},e.mvex=function(t){for(var r=t.length,i=[];r--;)i[r]=e.trex(t[r]);return e.box.apply(null,[e.types.mvex].concat(i))},e.mvhd=function(t,r){r*=t;var i=Math.floor(r/(xi+1)),n=Math.floor(r%(xi+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,n>>24,n>>16&255,n>>8&255,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,s)},e.sdtp=function(t){var r,i,n=t.samples||[],s=new Uint8Array(4+n.length);for(r=0;r<n.length;r++)i=n[r].flags,s[r+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return e.box(e.types.sdtp,s)},e.stbl=function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))},e.avc1=function(t){var r,i,n,s=[],a=[];for(r=0;r<t.sps.length;r++)n=(i=t.sps[r]).byteLength,s.push(n>>>8&255),s.push(255&n),s=s.concat(Array.prototype.slice.call(i));for(r=0;r<t.pps.length;r++)n=(i=t.pps[r]).byteLength,a.push(n>>>8&255),a.push(255&n),a=a.concat(Array.prototype.slice.call(i));var o=e.box(e.types.avcC,new Uint8Array([1,s[3],s[4],s[5],255,224|t.sps.length].concat(s).concat([t.pps.length]).concat(a))),c=t.width,l=t.height,d=t.pixelRatio[0],u=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,255&c,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,255&d,u>>24,u>>16&255,u>>8&255,255&u])))},e.esds=function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))},e.mp4a=function(t){var r=t.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]),e.box(e.types.esds,e.esds(t)))},e.mp3=function(t){var r=t.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]))},e.stsd=function(t){return"audio"===t.type?"mp3"===t.segmentCodec&&"mp3"===t.codec?e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))},e.tkhd=function(t){var r=t.id,i=t.duration*t.timescale,n=t.width,s=t.height,a=Math.floor(i/(xi+1)),o=Math.floor(i%(xi+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,o>>24,o>>16&255,o>>8&255,255&o,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,255&n,0,0,s>>8&255,255&s,0,0]))},e.traf=function(t,r){var i=e.sdtp(t),n=t.id,s=Math.floor(r/(xi+1)),a=Math.floor(r%(xi+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,a>>24,a>>16&255,a>>8&255,255&a])),e.trun(t,i.length+16+20+8+16+8+8),i)},e.trak=function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))},e.trex=function(t){var r=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},e.trun=function(t,r){var i,n,s,a,o,c,l=t.samples||[],d=l.length,u=12+16*d,h=new Uint8Array(u);for(r+=8+u,h.set(["video"===t.type?1:0,0,15,1,d>>>24&255,d>>>16&255,d>>>8&255,255&d,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0),i=0;i<d;i++)s=(n=l[i]).duration,a=n.size,o=n.flags,c=n.cts,h.set([s>>>24&255,s>>>16&255,s>>>8&255,255&s,a>>>24&255,a>>>16&255,a>>>8&255,255&a,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,c>>>24&255,c>>>16&255,c>>>8&255,255&c],12+16*i);return e.box(e.types.trun,h)},e.initSegment=function(t){e.types||e.init();var r=e.moov(t),i=new Uint8Array(e.FTYP.byteLength+r.byteLength);return i.set(e.FTYP),i.set(r,e.FTYP.byteLength),i},e}();Ni.types=void 0,Ni.HDLR_TYPES=void 0,Ni.STTS=void 0,Ni.STSC=void 0,Ni.STCO=void 0,Ni.STSZ=void 0,Ni.VMHD=void 0,Ni.SMHD=void 0,Ni.STSD=void 0,Ni.FTYP=void 0,Ni.DINF=void 0;var Fi=9e4;function Bi(e,t,r,i){void 0===r&&(r=1),void 0===i&&(i=!1);var n=e*t*r;return i?Math.round(n):n}function ji(e,t){return void 0===t&&(t=!1),Bi(e,1e3,1/Fi,t)}var Ui=null,Vi=null,Gi=function(){function e(e,t,r,i){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,null===Ui){var n=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Ui=n?parseInt(n[1]):0}if(null===Vi){var s=navigator.userAgent.match(/Safari\/(\d+)/i);Vi=s?parseInt(s[1]):0}}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(e){P.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e},t.resetNextTimestamp=function(){P.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},t.resetInitSegment=function(){P.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},t.getVideoStartPts=function(e){var t=!1,r=e.reduce((function(e,r){var i=r.pts-e;return i<-4294967296?(t=!0,Hi(e,r.pts)):i>0?e:r.pts}),e[0].pts);return t&&P.debug("PTS rollover detected"),r},t.remux=function(e,t,r,i,n,s,a,o){var c,l,d,u,h,p,f=n,m=n,g=e.pid>-1,v=t.pid>-1,_=t.samples.length,y=e.samples.length>0,b=a&&_>0||_>1;if((!g||y)&&(!v||b)||this.ISGenerated||a){this.ISGenerated||(d=this.generateIS(e,t,n,s));var E,S=this.isVideoContiguous,w=-1;if(b&&(w=function(e){for(var t=0;t<e.length;t++)if(e[t].key)return t;return-1}(t.samples),!S&&this.config.forceKeyFrameOnDiscontinuity))if(p=!0,w>0){P.warn("[mp4-remuxer]: Dropped "+w+" out of "+_+" video samples due to a missing keyframe");var T=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(w),t.dropped+=w,E=m+=(t.samples[0].pts-T)/t.inputTimeScale}else-1===w&&(P.warn("[mp4-remuxer]: No keyframe found out of "+_+" video samples"),p=!1);if(this.ISGenerated){if(y&&b){var R=this.getVideoStartPts(t.samples),C=(Hi(e.samples[0].pts,R)-R)/t.inputTimeScale;f+=Math.max(0,C),m+=Math.max(0,-C)}if(y){if(e.samplerate||(P.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),d=this.generateIS(e,t,n,s)),l=this.remuxAudio(e,f,this.isAudioContiguous,s,v||b||o===ft?m:void 0),b){var A=l?l.endPTS-l.startPTS:0;t.inputTimeScale||(P.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),d=this.generateIS(e,t,n,s)),c=this.remuxVideo(t,m,S,A)}}else b&&(c=this.remuxVideo(t,m,S,0));c&&(c.firstKeyFrame=w,c.independent=-1!==w,c.firstKeyFramePTS=E)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(h=Ki(r,n,this._initPTS,this._initDTS)),i.samples.length&&(u=qi(i,n,this._initPTS))),{audio:l,video:c,initSegment:d,independent:p,text:u,id3:h}},t.generateIS=function(e,t,r,i){var n,s,a,o=e.samples,c=t.samples,l=this.typeSupported,d={},u=this._initPTS,h=!u||i,p="audio/mp4";if(h&&(n=s=1/0),e.config&&o.length&&(e.timescale=e.samplerate,"mp3"===e.segmentCodec&&(l.mpeg?(p="audio/mpeg",e.codec=""):l.mp3&&(e.codec="mp3")),d.audio={id:"audio",container:p,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&l.mpeg?new Uint8Array(0):Ni.initSegment([e]),metadata:{channelCount:e.channelCount}},h&&(a=e.inputTimeScale,u&&a===u.timescale?h=!1:n=s=o[0].pts-Math.round(a*r))),t.sps&&t.pps&&c.length&&(t.timescale=t.inputTimeScale,d.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:Ni.initSegment([t]),metadata:{width:t.width,height:t.height}},h))if(a=t.inputTimeScale,u&&a===u.timescale)h=!1;else{var f=this.getVideoStartPts(c),m=Math.round(a*r);s=Math.min(s,Hi(c[0].dts,f)-m),n=Math.min(n,f-m)}if(Object.keys(d).length)return this.ISGenerated=!0,h?(this._initPTS={baseTime:n,timescale:a},this._initDTS={baseTime:s,timescale:a}):n=a=void 0,{tracks:d,initPTS:n,timescale:a}},t.remuxVideo=function(e,t,r,i){var n,s,a=e.inputTimeScale,c=e.samples,l=[],d=c.length,u=this._initPTS,h=this.nextAvcDts,p=8,f=this.videoSampleDuration,m=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,v=!1;r&&null!==h||(h=t*a-(c[0].pts-Hi(c[0].dts,c[0].pts)));for(var _=u.baseTime*a/u.timescale,y=0;y<d;y++){var w=c[y];w.pts=Hi(w.pts-_,h),w.dts=Hi(w.dts-_,h),w.dts<c[y>0?y-1:y].dts&&(v=!0)}v&&c.sort((function(e,t){var r=e.dts-t.dts,i=e.pts-t.pts;return r||i})),n=c[0].dts;var T=c[c.length-1].dts-n,R=T?Math.round(T/(d-1)):f||e.inputTimeScale/30;if(r){var C=n-h,A=C>R,D=C<-1;if((A||D)&&(A?P.warn("AVC: "+ji(C,!0)+" ms ("+C+"dts) hole between fragments detected, filling it"):P.warn("AVC: "+ji(-C,!0)+" ms ("+C+"dts) overlapping between fragments detected"),!D||h>=c[0].pts)){n=h;var L=c[0].pts-C;c[0].dts=n,c[0].pts=L,P.log("Video: First PTS/DTS adjusted: "+ji(L,!0)+"/"+ji(n,!0)+", delta: "+ji(C,!0)+" ms")}}n=Math.max(0,n);for(var k=0,I=0,O=0;O<d;O++){for(var M=c[O],x=M.units,N=x.length,F=0,B=0;B<N;B++)F+=x[B].data.length;I+=F,k+=N,M.length=F,M.dts=Math.max(M.dts,n),m=Math.min(M.pts,m),g=Math.max(M.pts,g)}s=c[d-1].dts;var j,U=I+4*k+8;try{j=new Uint8Array(U)}catch(e){return void this.observer.emit(b.ERROR,b.ERROR,{type:E.MUX_ERROR,details:S.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:U,reason:"fail allocating video mdat "+U})}var V=new DataView(j.buffer);V.setUint32(0,U),j.set(Ni.types.mdat,4);for(var G=!1,H=Number.POSITIVE_INFINITY,K=Number.POSITIVE_INFINITY,q=Number.NEGATIVE_INFINITY,W=Number.NEGATIVE_INFINITY,z=0;z<d;z++){for(var $=c[z],Y=$.units,Q=0,J=0,X=Y.length;J<X;J++){var Z=Y[J],ee=Z.data,te=Z.data.byteLength;V.setUint32(p,te),p+=4,j.set(ee,p),p+=te,Q+=4+te}var re=void 0;if(z<d-1)f=c[z+1].dts-$.dts,re=c[z+1].pts-$.pts;else{var ie=this.config,ne=z>0?$.dts-c[z-1].dts:R;if(re=z>0?$.pts-c[z-1].pts:R,ie.stretchShortVideoTrack&&null!==this.nextAudioPts){var se=Math.floor(ie.maxBufferHole*a),ae=(i?m+i*a:this.nextAudioPts)-$.pts;ae>se?((f=ae-ne)<0?f=ne:G=!0,P.log("[mp4-remuxer]: It is approximately "+ae/90+" ms to the next segment; using duration "+f/90+" ms for the last video frame.")):f=ne}else f=ne}var oe=Math.round($.pts-$.dts);H=Math.min(H,f),q=Math.max(q,f),K=Math.min(K,re),W=Math.max(W,re),l.push(new zi($.key,f,Q,oe))}if(l.length)if(Ui){if(Ui<70){var ce=l[0].flags;ce.dependsOn=2,ce.isNonSync=0}}else if(Vi&&W-K<q-H&&R/q<.025&&0===l[0].cts){P.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var le=n,de=0,ue=l.length;de<ue;de++){var he=le+l[de].duration,pe=le+l[de].cts;if(de<ue-1){var fe=he+l[de+1].cts;l[de].duration=fe-pe}else l[de].duration=de?l[de-1].duration:R;l[de].cts=0,le=he}}f=G||!f?R:f,this.nextAvcDts=h=s+f,this.videoSampleDuration=f,this.isVideoContiguous=!0;var me={data1:Ni.moof(e.sequenceNumber++,n,o({},e,{samples:l})),data2:j,startPTS:m/a,endPTS:(g+f)/a,startDTS:n/a,endDTS:h/a,type:"video",hasAudio:!1,hasVideo:!0,nb:l.length,dropped:e.dropped};return e.samples=[],e.dropped=0,me},t.remuxAudio=function(e,t,r,i,n){var s=e.inputTimeScale,a=s/(e.samplerate?e.samplerate:s),c="aac"===e.segmentCodec?1024:1152,l=c*a,d=this._initPTS,u="mp3"===e.segmentCodec&&this.typeSupported.mpeg,h=[],p=void 0!==n,f=e.samples,m=u?0:8,g=this.nextAudioPts||-1,v=t*s,_=d.baseTime*s/d.timescale;if(this.isAudioContiguous=r=r||f.length&&g>0&&(i&&Math.abs(v-g)<9e3||Math.abs(Hi(f[0].pts-_,v)-g)<20*l),f.forEach((function(e){e.pts=Hi(e.pts-_,v)})),!r||g<0){if(f=f.filter((function(e){return e.pts>=0})),!f.length)return;g=0===n?0:i&&!p?Math.max(0,v):f[0].pts}if("aac"===e.segmentCodec)for(var y=this.config.maxAudioFramesDrift,w=0,T=g;w<f.length;w++){var R=f[w],C=R.pts,A=C-T,D=Math.abs(1e3*A/s);if(A<=-y*l&&p)0===w&&(P.warn("Audio frame @ "+(C/s).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*A/s)+" ms."),this.nextAudioPts=g=T=C);else if(A>=y*l&&D<1e4&&p){var L=Math.round(A/l);(T=C-L*l)<0&&(L--,T+=l),0===w&&(this.nextAudioPts=g=T),P.warn("[mp4-remuxer]: Injecting "+L+" audio frame @ "+(T/s).toFixed(3)+"s due to "+Math.round(1e3*A/s)+" ms gap.");for(var k=0;k<L;k++){var I=Math.max(T,0),O=Mi.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);O||(P.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),O=R.unit.subarray()),f.splice(w,0,{unit:O,pts:I}),T+=l,w++}}R.pts=T,T+=l}for(var M,x=null,N=null,F=0,B=f.length;B--;)F+=f[B].unit.byteLength;for(var j=0,U=f.length;j<U;j++){var V=f[j],G=V.unit,H=V.pts;if(null!==N)h[j-1].duration=Math.round((H-N)/a);else{if(r&&"aac"===e.segmentCodec&&(H=g),x=H,!(F>0))return;F+=m;try{M=new Uint8Array(F)}catch(e){return void this.observer.emit(b.ERROR,b.ERROR,{type:E.MUX_ERROR,details:S.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:F,reason:"fail allocating audio mdat "+F})}u||(new DataView(M.buffer).setUint32(0,F),M.set(Ni.types.mdat,4))}M.set(G,m);var K=G.byteLength;m+=K,h.push(new zi(!0,c,K,0)),N=H}var q=h.length;if(q){var W=h[h.length-1];this.nextAudioPts=g=N+a*W.duration;var z=u?new Uint8Array(0):Ni.moof(e.sequenceNumber++,x/a,o({},e,{samples:h}));e.samples=[];var $=x/s,Y=g/s,Q={data1:z,data2:M,startPTS:$,endPTS:Y,startDTS:$,endDTS:Y,type:"audio",hasAudio:!0,hasVideo:!1,nb:q};return this.isAudioContiguous=!0,Q}},t.remuxEmptyAudio=function(e,t,r,i){var n=e.inputTimeScale,s=n/(e.samplerate?e.samplerate:n),a=this.nextAudioPts,o=this._initDTS,c=9e4*o.baseTime/o.timescale,l=(null!==a?a:i.startDTS*n)+c,d=i.endDTS*n+c,u=1024*s,h=Math.ceil((d-l)/u),p=Mi.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(P.warn("[mp4-remuxer]: remux empty Audio"),p){for(var f=[],m=0;m<h;m++){var g=l+m*u;f.push({unit:p,pts:g,dts:g})}return e.samples=f,this.remuxAudio(e,t,r,!1)}P.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},e}();function Hi(e,t){var r;if(null===t)return e;for(r=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=r;return e}function Ki(e,t,r,i){var n=e.samples.length;if(n){for(var s=e.inputTimeScale,a=0;a<n;a++){var o=e.samples[a];o.pts=Hi(o.pts-r.baseTime*s/r.timescale,t*s)/s,o.dts=Hi(o.dts-i.baseTime*s/i.timescale,t*s)/s}var c=e.samples;return e.samples=[],{samples:c}}}function qi(e,t,r){var i=e.samples.length;if(i){for(var n=e.inputTimeScale,s=0;s<i;s++){var a=e.samples[s];a.pts=Hi(a.pts-9e4*r.baseTime/r.timescale,t*n)/n}e.samples.sort((function(e,t){return e.pts-t.pts}));var o=e.samples;return e.samples=[],{samples:o}}}var Wi,zi=function(e,t,r,i){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=r,this.cts=i,this.flags=new $i(e)},$i=function(e){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=e?2:1,this.isNonSync=e?0:1},Yi=function(){function e(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(e){this.initPTS=e,this.lastEndTime=null},t.resetNextTimestamp=function(){this.lastEndTime=null},t.resetInitSegment=function(e,t,r,i){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(function(e,t){if(!e||!t)return e;var r=t.keyId;return r&&t.isCommonEncryption&&Ae(e,["moov","trak"]).forEach((function(e){var t=Ae(e,["mdia","minf","stbl","stsd"])[0].subarray(8),i=Ae(t,["enca"]),n=i.length>0;n||(i=Ae(t,["encv"])),i.forEach((function(e){Ae(n?e.subarray(28):e.subarray(78),["sinf"]).forEach((function(e){var t=Le(e);if(t){var i=t.subarray(8,24);i.some((function(e){return 0!==e}))||(P.log("[eme] Patching keyId in 'enc"+(n?"a":"v")+">sinf>>tenc' box: "+_e(i)+" -> "+_e(r)),t.set(r,8))}}))}))})),e}(e,i)),this.emitInitSegment=!0},t.generateInitSegment=function(e){var t=this.audioCodec,r=this.videoCodec;if(null==e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var i=this.initData=De(e);t||(t=Qi(i.audio,x)),r||(r=Qi(i.video,N));var n={};i.audio&&i.video?n.audiovideo={container:"video/mp4",codec:t+","+r,initSegment:e,id:"main"}:i.audio?n.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:i.video?n.video={container:"video/mp4",codec:r,initSegment:e,id:"main"}:P.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=n},t.remux=function(e,t,r,i,n,s){var a,o,c=this.initPTS,l=this.lastEndTime,d={audio:void 0,video:void 0,text:i,id3:r,initSegment:void 0};y(l)||(l=this.lastEndTime=n||0);var u=t.samples;if(null==u||!u.length)return d;var h={initPTS:void 0,timescale:1},p=this.initData;if(null!=(a=p)&&a.length||(this.generateInitSegment(u),p=this.initData),null==(o=p)||!o.length)return P.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),d;this.emitInitSegment&&(h.tracks=this.initTracks,this.emitInitSegment=!1);var f=function(e,t){for(var r=0,i=0,n=0,s=Ae(e,["moof","traf"]),a=0;a<s.length;a++){var o=s[a],c=Ae(o,["tfhd"])[0],l=t[Te(c,4)];if(l){var d=l.default,u=Te(c,0)|(null==d?void 0:d.flags),h=null==d?void 0:d.duration;8&u&&(h=Te(c,2&u?12:8));for(var p=l.timescale||9e4,f=Ae(o,["trun"]),m=0;m<f.length;m++)!(r=ke(f[m]))&&h&&(r=h*Te(f[m],4)),l.type===N?i+=r/p:l.type===x&&(n+=r/p)}}if(0===i&&0===n){for(var g=0,v=Ae(e,["sidx"]),_=0;_<v.length;_++){var y=Pe(v[_]);null!=y&&y.references&&(g+=y.references.reduce((function(e,t){return e+t.info.duration||0}),0))}return g}return i||n}(u,p),m=function(e,t){return Ae(t,["moof","traf"]).reduce((function(t,r){var i=Ae(r,["tfdt"])[0],n=i[0],s=Ae(r,["tfhd"]).reduce((function(t,r){var s=Te(r,4),a=e[s];if(a){var o=Te(i,4);if(1===n){if(o===ye)return P.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),t;o*=ye+1,o+=Te(i,8)}var c=o/(a.timescale||9e4);if(isFinite(c)&&(null===t||c<t))return c}return t}),null);return null!==s&&isFinite(s)&&(null===t||s<t)?s:t}),null)}(p,u),g=null===m?n:m;(function(e,t,r,i){if(null===e)return!0;var n=Math.max(i,1),s=t-e.baseTime/e.timescale;return Math.abs(s-r)>n}(c,g,n,f)||h.timescale!==c.timescale&&s)&&(h.initPTS=g-n,c&&1===c.timescale&&P.warn("Adjusting initPTS by "+(h.initPTS-c.baseTime)),this.initPTS=c={baseTime:h.initPTS,timescale:1});var v=e?g-c.baseTime/c.timescale:l,_=v+f;(function(e,t,r){Ae(t,["moof","traf"]).forEach((function(t){Ae(t,["tfhd"]).forEach((function(i){var n=Te(i,4),s=e[n];if(s){var a=s.timescale||9e4;Ae(t,["tfdt"]).forEach((function(e){var t=e[0],i=Te(e,4);if(0===t)i-=r*a,Ce(e,4,i=Math.max(i,0));else{i*=Math.pow(2,32),i+=Te(e,8),i-=r*a,i=Math.max(i,0);var n=Math.floor(i/(ye+1)),s=Math.floor(i%(ye+1));Ce(e,4,n),Ce(e,8,s)}}))}}))}))})(p,u,c.baseTime/c.timescale),f>0?this.lastEndTime=_:(P.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var b=!!p.audio,E=!!p.video,S="";b&&(S+="audio"),E&&(S+="video");var w={data1:u,startPTS:v,startDTS:v,endPTS:_,endDTS:_,type:S,hasAudio:b,hasVideo:E,nb:1,dropped:0};return d.audio="audio"===w.type?w:void 0,d.video="audio"!==w.type?w:void 0,d.initSegment=h,d.id3=Ki(r,n,c,c),i.samples.length&&(d.text=qi(i,n,c)),d},e}();function Qi(e,t){var r=null==e?void 0:e.codec;return r&&r.length>4?r:"hvc1"===r||"hev1"===r?"hvc1.1.6.L120.90":"av01"===r?"av01.0.04M.08":"avc1"===r||t===N?"avc1.42e01e":"mp4a.40.5"}try{Wi=self.performance.now.bind(self.performance)}catch(e){P.debug("Unable to use Performance API on this environment"),Wi="undefined"!=typeof self&&self.Date.now}var Ji=[{demux:hi,remux:Yi},{demux:Ci,remux:Gi},{demux:di,remux:Gi},{demux:Oi,remux:Gi}],Xi=function(){function e(e,t,r,i,n){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.vendor=i,this.id=n}var t=e.prototype;return t.configure=function(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()},t.push=function(e,t,r,i){var n=this,s=r.transmuxing;s.executeStart=Wi();var a=new Uint8Array(e),o=this.currentTransmuxState,c=this.transmuxConfig;i&&(this.currentTransmuxState=i);var l=i||o,d=l.contiguous,u=l.discontinuity,h=l.trackSwitch,p=l.accurateTimeOffset,f=l.timeOffset,m=l.initSegmentChange,g=c.audioCodec,v=c.videoCodec,_=c.defaultInitPts,y=c.duration,w=c.initSegmentData,T=function(e,t){var r=null;return e.byteLength>0&&null!=t&&null!=t.key&&null!==t.iv&&null!=t.method&&(r=t),r}(a,t);if(T&&"AES-128"===T.method){var R=this.getDecrypter();if(!R.isSync())return this.decryptionPromise=R.webCryptoDecrypt(a,T.key.buffer,T.iv.buffer).then((function(e){var t=n.push(e,null,r);return n.decryptionPromise=null,t})),this.decryptionPromise;var C=R.softwareDecrypt(a,T.key.buffer,T.iv.buffer);if(r.part>-1&&(C=R.flush()),!C)return s.executeEnd=Wi(),Zi(r);a=new Uint8Array(C)}var A=this.needsProbing(u,h);if(A){var D=this.configureTransmuxer(a);if(D)return P.warn("[transmuxer] "+D.message),this.observer.emit(b.ERROR,b.ERROR,{type:E.MEDIA_ERROR,details:S.FRAG_PARSING_ERROR,fatal:!1,error:D,reason:D.message}),s.executeEnd=Wi(),Zi(r)}(u||h||m||A)&&this.resetInitSegment(w,g,v,y,t),(u||m||A)&&this.resetInitialTimestamp(_),d||this.resetContiguity();var L=this.transmux(a,T,f,p,r),k=this.currentTransmuxState;return k.contiguous=!0,k.discontinuity=!1,k.trackSwitch=!1,s.executeEnd=Wi(),L},t.flush=function(e){var t=this,r=e.transmuxing;r.executeStart=Wi();var i=this.decrypter,n=this.currentTransmuxState,s=this.decryptionPromise;if(s)return s.then((function(){return t.flush(e)}));var a=[],o=n.timeOffset;if(i){var c=i.flush();c&&a.push(this.push(c,null,e))}var l=this.demuxer,d=this.remuxer;if(!l||!d)return r.executeEnd=Wi(),[Zi(e)];var u=l.flush(o);return en(u)?u.then((function(r){return t.flushRemux(a,r,e),a})):(this.flushRemux(a,u,e),a)},t.flushRemux=function(e,t,r){var i=t.audioTrack,n=t.videoTrack,s=t.id3Track,a=t.textTrack,o=this.currentTransmuxState,c=o.accurateTimeOffset,l=o.timeOffset;P.log("[transmuxer.ts]: Flushed fragment "+r.sn+(r.part>-1?" p: "+r.part:"")+" of level "+r.level);var d=this.remuxer.remux(i,n,s,a,l,c,!0,this.id);e.push({remuxResult:d,chunkMeta:r}),r.transmuxing.executeEnd=Wi()},t.resetInitialTimestamp=function(e){var t=this.demuxer,r=this.remuxer;t&&r&&(t.resetTimeStamp(e),r.resetTimeStamp(e))},t.resetContiguity=function(){var e=this.demuxer,t=this.remuxer;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())},t.resetInitSegment=function(e,t,r,i,n){var s=this.demuxer,a=this.remuxer;s&&a&&(s.resetInitSegment(e,t,r,i),a.resetInitSegment(e,t,r,n))},t.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},t.transmux=function(e,t,r,i,n){return t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,r,i,n):this.transmuxUnencrypted(e,r,i,n)},t.transmuxUnencrypted=function(e,t,r,i){var n=this.demuxer.demux(e,t,!1,!this.config.progressive),s=n.audioTrack,a=n.videoTrack,o=n.id3Track,c=n.textTrack;return{remuxResult:this.remuxer.remux(s,a,o,c,t,r,!1,this.id),chunkMeta:i}},t.transmuxSampleAes=function(e,t,r,i,n){var s=this;return this.demuxer.demuxSampleAes(e,t,r).then((function(e){return{remuxResult:s.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,r,i,!1,s.id),chunkMeta:n}}))},t.configureTransmuxer=function(e){for(var t,r=this.config,i=this.observer,n=this.typeSupported,s=this.vendor,a=0,o=Ji.length;a<o;a++)if(Ji[a].demux.probe(e)){t=Ji[a];break}if(!t)return new Error("Failed to find demuxer by probing fragment data");var c=this.demuxer,l=this.remuxer,d=t.remux,u=t.demux;l&&l instanceof d||(this.remuxer=new d(i,r,n,s)),c&&c instanceof u||(this.demuxer=new u(i,r,n),this.probe=u.probe)},t.needsProbing=function(e,t){return!this.demuxer||!this.remuxer||e||t},t.getDecrypter=function(){var e=this.decrypter;return e||(e=this.decrypter=new Fr(this.config)),e},e}();var Zi=function(e){return{remuxResult:{},chunkMeta:e}};function en(e){return"then"in e&&e.then instanceof Function}var tn=function(e,t,r,i,n){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=r,this.duration=i,this.defaultInitPts=n||null},rn=function(e,t,r,i,n,s){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=r,this.trackSwitch=i,this.timeOffset=n,this.initSegmentChange=s},nn={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,r="~";function i(){}function n(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function s(e,t,i,s,a){if("function"!=typeof i)throw new TypeError("The listener must be a function");var o=new n(i,s||e,a),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],o]:e._events[c].push(o):(e._events[c]=o,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function o(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(r=!1)),o.prototype.eventNames=function(){var e,i,n=[];if(0===this._eventsCount)return n;for(i in e=this._events)t.call(e,i)&&n.push(r?i.slice(1):i);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},o.prototype.listeners=function(e){var t=r?r+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,s=i.length,a=new Array(s);n<s;n++)a[n]=i[n].fn;return a},o.prototype.listenerCount=function(e){var t=r?r+e:e,i=this._events[t];return i?i.fn?1:i.length:0},o.prototype.emit=function(e,t,i,n,s,a){var o=r?r+e:e;if(!this._events[o])return!1;var c,l,d=this._events[o],u=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),u){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,i),!0;case 4:return d.fn.call(d.context,t,i,n),!0;case 5:return d.fn.call(d.context,t,i,n,s),!0;case 6:return d.fn.call(d.context,t,i,n,s,a),!0}for(l=1,c=new Array(u-1);l<u;l++)c[l-1]=arguments[l];d.fn.apply(d.context,c)}else{var h,p=d.length;for(l=0;l<p;l++)switch(d[l].once&&this.removeListener(e,d[l].fn,void 0,!0),u){case 1:d[l].fn.call(d[l].context);break;case 2:d[l].fn.call(d[l].context,t);break;case 3:d[l].fn.call(d[l].context,t,i);break;case 4:d[l].fn.call(d[l].context,t,i,n);break;default:if(!c)for(h=1,c=new Array(u-1);h<u;h++)c[h-1]=arguments[h];d[l].fn.apply(d[l].context,c)}}return!0},o.prototype.on=function(e,t,r){return s(this,e,t,r,!1)},o.prototype.once=function(e,t,r){return s(this,e,t,r,!0)},o.prototype.removeListener=function(e,t,i,n){var s=r?r+e:e;if(!this._events[s])return this;if(!t)return a(this,s),this;var o=this._events[s];if(o.fn)o.fn!==t||n&&!o.once||i&&o.context!==i||a(this,s);else{for(var c=0,l=[],d=o.length;c<d;c++)(o[c].fn!==t||n&&!o[c].once||i&&o[c].context!==i)&&l.push(o[c]);l.length?this._events[s]=1===l.length?l[0]:l:a(this,s)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&a(this,t)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=r,o.EventEmitter=o,e.exports=o}(nn);var sn=g(nn.exports);function an(e,t){if(!((r=t.remuxResult).audio||r.video||r.text||r.id3||r.initSegment))return!1;var r,i=[],n=t.remuxResult,s=n.audio,a=n.video;return s&&on(i,s),a&&on(i,a),e.postMessage({event:"transmuxComplete",data:t},i),!0}function on(e,t){t.data1&&e.push(t.data1.buffer),t.data2&&e.push(t.data2.buffer)}function cn(e,t,r){t.reduce((function(t,r){return an(e,r)||t}),!1)||e.postMessage({event:"transmuxComplete",data:t[0]}),e.postMessage({event:"flush",data:r})}void 0!==r&&r&&function(e){var t=new sn,r=function(t,r){e.postMessage({event:t,data:r})};t.on(b.FRAG_DECRYPTED,r),t.on(b.ERROR,r),e.addEventListener("message",(function(i){var n=i.data;switch(n.cmd){case"init":var s=JSON.parse(n.config);e.transmuxer=new Xi(t,n.typeSupported,s,n.vendor,n.id),A(s.debug,n.id),function(){var e=function(e){P[e]=function(t){r("workerLog",{logType:e,message:t})}};for(var t in P)e(t)}(),r("init",null);break;case"configure":e.transmuxer.configure(n.config);break;case"demux":var a=e.transmuxer.push(n.data,n.decryptdata,n.chunkMeta,n.state);en(a)?(e.transmuxer.async=!0,a.then((function(t){an(e,t)})).catch((function(e){r(b.ERROR,{type:E.MEDIA_ERROR,details:S.FRAG_PARSING_ERROR,chunkMeta:n.chunkMeta,fatal:!1,error:e,err:e,reason:"transmuxer-worker push error"})}))):(e.transmuxer.async=!1,an(e,a));break;case"flush":var o=n.chunkMeta,c=e.transmuxer.flush(o);en(c)||e.transmuxer.async?(en(c)||(c=Promise.resolve(c)),c.then((function(t){cn(e,t,o)})).catch((function(e){r(b.ERROR,{type:E.MEDIA_ERROR,details:S.FRAG_PARSING_ERROR,chunkMeta:n.chunkMeta,fatal:!1,error:e,err:e,reason:"transmuxer-worker flush error"})}))):cn(e,c,o)}}))}(self);var ln=We()||{isTypeSupported:function(){return!1}},dn=function(){function e(e,r,i,n){var s=this;this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var a=e.config;this.hls=e,this.id=r,this.useWorker=!!a.enableWorker,this.onTransmuxComplete=i,this.onFlush=n;var o=function(e,t){(t=t||{}).frag=s.frag,t.id=s.id,e===b.ERROR&&(s.error=t.error),s.hls.trigger(e,t)};this.observer=new sn,this.observer.on(b.FRAG_DECRYPTED,o),this.observer.on(b.ERROR,o);var c,l,d,u,h={mp4:ln.isTypeSupported("video/mp4"),mpeg:ln.isTypeSupported("audio/mpeg"),mp3:ln.isTypeSupported('audio/mp4; codecs="mp3"')},p=navigator.vendor;if(this.useWorker&&"undefined"!=typeof Worker&&(a.workerPath,1))try{a.workerPath?(P.log("loading Web Worker "+a.workerPath+' for "'+r+'"'),this.workerContext=(d=a.workerPath,u=new self.URL(d,self.location.href).href,{worker:new self.Worker(u),scriptURL:u})):(P.log('injecting Web Worker for "'+r+'"'),this.workerContext=(c=new self.Blob(["var exports={};var module={exports:exports};function define(f){f()};define.amd=true;("+t.toString()+")(true);"],{type:"text/javascript"}),l=self.URL.createObjectURL(c),{worker:new self.Worker(l),objectURL:l})),this.onwmsg=function(e){return s.onWorkerMessage(e)};var f=this.workerContext.worker;f.addEventListener("message",this.onwmsg),f.onerror=function(e){var t=new Error(e.message+"  ("+e.filename+":"+e.lineno+")");a.enableWorker=!1,P.warn('Error in "'+r+'" Web Worker, fallback to inline'),s.hls.trigger(b.ERROR,{type:E.OTHER_ERROR,details:S.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:t})},f.postMessage({cmd:"init",typeSupported:h,vendor:p,id:r,config:JSON.stringify(a)})}catch(e){P.warn('Error setting up "'+r+'" Web Worker, fallback to inline',e),this.resetWorker(),this.error=null,this.transmuxer=new Xi(this.observer,h,a,p,r)}else this.transmuxer=new Xi(this.observer,h,a,p,r)}var r=e.prototype;return r.resetWorker=function(){if(this.workerContext){var e=this.workerContext,t=e.worker,r=e.objectURL;r&&self.URL.revokeObjectURL(r),t.removeEventListener("message",this.onwmsg),t.onerror=null,t.terminate(),this.workerContext=null}},r.destroy=function(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{var e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}var t=this.observer;t&&t.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},r.push=function(e,t,r,i,n,s,a,o,c,l){var d,u,h=this;c.transmuxing.start=self.performance.now();var p=this.transmuxer,f=s?s.start:n.start,m=n.decryptdata,g=this.frag,v=!(g&&n.cc===g.cc),_=!(g&&c.level===g.level),y=g?c.sn-g.sn:-1,b=this.part?c.part-this.part.index:-1,E=0===y&&c.id>1&&c.id===(null==g?void 0:g.stats.chunkCount),S=!_&&(1===y||0===y&&(1===b||E&&b<=0)),w=self.performance.now();(_||y||0===n.stats.parsing.start)&&(n.stats.parsing.start=w),!s||!b&&S||(s.stats.parsing.start=w);var T=!(g&&(null==(d=n.initSegment)?void 0:d.url)===(null==(u=g.initSegment)?void 0:u.url)),R=new rn(v,S,o,_,f,T);if(!S||v||T){P.log("[transmuxer-interface, "+n.type+"]: Starting new transmux session for sn: "+c.sn+" p: "+c.part+" level: "+c.level+" id: "+c.id+"\n        discontinuity: "+v+"\n        trackSwitch: "+_+"\n        contiguous: "+S+"\n        accurateTimeOffset: "+o+"\n        timeOffset: "+f+"\n        initSegmentChange: "+T);var C=new tn(r,i,t,a,l);this.configureTransmuxer(C)}if(this.frag=n,this.part=s,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:m,chunkMeta:c,state:R},e instanceof ArrayBuffer?[e]:[]);else if(p){var A=p.push(e,m,c,R);en(A)?(p.async=!0,A.then((function(e){h.handleTransmuxComplete(e)})).catch((function(e){h.transmuxerError(e,c,"transmuxer-interface push error")}))):(p.async=!1,this.handleTransmuxComplete(A))}},r.flush=function(e){var t=this;e.transmuxing.start=self.performance.now();var r=this.transmuxer;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(r){var i=r.flush(e);en(i)||r.async?(en(i)||(i=Promise.resolve(i)),i.then((function(r){t.handleFlushResult(r,e)})).catch((function(r){t.transmuxerError(r,e,"transmuxer-interface flush error")}))):this.handleFlushResult(i,e)}},r.transmuxerError=function(e,t,r){this.hls&&(this.error=e,this.hls.trigger(b.ERROR,{type:E.MEDIA_ERROR,details:S.FRAG_PARSING_ERROR,chunkMeta:t,fatal:!1,error:e,err:e,reason:r}))},r.handleFlushResult=function(e,t){var r=this;e.forEach((function(e){r.handleTransmuxComplete(e)})),this.onFlush(t)},r.onWorkerMessage=function(e){var t=e.data,r=this.hls;switch(t.event){case"init":var i,n=null==(i=this.workerContext)?void 0:i.objectURL;n&&self.URL.revokeObjectURL(n);break;case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":P[t.data.logType]&&P[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,r.trigger(t.event,t.data)}},r.configureTransmuxer=function(e){var t=this.transmuxer;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):t&&t.configure(e)},r.handleTransmuxComplete=function(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)},e}(),un=function(){function e(e,t,r,i){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=r,this.hls=i}var t=e.prototype;return t.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},t.poll=function(e,t){var r=this.config,i=this.media,n=this.stalled;if(null!==i){var s=i.currentTime,a=i.seeking,o=this.seeking&&!a,c=!this.seeking&&a;if(this.seeking=a,s===e){if(c||o)this.stalled=null;else if(!(i.paused&&!a||i.ended||0===i.playbackRate)&&Ar.getBuffered(i).length){var l=Ar.bufferInfo(i,s,0),d=l.len>0,u=l.nextStart||0;if(d||u){if(a){var h=l.len>2,p=!u||t&&t.start<=s||u-s>2&&!this.fragmentTracker.getPartialFragment(s);if(h||p)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var f,m=Math.max(u,l.start||0)-s,g=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,v=(null==g||null==(f=g.details)?void 0:f.live)?2*g.details.targetduration:2,_=this.fragmentTracker.getPartialFragment(s);if(m>0&&(m<=v||_))return void this._trySkipBufferHole(_)}var y=self.performance.now();if(null!==n){var b=y-n;if(a||!(b>=250)||(this._reportStall(l),this.media)){var E=Ar.bufferInfo(i,s,r.maxBufferHole);this._tryFixBufferStall(E,b)}}else this.stalled=y}}}else if(this.moved=!0,null!==n){if(this.stallReported){var S=self.performance.now()-n;P.warn("playback not stuck anymore @"+s+", after "+Math.round(S)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}}},t._tryFixBufferStall=function(e,t){var r=this.config,i=this.fragmentTracker,n=this.media;if(null!==n){var s=n.currentTime,a=i.getPartialFragment(s);if(a&&(this._trySkipBufferHole(a)||!this.media))return;(e.len>r.maxBufferHole||e.nextStart&&e.nextStart-s<r.maxBufferHole)&&t>1e3*r.highBufferWatchdogPeriod&&(P.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},t._reportStall=function(e){var t=this.hls,r=this.media;if(!this.stallReported&&r){this.stallReported=!0;var i=new Error("Playback stalling at @"+r.currentTime+" due to low buffer ("+JSON.stringify(e)+")");P.warn(i.message),t.trigger(b.ERROR,{type:E.MEDIA_ERROR,details:S.BUFFER_STALLED_ERROR,fatal:!1,error:i,buffer:e.len})}},t._trySkipBufferHole=function(e){var t=this.config,r=this.hls,i=this.media;if(null===i)return 0;var n=i.currentTime,s=Ar.bufferInfo(i,n,0),a=n<s.start?s.start:s.nextStart;if(a){var o=s.len<=t.maxBufferHole,c=s.len>0&&s.len<1&&i.readyState<3,l=a-n;if(l>0&&(o||c)){if(l>t.maxBufferHole){var d=this.fragmentTracker,u=!1;if(0===n){var h=d.getAppendedFrag(0,pt);h&&a<h.end&&(u=!0)}if(!u){var p=e||d.getAppendedFrag(n,pt);if(p){for(var f=!1,m=p.end;m<a;){var g=d.getPartialFragment(m);if(!g){f=!0;break}m+=g.duration}if(f)return 0}}}var v=Math.max(a+.05,n+.1);if(P.warn("skipping hole, adjusting currentTime from "+n+" to "+v),this.moved=!0,this.stalled=null,i.currentTime=v,e&&!e.gap){var _=new Error("fragment loaded with buffer holes, seeking from "+n+" to "+v);r.trigger(b.ERROR,{type:E.MEDIA_ERROR,details:S.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:_,reason:_.message,frag:e})}return v}}return 0},t._tryNudgeBuffer=function(){var e=this.config,t=this.hls,r=this.media,i=this.nudgeRetry;if(null!==r){var n=r.currentTime;if(this.nudgeRetry++,i<e.nudgeMaxRetry){var s=n+(i+1)*e.nudgeOffset,a=new Error("Nudging 'currentTime' from "+n+" to "+s);P.warn(a.message),r.currentTime=s,t.trigger(b.ERROR,{type:E.MEDIA_ERROR,details:S.BUFFER_NUDGE_ON_STALL,error:a,fatal:!1})}else{var o=new Error("Playhead still not moving while enough data buffered @"+n+" after "+e.nudgeMaxRetry+" nudges");P.error(o.message),t.trigger(b.ERROR,{type:E.MEDIA_ERROR,details:S.BUFFER_STALLED_ERROR,error:o,fatal:!0})}}},e}(),hn=function(e){function t(t,r,i){var n;return(n=e.call(this,t,r,i,"[stream-controller]",pt)||this).audioCodecSwap=!1,n.gapController=null,n.level=-1,n._forceStartLoad=!1,n.altAudio=!1,n.audioOnly=!1,n.fragPlaying=null,n.onvplaying=null,n.onvseeked=null,n.fragLastKbps=0,n.couldBacktrack=!1,n.backtrackFragment=null,n.audioCodecSwitch=!1,n.videoBuffer=null,n._registerListeners(),n}c(t,e);var r=t.prototype;return r._registerListeners=function(){var e=this.hls;e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.LEVEL_LOADING,this.onLevelLoading,this),e.on(b.LEVEL_LOADED,this.onLevelLoaded,this),e.on(b.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(b.ERROR,this.onError,this),e.on(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(b.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(b.BUFFER_CREATED,this.onBufferCreated,this),e.on(b.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(b.FRAG_BUFFERED,this.onFragBuffered,this)},r._unregisterListeners=function(){var e=this.hls;e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.LEVEL_LOADED,this.onLevelLoaded,this),e.off(b.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(b.ERROR,this.onError,this),e.off(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(b.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(b.BUFFER_CREATED,this.onBufferCreated,this),e.off(b.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(b.FRAG_BUFFERED,this.onFragBuffered,this)},r.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},r.startLoad=function(e){if(this.levels){var t=this.lastCurrentTime,r=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){var i=r.startLevel;-1===i&&(r.config.testBandwidth&&this.levels.length>1?(i=0,this.bitrateTest=!0):i=r.nextAutoLevel),this.level=r.nextLoadLevel=i,this.loadedmetadata=!1}t>0&&-1===e&&(this.log("Override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=Ur,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=jr},r.stopLoad=function(){this._forceStartLoad=!1,e.prototype.stopLoad.call(this)},r.doTick=function(){switch(this.state){case Qr:var e,t=this.levels,r=this.level,i=null==t||null==(e=t[r])?void 0:e.details;if(i&&(!i.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(i))break;this.state=Ur;break}if(this.hls.nextLoadLevel!==this.level){this.state=Ur;break}break;case Hr:var n,s=self.performance.now(),a=this.retryDate;(!a||s>=a||null!=(n=this.media)&&n.seeking)&&(this.resetStartWhenNotLoaded(this.level),this.state=Ur)}this.state===Ur&&this.doTickIdle(),this.onTickEnd()},r.onTickEnd=function(){e.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},r.doTickIdle=function(){var e=this.hls,t=this.levelLastLoaded,r=this.levels,i=this.media,n=e.config,s=e.nextLoadLevel;if(null!==t&&(i||!this.startFragRequested&&n.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&null!=r&&r[s]){var a=r[s],o=this.getMainFwdBufferInfo();if(null!==o){var c=this.getLevelDetails();if(c&&this._streamEnded(o,c)){var l={};return this.altAudio&&(l.type="video"),this.hls.trigger(b.BUFFER_EOS,l),void(this.state=zr)}e.loadLevel!==s&&-1===e.manualLevel&&this.log("Adapting to level "+s+" from level "+this.level),this.level=e.nextLoadLevel=s;var d=a.details;if(!d||this.state===Qr||d.live&&this.levelLastLoaded!==s)return this.level=s,void(this.state=Qr);var u=o.len,h=this.getMaxBufferLength(a.maxBitrate);if(!(u>=h)){this.backtrackFragment&&this.backtrackFragment.start>o.end&&(this.backtrackFragment=null);var p=this.backtrackFragment?this.backtrackFragment.start:o.end,f=this.getNextFragment(p,d);if(this.couldBacktrack&&!this.fragPrevious&&f&&"initSegment"!==f.sn&&this.fragmentTracker.getState(f)!==mr){var m,g=(null!=(m=this.backtrackFragment)?m:f).sn-d.startSN,v=d.fragments[g-1];v&&f.cc===v.cc&&(f=v,this.fragmentTracker.removeFragment(v))}else this.backtrackFragment&&o.len&&(this.backtrackFragment=null);if(f&&this.isLoopLoading(f,p)){if(!f.gap){var _=this.audioOnly&&!this.altAudio?x:N,y=(_===N?this.videoBuffer:this.mediaBuffer)||this.media;y&&this.afterBufferFlushed(y,_,pt)}f=this.getNextFragmentLoopLoading(f,d,o,pt,h)}f&&(!f.initSegment||f.initSegment.data||this.bitrateTest||(f=f.initSegment),this.loadFragment(f,a,p))}}}},r.loadFragment=function(t,r,i){var n=this.fragmentTracker.getState(t);this.fragCurrent=t,n===hr||n===fr?"initSegment"===t.sn?this._loadInitSegment(t,r):this.bitrateTest?(this.log("Fragment "+t.sn+" of level "+t.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(t,r)):(this.startFragRequested=!0,e.prototype.loadFragment.call(this,t,r,i)):this.clearTrackerIfNeeded(t)},r.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,pt)},r.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.end+.5):null},r.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},r.nextLevelSwitch=function(){var e=this.levels,t=this.media;if(null!=t&&t.readyState){var r,i=this.getAppendedFrag(t.currentTime);i&&i.start>1&&this.flushMainBuffer(0,i.start-1);var n=this.getLevelDetails();if(null!=n&&n.live){var s=this.getMainFwdBufferInfo();if(!s||s.len<2*n.targetduration)return}if(!t.paused&&e){var a=e[this.hls.nextLoadLevel],o=this.fragLastKbps;r=o&&this.fragCurrent?this.fragCurrent.duration*a.maxBitrate/(1e3*o)+1:0}else r=0;var c=this.getBufferedFrag(t.currentTime+r);if(c){var l=this.followingBufferedFrag(c);if(l){this.abortCurrentFrag();var d=l.maxStartPTS?l.maxStartPTS:l.start,u=l.duration,h=Math.max(c.end,d+Math.min(Math.max(u-this.config.maxFragLookUpTolerance,.5*u),.75*u));this.flushMainBuffer(h,Number.POSITIVE_INFINITY)}}}},r.abortCurrentFrag=function(){var e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case Vr:case Gr:case Hr:case qr:case Wr:this.state=Ur}this.nextLoadPosition=this.getLoadPosition()},r.flushMainBuffer=function(t,r){e.prototype.flushMainBuffer.call(this,t,r,this.altAudio?"video":null)},r.onMediaAttached=function(t,r){e.prototype.onMediaAttached.call(this,t,r);var i=r.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),i.addEventListener("playing",this.onvplaying),i.addEventListener("seeked",this.onvseeked),this.gapController=new un(this.config,i,this.fragmentTracker,this.hls)},r.onMediaDetaching=function(){var t=this.media;t&&this.onvplaying&&this.onvseeked&&(t.removeEventListener("playing",this.onvplaying),t.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),e.prototype.onMediaDetaching.call(this)},r.onMediaPlaying=function(){this.tick()},r.onMediaSeeked=function(){var e=this.media,t=e?e.currentTime:null;y(t)&&this.log("Media seeked to "+t.toFixed(3));var r=this.getMainFwdBufferInfo();null!==r&&0!==r.len?this.tick():this.warn('Main forward buffer length on "seeked" event '+(r?r.len:"empty")+")")},r.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(b.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.levels=this.fragPlaying=this.backtrackFragment=null,this.altAudio=this.audioOnly=!1},r.onManifestParsed=function(e,t){var r,i,n,s=!1,a=!1;t.levels.forEach((function(e){(r=e.audioCodec)&&(-1!==r.indexOf("mp4a.40.2")&&(s=!0),-1!==r.indexOf("mp4a.40.5")&&(a=!0))})),this.audioCodecSwitch=s&&a&&!("function"==typeof(null==(n=Xr())||null==(i=n.prototype)?void 0:i.changeType)),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1},r.onLevelLoading=function(e,t){var r=this.levels;if(r&&this.state===Ur){var i=r[t.level];(!i.details||i.details.live&&this.levelLastLoaded!==t.level||this.waitForCdnTuneIn(i.details))&&(this.state=Qr)}},r.onLevelLoaded=function(e,t){var r,i=this.levels,n=t.level,s=t.details,a=s.totalduration;if(i){this.log("Level "+n+" loaded ["+s.startSN+","+s.endSN+"]"+(s.lastPartSn?"[part-"+s.lastPartSn+"-"+s.lastPartIndex+"]":"")+", cc ["+s.startCC+", "+s.endCC+"] duration:"+a);var o=i[n],c=this.fragCurrent;!c||this.state!==Gr&&this.state!==Hr||c.level===t.level&&c.urlId===o.urlId||!c.loader||this.abortCurrentFrag();var l=0;if(s.live||null!=(r=o.details)&&r.live){if(s.fragments[0]||(s.deltaUpdateFailed=!0),s.deltaUpdateFailed)return;l=this.alignPlaylists(s,o.details)}if(o.details=s,this.levelLastLoaded=n,this.hls.trigger(b.LEVEL_UPDATED,{details:s,level:n}),this.state===Qr){if(this.waitForCdnTuneIn(s))return;this.state=Ur}this.startFragRequested?s.live&&this.synchronizeToLiveEdge(s):this.setStartPosition(s,l),this.tick()}else this.warn("Levels were reset while loading level "+n)},r._handleFragmentLoadProgress=function(e){var t,r=e.frag,i=e.part,n=e.payload,s=this.levels;if(s){var a=s[r.level],o=a.details;if(!o)return this.warn("Dropping fragment "+r.sn+" of level "+r.level+" after level details were reset"),void this.fragmentTracker.removeFragment(r);var c=a.videoCodec,l=o.PTSKnown||!o.live,d=null==(t=r.initSegment)?void 0:t.data,u=this._getAudioCodec(a),h=this.transmuxer=this.transmuxer||new dn(this.hls,pt,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),p=i?i.index:-1,f=-1!==p,m=new Pr(r.level,r.sn,r.stats.chunkCount,n.byteLength,p,f),g=this.initPTS[r.cc];h.push(n,d,u,c,r,i,o.totalduration,l,m,g)}else this.warn("Levels were reset while fragment load was in progress. Fragment "+r.sn+" of level "+r.level+" will not be buffered")},r.onAudioTrackSwitching=function(e,t){var r=this.altAudio;if(!t.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var i=this.fragCurrent;i&&(this.log("Switching to main audio track, cancel main fragment load"),i.abortRequests(),this.fragmentTracker.removeFragment(i)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var n=this.hls;r&&(n.trigger(b.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),n.trigger(b.AUDIO_TRACK_SWITCHED,t)}},r.onAudioTrackSwitched=function(e,t){var r=t.id,i=!!this.hls.audioTracks[r].url;if(i){var n=this.videoBuffer;n&&this.mediaBuffer!==n&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=n)}this.altAudio=i,this.tick()},r.onBufferCreated=function(e,t){var r,i,n=t.tracks,s=!1;for(var a in n){var o=n[a];if("main"===o.id){if(i=a,r=o,"video"===a){var c=n[a];c&&(this.videoBuffer=c.buffer)}}else s=!0}s&&r?(this.log("Alternate track found, use "+i+".buffered to schedule main fragment loading"),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media},r.onFragBuffered=function(e,t){var r=t.frag,i=t.part;if(!r||r.type===pt){if(this.fragContextChanged(r))return this.warn("Fragment "+r.sn+(i?" p: "+i.index:"")+" of level "+r.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===Wr&&(this.state=Ur));var n=i?i.stats:r.stats;this.fragLastKbps=Math.round(8*n.total/(n.buffering.end-n.loading.first)),"initSegment"!==r.sn&&(this.fragPrevious=r),this.fragBufferedComplete(r,i)}},r.onError=function(e,t){var r;if(t.fatal)this.state=$r;else switch(t.details){case S.FRAG_GAP:case S.FRAG_PARSING_ERROR:case S.FRAG_DECRYPT_ERROR:case S.FRAG_LOAD_ERROR:case S.FRAG_LOAD_TIMEOUT:case S.KEY_LOAD_ERROR:case S.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(pt,t);break;case S.LEVEL_LOAD_ERROR:case S.LEVEL_LOAD_TIMEOUT:case S.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==Qr||(null==(r=t.context)?void 0:r.type)!==dt||(this.state=Ur);break;case S.BUFFER_FULL_ERROR:if(!t.parent||"main"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case S.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}},r.checkBuffer=function(){var e=this.media,t=this.gapController;if(e&&t&&e.readyState){if(this.loadedmetadata||!Ar.getBuffered(e).length){var r=this.state!==Ur?this.fragCurrent:null;t.poll(this.lastCurrentTime,r)}this.lastCurrentTime=e.currentTime}},r.onFragLoadEmergencyAborted=function(){this.state=Ur,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},r.onBufferFlushed=function(e,t){var r=t.type;if(r!==x||this.audioOnly&&!this.altAudio){var i=(r===N?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(i,r,pt)}},r.onLevelsUpdated=function(e,t){this.levels=t.levels},r.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},r.seekToStartPos=function(){var e=this.media;if(e){var t=e.currentTime,r=this.startPosition;if(r>=0&&t<r){if(e.seeking)return void this.log("could not seek to "+r+", already seeking at "+t);var i=Ar.getBuffered(e),n=(i.length?i.start(0):0)-r;n>0&&(n<this.config.maxBufferHole||n<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+n+" to match buffer start"),r+=n,this.startPosition=r),this.log("seek to target start position "+r+" from current time "+t),e.currentTime=r}}},r._getAudioCodec=function(e){var t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t},r._loadBitrateTestFrag=function(e,t){var r=this;e.bitrateTest=!0,this._doFragLoad(e,t).then((function(i){var n=r.hls;if(i&&!r.fragContextChanged(e)){t.fragmentError=0,r.state=Ur,r.startFragRequested=!1,r.bitrateTest=!1;var s=e.stats;s.parsing.start=s.parsing.end=s.buffering.start=s.buffering.end=self.performance.now(),n.trigger(b.FRAG_LOADED,i),e.bitrateTest=!1}}))},r._handleTransmuxComplete=function(e){var t,r="main",i=this.hls,n=e.remuxResult,s=e.chunkMeta,a=this.getCurrentContext(s);if(a){var o=a.frag,c=a.part,l=a.level,d=n.video,u=n.text,h=n.id3,p=n.initSegment,f=l.details,m=this.altAudio?void 0:n.audio;if(this.fragContextChanged(o))this.fragmentTracker.removeFragment(o);else{if(this.state=qr,p){if(null!=p&&p.tracks){var g=o.initSegment||o;this._bufferInitSegment(l,p.tracks,g,s),i.trigger(b.FRAG_PARSING_INIT_SEGMENT,{frag:g,id:r,tracks:p.tracks})}var v=p.initPTS,_=p.timescale;y(v)&&(this.initPTS[o.cc]={baseTime:v,timescale:_},i.trigger(b.INIT_PTS_FOUND,{frag:o,id:r,initPTS:v,timescale:_}))}if(d&&!1!==n.independent){if(f){var E=d.startPTS,S=d.endPTS,w=d.startDTS,T=d.endDTS;if(c)c.elementaryStreams[d.type]={startPTS:E,endPTS:S,startDTS:w,endDTS:T};else if(d.firstKeyFrame&&d.independent&&1===s.id&&(this.couldBacktrack=!0),d.dropped&&d.independent){var R=this.getMainFwdBufferInfo();if((R?R.end:this.getLoadPosition())+this.config.maxBufferHole<(d.firstKeyFramePTS?d.firstKeyFramePTS:E)-this.config.maxBufferHole)return void this.backtrack(o);o.setElementaryStreamInfo(d.type,o.start,S,o.start,T,!0)}o.setElementaryStreamInfo(d.type,E,S,w,T),this.backtrackFragment&&(this.backtrackFragment=o),this.bufferFragmentData(d,o,c,s)}}else if(!1===n.independent)return void this.backtrack(o);if(m){var C=m.startPTS,A=m.endPTS,P=m.startDTS,D=m.endDTS;c&&(c.elementaryStreams[x]={startPTS:C,endPTS:A,startDTS:P,endDTS:D}),o.setElementaryStreamInfo(x,C,A,P,D),this.bufferFragmentData(m,o,c,s)}if(f&&null!=h&&null!=(t=h.samples)&&t.length){var L={id:r,frag:o,details:f,samples:h.samples};i.trigger(b.FRAG_PARSING_METADATA,L)}if(f&&u){var k={id:r,frag:o,details:f,samples:u.samples};i.trigger(b.FRAG_PARSING_USERDATA,k)}}}else this.resetWhenMissingContext(s)},r._bufferInitSegment=function(e,t,r,i){var n=this;if(this.state===qr){this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;var s=t.audio,a=t.video,o=t.audiovideo;if(s){var c=e.audioCodec,l=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(c&&(c=-1!==c.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==s.metadata.channelCount&&-1===l.indexOf("firefox")&&(c="mp4a.40.5")),-1!==l.indexOf("android")&&"audio/mpeg"!==s.container&&(c="mp4a.40.2",this.log("Android: force audio codec to "+c)),e.audioCodec&&e.audioCodec!==c&&this.log('Swapping manifest audio codec "'+e.audioCodec+'" for "'+c+'"'),s.levelCodec=c,s.id="main",this.log("Init audio buffer, container:"+s.container+", codecs[selected/level/parsed]=["+(c||"")+"/"+(e.audioCodec||"")+"/"+s.codec+"]")}a&&(a.levelCodec=e.videoCodec,a.id="main",this.log("Init video buffer, container:"+a.container+", codecs[level/parsed]=["+(e.videoCodec||"")+"/"+a.codec+"]")),o&&this.log("Init audiovideo buffer, container:"+o.container+", codecs[level/parsed]=["+(e.attrs.CODECS||"")+"/"+o.codec+"]"),this.hls.trigger(b.BUFFER_CODECS,t),Object.keys(t).forEach((function(e){var s=t[e].initSegment;null!=s&&s.byteLength&&n.hls.trigger(b.BUFFER_APPENDING,{type:e,data:s,frag:r,part:null,chunkMeta:i,parent:r.type})})),this.tick()}},r.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,pt)},r.backtrack=function(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=Ur},r.checkFragmentChanged=function(){var e=this.media,t=null;if(e&&e.readyState>1&&!1===e.seeking){var r=e.currentTime;if(Ar.isBuffered(e,r)?t=this.getAppendedFrag(r):Ar.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){this.backtrackFragment=null;var i=this.fragPlaying,n=t.level;i&&t.sn===i.sn&&i.level===n&&t.urlId===i.urlId||(this.fragPlaying=t,this.hls.trigger(b.FRAG_CHANGED,{frag:t}),i&&i.level===n||this.hls.trigger(b.LEVEL_SWITCHED,{level:n}))}}},s(t,[{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"currentFrag",get:function(){var e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}},{key:"currentProgramDateTime",get:function(){var e=this.media;if(e){var t=e.currentTime,r=this.currentFrag;if(r&&y(t)&&y(r.programDateTime)){var i=r.programDateTime+1e3*(t-r.start);return new Date(i)}}return null}},{key:"currentLevel",get:function(){var e=this.currentFrag;return e?e.level:-1}},{key:"nextBufferedFrag",get:function(){var e=this.currentFrag;return e?this.followingBufferedFrag(e):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),t}(Jr),pn=function(){function e(e,t,r){void 0===t&&(t=0),void 0===r&&(r=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}var t=e.prototype;return t.sample=function(e,t){var r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e},t.getTotalWeight=function(){return this.totalWeight_},t.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_},e}(),fn=function(){function e(e,t,r,i){void 0===i&&(i=100),this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new pn(e),this.fast_=new pn(t),this.defaultTTFB_=i,this.ttfb_=new pn(e)}var t=e.prototype;return t.update=function(e,t){var r=this.slow_,i=this.fast_,n=this.ttfb_;r.halfLife!==e&&(this.slow_=new pn(e,r.getEstimate(),r.getTotalWeight())),i.halfLife!==t&&(this.fast_=new pn(t,i.getEstimate(),i.getTotalWeight())),n.halfLife!==e&&(this.ttfb_=new pn(e,n.getEstimate(),n.getTotalWeight()))},t.sample=function(e,t){var r=(e=Math.max(e,this.minDelayMs_))/1e3,i=8*t/r;this.fast_.sample(r,i),this.slow_.sample(r,i)},t.sampleTTFB=function(e){var t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))},t.canEstimate=function(){return this.fast_.getTotalWeight()>=this.minWeight_},t.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},t.getEstimateTTFB=function(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_},t.destroy=function(){},e}(),mn=function(){function e(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=-1,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=e;var t=e.config;this.bwEstimator=new fn(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate),this.registerListeners()}var t=e.prototype;return t.registerListeners=function(){var e=this.hls;e.on(b.FRAG_LOADING,this.onFragLoading,this),e.on(b.FRAG_LOADED,this.onFragLoaded,this),e.on(b.FRAG_BUFFERED,this.onFragBuffered,this),e.on(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(b.LEVEL_LOADED,this.onLevelLoaded,this)},t.unregisterListeners=function(){var e=this.hls;e.off(b.FRAG_LOADING,this.onFragLoading,this),e.off(b.FRAG_LOADED,this.onFragLoaded,this),e.off(b.FRAG_BUFFERED,this.onFragBuffered,this),e.off(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(b.LEVEL_LOADED,this.onLevelLoaded,this)},t.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},t.onFragLoading=function(e,t){var r,i=t.frag;this.ignoreFragment(i)||(this.fragCurrent=i,this.partCurrent=null!=(r=t.part)?r:null,this.clearTimer(),this.timer=self.setInterval(this.onCheck,100))},t.onLevelSwitching=function(e,t){this.clearTimer()},t.getTimeToLoadFrag=function(e,t,r,i){return e+r/t+(i?this.lastLevelLoadSec:0)},t.onLevelLoaded=function(e,t){var r=this.hls.config,i=t.stats,n=i.total,s=i.bwEstimate;y(n)&&y(s)&&(this.lastLevelLoadSec=8*n/s),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)},t._abandonRulesCheck=function(){var e=this.fragCurrent,t=this.partCurrent,r=this.hls,i=r.autoLevelEnabled,n=r.media;if(e&&n){var s=performance.now(),a=t?t.stats:e.stats,o=t?t.duration:e.duration,c=s-a.loading.start;if(a.aborted||a.loaded&&a.loaded===a.total||0===e.level)return this.clearTimer(),void(this._nextAutoLevel=-1);if(i&&!n.paused&&n.playbackRate&&n.readyState){var l=r.mainForwardBufferInfo;if(null!==l){var d=this.bwEstimator.getEstimateTTFB(),u=Math.abs(n.playbackRate);if(!(c<=Math.max(d,o/(2*u)*1e3))){var h=l.len/u;if(!(h>=2*o/u)){var p=a.loading.first?a.loading.first-a.loading.start:-1,f=a.loaded&&p>-1,m=this.bwEstimator.getEstimate(),g=r.levels,v=r.minAutoLevel,_=g[e.level],E=a.total||Math.max(a.loaded,Math.round(o*_.maxBitrate/8)),S=c-p;S<1&&f&&(S=Math.min(c,8*a.loaded/m));var w=f?1e3*a.loaded/S:0,T=w?(E-a.loaded)/w:8*E/m+d/1e3;if(!(T<=h)){var R,C=w?8*w:m,A=Number.POSITIVE_INFINITY;for(R=e.level-1;R>v;R--){var D=g[R].maxBitrate;if((A=this.getTimeToLoadFrag(d/1e3,C,o*D,!g[R].details))<h)break}A>=T||A>10*o||(r.nextLoadLevel=R,f?this.bwEstimator.sample(c-Math.min(d,p),a.loaded):this.bwEstimator.sampleTTFB(c),this.clearTimer(),P.warn("[abr] Fragment "+e.sn+(t?" part "+t.index:"")+" of level "+e.level+" is loading too slowly;\n      Time to underbuffer: "+h.toFixed(3)+" s\n      Estimated load time for current fragment: "+T.toFixed(3)+" s\n      Estimated load time for down switch fragment: "+A.toFixed(3)+" s\n      TTFB estimate: "+p+"\n      Current BW estimate: "+(y(m)?(m/1024).toFixed(3):"Unknown")+" Kb/s\n      New BW estimate: "+(this.bwEstimator.getEstimate()/1024).toFixed(3)+" Kb/s\n      Aborting and switching to level "+R),e.loader&&(this.fragCurrent=this.partCurrent=null,e.abortRequests()),r.trigger(b.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:t,stats:a}))}}}}}}},t.onFragLoaded=function(e,t){var r=t.frag,i=t.part,n=i?i.stats:r.stats;if(r.type===pt&&this.bwEstimator.sampleTTFB(n.loading.first-n.loading.start),!this.ignoreFragment(r)){if(this.clearTimer(),this.lastLoadedFragLevel=r.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var s=i?i.duration:r.duration,a=this.hls.levels[r.level],o=(a.loaded?a.loaded.bytes:0)+n.loaded,c=(a.loaded?a.loaded.duration:0)+s;a.loaded={bytes:o,duration:c},a.realBitrate=Math.round(8*o/c)}if(r.bitrateTest){var l={stats:n,frag:r,part:i,id:r.type};this.onFragBuffered(b.FRAG_BUFFERED,l),r.bitrateTest=!1}}},t.onFragBuffered=function(e,t){var r=t.frag,i=t.part,n=null!=i&&i.stats.loaded?i.stats:r.stats;if(!n.aborted&&!this.ignoreFragment(r)){var s=n.parsing.end-n.loading.start-Math.min(n.loading.first-n.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(s,n.loaded),n.bwEstimate=this.bwEstimator.getEstimate(),r.bitrateTest?this.bitrateTestDelay=s/1e3:this.bitrateTestDelay=0}},t.ignoreFragment=function(e){return e.type!==pt||"initSegment"===e.sn},t.clearTimer=function(){self.clearInterval(this.timer)},t.getNextABRAutoLevel=function(){var e=this.fragCurrent,t=this.partCurrent,r=this.hls,i=r.maxAutoLevel,n=r.config,s=r.minAutoLevel,a=r.media,o=t?t.duration:e?e.duration:0,c=a&&0!==a.playbackRate?Math.abs(a.playbackRate):1,l=this.bwEstimator?this.bwEstimator.getEstimate():n.abrEwmaDefaultEstimate,d=r.mainForwardBufferInfo,u=(d?d.len:0)/c,h=this.findBestLevel(l,s,i,u,n.abrBandWidthFactor,n.abrBandWidthUpFactor);if(h>=0)return h;P.trace("[abr] "+(u?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var p=o?Math.min(o,n.maxStarvationDelay):n.maxStarvationDelay,f=n.abrBandWidthFactor,m=n.abrBandWidthUpFactor;if(!u){var g=this.bitrateTestDelay;g&&(p=(o?Math.min(o,n.maxLoadingDelay):n.maxLoadingDelay)-g,P.trace("[abr] bitrate test took "+Math.round(1e3*g)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*p)+" ms"),f=m=1)}return h=this.findBestLevel(l,s,i,u+p,f,m),Math.max(h,0)},t.findBestLevel=function(e,t,r,i,n,s){for(var a,o=this.fragCurrent,c=this.partCurrent,l=this.lastLoadedFragLevel,d=this.hls.levels,u=d[l],h=!(null==u||null==(a=u.details)||!a.live),p=null==u?void 0:u.codecSet,f=c?c.duration:o?o.duration:0,m=this.bwEstimator.getEstimateTTFB()/1e3,g=t,v=-1,_=r;_>=t;_--){var b=d[_];if(!b||p&&b.codecSet!==p)b&&(g=Math.min(_,g),v=Math.max(_,v));else{-1!==v&&P.trace("[abr] Skipped level(s) "+g+"-"+v+' with CODECS:"'+d[v].attrs.CODECS+'"; not compatible with "'+u.attrs.CODECS+'"');var E,S=b.details,w=(c?null==S?void 0:S.partTarget:null==S?void 0:S.averagetargetduration)||f;E=_<=l?n*e:s*e;var T=d[_].maxBitrate,R=this.getTimeToLoadFrag(m,E,T*w,void 0===S);if(P.trace("[abr] level:"+_+" adjustedbw-bitrate:"+Math.round(E-T)+" avgDuration:"+w.toFixed(1)+" maxFetchDuration:"+i.toFixed(1)+" fetchDuration:"+R.toFixed(1)),E>T&&(0===R||!y(R)||h&&!this.bitrateTestDelay||R<i))return _}}return-1},s(e,[{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this.bwEstimator;if(-1!==e&&!t.canEstimate())return e;var r=this.getNextABRAutoLevel();if(-1!==e){var i=this.hls.levels;if(i.length>Math.max(e,r)&&i[e].loadError<=i[r].loadError)return e}return-1!==e&&(r=Math.min(e,r)),r},set:function(e){this._nextAutoLevel=e}}]),e}(),gn=function(){function e(){this.chunks=[],this.dataLength=0}var t=e.prototype;return t.push=function(e){this.chunks.push(e),this.dataLength+=e.length},t.flush=function(){var e,t=this.chunks,r=this.dataLength;return t.length?(e=1===t.length?t[0]:function(e,t){for(var r=new Uint8Array(t),i=0,n=0;n<e.length;n++){var s=e[n];r.set(s,i),i+=s.length}return r}(t,r),this.reset(),e):new Uint8Array(0)},t.reset=function(){this.chunks.length=0,this.dataLength=0},e}();var vn=function(e){function t(t,r,i){var n;return(n=e.call(this,t,r,i,"[audio-stream-controller]",ft)||this).videoBuffer=null,n.videoTrackCC=-1,n.waitingVideoCC=-1,n.bufferedTrack=null,n.switchingTrack=null,n.trackId=-1,n.waitingData=null,n.mainDetails=null,n.bufferFlushed=!1,n.cachedTrackLoadedData=null,n._registerListeners(),n}c(t,e);var r=t.prototype;return r.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null},r._registerListeners=function(){var e=this.hls;e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.LEVEL_LOADED,this.onLevelLoaded,this),e.on(b.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(b.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(b.ERROR,this.onError,this),e.on(b.BUFFER_RESET,this.onBufferReset,this),e.on(b.BUFFER_CREATED,this.onBufferCreated,this),e.on(b.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(b.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(b.FRAG_BUFFERED,this.onFragBuffered,this)},r._unregisterListeners=function(){var e=this.hls;e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.LEVEL_LOADED,this.onLevelLoaded,this),e.off(b.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(b.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(b.ERROR,this.onError,this),e.off(b.BUFFER_RESET,this.onBufferReset,this),e.off(b.BUFFER_CREATED,this.onBufferCreated,this),e.off(b.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(b.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(b.FRAG_BUFFERED,this.onFragBuffered,this)},r.onInitPtsFound=function(e,t){var r=t.frag,i=t.id,n=t.initPTS,s=t.timescale;if("main"===i){var a=r.cc;this.initPTS[r.cc]={baseTime:n,timescale:s},this.log("InitPTS for cc: "+a+" found from main: "+n),this.videoTrackCC=a,this.state===Yr&&this.tick()}},r.startLoad=function(e){if(!this.levels)return this.startPosition=e,void(this.state=jr);var t=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),t>0&&-1===e?(this.log("Override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t,this.state=Ur):(this.loadedmetadata=!1,this.state=Kr),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()},r.doTick=function(){switch(this.state){case Ur:this.doTickIdle();break;case Kr:var t,r=this.levels,i=this.trackId,n=null==r||null==(t=r[i])?void 0:t.details;if(n){if(this.waitForCdnTuneIn(n))break;this.state=Yr}break;case Hr:var s,a=performance.now(),o=this.retryDate;(!o||a>=o||null!=(s=this.media)&&s.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=Ur);break;case Yr:var c=this.waitingData;if(c){var l=c.frag,d=c.part,u=c.cache,h=c.complete;if(void 0!==this.initPTS[l.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=Gr;var p={frag:l,part:d,payload:u.flush(),networkDetails:null};this._handleFragmentLoadProgress(p),h&&e.prototype._handleFragmentLoadComplete.call(this,p)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+l.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var f=this.getLoadPosition(),m=Ar.bufferInfo(this.mediaBuffer,f,this.config.maxBufferHole);Jt(m.end,this.config.maxFragLookUpTolerance,l)<0&&(this.log("Waiting fragment cc ("+l.cc+") @ "+l.start+" cancelled because another fragment at "+m.end+" is needed"),this.clearWaitingFragment())}}else this.state=Ur}this.onTickEnd()},r.clearWaitingFragment=function(){var e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=Ur)},r.resetLoadingState=function(){this.clearWaitingFragment(),e.prototype.resetLoadingState.call(this)},r.onTickEnd=function(){var e=this.media;null!=e&&e.readyState&&(this.lastCurrentTime=e.currentTime)},r.doTickIdle=function(){var e=this.hls,t=this.levels,r=this.media,i=this.trackId,n=e.config;if(null!=t&&t[i]&&(r||!this.startFragRequested&&n.startFragPrefetch)){var s=t[i],a=s.details;if(!a||a.live&&this.levelLastLoaded!==i||this.waitForCdnTuneIn(a))this.state=Kr;else{var o=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&o&&(this.bufferFlushed=!1,this.afterBufferFlushed(o,x,ft));var c=this.getFwdBufferInfo(o,ft);if(null!==c){var l=this.bufferedTrack,d=this.switchingTrack;if(!d&&this._streamEnded(c,a))return e.trigger(b.BUFFER_EOS,{type:"audio"}),void(this.state=zr);var u=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,pt),h=c.len,p=this.getMaxBufferLength(null==u?void 0:u.len);if(!(h>=p)||d){var f=a.fragments[0].start,m=c.end;if(d&&r){var g=this.getLoadPosition();l&&d.attrs!==l.attrs&&(m=g),a.PTSKnown&&g<f&&(c.end>f||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=f+.05)}var v=this.getNextFragment(m,a),_=!1;if(v&&this.isLoopLoading(v,m)&&(_=!!v.gap,v=this.getNextFragmentLoopLoading(v,a,c,pt,p)),v){var y=u&&v.start>u.end+a.targetduration;if(y||(null==u||!u.len)&&c.len){var E=this.getAppendedFrag(v.start,pt);if(null===E)return;if(_||(_=!!E.gap||!!y&&0===u.len),y&&!_||_&&c.nextStart&&c.nextStart<E.end)return}this.loadFragment(v,s,m)}else this.bufferFlushed=!0}}}}},r.getMaxBufferLength=function(t){var r=e.prototype.getMaxBufferLength.call(this);return t?Math.min(Math.max(r,t),this.config.maxMaxBufferLength):r},r.onMediaDetaching=function(){this.videoBuffer=null,e.prototype.onMediaDetaching.call(this)},r.onAudioTracksUpdated=function(e,t){var r=t.audioTracks;this.resetTransmuxer(),this.levels=r.map((function(e){return new Nt(e)}))},r.onAudioTrackSwitching=function(e,t){var r=!!t.url;this.trackId=t.id;var i=this.fragCurrent;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),r?this.setInterval(100):this.resetTransmuxer(),r?(this.switchingTrack=t,this.state=Ur):(this.switchingTrack=null,this.bufferedTrack=t,this.state=jr),this.tick()},r.onManifestLoading=function(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1},r.onLevelLoaded=function(e,t){this.mainDetails=t.details,null!==this.cachedTrackLoadedData&&(this.hls.trigger(b.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},r.onAudioTrackLoaded=function(e,t){var r;if(null!=this.mainDetails){var i=this.levels,n=t.details,s=t.id;if(i){this.log("Track "+s+" loaded ["+n.startSN+","+n.endSN+"]"+(n.lastPartSn?"[part-"+n.lastPartSn+"-"+n.lastPartIndex+"]":"")+",duration:"+n.totalduration);var a=i[s],o=0;if(n.live||null!=(r=a.details)&&r.live){var c=this.mainDetails;if(n.fragments[0]||(n.deltaUpdateFailed=!0),n.deltaUpdateFailed||!c)return;!a.details&&n.hasProgramDateTime&&c.hasProgramDateTime?(Or(n,c),o=n.fragments[0].start):o=this.alignPlaylists(n,a.details)}a.details=n,this.levelLastLoaded=s,this.startFragRequested||!this.mainDetails&&n.live||this.setStartPosition(a.details,o),this.state!==Kr||this.waitForCdnTuneIn(n)||(this.state=Ur),this.tick()}else this.warn("Audio tracks were reset while loading level "+s)}else this.cachedTrackLoadedData=t},r._handleFragmentLoadProgress=function(e){var t,r=e.frag,i=e.part,n=e.payload,s=this.config,a=this.trackId,o=this.levels;if(o){var c=o[a];if(c){var l=c.details;if(!l)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(r.start);var d=s.defaultAudioCodec||c.audioCodec||"mp4a.40.2",u=this.transmuxer;u||(u=this.transmuxer=new dn(this.hls,ft,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var h=this.initPTS[r.cc],p=null==(t=r.initSegment)?void 0:t.data;if(void 0!==h){var f=i?i.index:-1,m=-1!==f,g=new Pr(r.level,r.sn,r.stats.chunkCount,n.byteLength,f,m);u.push(n,p,d,"",r,i,l.totalduration,!1,g,h)}else this.log("Unknown video PTS for cc "+r.cc+", waiting for video PTS before demuxing audio frag "+r.sn+" of ["+l.startSN+" ,"+l.endSN+"],track "+a),(this.waitingData=this.waitingData||{frag:r,part:i,cache:new gn,complete:!1}).cache.push(new Uint8Array(n)),this.waitingVideoCC=this.videoTrackCC,this.state=Yr}else this.warn("Audio track is undefined on fragment load progress")}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+r.sn+" of level "+r.level+" will not be buffered")},r._handleFragmentLoadComplete=function(t){this.waitingData?this.waitingData.complete=!0:e.prototype._handleFragmentLoadComplete.call(this,t)},r.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},r.onBufferCreated=function(e,t){var r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer||null),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer||null)},r.onFragBuffered=function(e,t){var r=t.frag,n=t.part;if(r.type===ft)if(this.fragContextChanged(r))this.warn("Fragment "+r.sn+(n?" p: "+n.index:"")+" of level "+r.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+(this.switchingTrack?this.switchingTrack.name:"false"));else{if("initSegment"!==r.sn){this.fragPrevious=r;var s=this.switchingTrack;s&&(this.bufferedTrack=s,this.switchingTrack=null,this.hls.trigger(b.AUDIO_TRACK_SWITCHED,i({},s)))}this.fragBufferedComplete(r,n)}else if(!this.loadedmetadata&&r.type===pt){var a=this.videoBuffer||this.media;a&&Ar.getBuffered(a).length&&(this.loadedmetadata=!0)}},r.onError=function(t,r){var i;if(r.fatal)this.state=$r;else switch(r.details){case S.FRAG_GAP:case S.FRAG_PARSING_ERROR:case S.FRAG_DECRYPT_ERROR:case S.FRAG_LOAD_ERROR:case S.FRAG_LOAD_TIMEOUT:case S.KEY_LOAD_ERROR:case S.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ft,r);break;case S.AUDIO_TRACK_LOAD_ERROR:case S.AUDIO_TRACK_LOAD_TIMEOUT:case S.LEVEL_PARSING_ERROR:r.levelRetry||this.state!==Kr||(null==(i=r.context)?void 0:i.type)!==ut||(this.state=Ur);break;case S.BUFFER_FULL_ERROR:if(!r.parent||"audio"!==r.parent)return;this.reduceLengthAndFlushBuffer(r)&&(this.bufferedTrack=null,e.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio"));break;case S.INTERNAL_EXCEPTION:this.recoverWorkerError(r)}},r.onBufferFlushed=function(e,t){t.type===x&&(this.bufferFlushed=!0,this.state===zr&&(this.state=Ur))},r._handleTransmuxComplete=function(e){var t,r="audio",i=this.hls,n=e.remuxResult,s=e.chunkMeta,a=this.getCurrentContext(s);if(a){var c=a.frag,l=a.part,d=a.level.details,u=n.audio,h=n.text,p=n.id3,f=n.initSegment;if(!this.fragContextChanged(c)&&d){if(this.state=qr,this.switchingTrack&&u&&this.completeAudioSwitch(this.switchingTrack),null!=f&&f.tracks){var m=c.initSegment||c;this._bufferInitSegment(f.tracks,m,s),i.trigger(b.FRAG_PARSING_INIT_SEGMENT,{frag:m,id:r,tracks:f.tracks})}if(u){var g=u.startPTS,v=u.endPTS,_=u.startDTS,y=u.endDTS;l&&(l.elementaryStreams[x]={startPTS:g,endPTS:v,startDTS:_,endDTS:y}),c.setElementaryStreamInfo(x,g,v,_,y),this.bufferFragmentData(u,c,l,s)}if(null!=p&&null!=(t=p.samples)&&t.length){var E=o({id:r,frag:c,details:d},p);i.trigger(b.FRAG_PARSING_METADATA,E)}if(h){var S=o({id:r,frag:c,details:d},h);i.trigger(b.FRAG_PARSING_USERDATA,S)}}else this.fragmentTracker.removeFragment(c)}else this.resetWhenMissingContext(s)},r._bufferInitSegment=function(e,t,r){if(this.state===qr){e.video&&delete e.video;var i=e.audio;if(i){i.levelCodec=i.codec,i.id="audio",this.log("Init audio buffer, container:"+i.container+", codecs[parsed]=["+i.codec+"]"),this.hls.trigger(b.BUFFER_CODECS,e);var n=i.initSegment;if(null!=n&&n.byteLength){var s={type:"audio",frag:t,part:null,chunkMeta:r,parent:t.type,data:n};this.hls.trigger(b.BUFFER_APPENDING,s)}this.tick()}}},r.loadFragment=function(t,r,i){var n,s=this.fragmentTracker.getState(t);this.fragCurrent=t,this.switchingTrack||s===hr||s===fr?"initSegment"===t.sn?this._loadInitSegment(t,r):null!=(n=r.details)&&n.live&&!this.initPTS[t.cc]?(this.log("Waiting for video PTS in continuity counter "+t.cc+" of live stream before loading audio fragment "+t.sn+" of level "+this.trackId),this.state=Yr):(this.startFragRequested=!0,e.prototype.loadFragment.call(this,t,r,i)):this.clearTrackerIfNeeded(t)},r.completeAudioSwitch=function(t){var r=this.hls,n=this.media,s=this.bufferedTrack,a=null==s?void 0:s.attrs,o=t.attrs;n&&a&&(a.CHANNELS!==o.CHANNELS||a.NAME!==o.NAME||a.LANGUAGE!==o.LANGUAGE)&&(this.log("Switching audio track : flushing all audio"),e.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.bufferedTrack=t,this.switchingTrack=null,r.trigger(b.AUDIO_TRACK_SWITCHED,i({},t))},t}(Jr),_n=function(e){function t(t){var r;return(r=e.call(this,t,"[audio-track-controller]")||this).tracks=[],r.groupId=null,r.tracksInGroup=[],r.trackId=-1,r.currentTrack=null,r.selectDefaultTrack=!0,r.registerListeners(),r}c(t,e);var r=t.prototype;return r.registerListeners=function(){var e=this.hls;e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.LEVEL_LOADING,this.onLevelLoading,this),e.on(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(b.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(b.ERROR,this.onError,this)},r.unregisterListeners=function(){var e=this.hls;e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.LEVEL_LOADING,this.onLevelLoading,this),e.off(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(b.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(b.ERROR,this.onError,this)},r.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,e.prototype.destroy.call(this)},r.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0},r.onManifestParsed=function(e,t){this.tracks=t.audioTracks||[]},r.onAudioTrackLoaded=function(e,t){var r=t.id,i=t.groupId,n=t.details,s=this.tracksInGroup[r];if(s&&s.groupId===i){var a=s.details;s.details=t.details,this.log("audio-track "+r+' "'+s.name+'" lang:'+s.lang+" group:"+i+" loaded ["+n.startSN+"-"+n.endSN+"]"),r===this.trackId&&this.playlistLoaded(r,t,a)}else this.warn("Track with id:"+r+" and group:"+i+" not found in active group "+s.groupId)},r.onLevelLoading=function(e,t){this.switchLevel(t.level)},r.onLevelSwitching=function(e,t){this.switchLevel(t.level)},r.switchLevel=function(e){var t=this.hls.levels[e];if(null!=t&&t.audioGroupIds){var r=t.audioGroupIds[t.urlId];if(this.groupId!==r){this.groupId=r||null;var i=this.tracks.filter((function(e){return!r||e.groupId===r}));this.selectDefaultTrack&&!i.some((function(e){return e.default}))&&(this.selectDefaultTrack=!1),this.tracksInGroup=i;var n={audioTracks:i};this.log("Updating audio tracks, "+i.length+" track(s) found in group:"+r),this.hls.trigger(b.AUDIO_TRACKS_UPDATED,n),this.selectInitialTrack()}else this.shouldReloadPlaylist(this.currentTrack)&&this.setAudioTrack(this.trackId)}},r.onError=function(e,t){!t.fatal&&t.context&&t.context.type===ut&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&(this.requestScheduled=-1,this.checkRetry(t))},r.setAudioTrack=function(e){var t=this.tracksInGroup;if(e<0||e>=t.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var r=this.currentTrack;t[this.trackId];var n=t[e],s=n.groupId,a=n.name;if(this.log("Switching to audio-track "+e+' "'+a+'" lang:'+n.lang+" group:"+s),this.trackId=e,this.currentTrack=n,this.selectDefaultTrack=!1,this.hls.trigger(b.AUDIO_TRACK_SWITCHING,i({},n)),!n.details||n.details.live){var o=this.switchParams(n.url,null==r?void 0:r.details);this.loadPlaylist(o)}}},r.selectInitialTrack=function(){var e=this.tracksInGroup,t=this.findTrackId(this.currentTrack)|this.findTrackId(null);if(-1!==t)this.setAudioTrack(t);else{var r=new Error("No track found for running audio group-ID: "+this.groupId+" track count: "+e.length);this.warn(r.message),this.hls.trigger(b.ERROR,{type:E.MEDIA_ERROR,details:S.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:r})}},r.findTrackId=function(e){for(var t=this.tracksInGroup,r=0;r<t.length;r++){var i=t[r];if(!this.selectDefaultTrack||i.default){if(!e||void 0!==e.attrs["STABLE-RENDITION-ID"]&&e.attrs["STABLE-RENDITION-ID"]===i.attrs["STABLE-RENDITION-ID"])return i.id;if(e.name===i.name&&e.lang===i.lang)return i.id}}return-1},r.loadPlaylist=function(t){e.prototype.loadPlaylist.call(this);var r=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(r)){var i=r.id,n=r.groupId,s=r.url;if(t)try{s=t.addDirectives(s)}catch(e){this.warn("Could not construct new URL with HLS Delivery Directives: "+e)}this.log("loading audio-track playlist "+i+' "'+r.name+'" lang:'+r.lang+" group:"+n),this.clearTimer(),this.hls.trigger(b.AUDIO_TRACK_LOADING,{url:s,id:i,groupId:n,deliveryDirectives:t||null})}},s(t,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}}]),t}(cr);function yn(e,t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!bn(e[r].attrs,t[r].attrs))return!1;return!0}function bn(e,t){var r=e["STABLE-RENDITION-ID"];return r?r===t["STABLE-RENDITION-ID"]:!["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED"].some((function(r){return e[r]!==t[r]}))}var En=function(e){function t(t,r,i){var n;return(n=e.call(this,t,r,i,"[subtitle-stream-controller]",mt)||this).levels=[],n.currentTrackId=-1,n.tracksBuffered=[],n.mainDetails=null,n._registerListeners(),n}c(t,e);var r=t.prototype;return r.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},r._registerListeners=function(){var e=this.hls;e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.LEVEL_LOADED,this.onLevelLoaded,this),e.on(b.ERROR,this.onError,this),e.on(b.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(b.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(b.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(b.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(b.FRAG_BUFFERED,this.onFragBuffered,this)},r._unregisterListeners=function(){var e=this.hls;e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.LEVEL_LOADED,this.onLevelLoaded,this),e.off(b.ERROR,this.onError,this),e.off(b.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(b.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(b.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(b.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(b.FRAG_BUFFERED,this.onFragBuffered,this)},r.startLoad=function(e){this.stopLoad(),this.state=Ur,this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()},r.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},r.onMediaDetaching=function(){this.tracksBuffered=[],e.prototype.onMediaDetaching.call(this)},r.onLevelLoaded=function(e,t){this.mainDetails=t.details},r.onSubtitleFragProcessed=function(e,t){var r=t.frag,i=t.success;if(this.fragPrevious=r,this.state=Ur,i){var n=this.tracksBuffered[this.currentTrackId];if(n){for(var s,a=r.start,o=0;o<n.length;o++)if(a>=n[o].start&&a<=n[o].end){s=n[o];break}var c=r.start+r.duration;s?s.end=c:(s={start:a,end:c},n.push(s)),this.fragmentTracker.fragBuffered(r)}}},r.onBufferFlushing=function(e,t){var r=t.startOffset,i=t.endOffset;if(0===r&&i!==Number.POSITIVE_INFINITY){var n=this.currentTrackId,s=this.levels;if(!s.length||!s[n]||!s[n].details)return;var a=i-s[n].details.targetduration;if(a<=0)return;t.endOffsetSubtitles=Math.max(0,a),this.tracksBuffered.forEach((function(e){for(var t=0;t<e.length;)if(e[t].end<=a)e.shift();else{if(!(e[t].start<a))break;e[t].start=a,t++}})),this.fragmentTracker.removeFragmentsInRange(r,a,mt)}},r.onFragBuffered=function(e,t){var r;this.loadedmetadata||t.frag.type!==pt||null!=(r=this.media)&&r.buffered.length&&(this.loadedmetadata=!0)},r.onError=function(e,t){var r=t.frag;(null==r?void 0:r.type)===mt&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==jr&&(this.state=Ur))},r.onSubtitleTracksUpdated=function(e,t){var r=this,i=t.subtitleTracks;yn(this.levels,i)?this.levels=i.map((function(e){return new Nt(e)})):(this.tracksBuffered=[],this.levels=i.map((function(e){var t=new Nt(e);return r.tracksBuffered[t.id]=[],t})),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,mt),this.fragPrevious=null,this.mediaBuffer=null)},r.onSubtitleTrackSwitch=function(e,t){if(this.currentTrackId=t.id,this.levels.length&&-1!==this.currentTrackId){var r=this.levels[this.currentTrackId];null!=r&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.setInterval(500)}else this.clearInterval()},r.onSubtitleTrackLoaded=function(e,t){var r,i=t.details,n=t.id,s=this.currentTrackId,a=this.levels;if(a.length){var o=a[s];if(!(n>=a.length||n!==s)&&o){this.mediaBuffer=this.mediaBufferTimeRanges;var c=0;if(i.live||null!=(r=o.details)&&r.live){var l=this.mainDetails;if(i.deltaUpdateFailed||!l)return;var d=l.fragments[0];o.details?0===(c=this.alignPlaylists(i,o.details))&&d&&Vt(i,c=d.start):i.hasProgramDateTime&&l.hasProgramDateTime?(Or(i,l),c=i.fragments[0].start):d&&Vt(i,c=d.start)}o.details=i,this.levelLastLoaded=n,this.startFragRequested||!this.mainDetails&&i.live||this.setStartPosition(o.details,c),this.tick(),i.live&&!this.fragCurrent&&this.media&&this.state===Ur&&(Qt(null,i.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),o.details=void 0))}}},r._handleFragmentLoadComplete=function(e){var t=this,r=e.frag,i=e.payload,n=r.decryptdata,s=this.hls;if(!this.fragContextChanged(r)&&i&&i.byteLength>0&&n&&n.key&&n.iv&&"AES-128"===n.method){var a=performance.now();this.decrypter.decrypt(new Uint8Array(i),n.key.buffer,n.iv.buffer).catch((function(e){throw s.trigger(b.ERROR,{type:E.MEDIA_ERROR,details:S.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:r}),e})).then((function(e){var t=performance.now();s.trigger(b.FRAG_DECRYPTED,{frag:r,payload:e,stats:{tstart:a,tdecrypt:t}})})).catch((function(e){t.warn(e.name+": "+e.message),t.state=Ur}))}},r.doTick=function(){if(this.media){if(this.state===Ur){var e=this.currentTrackId,t=this.levels,r=t[e];if(!t.length||!r||!r.details)return;var i=r.details,n=i.targetduration,s=this.config,a=this.getLoadPosition(),o=Ar.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],a-n,s.maxBufferHole),c=o.end,l=o.len,d=this.getFwdBufferInfo(this.media,pt);if(l>this.getMaxBufferLength(null==d?void 0:d.len)+n)return;var u=i.fragments,h=u.length,p=i.edge,f=null,m=this.fragPrevious;if(c<p){var g=s.maxFragLookUpTolerance;!(f=Qt(m,u,Math.max(u[0].start,c),g))&&m&&m.start<u[0].start&&(f=u[0])}else f=u[h-1];if(!f)return;f=this.mapToInitFragWhenRequired(f),this.fragmentTracker.getState(f)===hr&&this.loadFragment(f,r,c)}}else this.state=Ur},r.getMaxBufferLength=function(t){var r=e.prototype.getMaxBufferLength.call(this);return t?Math.max(r,t):r},r.loadFragment=function(t,r,i){this.fragCurrent=t,"initSegment"===t.sn?this._loadInitSegment(t,r):(this.startFragRequested=!0,e.prototype.loadFragment.call(this,t,r,i))},s(t,[{key:"mediaBufferTimeRanges",get:function(){return new Sn(this.tracksBuffered[this.currentTrackId]||[])}}]),t}(Jr),Sn=function(e){this.buffered=void 0;var t=function(t,r,i){if((r>>>=0)>i-1)throw new DOMException("Failed to execute '"+t+"' on 'TimeRanges': The index provided ("+r+") is greater than the maximum bound ("+i+")");return e[r][t]};this.buffered={get length(){return e.length},end:function(r){return t("end",r,e.length)},start:function(r){return t("start",r,e.length)}}},wn=function(e){function t(t){var r;return(r=e.call(this,t,"[subtitle-track-controller]")||this).media=null,r.tracks=[],r.groupId=null,r.tracksInGroup=[],r.trackId=-1,r.selectDefaultTrack=!0,r.queuedDefaultTrack=-1,r.trackChangeListener=function(){return r.onTextTracksChanged()},r.asyncPollTrackChange=function(){return r.pollTrackChange(0)},r.useTextTrackPolling=!1,r.subtitlePollingInterval=-1,r._subtitleDisplay=!0,r.registerListeners(),r}c(t,e);var r=t.prototype;return r.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,e.prototype.destroy.call(this)},r.registerListeners=function(){var e=this.hls;e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.LEVEL_LOADING,this.onLevelLoading,this),e.on(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(b.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(b.ERROR,this.onError,this)},r.unregisterListeners=function(){var e=this.hls;e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.LEVEL_LOADING,this.onLevelLoading,this),e.off(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(b.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(b.ERROR,this.onError,this)},r.onMediaAttached=function(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},r.pollTrackChange=function(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)},r.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),Tn(this.media.textTracks).forEach((function(e){Et(e)})),this.subtitleTrack=-1,this.media=null)},r.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},r.onManifestParsed=function(e,t){this.tracks=t.subtitleTracks},r.onSubtitleTrackLoaded=function(e,t){var r=t.id,i=t.details,n=this.trackId,s=this.tracksInGroup[n];if(s){var a=s.details;s.details=t.details,this.log("subtitle track "+r+" loaded ["+i.startSN+"-"+i.endSN+"]"),r===this.trackId&&this.playlistLoaded(r,t,a)}else this.warn("Invalid subtitle track id "+r)},r.onLevelLoading=function(e,t){this.switchLevel(t.level)},r.onLevelSwitching=function(e,t){this.switchLevel(t.level)},r.switchLevel=function(e){var t=this.hls.levels[e];if(null!=t&&t.textGroupIds){var r=t.textGroupIds[t.urlId],i=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;if(this.groupId!==r){var n=this.tracks.filter((function(e){return!r||e.groupId===r}));this.tracksInGroup=n;var s=this.findTrackId(null==i?void 0:i.name)||this.findTrackId();this.groupId=r||null;var a={subtitleTracks:n};this.log("Updating subtitle tracks, "+n.length+' track(s) found in "'+r+'" group-id'),this.hls.trigger(b.SUBTITLE_TRACKS_UPDATED,a),-1!==s&&this.setSubtitleTrack(s,i)}else this.shouldReloadPlaylist(i)&&this.setSubtitleTrack(this.trackId,i)}},r.findTrackId=function(e){for(var t=this.tracksInGroup,r=0;r<t.length;r++){var i=t[r];if((!this.selectDefaultTrack||i.default)&&(!e||e===i.name))return i.id}return-1},r.onError=function(e,t){!t.fatal&&t.context&&t.context.type===ht&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&this.checkRetry(t)},r.loadPlaylist=function(t){e.prototype.loadPlaylist.call(this);var r=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(r)){var i=r.id,n=r.groupId,s=r.url;if(t)try{s=t.addDirectives(s)}catch(e){this.warn("Could not construct new URL with HLS Delivery Directives: "+e)}this.log("Loading subtitle playlist for id "+i),this.hls.trigger(b.SUBTITLE_TRACK_LOADING,{url:s,id:i,groupId:n,deliveryDirectives:t||null})}},r.toggleTrackModes=function(e){var t=this,r=this.media,i=this.trackId;if(r){var n=Tn(r.textTracks),s=n.filter((function(e){return e.groupId===t.groupId}));if(-1===e)[].slice.call(n).forEach((function(e){e.mode="disabled"}));else{var a=s[i];a&&(a.mode="disabled")}var o=s[e];o&&(o.mode=this.subtitleDisplay?"showing":"hidden")}},r.setSubtitleTrack=function(e,t){var r,i=this.tracksInGroup;if(this.media){if(this.trackId!==e&&this.toggleTrackModes(e),!(this.trackId===e&&(-1===e||null!=(r=i[e])&&r.details)||e<-1||e>=i.length)){this.clearTimer();var n=i[e];if(this.log("Switching to subtitle-track "+e+(n?' "'+n.name+'" lang:'+n.lang+" group:"+n.groupId:"")),this.trackId=e,n){var s=n.id,a=n.groupId,o=void 0===a?"":a,c=n.name,l=n.type,d=n.url;this.hls.trigger(b.SUBTITLE_TRACK_SWITCH,{id:s,groupId:o,name:c,type:l,url:d});var u=this.switchParams(n.url,null==t?void 0:t.details);this.loadPlaylist(u)}else this.hls.trigger(b.SUBTITLE_TRACK_SWITCH,{id:e})}}else this.queuedDefaultTrack=e},r.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var e=-1,t=Tn(this.media.textTracks),r=0;r<t.length;r++)if("hidden"===t[r].mode)e=r;else if("showing"===t[r].mode){e=r;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}},s(t,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1;var t=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,t)}}]),t}(cr);function Tn(e){for(var t=[],r=0;r<e.length;r++){var i=e[r];"subtitles"!==i.kind&&"captions"!==i.kind||!i.label||t.push(e[r])}return t}var Rn=function(){function e(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}var t=e.prototype;return t.append=function(e,t){var r=this.queues[t];r.push(e),1===r.length&&this.buffers[t]&&this.executeNext(t)},t.insertAbort=function(e,t){this.queues[t].unshift(e),this.executeNext(t)},t.appendBlocker=function(e){var t,r=new Promise((function(e){t=e})),i={execute:t,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(i,e),r},t.executeNext=function(e){var t=this.buffers,r=this.queues,i=t[e],n=r[e];if(n.length){var s=n[0];try{s.execute()}catch(t){P.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),s.onError(t),null!=i&&i.updating||(n.shift(),this.executeNext(e))}}},t.shiftAndExecuteNext=function(e){this.queues[e].shift(),this.executeNext(e)},t.current=function(e){return this.queues[e][0]},e}(),Cn=We(),An=/([ha]vc.)(?:\.[^.,]+)+/,Pn=function(){function e(e){var t=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var e=t.media,r=t.mediaSource;P.log("[buffer-controller]: Media source opened"),e&&(e.removeEventListener("emptied",t._onMediaEmptied),t.updateMediaElementDuration(),t.hls.trigger(b.MEDIA_ATTACHED,{media:e})),r&&r.removeEventListener("sourceopen",t._onMediaSourceOpen),t.checkPendingTracks()},this._onMediaSourceClose=function(){P.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){P.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=function(){var e=t.media,r=t._objectUrl;e&&e.src!==r&&P.error("Media element src was set while attaching MediaSource ("+r+" > "+e.src+")")},this.hls=e,this._initSourceBuffer(),this.registerListeners()}var t=e.prototype;return t.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},t.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null},t.registerListeners=function(){var e=this.hls;e.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.BUFFER_RESET,this.onBufferReset,this),e.on(b.BUFFER_APPENDING,this.onBufferAppending,this),e.on(b.BUFFER_CODECS,this.onBufferCodecs,this),e.on(b.BUFFER_EOS,this.onBufferEos,this),e.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(b.FRAG_PARSED,this.onFragParsed,this),e.on(b.FRAG_CHANGED,this.onFragChanged,this)},t.unregisterListeners=function(){var e=this.hls;e.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.BUFFER_RESET,this.onBufferReset,this),e.off(b.BUFFER_APPENDING,this.onBufferAppending,this),e.off(b.BUFFER_CODECS,this.onBufferCodecs,this),e.off(b.BUFFER_EOS,this.onBufferEos,this),e.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(b.FRAG_PARSED,this.onFragParsed,this),e.off(b.FRAG_CHANGED,this.onFragChanged,this)},t._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new Rn(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null},t.onManifestLoading=function(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null},t.onManifestParsed=function(e,t){var r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,P.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},t.onMediaAttaching=function(e,t){var r=this.media=t.media;if(r&&Cn){var i=this.mediaSource=new Cn;i.addEventListener("sourceopen",this._onMediaSourceOpen),i.addEventListener("sourceended",this._onMediaSourceEnded),i.addEventListener("sourceclose",this._onMediaSourceClose),r.src=self.URL.createObjectURL(i),this._objectUrl=r.src,r.addEventListener("emptied",this._onMediaEmptied)}},t.onMediaDetaching=function(){var e=this.media,t=this.mediaSource,r=this._objectUrl;if(t){if(P.log("[buffer-controller]: media source detaching"),"open"===t.readyState)try{t.endOfStream()}catch(e){P.warn("[buffer-controller]: onMediaDetaching: "+e.message+" while calling endOfStream")}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(e.removeEventListener("emptied",this._onMediaEmptied),r&&self.URL.revokeObjectURL(r),e.src===r?(e.removeAttribute("src"),e.load()):P.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(b.MEDIA_DETACHED,void 0)},t.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach((function(t){var r=e.sourceBuffer[t];try{r&&(e.removeBufferListeners(t),e.mediaSource&&e.mediaSource.removeSourceBuffer(r),e.sourceBuffer[t]=void 0)}catch(e){P.warn("[buffer-controller]: Failed to reset the "+t+" buffer",e)}})),this._initSourceBuffer()},t.onBufferCodecs=function(e,t){var r=this,i=this.getSourceBufferTypes().length;Object.keys(t).forEach((function(e){if(i){var n=r.tracks[e];if(n&&"function"==typeof n.buffer.changeType){var s=t[e],a=s.id,o=s.codec,c=s.levelCodec,l=s.container,d=s.metadata,u=(n.levelCodec||n.codec).replace(An,"$1"),h=(c||o).replace(An,"$1");if(u!==h){var p=l+";codecs="+(c||o);r.appendChangeType(e,p),P.log("[buffer-controller]: switching codec "+u+" to "+h),r.tracks[e]={buffer:n.buffer,codec:o,container:l,levelCodec:c,metadata:d,id:a}}}}else r.pendingTracks[e]=t[e]})),i||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},t.appendChangeType=function(e,t){var r=this,i=this.operationQueue,n={execute:function(){var n=r.sourceBuffer[e];n&&(P.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+t),n.changeType(t)),i.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(t){P.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",t)}};i.append(n,e)},t.onBufferAppending=function(e,t){var r=this,i=this.hls,n=this.operationQueue,s=this.tracks,a=t.data,o=t.type,c=t.frag,l=t.part,d=t.chunkMeta,u=d.buffering[o],h=self.performance.now();u.start=h;var p=c.stats.buffering,f=l?l.stats.buffering:null;0===p.start&&(p.start=h),f&&0===f.start&&(f.start=h);var m=s.audio,g=!1;"audio"===o&&"audio/mpeg"===(null==m?void 0:m.container)&&(g=!this.lastMpegAudioChunk||1===d.id||this.lastMpegAudioChunk.sn!==d.sn,this.lastMpegAudioChunk=d);var v=c.start,_={execute:function(){if(u.executeStart=self.performance.now(),g){var e=r.sourceBuffer[o];if(e){var t=v-e.timestampOffset;Math.abs(t)>=.1&&(P.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+v+" (delta: "+t+") sn: "+c.sn+")"),e.timestampOffset=v)}}r.appendExecutor(a,o)},onStart:function(){},onComplete:function(){var e=self.performance.now();u.executeEnd=u.end=e,0===p.first&&(p.first=e),f&&0===f.first&&(f.first=e);var t=r.sourceBuffer,i={};for(var n in t)i[n]=Ar.getBuffered(t[n]);r.appendError=0,r.hls.trigger(b.BUFFER_APPENDED,{type:o,frag:c,part:l,chunkMeta:d,parent:c.type,timeRanges:i})},onError:function(e){P.error("[buffer-controller]: Error encountered while trying to append to the "+o+" SourceBuffer",e);var t={type:E.MEDIA_ERROR,parent:c.type,details:S.BUFFER_APPEND_ERROR,frag:c,part:l,chunkMeta:d,error:e,err:e,fatal:!1};e.code===DOMException.QUOTA_EXCEEDED_ERR?t.details=S.BUFFER_FULL_ERROR:(r.appendError++,t.details=S.BUFFER_APPEND_ERROR,r.appendError>i.config.appendErrorMaxRetry&&(P.error("[buffer-controller]: Failed "+i.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),t.fatal=!0)),i.trigger(b.ERROR,t)}};n.append(_,o)},t.onBufferFlushing=function(e,t){var r=this,i=this.operationQueue,n=function(e){return{execute:r.removeExecutor.bind(r,e,t.startOffset,t.endOffset),onStart:function(){},onComplete:function(){r.hls.trigger(b.BUFFER_FLUSHED,{type:e})},onError:function(t){P.warn("[buffer-controller]: Failed to remove from "+e+" SourceBuffer",t)}}};t.type?i.append(n(t.type),t.type):this.getSourceBufferTypes().forEach((function(e){i.append(n(e),e)}))},t.onFragParsed=function(e,t){var r=this,i=t.frag,n=t.part,s=[],a=n?n.elementaryStreams:i.elementaryStreams;a[F]?s.push("audiovideo"):(a[x]&&s.push("audio"),a[N]&&s.push("video"));0===s.length&&P.warn("Fragments must have at least one ElementaryStreamType set. type: "+i.type+" level: "+i.level+" sn: "+i.sn),this.blockBuffers((function(){var e=self.performance.now();i.stats.buffering.end=e,n&&(n.stats.buffering.end=e);var t=n?n.stats:i.stats;r.hls.trigger(b.FRAG_BUFFERED,{frag:i,part:n,stats:t,id:i.type})}),s)},t.onFragChanged=function(e,t){this.flushBackBuffer()},t.onBufferEos=function(e,t){var r=this;this.getSourceBufferTypes().reduce((function(e,i){var n=r.sourceBuffer[i];return!n||t.type&&t.type!==i||(n.ending=!0,n.ended||(n.ended=!0,P.log("[buffer-controller]: "+i+" sourceBuffer now EOS"))),e&&!(n&&!n.ended)}),!0)&&(P.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers((function(){r.getSourceBufferTypes().forEach((function(e){var t=r.sourceBuffer[e];t&&(t.ending=!1)}));var e=r.mediaSource;e&&"open"===e.readyState?(P.log("[buffer-controller]: Calling mediaSource.endOfStream()"),e.endOfStream()):e&&P.info("[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: "+e.readyState)})))},t.onLevelUpdated=function(e,t){var r=t.details;r.fragments.length&&(this.details=r,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},t.flushBackBuffer=function(){var e=this.hls,t=this.details,r=this.media,i=this.sourceBuffer;if(r&&null!==t){var n=this.getSourceBufferTypes();if(n.length){var s=t.live&&null!==e.config.liveBackBufferLength?e.config.liveBackBufferLength:e.config.backBufferLength;if(y(s)&&!(s<0)){var a=r.currentTime,o=t.levelTargetDuration,c=Math.max(s,o),l=Math.floor(a/o)*o-c;n.forEach((function(r){var n=i[r];if(n){var s=Ar.getBuffered(n);if(s.length>0&&l>s.start(0)){if(e.trigger(b.BACK_BUFFER_REACHED,{bufferEnd:l}),t.live)e.trigger(b.LIVE_BACK_BUFFER_REACHED,{bufferEnd:l});else if(n.ended&&s.end(s.length-1)-a<2*o)return void P.info("[buffer-controller]: Cannot flush "+r+" back buffer while SourceBuffer is in ended state");e.trigger(b.BUFFER_FLUSHING,{startOffset:0,endOffset:l,type:r})}}}))}}}},t.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState){var e=this.details,t=this.hls,r=this.media,i=this.mediaSource,n=e.fragments[0].start+e.totalduration,s=r.duration,a=y(i.duration)?i.duration:0;e.live&&t.config.liveDurationInfinity?(P.log("[buffer-controller]: Media Source duration is set to Infinity"),i.duration=1/0,this.updateSeekableRange(e)):(n>a&&n>s||!y(s))&&(P.log("[buffer-controller]: Updating Media Source duration to "+n.toFixed(3)),i.duration=n)}},t.updateSeekableRange=function(e){var t=this.mediaSource,r=e.fragments;if(r.length&&e.live&&null!=t&&t.setLiveSeekableRange){var i=Math.max(0,r[0].start),n=Math.max(i,i+e.totalduration);t.setLiveSeekableRange(i,n)}},t.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.operationQueue,r=this.pendingTracks,i=Object.keys(r).length;if(i&&!e||2===i){this.createSourceBuffers(r),this.pendingTracks={};var n=this.getSourceBufferTypes();if(n.length)this.hls.trigger(b.BUFFER_CREATED,{tracks:this.tracks}),n.forEach((function(e){t.executeNext(e)}));else{var s=new Error("could not create source buffer for media codec(s)");this.hls.trigger(b.ERROR,{type:E.MEDIA_ERROR,details:S.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:s,reason:s.message})}}},t.createSourceBuffers=function(e){var t=this.sourceBuffer,r=this.mediaSource;if(!r)throw Error("createSourceBuffers called when mediaSource was null");for(var i in e)if(!t[i]){var n=e[i];if(!n)throw Error("source buffer exists for track "+i+", however track does not");var s=n.levelCodec||n.codec,a=n.container+";codecs="+s;P.log("[buffer-controller]: creating sourceBuffer("+a+")");try{var o=t[i]=r.addSourceBuffer(a),c=i;this.addBufferListener(c,"updatestart",this._onSBUpdateStart),this.addBufferListener(c,"updateend",this._onSBUpdateEnd),this.addBufferListener(c,"error",this._onSBUpdateError),this.tracks[i]={buffer:o,codec:s,container:n.container,levelCodec:n.levelCodec,metadata:n.metadata,id:n.id}}catch(e){P.error("[buffer-controller]: error while trying to add sourceBuffer: "+e.message),this.hls.trigger(b.ERROR,{type:E.MEDIA_ERROR,details:S.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:e,mimeType:a})}}},t._onSBUpdateStart=function(e){this.operationQueue.current(e).onStart()},t._onSBUpdateEnd=function(e){var t=this.operationQueue;t.current(e).onComplete(),t.shiftAndExecuteNext(e)},t._onSBUpdateError=function(e,t){var r=new Error(e+" SourceBuffer error");P.error("[buffer-controller]: "+r,t),this.hls.trigger(b.ERROR,{type:E.MEDIA_ERROR,details:S.BUFFER_APPENDING_ERROR,error:r,fatal:!1});var i=this.operationQueue.current(e);i&&i.onError(t)},t.removeExecutor=function(e,t,r){var i=this.media,n=this.mediaSource,s=this.operationQueue,a=this.sourceBuffer[e];if(!i||!n||!a)return P.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),void s.shiftAndExecuteNext(e);var o=y(i.duration)?i.duration:1/0,c=y(n.duration)?n.duration:1/0,l=Math.max(0,t),d=Math.min(r,o,c);d>l&&!a.ending?(a.ended=!1,P.log("[buffer-controller]: Removing ["+l+","+d+"] from the "+e+" SourceBuffer"),a.remove(l,d)):s.shiftAndExecuteNext(e)},t.appendExecutor=function(e,t){var r=this.operationQueue,i=this.sourceBuffer[t];if(!i)return P.warn("[buffer-controller]: Attempting to append to the "+t+" SourceBuffer, but it does not exist"),void r.shiftAndExecuteNext(t);i.ended=!1,i.appendBuffer(e)},t.blockBuffers=function(e,t){var r=this;if(void 0===t&&(t=this.getSourceBufferTypes()),!t.length)return P.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(e);var i=this.operationQueue,n=t.map((function(e){return i.appendBlocker(e)}));Promise.all(n).then((function(){e(),t.forEach((function(e){var t=r.sourceBuffer[e];null!=t&&t.updating||i.shiftAndExecuteNext(e)}))}))},t.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},t.addBufferListener=function(e,t,r){var i=this.sourceBuffer[e];if(i){var n=r.bind(this,e);this.listeners[e].push({event:t,listener:n}),i.addEventListener(t,n)}},t.removeBufferListeners=function(e){var t=this.sourceBuffer[e];t&&this.listeners[e].forEach((function(e){t.removeEventListener(e.event,e.listener)}))},e}(),Dn={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Ln=function(e){var t=e;return Dn.hasOwnProperty(e)&&(t=Dn[e]),String.fromCharCode(t)},kn=15,In=100,On={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Mn={17:2,18:4,21:6,22:8,23:10,19:13,20:15},xn={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Nn={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Fn=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],Bn=function(){function e(){this.time=null,this.verboseLevel=0}return e.prototype.log=function(e,t){if(this.verboseLevel>=e){var r="function"==typeof t?t():t;P.log(this.time+" ["+e+"] "+r)}},e}(),jn=function(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r].toString(16));return t},Un=function(){function e(e,t,r,i,n){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=e||"white",this.underline=t||!1,this.italics=r||!1,this.background=i||"black",this.flash=n||!1}var t=e.prototype;return t.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},t.setStyles=function(e){for(var t=["foreground","underline","italics","background","flash"],r=0;r<t.length;r++){var i=t[r];e.hasOwnProperty(i)&&(this[i]=e[i])}},t.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},t.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},t.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},t.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},e}(),Vn=function(){function e(e,t,r,i,n,s){this.uchar=void 0,this.penState=void 0,this.uchar=e||" ",this.penState=new Un(t,r,i,n,s)}var t=e.prototype;return t.reset=function(){this.uchar=" ",this.penState.reset()},t.setChar=function(e,t){this.uchar=e,this.penState.copy(t)},t.setPenState=function(e){this.penState.copy(e)},t.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},t.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},t.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},e}(),Gn=function(){function e(e){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var t=0;t<In;t++)this.chars.push(new Vn);this.logger=e,this.pos=0,this.currPenState=new Un}var t=e.prototype;return t.equals=function(e){for(var t=!0,r=0;r<In;r++)if(!this.chars[r].equals(e.chars[r])){t=!1;break}return t},t.copy=function(e){for(var t=0;t<In;t++)this.chars[t].copy(e.chars[t])},t.isEmpty=function(){for(var e=!0,t=0;t<In;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},t.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>In&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=In)},t.moveCursor=function(e){var t=this.pos+e;if(e>1)for(var r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)},t.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},t.insertChar=function(e){var t=this;e>=144&&this.backSpace();var r=Ln(e);this.pos>=In?this.logger.log(0,(function(){return"Cannot insert "+e.toString(16)+" ("+r+") at position "+t.pos+". Skipping it!"})):(this.chars[this.pos].setChar(r,this.currPenState),this.moveCursor(1))},t.clearFromPos=function(e){var t;for(t=e;t<In;t++)this.chars[t].reset()},t.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},t.clearToEndOfRow=function(){this.clearFromPos(this.pos)},t.getTextString=function(){for(var e=[],t=!0,r=0;r<In;r++){var i=this.chars[r].uchar;" "!==i&&(t=!1),e.push(i)}return t?"":e.join("")},t.setPenStyles=function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)},e}(),Hn=function(){function e(e){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var t=0;t<kn;t++)this.rows.push(new Gn(e));this.logger=e,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var t=e.prototype;return t.reset=function(){for(var e=0;e<kn;e++)this.rows[e].clear();this.currRow=14},t.equals=function(e){for(var t=!0,r=0;r<kn;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t},t.copy=function(e){for(var t=0;t<kn;t++)this.rows[t].copy(e.rows[t])},t.isEmpty=function(){for(var e=!0,t=0;t<kn;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},t.backSpace=function(){this.rows[this.currRow].backSpace()},t.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},t.insertChar=function(e){this.rows[this.currRow].insertChar(e)},t.setPen=function(e){this.rows[this.currRow].setPenStyles(e)},t.moveCursor=function(e){this.rows[this.currRow].moveCursor(e)},t.setCursor=function(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)},t.setPAC=function(e){this.logger.log(2,(function(){return"pacData = "+JSON.stringify(e)}));var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var r=0;r<kn;r++)this.rows[r].clear();var i=this.currRow+1-this.nrRollUpRows,n=this.lastOutputScreen;if(n){var s=n.rows[i].cueStartTime,a=this.logger.time;if(s&&null!==a&&s<a)for(var o=0;o<this.nrRollUpRows;o++)this.rows[t-this.nrRollUpRows+o+1].copy(n.rows[i+o])}}this.currRow=t;var c=this.rows[this.currRow];if(null!==e.indent){var l=e.indent,d=Math.max(l-1,0);c.setCursor(e.indent),e.color=c.chars[d].penState.foreground}var u={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(u)},t.setBkgData=function(e){this.logger.log(2,(function(){return"bkgData = "+JSON.stringify(e)})),this.backSpace(),this.setPen(e),this.insertChar(32)},t.setRollUpRows=function(e){this.nrRollUpRows=e},t.rollUp=function(){var e=this;if(null!==this.nrRollUpRows){this.logger.log(1,(function(){return e.getDisplayText()}));var t=this.currRow+1-this.nrRollUpRows,r=this.rows.splice(t,1)[0];r.clear(),this.rows.splice(this.currRow,0,r),this.logger.log(2,"Rolling up")}else this.logger.log(3,"roll_up but nrRollUpRows not set yet")},t.getDisplayText=function(e){e=e||!1;for(var t=[],r="",i=-1,n=0;n<kn;n++){var s=this.rows[n].getTextString();s&&(i=n+1,e?t.push("Row "+i+": '"+s+"'"):t.push(s.trim()))}return t.length>0&&(r=e?"["+t.join(" | ")+"]":t.join("\n")),r},t.getTextAndFormat=function(){return this.rows},e}(),Kn=function(){function e(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Hn(r),this.nonDisplayedMemory=new Hn(r),this.lastOutputScreen=new Hn(r),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}var t=e.prototype;return t.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},t.getHandler=function(){return this.outputFilter},t.setHandler=function(e){this.outputFilter=e},t.setPAC=function(e){this.writeScreen.setPAC(e)},t.setBkgData=function(e){this.writeScreen.setBkgData(e)},t.setMode=function(e){e!==this.mode&&(this.mode=e,this.logger.log(2,(function(){return"MODE="+e})),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},t.insertChars=function(e){for(var t=this,r=0;r<e.length;r++)this.writeScreen.insertChar(e[r]);var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,(function(){return i+": "+t.writeScreen.getDisplayText(!0)})),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(1,(function(){return"DISPLAYED: "+t.displayedMemory.getDisplayText(!0)})),this.outputDataUpdate())},t.ccRCL=function(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},t.ccBS=function(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},t.ccAOF=function(){},t.ccAON=function(){},t.ccDER=function(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},t.ccRU=function(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},t.ccFON=function(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},t.ccRDC=function(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},t.ccTR=function(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")},t.ccRTD=function(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")},t.ccEDM=function(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},t.ccCR=function(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},t.ccENM=function(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},t.ccEOC=function(){var e=this;if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,(function(){return"DISP: "+e.displayedMemory.getDisplayText()}))}this.outputDataUpdate(!0)},t.ccTO=function(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},t.ccMIDROW=function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var r=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][r]}this.logger.log(2,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},t.outputDataUpdate=function(e){void 0===e&&(e=!1);var t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},t.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},e}(),qn=function(){function e(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var i=new Bn;this.channels=[null,new Kn(e,t,i),new Kn(e+1,r,i)],this.cmdHistory={a:null,b:null},this.logger=i}var t=e.prototype;return t.getHandler=function(e){return this.channels[e].getHandler()},t.setHandler=function(e,t){this.channels[e].setHandler(t)},t.addData=function(e,t){var r,i,n,s=!1;this.logger.time=e;for(var a=0;a<t.length;a+=2)if(i=127&t[a],n=127&t[a+1],0!==i||0!==n){if(this.logger.log(3,"["+jn([t[a],t[a+1]])+"] -> ("+jn([i,n])+")"),(r=this.parseCmd(i,n))||(r=this.parseMidrow(i,n)),r||(r=this.parsePAC(i,n)),r||(r=this.parseBackgroundAttributes(i,n)),!r&&(s=this.parseChars(i,n))){var o=this.currentChannel;o&&o>0?this.channels[o].insertChars(s):this.logger.log(2,"No channel found yet. TEXT-MODE?")}r||s||this.logger.log(2,"Couldn't parse cleaned data "+jn([i,n])+" orig: "+jn([t[a],t[a+1]]))}},t.parseCmd=function(e,t){var r=this.cmdHistory;if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=33&&t<=35))return!1;if(zn(e,t,r))return Wn(null,null,r),this.logger.log(3,"Repeated command ("+jn([e,t])+") is dropped"),!0;var i=20===e||21===e||23===e?1:2,n=this.channels[i];return 20===e||21===e||28===e||29===e?32===t?n.ccRCL():33===t?n.ccBS():34===t?n.ccAOF():35===t?n.ccAON():36===t?n.ccDER():37===t?n.ccRU(2):38===t?n.ccRU(3):39===t?n.ccRU(4):40===t?n.ccFON():41===t?n.ccRDC():42===t?n.ccTR():43===t?n.ccRTD():44===t?n.ccEDM():45===t?n.ccCR():46===t?n.ccENM():47===t&&n.ccEOC():n.ccTO(t-32),Wn(e,t,r),this.currentChannel=i,!0},t.parseMidrow=function(e,t){var r=0;if((17===e||25===e)&&t>=32&&t<=47){if((r=17===e?1:2)!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;var i=this.channels[r];return!!i&&(i.ccMIDROW(t),this.logger.log(3,"MIDROW ("+jn([e,t])+")"),!0)}return!1},t.parsePAC=function(e,t){var r,i=this.cmdHistory;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127||(16===e||24===e)&&t>=64&&t<=95))return!1;if(zn(e,t,i))return Wn(null,null,i),!0;var n=e<=23?1:2;r=t>=64&&t<=95?1===n?On[e]:xn[e]:1===n?Mn[e]:Nn[e];var s=this.channels[n];return!!s&&(s.setPAC(this.interpretPAC(r,t)),Wn(e,t,i),this.currentChannel=n,!0)},t.interpretPAC=function(e,t){var r,i={color:null,italics:!1,indent:null,underline:!1,row:e};return r=t>95?t-96:t-64,i.underline=1==(1&r),r<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((r-16)/2),i},t.parseChars=function(e,t){var r,i,n=null,s=null;if(e>=25?(r=2,s=e-8):(r=1,s=e),s>=17&&s<=19?(i=17===s?t+80:18===s?t+112:t+144,this.logger.log(2,"Special char '"+Ln(i)+"' in channel "+r),n=[i]):e>=32&&e<=127&&(n=0===t?[e]:[e,t]),n){var a=jn(n);this.logger.log(3,"Char codes =  "+a.join(",")),Wn(e,t,this.cmdHistory)}return n},t.parseBackgroundAttributes=function(e,t){var r;if(!((16===e||24===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=45&&t<=47))return!1;var i={};16===e||24===e?(r=Math.floor((t-32)/2),i.background=Fn[r],t%2==1&&(i.background=i.background+"_semi")):45===t?i.background="transparent":(i.foreground="black",47===t&&(i.underline=!0));var n=e<=23?1:2;return this.channels[n].setBkgData(i),Wn(e,t,this.cmdHistory),!0},t.reset=function(){for(var e=0;e<Object.keys(this.channels).length;e++){var t=this.channels[e];t&&t.reset()}this.cmdHistory={a:null,b:null}},t.cueSplitAtTime=function(e){for(var t=0;t<this.channels.length;t++){var r=this.channels[t];r&&r.cueSplitAtTime(e)}},e}();function Wn(e,t,r){r.a=e,r.b=t}function zn(e,t,r){return r.a===e&&r.b===t}var $n=function(){function e(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}var t=e.prototype;return t.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},t.newCue=function(e,t,r){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)},t.reset=function(){this.cueRanges=[],this.startTime=null},e}(),Yn=function(){if("undefined"!=typeof self&&self.VTTCue)return self.VTTCue;var e=["","lr","rl"],t=["start","middle","end","left","right"];function r(e,t){if("string"!=typeof t)return!1;if(!Array.isArray(e))return!1;var r=t.toLowerCase();return!!~e.indexOf(r)&&r}function i(e){return r(t,e)}function n(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];for(var n=1;n<arguments.length;n++){var s=arguments[n];for(var a in s)e[a]=s[a]}return e}function s(t,s,a){var o=this,c={enumerable:!0};o.hasBeenReset=!1;var l="",d=!1,u=t,h=s,p=a,f=null,m="",g=!0,v="auto",_="start",y=50,b="middle",E=50,S="middle";Object.defineProperty(o,"id",n({},c,{get:function(){return l},set:function(e){l=""+e}})),Object.defineProperty(o,"pauseOnExit",n({},c,{get:function(){return d},set:function(e){d=!!e}})),Object.defineProperty(o,"startTime",n({},c,{get:function(){return u},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");u=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",n({},c,{get:function(){return h},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",n({},c,{get:function(){return p},set:function(e){p=""+e,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",n({},c,{get:function(){return f},set:function(e){f=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",n({},c,{get:function(){return m},set:function(t){var i=function(t){return r(e,t)}(t);if(!1===i)throw new SyntaxError("An invalid or illegal string was specified.");m=i,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",n({},c,{get:function(){return g},set:function(e){g=!!e,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",n({},c,{get:function(){return v},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");v=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",n({},c,{get:function(){return _},set:function(e){var t=i(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");_=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",n({},c,{get:function(){return y},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",n({},c,{get:function(){return b},set:function(e){var t=i(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");b=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",n({},c,{get:function(){return E},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");E=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",n({},c,{get:function(){return S},set:function(e){var t=i(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");S=t,this.hasBeenReset=!0}})),o.displayState=void 0}return s.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},s}(),Qn=function(){function e(){}return e.prototype.decode=function(e,t){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))},e}();function Jn(e){function t(e,t,r,i){return 3600*(0|e)+60*(0|t)+(0|r)+parseFloat(i||0)}var r=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return r?parseFloat(r[2])>59?t(r[2],r[3],0,r[4]):t(r[1],r[2],r[3],r[4]):null}var Xn=function(){function e(){this.values=Object.create(null)}var t=e.prototype;return t.set=function(e,t){this.get(e)||""===t||(this.values[e]=t)},t.get=function(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t},t.has=function(e){return e in this.values},t.alt=function(e,t,r){for(var i=0;i<r.length;++i)if(t===r[i]){this.set(e,t);break}},t.integer=function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},t.percent=function(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){var r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1},e}();function Zn(e,t,r,i){var n=i?e.split(i):[e];for(var s in n)if("string"==typeof n[s]){var a=n[s].split(r);2===a.length&&t(a[0],a[1])}}var es=new Yn(0,0,""),ts="middle"===es.align?"middle":"center";function rs(e,t,r){var i=e;function n(){var t=Jn(e);if(null===t)throw new Error("Malformed timestamp: "+i);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function s(){e=e.replace(/^\s+/,"")}if(s(),t.startTime=n(),s(),"--\x3e"!==e.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+i);e=e.slice(3),s(),t.endTime=n(),s(),function(e,t){var i=new Xn;Zn(e,(function(e,t){var n;switch(e){case"region":for(var s=r.length-1;s>=0;s--)if(r[s].id===t){i.set(e,r[s].region);break}break;case"vertical":i.alt(e,t,["rl","lr"]);break;case"line":n=t.split(","),i.integer(e,n[0]),i.percent(e,n[0])&&i.set("snapToLines",!1),i.alt(e,n[0],["auto"]),2===n.length&&i.alt("lineAlign",n[1],["start",ts,"end"]);break;case"position":n=t.split(","),i.percent(e,n[0]),2===n.length&&i.alt("positionAlign",n[1],["start",ts,"end","line-left","line-right","auto"]);break;case"size":i.percent(e,t);break;case"align":i.alt(e,t,["start",ts,"end","left","right"])}}),/:/,/\s/),t.region=i.get("region",null),t.vertical=i.get("vertical","");var n=i.get("line","auto");"auto"===n&&-1===es.line&&(n=-1),t.line=n,t.lineAlign=i.get("lineAlign","start"),t.snapToLines=i.get("snapToLines",!0),t.size=i.get("size",100),t.align=i.get("align",ts);var s=i.get("position","auto");"auto"===s&&50===es.position&&(s="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=s}(e,t)}function is(e){return e.replace(/<br(?: \/)?>/gi,"\n")}var ns=function(){function e(){this.state="INITIAL",this.buffer="",this.decoder=new Qn,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var t=e.prototype;return t.parse=function(e){var t=this;function r(){var e=t.buffer,r=0;for(e=is(e);r<e.length&&"\r"!==e[r]&&"\n"!==e[r];)++r;var i=e.slice(0,r);return"\r"===e[r]&&++r,"\n"===e[r]&&++r,t.buffer=e.slice(r),i}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var i="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;var n=(i=r()).match(/^()?WEBVTT([ \t].*)?$/);if(null==n||!n[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var s=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(s?s=!1:i=r(),t.state){case"HEADER":/:/.test(i)?Zn(i,(function(e,t){}),/:/):i||(t.state="ID");continue;case"NOTE":i||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){t.state="NOTE";break}if(!i)continue;if(t.cue=new Yn(0,0,""),t.state="CUE",-1===i.indexOf("--\x3e")){t.cue.id=i;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{rs(i,t.cue,t.regionList)}catch(e){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var a=-1!==i.indexOf("--\x3e");if(!i||a&&(s=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=i;continue;case"BADCUE":i||(t.state="ID")}}}catch(e){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this},t.flush=function(){var e=this;try{if((e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state||"BADWEBVTT"===e.state)throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this},e}(),ss=/\r\n|\n\r|\n|\r/g,as=function(e,t,r){return void 0===r&&(r=0),e.slice(r,r+t.length)===t},os=function(e){for(var t=5381,r=e.length;r;)t=33*t^e.charCodeAt(--r);return(t>>>0).toString()};function cs(e,t,r){return os(e.toString())+os(t.toString())+os(r)}function ls(e,t,r,i,n,s,a){var o,c,l,d=new ns,u=ge(new Uint8Array(e)).trim().replace(ss,"\n").split("\n"),h=[],p=(c=t.baseTime,void 0===(l=t.timescale)&&(l=1),Bi(c,Fi,1/l)),f="00:00.000",m=0,g=0,v=!0;d.oncue=function(e){var t=r[i],s=r.ccOffset,a=(m-p)/9e4;null!=t&&t.new&&(void 0!==g?s=r.ccOffset=t.start:function(e,t,r){var i=e[t],n=e[i.prevCC];if(!n||!n.new&&i.new)return e.ccOffset=e.presentationOffset=i.start,void(i.new=!1);for(;null!=(s=n)&&s.new;){var s;e.ccOffset+=i.start-n.start,i.new=!1,n=e[(i=n).prevCC]}e.presentationOffset=r}(r,i,a)),a&&(s=a-r.presentationOffset);var o=e.endTime-e.startTime,c=Hi(9e4*(e.startTime+s-g),9e4*n)/9e4;e.startTime=Math.max(c,0),e.endTime=Math.max(c+o,0);var l=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(l)),e.id||(e.id=cs(e.startTime,e.endTime,l)),e.endTime>0&&h.push(e)},d.onparsingerror=function(e){o=e},d.onflush=function(){o?a(o):s(h)},u.forEach((function(e){if(v){if(as(e,"X-TIMESTAMP-MAP=")){v=!1,e.slice(16).split(",").forEach((function(e){as(e,"LOCAL:")?f=e.slice(6):as(e,"MPEGTS:")&&(m=parseInt(e.slice(7)))}));try{g=function(e){var t=parseInt(e.slice(-3)),r=parseInt(e.slice(-6,-4)),i=parseInt(e.slice(-9,-7)),n=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!(y(t)&&y(r)&&y(i)&&y(n)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+e);return t+=1e3*r,(t+=6e4*i)+36e5*n}(f)/1e3}catch(e){o=e}return}""===e&&(v=!1)}d.parse(e+"\n")})),d.flush()}var ds="stpp.ttml.im1t",us=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,hs=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,ps={left:"start",center:"center",right:"end",start:"start",end:"end"};function fs(e,t,r,i){var n,s,a,c,l=Ae(new Uint8Array(e),["mdat"]);if(0!==l.length){var d=l.map((function(e){return ge(e)})),u=(n=t.baseTime,s=1,void 0===(a=t.timescale)&&(a=1),void 0===c&&(c=!1),Bi(n,s,1/a,c));try{d.forEach((function(e){return r(function(e,t){var r=(new DOMParser).parseFromString(e,"text/xml").getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");var i={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},n=Object.keys(i).reduce((function(e,t){return e[t]=r.getAttribute("ttp:"+t)||i[t],e}),{}),s="preserve"!==r.getAttribute("xml:space"),a=gs(ms(r,"styling","style")),c=gs(ms(r,"layout","region")),l=ms(r,"body","[begin]");return[].map.call(l,(function(e){var r=vs(e,s);if(!r||!e.hasAttribute("begin"))return null;var i=bs(e.getAttribute("begin"),n),l=bs(e.getAttribute("dur"),n),d=bs(e.getAttribute("end"),n);if(null===i)throw ys(e);if(null===d){if(null===l)throw ys(e);d=i+l}var u=new Yn(i-t,d-t,r);u.id=cs(u.startTime,u.endTime,u.text);var h=function(e,t,r){var i="http://www.w3.org/ns/ttml#styling",n=null,s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=null!=e&&e.hasAttribute("style")?e.getAttribute("style"):null;return a&&r.hasOwnProperty(a)&&(n=r[a]),s.reduce((function(r,s){var a=_s(t,i,s)||_s(e,i,s)||_s(n,i,s);return a&&(r[s]=a),r}),{})}(c[e.getAttribute("region")],a[e.getAttribute("style")],a),p=h.textAlign;if(p){var f=ps[p];f&&(u.lineAlign=f),u.align=p}return o(u,h),u})).filter((function(e){return null!==e}))}(e,u))}))}catch(e){i(e)}}else i(new Error("Could not parse IMSC1 mdat"))}function ms(e,t,r){var i=e.getElementsByTagName(t)[0];return i?[].slice.call(i.querySelectorAll(r)):[]}function gs(e){return e.reduce((function(e,t){var r=t.getAttribute("xml:id");return r&&(e[r]=t),e}),{})}function vs(e,t){return[].slice.call(e.childNodes).reduce((function(e,r,i){var n;return"br"===r.nodeName&&i?e+"\n":null!=(n=r.childNodes)&&n.length?vs(r,t):t?e+r.textContent.trim().replace(/\s+/g," "):e+r.textContent}),"")}function _s(e,t,r){return e&&e.hasAttributeNS(t,r)?e.getAttributeNS(t,r):null}function ys(e){return new Error("Could not parse ttml timestamp "+e)}function bs(e,t){if(!e)return null;var r=Jn(e);return null===r&&(us.test(e)?r=function(e,t){var r=us.exec(e),i=(0|r[4])+(0|r[5])/t.subFrameRate;return 3600*(0|r[1])+60*(0|r[2])+(0|r[3])+i/t.frameRate}(e,t):hs.test(e)&&(r=function(e,t){var r=hs.exec(e),i=Number(r[1]);switch(r[2]){case"h":return 3600*i;case"m":return 60*i;case"ms":return 1e3*i;case"f":return i/t.frameRate;case"t":return i/t.tickRate}return i}(e,t))),r}var Es=function(){function e(e){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var t=new $n(this,"textTrack1"),r=new $n(this,"textTrack2"),i=new $n(this,"textTrack3"),n=new $n(this,"textTrack4");this.cea608Parser1=new qn(1,t,r),this.cea608Parser2=new qn(3,i,n)}e.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(b.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(b.FRAG_LOADING,this.onFragLoading,this),e.on(b.FRAG_LOADED,this.onFragLoaded,this),e.on(b.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(b.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(b.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(b.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this)}var t=e.prototype;return t.destroy=function(){var e=this.hls;e.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(b.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(b.FRAG_LOADING,this.onFragLoading,this),e.off(b.FRAG_LOADED,this.onFragLoaded,this),e.off(b.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(b.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(b.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(b.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},t.addCues=function(e,t,r,i,n){for(var s=!1,a=n.length;a--;){var o=n[a],c=(l=o[0],d=o[1],u=t,h=r,Math.min(d,h)-Math.max(l,u));if(c>=0&&(o[0]=Math.min(o[0],t),o[1]=Math.max(o[1],r),s=!0,c/(r-t)>.5))return}var l,d,u,h;if(s||n.push([t,r]),this.config.renderTextTracksNatively){var p=this.captionsTracks[e];this.Cues.newCue(p,t,r,i)}else{var f=this.Cues.newCue(null,t,r,i);this.hls.trigger(b.CUES_PARSED,{type:"captions",cues:f,track:e})}},t.onInitPtsFound=function(e,t){var r=this,i=t.frag,n=t.id,s=t.initPTS,a=t.timescale,o=this.unparsedVttFrags;"main"===n&&(this.initPTS[i.cc]={baseTime:s,timescale:a}),o.length&&(this.unparsedVttFrags=[],o.forEach((function(e){r.onFragLoaded(b.FRAG_LOADED,e)})))},t.getExistingTrack=function(e){var t=this.media;if(t)for(var r=0;r<t.textTracks.length;r++){var i=t.textTracks[r];if(i[e])return i}return null},t.createCaptionsTrack=function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)},t.createNativeTrack=function(e){if(!this.captionsTracks[e]){var t=this.captionsProperties,r=this.captionsTracks,i=this.media,n=t[e],s=n.label,a=n.languageCode,o=this.getExistingTrack(e);if(o)r[e]=o,Et(r[e]),yt(r[e],i);else{var c=this.createTextTrack("captions",s,a);c&&(c[e]=!0,r[e]=c)}}},t.createNonNativeTrack=function(e){if(!this.nonNativeCaptionsTracks[e]){var t=this.captionsProperties[e];if(t){var r={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(b.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}}},t.createTextTrack=function(e,t,r){var i=this.media;if(i)return i.addTextTrack(e,t,r)},t.onMediaAttaching=function(e,t){this.media=t.media,this._cleanTracks()},t.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach((function(t){Et(e[t]),delete e[t]})),this.nonNativeCaptionsTracks={}},t.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},t._cleanTracks=function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var r=0;r<t.length;r++)Et(t[r])}},t.onSubtitleTracksUpdated=function(e,t){var r=this,i=t.subtitleTracks||[],n=i.some((function(e){return e.textCodec===ds}));if(this.config.enableWebVTT||n&&this.config.enableIMSC1){if(yn(this.tracks,i))return void(this.tracks=i);if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){var s=this.media?this.media.textTracks:null;this.tracks.forEach((function(e,t){var i;if(s&&t<s.length){for(var n=null,a=0;a<s.length;a++)if(Ss(s[a],e)){n=s[a];break}n&&(i=n)}if(i)Et(i);else{var o=r._captionsOrSubtitlesFromCharacteristics(e);(i=r.createTextTrack(o,e.name,e.lang))&&(i.mode="disabled")}i&&(i.groupId=e.groupId,r.textTracks.push(i))}))}else if(this.tracks.length){var a=this.tracks.map((function(e){return{label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e}}));this.hls.trigger(b.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}},t._captionsOrSubtitlesFromCharacteristics=function(e){if(e.attrs.CHARACTERISTICS){var t=/transcribes-spoken-dialog/gi.test(e.attrs.CHARACTERISTICS),r=/describes-music-and-sound/gi.test(e.attrs.CHARACTERISTICS);if(t&&r)return"captions"}return"subtitles"},t.onManifestLoaded=function(e,t){var r=this;this.config.enableCEA708Captions&&t.captions&&t.captions.forEach((function(e){var t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(t){var i="textTrack"+t[1],n=r.captionsProperties[i];n&&(n.label=e.name,e.lang&&(n.languageCode=e.lang),n.media=e)}}))},t.closedCaptionsForLevel=function(e){var t=this.hls.levels[e.level];return null==t?void 0:t.attrs["CLOSED-CAPTIONS"]},t.onFragLoading=function(e,t){var r=this.cea608Parser1,i=this.cea608Parser2,n=this.lastSn,s=this.lastPartIndex;if(this.enabled&&r&&i&&t.frag.type===pt){var a,o,c=t.frag.sn,l=null!=(a=null==t||null==(o=t.part)?void 0:o.index)?a:-1;c===n+1||c===n&&l===s+1||(r.reset(),i.reset()),this.lastSn=c,this.lastPartIndex=l}},t.onFragLoaded=function(e,t){var r=t.frag,i=t.payload,n=this.initPTS,s=this.unparsedVttFrags;if(r.type===mt)if(i.byteLength){if(!n[r.cc])return s.push(t),void(n.length&&this.hls.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Missing initial subtitle PTS")}));var a=r.decryptdata,o="stats"in t;if(null==a||!a.encrypted||o){var c=this.tracks[r.level],l=this.vttCCs;l[r.cc]||(l[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),c&&c.textCodec===ds?this._parseIMSC1(r,i):this._parseVTTs(r,i,l)}}else this.hls.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})},t._parseIMSC1=function(e,t){var r=this,i=this.hls;fs(t,this.initPTS[e.cc],(function(t){r._appendCues(t,e.level),i.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})}),(function(t){P.log("Failed to parse IMSC1: "+t),i.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})}))},t._parseVTTs=function(e,t,r){var i,n=this,s=this.hls;ls(null!=(i=e.initSegment)&&i.data?Ie(e.initSegment.data,new Uint8Array(t)):t,this.initPTS[e.cc],r,e.cc,e.start,(function(t){n._appendCues(t,e.level),s.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})}),(function(r){n._fallbackToIMSC1(e,t),P.log("Failed to parse VTT cue: "+r),s.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:r})}))},t._fallbackToIMSC1=function(e,t){var r=this,i=this.tracks[e.level];i.textCodec||fs(t,this.initPTS[e.cc],(function(){i.textCodec=ds,r._parseIMSC1(e,t)}),(function(){i.textCodec="wvtt"}))},t._appendCues=function(e,t){var r=this.hls;if(this.config.renderTextTracksNatively){var i=this.textTracks[t];if(!i||"disabled"===i.mode)return;e.forEach((function(e){return bt(i,e)}))}else{var n=this.tracks[t];if(!n)return;var s=n.default?"default":"subtitles"+t;r.trigger(b.CUES_PARSED,{type:"subtitles",cues:e,track:s})}},t.onFragDecrypted=function(e,t){var r=t.frag;if(r.type===mt){if(!this.initPTS[r.cc])return void this.unparsedVttFrags.push(t);this.onFragLoaded(b.FRAG_LOADED,t)}},t.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},t.onFragParsingUserdata=function(e,t){var r=this.cea608Parser1,i=this.cea608Parser2;if(this.enabled&&r&&i){var n=t.frag,s=t.samples;if(n.type!==pt||"NONE"!==this.closedCaptionsForLevel(n))for(var a=0;a<s.length;a++){var o=s[a].bytes;if(o){var c=this.extractCea608Data(o);r.addData(s[a].pts,c[0]),i.addData(s[a].pts,c[1])}}}},t.onBufferFlushing=function(e,t){var r=t.startOffset,i=t.endOffset,n=t.endOffsetSubtitles,s=t.type,a=this.media;if(a&&!(a.currentTime<i)){if(!s||"video"===s){var o=this.captionsTracks;Object.keys(o).forEach((function(e){return St(o[e],r,i)}))}if(this.config.renderTextTracksNatively&&0===r&&void 0!==n){var c=this.textTracks;Object.keys(c).forEach((function(e){return St(c[e],r,n)}))}}},t.extractCea608Data=function(e){for(var t=[[],[]],r=31&e[0],i=2,n=0;n<r;n++){var s=e[i++],a=127&e[i++],o=127&e[i++];if((0!==a||0!==o)&&0!=(4&s)){var c=3&s;0!==c&&1!==c||(t[c].push(a),t[c].push(o))}}return t},e}();function Ss(e,t){return!!e&&e.label===t.name&&!(e.textTrack1||e.textTrack2)}var ws=function(){function e(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var t=e.prototype;return t.setStreamController=function(e){this.streamController=e},t.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},t.registerListeners=function(){var e=this.hls;e.on(b.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.BUFFER_CODECS,this.onBufferCodecs,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this)},t.unregisterListener=function(){var e=this.hls;e.off(b.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.BUFFER_CODECS,this.onBufferCodecs,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this)},t.onFpsDropLevelCapping=function(e,t){var r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})},t.onMediaAttaching=function(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null},t.onManifestParsed=function(e,t){var r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()},t.onBufferCodecs=function(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()},t.onMediaDetaching=function(){this.stopCapping()},t.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var e=this.hls.levels;if(e.length){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e.length-1),t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}},t.getMaxLevel=function(t){var r=this,i=this.hls.levels;if(!i.length)return-1;var n=i.filter((function(e,i){return r.isLevelAllowed(e)&&i<=t}));return this.clientRect=null,e.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)},t.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},t.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},t.getDimensions=function(){if(this.clientRect)return this.clientRect;var e=this.media,t={width:0,height:0};if(e){var r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,t.width||t.height||(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t},t.isLevelAllowed=function(e){return!this.restrictedLevels.some((function(t){return e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height}))},e.getMaxLevelByMediaSize=function(e,t,r){if(null==e||!e.length)return-1;for(var i=e.length-1,n=0;n<e.length;n+=1){var s=e[n];if((s.width>=t||s.height>=r)&&(a=s,!(o=e[n+1])||a.width!==o.width||a.height!==o.height)){i=n;break}}var a,o;return i},s(e,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(e){}return e}}]),e}(),Ts=function(){function e(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}var t=e.prototype;return t.setStreamController=function(e){this.streamController=e},t.registerListeners=function(){this.hls.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this)},t.unregisterListeners=function(){this.hls.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this)},t.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},t.onMediaAttaching=function(e,t){var r=this.hls.config;if(r.capLevelOnFPSDrop){var i=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=i,i&&"function"==typeof i.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}},t.checkFPS=function(e,t,r){var i=performance.now();if(t){if(this.lastTime){var n=i-this.lastTime,s=r-this.lastDroppedFrames,a=t-this.lastDecodedFrames,o=1e3*s/n,c=this.hls;if(c.trigger(b.FPS_DROP,{currentDropped:s,currentDecoded:a,totalDroppedFrames:r}),o>0&&s>c.config.fpsDroppedMonitoringThreshold*a){var l=c.currentLevel;P.warn("drop FPS ratio greater than max allowed value for currentLevel: "+l),l>0&&(-1===c.autoLevelCapping||c.autoLevelCapping>=l)&&(l-=1,c.trigger(b.FPS_DROP_LEVEL_CAPPING,{level:l,droppedLevel:c.currentLevel}),c.autoLevelCapping=l,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=r,this.lastDecodedFrames=t}},t.checkFPSInterval=function(){var e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},e}(),Rs="[eme]",Cs=function(){function e(t){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=e.CDMCleanupPromise?[e.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=P.debug.bind(P,Rs),this.log=P.log.bind(P,Rs),this.warn=P.warn.bind(P,Rs),this.error=P.error.bind(P,Rs),this.hls=t,this.config=t.config,this.registerListeners()}var t=e.prototype;return t.destroy=function(){this.unregisterListeners(),this.onMediaDetached();var e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null},t.registerListeners=function(){this.hls.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(b.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(b.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(b.MANIFEST_LOADED,this.onManifestLoaded,this)},t.unregisterListeners=function(){this.hls.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(b.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(b.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(b.MANIFEST_LOADED,this.onManifestLoaded,this)},t.getLicenseServerUrl=function(e){var t=this.config,r=t.drmSystems,i=t.widevineLicenseUrl,n=r[e];if(n)return n.licenseUrl;if(e===q.WIDEVINE&&i)return i;throw new Error('no license server URL configured for key-system "'+e+'"')},t.getServerCertificateUrl=function(e){var t=this.config.drmSystems[e];if(t)return t.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'+e+'"]')},t.attemptKeySystemAccess=function(e){var t=this,r=this.hls.levels,i=function(e,t,r){return!!e&&r.indexOf(e)===t},n=r.map((function(e){return e.audioCodec})).filter(i),s=r.map((function(e){return e.videoCodec})).filter(i);return n.length+s.length===0&&s.push("avc1.42e01e"),new Promise((function(r,i){!function e(a){var o=a.shift();t.getMediaKeysPromise(o,n,s).then((function(e){return r({keySystem:o,mediaKeys:e})})).catch((function(t){a.length?e(a):i(t instanceof As?t:new As({type:E.KEY_SYSTEM_ERROR,details:S.KEY_SYSTEM_NO_ACCESS,error:t,fatal:!0},t.message))}))}(e)}))},t.requestMediaKeySystemAccess=function(e,t){var r=this.config.requestMediaKeySystemAccessFunc;if("function"!=typeof r){var i="Configured requestMediaKeySystemAccess is not a function "+r;return null===ee&&"http:"===self.location.protocol&&(i="navigator.requestMediaKeySystemAccess is not available over insecure protocol "+location.protocol),Promise.reject(new Error(i))}return r(e,t)},t.getMediaKeysPromise=function(e,t,r){var i=this,n=function(e,t,r,i){var n;switch(e){case q.FAIRPLAY:n=["cenc","sinf"];break;case q.WIDEVINE:case q.PLAYREADY:n=["cenc"];break;case q.CLEARKEY:n=["cenc","keyids"];break;default:throw new Error("Unknown key-system: "+e)}return function(e,t,r,i){return[{initDataTypes:e,persistentState:i.persistentState||"not-allowed",distinctiveIdentifier:i.distinctiveIdentifier||"not-allowed",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:t.map((function(e){return{contentType:'audio/mp4; codecs="'+e+'"',robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null}})),videoCapabilities:r.map((function(e){return{contentType:'video/mp4; codecs="'+e+'"',robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}}))}]}(n,t,r,i)}(e,t,r,this.config.drmSystemOptions),s=this.keySystemAccessPromises[e],a=null==s?void 0:s.keySystemAccess;if(!a){this.log('Requesting encrypted media "'+e+'" key-system access with config: '+JSON.stringify(n)),a=this.requestMediaKeySystemAccess(e,n);var o=this.keySystemAccessPromises[e]={keySystemAccess:a};return a.catch((function(t){i.log('Failed to obtain access to key-system "'+e+'": '+t)})),a.then((function(t){i.log('Access for key-system "'+t.keySystem+'" obtained');var r=i.fetchServerCertificate(e);return i.log('Create media-keys for "'+e+'"'),o.mediaKeys=t.createMediaKeys().then((function(t){return i.log('Media-keys created for "'+e+'"'),r.then((function(r){return r?i.setMediaKeysServerCertificate(t,e,r):t}))})),o.mediaKeys.catch((function(t){i.error('Failed to create media-keys for "'+e+'"}: '+t)})),o.mediaKeys}))}return a.then((function(){return s.mediaKeys}))},t.createMediaKeySessionContext=function(e){var t=e.decryptdata,r=e.keySystem,i=e.mediaKeys;this.log('Creating key-system session "'+r+'" keyId: '+_e(t.keyId||[]));var n=i.createSession(),s={decryptdata:t,keySystem:r,mediaKeys:i,mediaKeysSession:n,keyStatus:"status-pending"};return this.mediaKeySessions.push(s),s},t.renewKeySession=function(e){var t=e.decryptdata;if(t.pssh){var r=this.createMediaKeySessionContext(e),i=this.getKeyIdString(t);this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(r,"cenc",t.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)},t.getKeyIdString=function(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(null===e.keyId)throw new Error("keyId is null");return _e(e.keyId)},t.updateKeySession=function(e,t){var r,i=e.mediaKeysSession;return this.log('Updating key-session "'+i.sessionId+'" for keyID '+_e((null==(r=e.decryptdata)?void 0:r.keyId)||[])+"\n      } (data length: "+(t?t.byteLength:t)+")"),i.update(t)},t.selectKeySystemFormat=function(e){var t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: "+e.sn+" "+e.type+": "+e.level+") key formats "+t.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise},t.getKeyFormatPromise=function(e){var t=this;return new Promise((function(r,i){var n=Z(t.config),s=e.map(Q).filter((function(e){return!!e&&-1!==n.indexOf(e)}));return t.getKeySystemSelectionPromise(s).then((function(e){var t=e.keySystem,n=X(t);n?r(n):i(new Error('Unable to find format for key-system "'+t+'"'))})).catch(i)}))},t.loadKey=function(e){var t=this,r=e.keyInfo.decryptdata,i=this.getKeyIdString(r),n="(keyId: "+i+' format: "'+r.keyFormat+'" method: '+r.method+" uri: "+r.uri+")";this.log("Starting session for key "+n);var s=this.keyIdToKeySessionPromise[i];return s||(s=this.keyIdToKeySessionPromise[i]=this.getKeySystemForKeyPromise(r).then((function(i){var s=i.keySystem,a=i.mediaKeys;return t.throwIfDestroyed(),t.log("Handle encrypted media sn: "+e.frag.sn+" "+e.frag.type+": "+e.frag.level+" using key "+n),t.attemptSetMediaKeys(s,a).then((function(){t.throwIfDestroyed();var e=t.createMediaKeySessionContext({keySystem:s,mediaKeys:a,decryptdata:r});return t.generateRequestWithPreferredKeySession(e,"cenc",r.pssh,"playlist-key")}))}))).catch((function(e){return t.handleError(e)})),s},t.throwIfDestroyed=function(e){if(!this.hls)throw new Error("invalid state")},t.handleError=function(e){this.hls&&(this.error(e.message),e instanceof As?this.hls.trigger(b.ERROR,e.data):this.hls.trigger(b.ERROR,{type:E.KEY_SYSTEM_ERROR,details:S.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))},t.getKeySystemForKeyPromise=function(e){var t=this.getKeyIdString(e),r=this.keyIdToKeySessionPromise[t];if(!r){var i=Q(e.keyFormat),n=i?[i]:Z(this.config);return this.attemptKeySystemAccess(n)}return r},t.getKeySystemSelectionPromise=function(e){if(e.length||(e=Z(this.config)),0===e.length)throw new As({type:E.KEY_SYSTEM_ERROR,details:S.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options "+JSON.stringify({drmSystems:this.config.drmSystems}));return this.attemptKeySystemAccess(e)},t._onMediaEncrypted=function(e){var t=this,r=e.initDataType,i=e.initData;if(this.debug('"'+e.type+'" event: init data type: "'+r+'"'),null!==i){var n,s;if("sinf"===r&&this.config.drmSystems[q.FAIRPLAY]){var a=Se(new Uint8Array(i));try{var o=G(JSON.parse(a).sinf),c=Le(new Uint8Array(o));if(!c)return;n=c.subarray(8,24),s=q.FAIRPLAY}catch(e){return void this.warn('Failed to parse sinf "encrypted" event message initData')}}else{var l=function(e){if(!(e instanceof ArrayBuffer)||e.byteLength<32)return null;var t={version:0,systemId:"",kids:null,data:null},r=new DataView(e),i=r.getUint32(0);if(e.byteLength!==i&&i>44)return null;if(1886614376!==r.getUint32(4))return null;if(t.version=r.getUint32(8)>>>24,t.version>1)return null;t.systemId=_e(new Uint8Array(e,12,16));var n=r.getUint32(28);if(0===t.version){if(i-32<n)return null;t.data=new Uint8Array(e,32,n)}else if(1===t.version){t.kids=[];for(var s=0;s<n;s++)t.kids.push(new Uint8Array(e,32+16*s,16))}return t}(i);if(null===l)return;0===l.version&&l.systemId===J&&l.data&&(n=l.data.subarray(8,24)),s=function(e){if(e===J)return q.WIDEVINE}(l.systemId)}if(s&&n){for(var d=_e(n),u=this.keyIdToKeySessionPromise,h=this.mediaKeySessions,p=u[d],f=function(){var e=h[m],s=e.decryptdata;if(s.pssh||!s.keyId)return"continue";var a=_e(s.keyId);return d===a||-1!==s.uri.replace(/-/g,"").indexOf(d)?(p=u[a],delete u[a],s.pssh=new Uint8Array(i),s.keyId=n,p=u[d]=p.then((function(){return t.generateRequestWithPreferredKeySession(e,r,i,"encrypted-event-key-match")})),"break"):void 0},m=0;m<h.length;m++){var g=f();if("continue"!==g&&"break"===g)break}p||(p=u[d]=this.getKeySystemSelectionPromise([s]).then((function(e){var s,a=e.keySystem,o=e.mediaKeys;t.throwIfDestroyed();var c=new je("ISO-23001-7",d,null!=(s=X(a))?s:"");return c.pssh=new Uint8Array(i),c.keyId=n,t.attemptSetMediaKeys(a,o).then((function(){t.throwIfDestroyed();var e=t.createMediaKeySessionContext({decryptdata:c,keySystem:a,mediaKeys:o});return t.generateRequestWithPreferredKeySession(e,r,i,"encrypted-event-no-match")}))}))),p.catch((function(e){return t.handleError(e)}))}}},t._onWaitingForKey=function(e){this.log('"'+e.type+'" event')},t.attemptSetMediaKeys=function(e,t){var r=this,i=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'+e+'"');var n=Promise.all(i).then((function(){if(!r.media)throw new Error("Attempted to set mediaKeys without media element attached");return r.media.setMediaKeys(t)}));return this.setMediaKeysQueue.push(n),n.then((function(){r.log('Media-keys set for "'+e+'"'),i.push(n),r.setMediaKeysQueue=r.setMediaKeysQueue.filter((function(e){return-1===i.indexOf(e)}))}))},t.generateRequestWithPreferredKeySession=function(e,t,r,i){var n,s,a=this,o=null==(n=this.config.drmSystems)||null==(s=n[e.keySystem])?void 0:s.generateRequest;if(o)try{var c=o.call(this.hls,t,r,e);if(!c)throw new Error("Invalid response from configured generateRequest filter");t=c.initDataType,r=e.decryptdata.pssh=c.initData?new Uint8Array(c.initData):null}catch(e){var l;if(this.warn(e.message),null!=(l=this.hls)&&l.config.debug)throw e}if(null===r)return this.log('Skipping key-session request for "'+i+'" (no initData)'),Promise.resolve(e);var d=this.getKeyIdString(e.decryptdata);this.log('Generating key-session request for "'+i+'": '+d+" (init data type: "+t+" length: "+(r?r.byteLength:null)+")");var u=new sn;e.mediaKeysSession.onmessage=function(t){var r=e.mediaKeysSession;if(r){var i=t.messageType,n=t.message;a.log('"'+i+'" message event for session "'+r.sessionId+'" message size: '+n.byteLength),"license-request"===i||"license-renewal"===i?a.renewLicense(e,n).catch((function(e){a.handleError(e),u.emit("error",e)})):"license-release"===i?e.keySystem===q.FAIRPLAY&&(a.updateKeySession(e,K("acknowledged")),a.removeSession(e)):a.warn('unhandled media key message type "'+i+'"')}else u.emit("error",new Error("invalid state"))},e.mediaKeysSession.onkeystatuseschange=function(t){if(e.mediaKeysSession){a.onKeyStatusChange(e);var r=e.keyStatus;u.emit("keyStatus",r),"expired"===r&&(a.warn(e.keySystem+" expired for key "+d),a.renewKeySession(e))}else u.emit("error",new Error("invalid state"))};var h=new Promise((function(e,t){u.on("error",t),u.on("keyStatus",(function(r){r.startsWith("usable")?e():"output-restricted"===r?t(new As({type:E.KEY_SYSTEM_ERROR,details:S.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):"internal-error"===r?t(new As({type:E.KEY_SYSTEM_ERROR,details:S.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},'key status changed to "'+r+'"')):"expired"===r?t(new Error("key expired while generating request")):a.warn('unhandled key status change "'+r+'"')}))}));return e.mediaKeysSession.generateRequest(t,r).then((function(){var t;a.log('Request generated for key-session "'+(null==(t=e.mediaKeysSession)?void 0:t.sessionId)+'" keyId: '+d)})).catch((function(e){throw new As({type:E.KEY_SYSTEM_ERROR,details:S.KEY_SYSTEM_NO_SESSION,error:e,fatal:!1},"Error generating key-session request: "+e)})).then((function(){return h})).catch((function(t){throw u.removeAllListeners(),a.removeSession(e),t})).then((function(){return u.removeAllListeners(),e}))},t.onKeyStatusChange=function(e){var t=this;e.mediaKeysSession.keyStatuses.forEach((function(r,i){t.log('key status change "'+r+'" for keyStatuses keyId: '+_e("buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i))+" session keyId: "+_e(new Uint8Array(e.decryptdata.keyId||[]))+" uri: "+e.decryptdata.uri),e.keyStatus=r}))},t.fetchServerCertificate=function(e){var t=this.config,r=new(0,t.loader)(t),n=this.getServerCertificateUrl(e);return n?(this.log('Fetching serverCertificate for "'+e+'"'),new Promise((function(s,a){var o={responseType:"arraybuffer",url:n},c=t.certLoadPolicy.default,l={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:function(e,t,r,i){s(e.data)},onError:function(t,r,s,c){a(new As({type:E.KEY_SYSTEM_ERROR,details:S.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:s,response:i({url:o.url,data:void 0},t)},'"'+e+'" certificate request failed ('+n+"). Status: "+t.code+" ("+t.text+")"))},onTimeout:function(t,r,i){a(new As({type:E.KEY_SYSTEM_ERROR,details:S.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:i,response:{url:o.url,data:void 0}},'"'+e+'" certificate request timed out ('+n+")"))},onAbort:function(e,t,r){a(new Error("aborted"))}};r.load(o,l,d)}))):Promise.resolve()},t.setMediaKeysServerCertificate=function(e,t,r){var i=this;return new Promise((function(n,s){e.setServerCertificate(r).then((function(s){i.log("setServerCertificate "+(s?"success":"not supported by CDM")+" ("+(null==r?void 0:r.byteLength)+') on "'+t+'"'),n(e)})).catch((function(e){s(new As({type:E.KEY_SYSTEM_ERROR,details:S.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:e,fatal:!0},e.message))}))}))},t.renewLicense=function(e,t){var r=this;return this.requestLicense(e,new Uint8Array(t)).then((function(t){return r.updateKeySession(e,new Uint8Array(t)).catch((function(e){throw new As({type:E.KEY_SYSTEM_ERROR,details:S.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:e,fatal:!0},e.message)}))}))},t.setupLicenseXHR=function(e,t,r,i){var n=this,s=this.config.licenseXhrSetup;return s?Promise.resolve().then((function(){if(!r.decryptdata)throw new Error("Key removed");return s.call(n.hls,e,t,r,i)})).catch((function(a){if(!r.decryptdata)throw a;return e.open("POST",t,!0),s.call(n.hls,e,t,r,i)})).then((function(r){return e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:r||i}})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:i}))},t.requestLicense=function(e,t){var r=this,i=this.config.keyLoadPolicy.default;return new Promise((function(n,s){var a=r.getLicenseServerUrl(e.keySystem);r.log("Sending license request to URL: "+a);var o=new XMLHttpRequest;o.responseType="arraybuffer",o.onreadystatechange=function(){if(!r.hls||!e.mediaKeysSession)return s(new Error("invalid state"));if(4===o.readyState)if(200===o.status){r._requestLicenseFailureCount=0;var c=o.response;r.log("License received "+(c instanceof ArrayBuffer?c.byteLength:c));var l=r.config.licenseResponseCallback;if(l)try{c=l.call(r.hls,o,a,e)}catch(e){r.error(e)}n(c)}else{var d=i.errorRetry,u=d?d.maxNumRetry:0;if(r._requestLicenseFailureCount++,r._requestLicenseFailureCount>u||o.status>=400&&o.status<500)s(new As({type:E.KEY_SYSTEM_ERROR,details:S.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:o,response:{url:a,data:void 0,code:o.status,text:o.statusText}},"License Request XHR failed ("+a+"). Status: "+o.status+" ("+o.statusText+")"));else{var h=u-r._requestLicenseFailureCount+1;r.warn("Retrying license request, "+h+" attempts left"),r.requestLicense(e,t).then(n,s)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=o,r.setupLicenseXHR(o,a,e,t).then((function(e){var t=e.xhr,r=e.licenseChallenge;t.send(r)}))}))},t.onMediaAttached=function(e,t){if(this.config.emeEnabled){var r=t.media;this.media=r,r.addEventListener("encrypted",this.onMediaEncrypted),r.addEventListener("waitingforkey",this.onWaitingForKey)}},t.onMediaDetached=function(){var t=this,r=this.media,i=this.mediaKeySessions;r&&(r.removeEventListener("encrypted",this.onMediaEncrypted),r.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},je.clearKeyUriToKeyIdMap();var n=i.length;e.CDMCleanupPromise=Promise.all(i.map((function(e){return t.removeSession(e)})).concat(null==r?void 0:r.setMediaKeys(null).catch((function(e){t.log("Could not clear media keys: "+e+". media.src: "+(null==r?void 0:r.src))})))).then((function(){n&&(t.log("finished closing key sessions and clearing media keys"),i.length=0)})).catch((function(e){t.log("Could not close sessions and clear media keys: "+e+". media.src: "+(null==r?void 0:r.src))}))},t.onManifestLoading=function(){this.keyFormatPromise=null},t.onManifestLoaded=function(e,t){var r=t.sessionKeys;if(r&&this.config.emeEnabled&&!this.keyFormatPromise){var i=r.reduce((function(e,t){return-1===e.indexOf(t.keyFormat)&&e.push(t.keyFormat),e}),[]);this.log("Selecting key-system from session-keys "+i.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(i)}},t.removeSession=function(e){var t=this,r=e.mediaKeysSession,i=e.licenseXhr;if(r){this.log("Remove licenses and keys and close session "+r.sessionId),r.onmessage=null,r.onkeystatuseschange=null,i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;var n=this.mediaKeySessions.indexOf(e);return n>-1&&this.mediaKeySessions.splice(n,1),r.remove().catch((function(e){t.log("Could not remove session: "+e)})).then((function(){return r.close()})).catch((function(e){t.log("Could not close session: "+e)}))}},e}();Cs.CDMCleanupPromise=void 0;var As=function(e){function t(t,r){var i;return(i=e.call(this,r)||this).data=void 0,t.error||(t.error=new Error(r)),i.data=t,t.err=t.error,i}return c(t,e),t}(h(Error)),Ps="m",Ds="a",Ls="v",ks="av",Is="i",Os="tt",Ms=function(){function e(t){var r=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){r.initialized&&(r.starved=!0),r.buffering=!0},this.onPlaying=function(){r.initialized||(r.initialized=!0),r.buffering=!1},this.applyPlaylistData=function(e){try{r.apply(e,{ot:Ps,su:!r.initialized})}catch(e){P.warn("Could not generate manifest CMCD data.",e)}},this.applyFragmentData=function(e){try{var t=e.frag,i=r.hls.levels[t.level],n=r.getObjectType(t),s={d:1e3*t.duration,ot:n};n!==Ls&&n!==Ds&&n!=ks||(s.br=i.bitrate/1e3,s.tb=r.getTopBandwidth(n)/1e3,s.bl=r.getBufferLength(n)),r.apply(e,s)}catch(e){P.warn("Could not generate segment CMCD data.",e)}},this.hls=t;var i=this.config=t.config,n=i.cmcd;null!=n&&(i.pLoader=this.createPlaylistLoader(),i.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||e.uuid(),this.cid=n.contentId,this.useHeaders=!0===n.useHeaders,this.registerListeners())}var t=e.prototype;return t.registerListeners=function(){var e=this.hls;e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHED,this.onMediaDetached,this),e.on(b.BUFFER_CREATED,this.onBufferCreated,this)},t.unregisterListeners=function(){var e=this.hls;e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHED,this.onMediaDetached,this),e.off(b.BUFFER_CREATED,this.onBufferCreated,this)},t.destroy=function(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},t.onMediaAttached=function(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},t.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},t.onBufferCreated=function(e,t){var r,i;this.audioBuffer=null==(r=t.tracks.audio)?void 0:r.buffer,this.videoBuffer=null==(i=t.tracks.video)?void 0:i.buffer},t.createData=function(){var e;return{v:1,sf:"h",sid:this.sid,cid:this.cid,pr:null==(e=this.media)?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},t.apply=function(t,r){void 0===r&&(r={}),o(r,this.createData());var i=r.ot===Is||r.ot===Ls||r.ot===ks;if(this.starved&&i&&(r.bs=!0,r.su=!0,this.starved=!1),null==r.su&&(r.su=this.buffering),this.useHeaders){var n=e.toHeaders(r);if(!Object.keys(n).length)return;t.headers||(t.headers={}),o(t.headers,n)}else{var s=e.toQuery(r);if(!s)return;t.url=e.appendQueryToUri(t.url,s)}},t.getObjectType=function(e){var t=e.type;return"subtitle"===t?Os:"initSegment"===e.sn?Is:"audio"===t?Ds:"main"===t?this.hls.audioTracks.length?Ls:ks:void 0},t.getTopBandwidth=function(e){var t,r=0,i=this.hls;if(e===Ds)t=i.audioTracks;else{var n=i.maxAutoLevel,s=n>-1?n+1:i.levels.length;t=i.levels.slice(0,s)}for(var a,o=f(t);!(a=o()).done;){var c=a.value;c.bitrate>r&&(r=c.bitrate)}return r>0?r:NaN},t.getBufferLength=function(e){var t=this.hls.media,r=e===Ds?this.audioBuffer:this.videoBuffer;return r&&t?1e3*Ar.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len:NaN},t.createPlaylistLoader=function(){var e=this.config.pLoader,t=this.applyPlaylistData,r=e||this.config.loader;return function(){function e(e){this.loader=void 0,this.loader=new r(e)}var i=e.prototype;return i.destroy=function(){this.loader.destroy()},i.abort=function(){this.loader.abort()},i.load=function(e,r,i){t(e),this.loader.load(e,r,i)},s(e,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),e}()},t.createFragmentLoader=function(){var e=this.config.fLoader,t=this.applyFragmentData,r=e||this.config.loader;return function(){function e(e){this.loader=void 0,this.loader=new r(e)}var i=e.prototype;return i.destroy=function(){this.loader.destroy()},i.abort=function(){this.loader.abort()},i.load=function(e,r,i){t(e),this.loader.load(e,r,i)},s(e,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),e}()},e.uuid=function(){var e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)},e.serialize=function(e){for(var t,r=[],i=function(e){return!Number.isNaN(e)&&null!=e&&""!==e&&!1!==e},n=function(e){return Math.round(e)},s=function(e){return 100*n(e/100)},a={br:n,d:n,bl:s,dl:s,mtp:s,nor:function(e){return encodeURIComponent(e)},rtp:s,tb:n},o=f(Object.keys(e||{}).sort());!(t=o()).done;){var c=t.value,l=e[c];if(i(l)&&!("v"===c&&1===l||"pr"==c&&1===l)){var d=a[c];d&&(l=d(l));var u,h=typeof l;u="ot"===c||"sf"===c||"st"===c?c+"="+l:"boolean"===h?c:"number"===h?c+"="+l:c+"="+JSON.stringify(l),r.push(u)}}return r.join(",")},e.toHeaders=function(t){for(var r={},i=["Object","Request","Session","Status"],n=[{},{},{},{}],s={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},a=0,o=Object.keys(t);a<o.length;a++){var c=o[a];n[null!=s[c]?s[c]:1][c]=t[c]}for(var l=0;l<n.length;l++){var d=e.serialize(n[l]);d&&(r["CMCD-"+i[l]]=d)}return r},e.toQuery=function(t){return"CMCD="+encodeURIComponent(e.serialize(t))},e.appendQueryToUri=function(e,t){if(!t)return e;var r=e.includes("?")?"&":"?";return""+e+r+t},e}(),xs=function(){function e(e){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.log=P.log.bind(P,"[content-steering]:"),this.registerListeners()}var t=e.prototype;return t.registerListeners=function(){var e=this.hls;e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.ERROR,this.onError,this)},t.unregisterListeners=function(){var e=this.hls;e&&(e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.ERROR,this.onError,this))},t.startLoad=function(){if(this.started=!0,self.clearTimeout(this.reloadTimer),this.enabled&&this.uri)if(this.updated){var e=Math.max(1e3*this.timeToLoad-(performance.now()-this.updated),0);this.scheduleRefresh(this.uri,e)}else this.loadSteeringManifest(this.uri)},t.stopLoad=function(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),self.clearTimeout(this.reloadTimer)},t.destroy=function(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null},t.removeLevel=function(e){var t=this.levels;t&&(this.levels=t.filter((function(t){return t!==e})))},t.onManifestLoading=function(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null},t.onManifestLoaded=function(e,t){var r=t.contentSteering;null!==r&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())},t.onManifestParsed=function(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks},t.onError=function(e,t){var r=t.errorAction;if((null==r?void 0:r.action)===tr&&r.flags===nr){var i=this.pathwayPriority,n=this.pathwayId;this.penalizedPathways[n]||(this.penalizedPathways[n]=performance.now()),!i&&this.levels&&(i=this.levels.reduce((function(e,t){return-1===e.indexOf(t.pathwayId)&&e.push(t.pathwayId),e}),[])),i&&i.length>1&&(this.updatePathwayPriority(i),r.resolved=this.pathwayId!==n)}},t.filterParsedLevels=function(e){this.levels=e;var t=this.getLevelsForPathway(this.pathwayId);if(0===t.length){var r=e[0].pathwayId;this.log("No levels found in Pathway "+this.pathwayId+'. Setting initial Pathway to "'+r+'"'),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length?(this.log("Found "+t.length+"/"+e.length+' levels in Pathway "'+this.pathwayId+'"'),t):e},t.getLevelsForPathway=function(e){return null===this.levels?[]:this.levels.filter((function(t){return e===t.pathwayId}))},t.updatePathwayPriority=function(e){var t;this.pathwayPriority=e;var r=this.penalizedPathways,i=performance.now();Object.keys(r).forEach((function(e){i-r[e]>3e5&&delete r[e]}));for(var n=0;n<e.length;n++){var s=e[n];if(!r[s]){if(s===this.pathwayId)return;var a=this.hls.nextLoadLevel,o=this.hls.levels[a];if((t=this.getLevelsForPathway(s)).length>0){this.log('Setting Pathway to "'+s+'"'),this.pathwayId=s,this.hls.trigger(b.LEVELS_UPDATED,{levels:t});var c=this.hls.levels[a];o&&c&&this.levels&&(c.attrs["STABLE-VARIANT-ID"]!==o.attrs["STABLE-VARIANT-ID"]&&c.bitrate!==o.bitrate&&this.log("Unstable Pathways change from bitrate "+o.bitrate+" to "+c.bitrate),this.hls.nextLoadLevel=a);break}}}},t.clonePathways=function(e){var t=this,r=this.levels;if(r){var i={},n={};e.forEach((function(e){var s=e.ID,a=e["BASE-ID"],c=e["URI-REPLACEMENT"];if(!r.some((function(e){return e.pathwayId===s}))){var l=t.getLevelsForPathway(a).map((function(e){var t=o({},e);t.details=void 0,t.url=Fs(e.uri,e.attrs["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",c);var r=new k(e.attrs);r["PATHWAY-ID"]=s;var a=r.AUDIO&&r.AUDIO+"_clone_"+s,l=r.SUBTITLES&&r.SUBTITLES+"_clone_"+s;a&&(i[r.AUDIO]=a,r.AUDIO=a),l&&(n[r.SUBTITLES]=l,r.SUBTITLES=l),t.attrs=r;var d=new Nt(t);return dr(d,"audio",a),dr(d,"text",l),d}));r.push.apply(r,l),Ns(t.audioTracks,i,c,s),Ns(t.subtitleTracks,n,c,s)}}))}},t.loadSteeringManifest=function(e){var t,r=this,i=this.hls.config,n=i.loader;this.loader&&this.loader.destroy(),this.loader=new n(i);try{t=new self.URL(e)}catch(t){return this.enabled=!1,void this.log("Failed to parse Steering Manifest URI: "+e)}if("data:"!==t.protocol){var s=0|(this.hls.bandwidthEstimate||i.abrEwmaDefaultEstimate);t.searchParams.set("_HLS_pathway",this.pathwayId),t.searchParams.set("_HLS_throughput",""+s)}var a={responseType:"json",url:t.href},o=i.steeringManifestLoadPolicy.default,c=o.errorRetry||o.timeoutRetry||{},l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:c.maxNumRetry||0,retryDelay:c.retryDelayMs||0,maxRetryDelay:c.maxRetryDelayMs||0},d={onSuccess:function(e,i,n,s){r.log('Loaded steering manifest: "'+t+'"');var a=e.data;if(1===a.VERSION){r.updated=performance.now(),r.timeToLoad=a.TTL;var o=a["RELOAD-URI"],c=a["PATHWAY-CLONES"],l=a["PATHWAY-PRIORITY"];if(o)try{r.uri=new self.URL(o,t).href}catch(e){return r.enabled=!1,void r.log("Failed to parse Steering Manifest RELOAD-URI: "+o)}r.scheduleRefresh(r.uri||n.url),c&&r.clonePathways(c),l&&r.updatePathwayPriority(l)}else r.log("Steering VERSION "+a.VERSION+" not supported!")},onError:function(e,t,i,n){if(r.log("Error loading steering manifest: "+e.code+" "+e.text+" ("+t.url+")"),r.stopLoad(),410===e.code)return r.enabled=!1,void r.log("Steering manifest "+t.url+" no longer available");var s=1e3*r.timeToLoad;if(429!==e.code)r.scheduleRefresh(r.uri||t.url,s);else{var a=r.loader;if("function"==typeof(null==a?void 0:a.getResponseHeader)){var o=a.getResponseHeader("Retry-After");o&&(s=1e3*parseFloat(o))}r.log("Steering manifest "+t.url+" rate limited")}},onTimeout:function(e,t,i){r.log("Timeout loading steering manifest ("+t.url+")"),r.scheduleRefresh(r.uri||t.url)}};this.log("Requesting steering manifest: "+t),this.loader.load(a,l,d)},t.scheduleRefresh=function(e,t){var r=this;void 0===t&&(t=1e3*this.timeToLoad),self.clearTimeout(this.reloadTimer),this.reloadTimer=self.setTimeout((function(){r.loadSteeringManifest(e)}),t)},e}();function Ns(e,t,r,i){e&&Object.keys(t).forEach((function(n){var s=e.filter((function(e){return e.groupId===n})).map((function(e){var s=o({},e);return s.details=void 0,s.attrs=new k(s.attrs),s.url=s.attrs.URI=Fs(e.url,e.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",r),s.groupId=s.attrs["GROUP-ID"]=t[n],s.attrs["PATHWAY-ID"]=i,s}));e.push.apply(e,s)}))}function Fs(e,t,r,i){var n,s=i.HOST,a=i.PARAMS,o=i[r];t&&(n=null==o?void 0:o[t])&&(e=n);var c=new self.URL(e);return s&&!n&&(c.host=s),a&&Object.keys(a).sort().forEach((function(e){e&&c.searchParams.set(e,a[e])})),c.href}var Bs=/^age:\s*[\d.]+\s*$/im,js=function(){function e(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new M,this.retryDelay=0}var t=e.prototype;return t.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},t.abortInternal=function(){var e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))},t.abort=function(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},t.load=function(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()},t.loadInternal=function(){var e=this,t=this.config,r=this.context;if(t){var i=this.loader=new self.XMLHttpRequest,n=this.stats;n.loading.first=0,n.loaded=0;var s=this.xhrSetup;s?Promise.resolve().then((function(){if(!e.stats.aborted)return s(i,r.url)})).catch((function(e){return i.open("GET",r.url,!0),s(i,r.url)})).then((function(){e.stats.aborted||e.openAndSendXhr(i,r,t)})).catch((function(t){e.callbacks.onError({code:i.status,text:t.message},r,i,n)})):this.openAndSendXhr(i,r,t)}},t.openAndSendXhr=function(e,t,r){e.readyState||e.open("GET",t.url,!0);var i=this.context.headers,n=r.loadPolicy,s=n.maxTimeToFirstByteMs,a=n.maxLoadTimeMs;if(i)for(var o in i)e.setRequestHeader(o,i[o]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=s&&y(s)?s:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()},t.readystatechange=function(){var e=this.context,t=this.loader,r=this.stats;if(e&&t){var i=t.readyState,n=this.config;if(!r.aborted&&i>=2&&(0===r.loading.first&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),n.timeout!==n.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),n.timeout=n.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),4===i)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;var s=t.status,a="text"!==t.responseType;if(s>=200&&s<300&&(a&&t.response||null!==t.responseText)){r.loading.end=Math.max(self.performance.now(),r.loading.first);var o=a?t.response:t.responseText,c="arraybuffer"===t.responseType?o.byteLength:o.length;if(r.loaded=r.total=c,r.bwEstimate=8e3*r.total/(r.loading.end-r.loading.first),!this.callbacks)return;var l=this.callbacks.onProgress;if(l&&l(r,e,o,t),!this.callbacks)return;var d={url:t.responseURL,data:o,code:s};this.callbacks.onSuccess(d,r,e,t)}else{var u=n.loadPolicy.errorRetry;$t(u,r.retry,!1,s)?this.retry(u):(P.error(s+" while loading "+e.url),this.callbacks.onError({code:s,text:t.statusText},e,t,r))}}}},t.loadtimeout=function(){var e,t=null==(e=this.config)?void 0:e.loadPolicy.timeoutRetry;if($t(t,this.stats.retry,!0))this.retry(t);else{P.warn("timeout while loading "+this.context.url);var r=this.callbacks;r&&(this.abortInternal(),r.onTimeout(this.stats,this.context,this.loader))}},t.retry=function(e){var t=this.context,r=this.stats;this.retryDelay=Wt(e,r.retry),r.retry++,P.warn((status?"HTTP Status "+status:"Timeout")+" while loading "+t.url+", retrying "+r.retry+"/"+e.maxNumRetry+" in "+this.retryDelay+"ms"),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)},t.loadprogress=function(e){var t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)},t.getCacheAge=function(){var e=null;if(this.loader&&Bs.test(this.loader.getAllResponseHeaders())){var t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e},t.getResponseHeader=function(e){return this.loader&&new RegExp("^"+e+":\\s*[\\d.]+\\s*$","im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null},e}();var Us=/(\d+)-(\d+)\/(\d+)/,Vs=function(){function e(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||Gs,this.controller=new self.AbortController,this.stats=new M}var t=e.prototype;return t.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},t.abortInternal=function(){var e=this.response;null!=e&&e.ok||(this.stats.aborted=!0,this.controller.abort())},t.abort=function(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},t.load=function(e,t,r){var i=this,n=this.stats;if(n.loading.start)throw new Error("Loader can only be used once.");n.loading.start=self.performance.now();var s=function(e,t){var r={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(o({},e.headers))};return e.rangeEnd&&r.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1)),r}(e,this.controller.signal),a=r.onProgress,c="arraybuffer"===e.responseType,l=c?"byteLength":"length",d=t.loadPolicy,u=d.maxTimeToFirstByteMs,h=d.maxLoadTimeMs;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),t.timeout=u&&y(u)?u:h,this.requestTimeout=self.setTimeout((function(){i.abortInternal(),r.onTimeout(n,e,i.response)}),t.timeout),self.fetch(this.request).then((function(s){i.response=i.loader=s;var o=Math.max(self.performance.now(),n.loading.start);if(self.clearTimeout(i.requestTimeout),t.timeout=h,i.requestTimeout=self.setTimeout((function(){i.abortInternal(),r.onTimeout(n,e,i.response)}),h-(o-n.loading.start)),!s.ok){var l=s.status,d=s.statusText;throw new Hs(d||"fetch, bad network response",l,s)}return n.loading.first=o,n.total=function(e){var t=e.get("Content-Range");if(t){var r=function(e){var t=Us.exec(e);if(t)return parseInt(t[2])-parseInt(t[1])+1}(t);if(y(r))return r}var i=e.get("Content-Length");if(i)return parseInt(i)}(s.headers)||n.total,a&&y(t.highWaterMark)?i.loadProgressively(s,n,e,t.highWaterMark,a):c?s.arrayBuffer():"json"===e.responseType?s.json():s.text()})).then((function(s){var o=i.response;self.clearTimeout(i.requestTimeout),n.loading.end=Math.max(self.performance.now(),n.loading.first);var c=s[l];c&&(n.loaded=n.total=c);var d={url:o.url,data:s,code:o.status};a&&!y(t.highWaterMark)&&a(n,e,s,o),r.onSuccess(d,n,e,o)})).catch((function(t){if(self.clearTimeout(i.requestTimeout),!n.aborted){var s=t&&t.code||0,a=t?t.message:null;r.onError({code:s,text:a},e,t?t.details:null,n)}}))},t.getCacheAge=function(){var e=null;if(this.response){var t=this.response.headers.get("age");e=t?parseFloat(t):null}return e},t.getResponseHeader=function(e){return this.response?this.response.headers.get(e):null},t.loadProgressively=function(e,t,r,i,n){void 0===i&&(i=0);var s=new gn,a=e.body.getReader();return function o(){return a.read().then((function(a){if(a.done)return s.dataLength&&n(t,r,s.flush(),e),Promise.resolve(new ArrayBuffer(0));var c=a.value,l=c.length;return t.loaded+=l,l<i||s.dataLength?(s.push(c),s.dataLength>=i&&n(t,r,s.flush(),e)):n(t,r,c,e),o()})).catch((function(){return Promise.reject()}))}()},e}();function Gs(e,t){return new self.Request(e.url,t)}var Hs=function(e){function t(t,r,i){var n;return(n=e.call(this,t)||this).code=void 0,n.details=void 0,n.code=r,n.details=i,n}return c(t,e),t}(h(Error)),Ks=/\s/,qs=i(i({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:js,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:mn,bufferController:Pn,capLevelController:ws,errorController:ar,fpsController:Ts,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:ee,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:{newCue:function(e,t,r,i){for(var n,s,a,o,c,l=[],d=self.VTTCue||self.TextTrackCue,u=0;u<i.rows.length;u++)if(a=!0,o=0,c="",!(n=i.rows[u]).isEmpty()){for(var h,p=0;p<n.chars.length;p++)Ks.test(n.chars[p].uchar)&&a?o++:(c+=n.chars[p].uchar,a=!1);n.cueStartTime=t,t===r&&(r+=1e-4),o>=16?o--:o++;var f=is(c.trim()),m=cs(t,r,f);null!=e&&null!=(h=e.cues)&&h.getCueById(m)||((s=new d(t,r,f)).id=m,s.line=u+1,s.align="left",s.position=10+Math.min(80,10*Math.floor(8*o/32)),l.push(s))}return e&&l.length&&(l.sort((function(e,t){return"auto"===e.line||"auto"===t.line?0:e.line>8&&t.line>8?t.line-e.line:e.line-t.line})),l.forEach((function(t){return bt(e,t)}))),l}},enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:En,subtitleTrackController:wn,timelineController:Es,audioStreamController:vn,audioTrackController:_n,emeController:Cs,cmcdController:Ms,contentSteeringController:xs});function Ws(e){return e&&"object"==typeof e?Array.isArray(e)?e.map(Ws):Object.keys(e).reduce((function(t,r){return t[r]=Ws(e[r]),t}),{}):e}function zs(e){var t=e.loader;t!==Vs&&t!==js?(P.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1):function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(e){}return!1}()&&(e.loader=Vs,e.progressive=!0,e.enableSoftwareAES=!0,P.log("[config]: Progressive streaming enabled, using FetchLoader"))}var $s=function(){function e(t){void 0===t&&(t={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new sn,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,A(t.debug||!1,"Hls instance");var r=this.config=function(e,t){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');var r=Ws(e),n=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach((function(e){var i=("level"===e?"playlist":e)+"LoadPolicy",s=void 0===t[i],a=[];n.forEach((function(n){var o=e+"Loading"+n,c=t[o];if(void 0!==c&&s){a.push(o);var l=r[i].default;switch(t[i]={default:l},n){case"TimeOut":l.maxLoadTimeMs=c,l.maxTimeToFirstByteMs=c;break;case"MaxRetry":l.errorRetry.maxNumRetry=c,l.timeoutRetry.maxNumRetry=c;break;case"RetryDelay":l.errorRetry.retryDelayMs=c,l.timeoutRetry.retryDelayMs=c;break;case"MaxRetryTimeout":l.errorRetry.maxRetryDelayMs=c,l.timeoutRetry.maxRetryDelayMs=c}}})),a.length&&P.warn('hls.js config: "'+a.join('", "')+'" setting(s) are deprecated, use "'+i+'": '+JSON.stringify(t[i]))})),i(i({},r),t)}(e.DefaultConfig,t);this.userConfig=t,this._autoLevelCapping=-1,r.progressive&&zs(r);var n=r.abrController,s=r.bufferController,a=r.capLevelController,o=r.errorController,c=r.fpsController,l=new o(this),d=this.abrController=new n(this),u=this.bufferController=new s(this),h=this.capLevelController=new a(this),p=new c(this),f=new _t(this),m=new Dt(this),g=r.contentSteeringController,v=g?new g(this):null,_=this.levelController=new lr(this,v),y=new gr(this),E=new Tr(this.config),S=this.streamController=new hn(this,y,E);h.setStreamController(S),p.setStreamController(S);var w=[f,_,S];v&&w.splice(1,0,v),this.networkControllers=w;var T=[d,u,h,p,m,y];this.audioTrackController=this.createController(r.audioTrackController,w);var R=r.audioStreamController;R&&w.push(new R(this,y,E)),this.subtitleTrackController=this.createController(r.subtitleTrackController,w);var C=r.subtitleStreamController;C&&w.push(new C(this,y,E)),this.createController(r.timelineController,T),E.emeController=this.emeController=this.createController(r.emeController,T),this.cmcdController=this.createController(r.cmcdController,T),this.latencyController=this.createController(Lt,T),this.coreComponents=T,w.push(l);var D=l.onErrorOut;"function"==typeof D&&this.on(b.ERROR,D,l)}e.isSupported=function(){return function(){var e=We();if(!e)return!1;var t=Xr(),r=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),i=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!r&&!!i}()};var t=e.prototype;return t.createController=function(e,t){if(e){var r=new e(this);return t&&t.push(r),r}return null},t.on=function(e,t,r){void 0===r&&(r=this),this._emitter.on(e,t,r)},t.once=function(e,t,r){void 0===r&&(r=this),this._emitter.once(e,t,r)},t.removeAllListeners=function(e){this._emitter.removeAllListeners(e)},t.off=function(e,t,r,i){void 0===r&&(r=this),this._emitter.off(e,t,r,i)},t.listeners=function(e){return this._emitter.listeners(e)},t.emit=function(e,t,r){return this._emitter.emit(e,t,r)},t.trigger=function(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(t){P.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),this.trigger(b.ERROR,{type:E.OTHER_ERROR,details:S.INTERNAL_EXCEPTION,fatal:!1,event:e,error:t})}return!1},t.listenerCount=function(e){return this._emitter.listenerCount(e)},t.destroy=function(){P.log("destroy"),this.trigger(b.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach((function(e){return e.destroy()})),this.networkControllers.length=0,this.coreComponents.forEach((function(e){return e.destroy()})),this.coreComponents.length=0;var e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null},t.attachMedia=function(e){P.log("attachMedia"),this._media=e,this.trigger(b.MEDIA_ATTACHING,{media:e})},t.detachMedia=function(){P.log("detachMedia"),this.trigger(b.MEDIA_DETACHING,void 0),this._media=null},t.loadSource=function(e){this.stopLoad();var t=this.media,r=this.url,i=this.url=_.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});P.log("loadSource:"+i),t&&r&&(r!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(b.MANIFEST_LOADING,{url:e})},t.startLoad=function(e){void 0===e&&(e=-1),P.log("startLoad("+e+")"),this.networkControllers.forEach((function(t){t.startLoad(e)}))},t.stopLoad=function(){P.log("stopLoad"),this.networkControllers.forEach((function(e){e.stopLoad()}))},t.swapAudioCodec=function(){P.log("swapAudioCodec"),this.streamController.swapAudioCodec()},t.recoverMediaError=function(){P.log("recoverMediaError");var e=this._media;this.detachMedia(),e&&this.attachMedia(e)},t.removeLevel=function(e,t){void 0===t&&(t=0),this.levelController.removeLevel(e,t)},s(e,[{key:"levels",get:function(){return this.levelController.levels||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){P.log("set currentLevel:"+e),this.loadLevel=e,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){P.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){P.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){P.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){P.log("set startLevel:"+e),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(e){var t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping!==e&&(P.log("set autoLevelCapping:"+e),this._autoLevelCapping=e)}},{key:"bandwidthEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.getEstimate():NaN}},{key:"ttfbEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.getEstimateTTFB():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(e){kt.indexOf(e)>-1&&(this._maxHdcpLevel=e)}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var e=this.levels,t=this.config.minAutoBitrate;if(!e)return 0;for(var r=e.length,i=0;i<r;i++)if(e[i].maxBitrate>=t)return i;return 0}},{key:"maxAutoLevel",get:function(){var e,t=this.levels,r=this.autoLevelCapping,i=this.maxHdcpLevel;if(e=-1===r&&t&&t.length?t.length-1:r,i)for(var n=e;n--;){var s=t[n].attrs["HDCP-LEVEL"];if(s&&s<=i)return n}return e}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(e){this.config.lowLatencyMode=e}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.4.5"}},{key:"Events",get:function(){return b}},{key:"ErrorTypes",get:function(){return E}},{key:"ErrorDetails",get:function(){return S}},{key:"DefaultConfig",get:function(){return e.defaultConfig?e.defaultConfig:qs},set:function(t){e.defaultConfig=t}}]),e}();return $s.defaultConfig=void 0,$s}()}(!1)},9514:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Consumer=void 0;const i=r(8562),n=r(4493),s=r(9992),a=new i.Logger("Consumer");class o extends n.EnhancedEventEmitter{constructor({id:e,localId:t,producerId:r,rtpReceiver:i,track:s,rtpParameters:o,appData:c}){super(),this._closed=!1,this._observer=new n.EnhancedEventEmitter,a.debug("constructor()"),this._id=e,this._localId=t,this._producerId=r,this._rtpReceiver=i,this._track=s,this._rtpParameters=o,this._paused=!s.enabled,this._appData=c||{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){this._closed||(a.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(a.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new s.InvalidStateError("closed");return new Promise(((e,t)=>{this.safeEmit("@getstats",e,t)}))}pause(){a.debug("pause()"),this._closed?a.error("pause() | Consumer closed"):this._paused?a.debug("pause() | Consumer is already paused"):(this._paused=!0,this._track.enabled=!1,this.emit("@pause"),this._observer.safeEmit("pause"))}resume(){a.debug("resume()"),this._closed?a.error("resume() | Consumer closed"):this._paused?(this._paused=!1,this._track.enabled=!0,this.emit("@resume"),this._observer.safeEmit("resume")):a.debug("resume() | Consumer is already resumed")}onTrackEnded(){a.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){try{this._track.removeEventListener("ended",this.onTrackEnded),this._track.stop()}catch(e){}}}t.Consumer=o},1623:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataConsumer=void 0;const i=r(8562),n=r(4493),s=new i.Logger("DataConsumer");class a extends n.EnhancedEventEmitter{constructor({id:e,dataProducerId:t,dataChannel:r,sctpStreamParameters:i,appData:a}){super(),this._closed=!1,this._observer=new n.EnhancedEventEmitter,s.debug("constructor()"),this._id=e,this._dataProducerId=t,this._dataChannel=r,this._sctpStreamParameters=i,this._appData=a||{},this.handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(e){this._dataChannel.binaryType=e}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){this._closed||(s.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(s.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}handleDataChannel(){this._dataChannel.addEventListener("open",(()=>{this._closed||(s.debug('DataChannel "open" event'),this.safeEmit("open"))})),this._dataChannel.addEventListener("error",(e=>{if(this._closed)return;let{error:t}=e;t||(t=new Error("unknown DataChannel error")),"sctp-failure"===t.errorDetail?s.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",t.sctpCauseCode,t.message):s.error('DataChannel "error" event: %o',t),this.safeEmit("error",t)})),this._dataChannel.addEventListener("close",(()=>{this._closed||(s.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))})),this._dataChannel.addEventListener("message",(e=>{this._closed||this.safeEmit("message",e.data)}))}}t.DataConsumer=a},5504:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataProducer=void 0;const i=r(8562),n=r(4493),s=r(9992),a=new i.Logger("DataProducer");class o extends n.EnhancedEventEmitter{constructor({id:e,dataChannel:t,sctpStreamParameters:r,appData:i}){super(),this._closed=!1,this._observer=new n.EnhancedEventEmitter,a.debug("constructor()"),this._id=e,this._dataChannel=t,this._sctpStreamParameters=r,this._appData=i||{},this.handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(e){this._dataChannel.bufferedAmountLowThreshold=e}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){this._closed||(a.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(a.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}send(e){if(a.debug("send()"),this._closed)throw new s.InvalidStateError("closed");this._dataChannel.send(e)}handleDataChannel(){this._dataChannel.addEventListener("open",(()=>{this._closed||(a.debug('DataChannel "open" event'),this.safeEmit("open"))})),this._dataChannel.addEventListener("error",(e=>{if(this._closed)return;let{error:t}=e;t||(t=new Error("unknown DataChannel error")),"sctp-failure"===t.errorDetail?a.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",t.sctpCauseCode,t.message):a.error('DataChannel "error" event: %o',t),this.safeEmit("error",t)})),this._dataChannel.addEventListener("close",(()=>{this._closed||(a.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))})),this._dataChannel.addEventListener("message",(()=>{this._closed||a.warn('DataChannel "message" event in a DataProducer, message discarded')})),this._dataChannel.addEventListener("bufferedamountlow",(()=>{this._closed||this.safeEmit("bufferedamountlow")}))}}t.DataProducer=o},3120:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Device=t.detectDevice=void 0;const o=a(r(1206)),c=r(8562),l=r(4493),d=r(9992),u=s(r(3347)),h=s(r(5280)),p=r(5202),f=r(2960),m=r(6656),g=r(5372),v=r(5697),_=r(564),y=r(1419),b=r(9862),E=r(2205),S=r(9852),w=r(3433),T=r(4770),R=new c.Logger("Device");function C(){if("object"==typeof navigator&&"ReactNative"===navigator.product)return"undefined"==typeof RTCPeerConnection?void R.warn("this._detectDevice() | unsupported react-native-webrtc without RTCPeerConnection, forgot to call registerGlobals()?"):"undefined"!=typeof RTCRtpTransceiver?(R.debug("this._detectDevice() | ReactNative UnifiedPlan handler chosen"),"ReactNativeUnifiedPlan"):(R.debug("this._detectDevice() | ReactNative PlanB handler chosen"),"ReactNative");if("object"!=typeof navigator||"string"!=typeof navigator.userAgent)R.warn("this._detectDevice() | unknown device");else{const e=navigator.userAgent,t=o.default.getParser(e),r=t.getEngine();if(t.satisfies({chrome:">=111",chromium:">=111","microsoft edge":">=111"}))return"Chrome111";if(t.satisfies({chrome:">=74",chromium:">=74","microsoft edge":">=88"}))return"Chrome74";if(t.satisfies({chrome:">=70",chromium:">=70"}))return"Chrome70";if(t.satisfies({chrome:">=67",chromium:">=67"}))return"Chrome67";if(t.satisfies({chrome:">=55",chromium:">=55"}))return"Chrome55";if(t.satisfies({firefox:">=60"}))return"Firefox60";if(t.satisfies({ios:{OS:">=14.3",firefox:">=30.0"}}))return"Safari12";if(t.satisfies({safari:">=12.0"})&&"undefined"!=typeof RTCRtpTransceiver&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(t.satisfies({safari:">=11"}))return"Safari11";if(t.satisfies({"microsoft edge":">=11"})&&t.satisfies({"microsoft edge":"<=18"}))return"Edge11";if(r.name&&"blink"===r.name.toLowerCase()){const t=e.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(t){const e=Number(t[1]);return e>=111?"Chrome111":e>=74?"Chrome74":e>=70?"Chrome70":e>=67?"Chrome67":"Chrome55"}return"Chrome111"}R.warn("this._detectDevice() | browser not supported [name:%s, version:%s]",t.getBrowserName(),t.getBrowserVersion())}}t.detectDevice=C,t.Device=class{constructor({handlerName:e,handlerFactory:t,Handler:r}={}){if(this._loaded=!1,this._observer=new l.EnhancedEventEmitter,R.debug("constructor()"),r){if(R.warn("constructor() | Handler option is DEPRECATED, use handlerName or handlerFactory instead"),"string"!=typeof r)throw new TypeError("non string Handler option no longer supported, use handlerFactory instead");e=r}if(e&&t)throw new TypeError("just one of handlerName or handlerInterface can be given");if(t)this._handlerFactory=t;else{if(e)R.debug("constructor() | handler given: %s",e);else{if(!(e=C()))throw new d.UnsupportedError("device not supported");R.debug("constructor() | detected handler: %s",e)}switch(e){case"Chrome111":this._handlerFactory=f.Chrome111.createFactory();break;case"Chrome74":this._handlerFactory=m.Chrome74.createFactory();break;case"Chrome70":this._handlerFactory=g.Chrome70.createFactory();break;case"Chrome67":this._handlerFactory=v.Chrome67.createFactory();break;case"Chrome55":this._handlerFactory=_.Chrome55.createFactory();break;case"Firefox60":this._handlerFactory=y.Firefox60.createFactory();break;case"Safari12":this._handlerFactory=b.Safari12.createFactory();break;case"Safari11":this._handlerFactory=E.Safari11.createFactory();break;case"Edge11":this._handlerFactory=S.Edge11.createFactory();break;case"ReactNativeUnifiedPlan":this._handlerFactory=w.ReactNativeUnifiedPlan.createFactory();break;case"ReactNative":this._handlerFactory=T.ReactNative.createFactory();break;default:throw new TypeError(`unknown handlerName "${e}"`)}}const i=this._handlerFactory();this._handlerName=i.name,i.close(),this._extendedRtpCapabilities=void 0,this._recvRtpCapabilities=void 0,this._canProduceByKind={audio:!1,video:!1},this._sctpCapabilities=void 0}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new d.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new d.InvalidStateError("not loaded");return this._sctpCapabilities}get observer(){return this._observer}async load({routerRtpCapabilities:e}){let t;R.debug("load() [routerRtpCapabilities:%o]",e),e=u.clone(e,void 0);try{if(this._loaded)throw new d.InvalidStateError("already loaded");h.validateRtpCapabilities(e),t=this._handlerFactory();const r=await t.getNativeRtpCapabilities();R.debug("load() | got native RTP capabilities:%o",r),h.validateRtpCapabilities(r),this._extendedRtpCapabilities=h.getExtendedRtpCapabilities(r,e),R.debug("load() | got extended RTP capabilities:%o",this._extendedRtpCapabilities),this._canProduceByKind.audio=h.canSend("audio",this._extendedRtpCapabilities),this._canProduceByKind.video=h.canSend("video",this._extendedRtpCapabilities),this._recvRtpCapabilities=h.getRecvRtpCapabilities(this._extendedRtpCapabilities),h.validateRtpCapabilities(this._recvRtpCapabilities),R.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._sctpCapabilities=await t.getNativeSctpCapabilities(),R.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),h.validateSctpCapabilities(this._sctpCapabilities),R.debug("load() succeeded"),this._loaded=!0,t.close()}catch(e){throw t&&t.close(),e}}canProduce(e){if(!this._loaded)throw new d.InvalidStateError("not loaded");if("audio"!==e&&"video"!==e)throw new TypeError(`invalid kind "${e}"`);return this._canProduceByKind[e]}createSendTransport({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n,iceServers:s,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:c,appData:l}){return R.debug("createSendTransport()"),this.createTransport({direction:"send",id:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n,iceServers:s,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:c,appData:l})}createRecvTransport({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n,iceServers:s,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:c,appData:l}){return R.debug("createRecvTransport()"),this.createTransport({direction:"recv",id:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n,iceServers:s,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:c,appData:l})}createTransport({direction:e,id:t,iceParameters:r,iceCandidates:i,dtlsParameters:n,sctpParameters:s,iceServers:a,iceTransportPolicy:o,additionalSettings:c,proprietaryConstraints:l,appData:u}){if(!this._loaded)throw new d.InvalidStateError("not loaded");if("string"!=typeof t)throw new TypeError("missing id");if("object"!=typeof r)throw new TypeError("missing iceParameters");if(!Array.isArray(i))throw new TypeError("missing iceCandidates");if("object"!=typeof n)throw new TypeError("missing dtlsParameters");if(s&&"object"!=typeof s)throw new TypeError("wrong sctpParameters");if(u&&"object"!=typeof u)throw new TypeError("if given, appData must be an object");const h=new p.Transport({direction:e,id:t,iceParameters:r,iceCandidates:i,dtlsParameters:n,sctpParameters:s,iceServers:a,iceTransportPolicy:o,additionalSettings:c,proprietaryConstraints:l,appData:u,handlerFactory:this._handlerFactory,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",h),h}}},4493:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EnhancedEventEmitter=void 0;const i=r(7187),n=new(r(8562).Logger)("EnhancedEventEmitter");class s extends i.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}emit(e,...t){return super.emit(e,...t)}safeEmit(e,...t){const r=super.listenerCount(e);try{return super.emit(e,...t)}catch(t){return n.error("safeEmit() | event listener threw an error [eventName:%s]:%o",e,t),Boolean(r)}}on(e,t){return super.on(e,t),this}off(e,t){return super.off(e,t),this}addListener(e,t){return super.on(e,t),this}prependListener(e,t){return super.prependListener(e,t),this}once(e,t){return super.once(e,t),this}prependOnceListener(e,t){return super.prependOnceListener(e,t),this}removeListener(e,t){return super.off(e,t),this}removeAllListeners(e){return super.removeAllListeners(e),this}listenerCount(e){return super.listenerCount(e)}listeners(e){return super.listeners(e)}rawListeners(e){return super.rawListeners(e)}}t.EnhancedEventEmitter=s},8562:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;const n=i(r(388)),s="mediasoup-client";t.Logger=class{constructor(e){e?(this._debug=(0,n.default)(`${s}:${e}`),this._warn=(0,n.default)(`${s}:WARN:${e}`),this._error=(0,n.default)(`${s}:ERROR:${e}`)):(this._debug=(0,n.default)(s),this._warn=(0,n.default)(`${s}:WARN`),this._error=(0,n.default)(`${s}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}},6569:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Producer=void 0;const i=r(8562),n=r(4493),s=r(9992),a=new i.Logger("Producer");class o extends n.EnhancedEventEmitter{constructor({id:e,localId:t,rtpSender:r,track:i,rtpParameters:s,stopTracks:o,disableTrackOnPause:c,zeroRtpOnPause:l,appData:d}){super(),this._closed=!1,this._observer=new n.EnhancedEventEmitter,a.debug("constructor()"),this._id=e,this._localId=t,this._rtpSender=r,this._track=i,this._kind=i.kind,this._rtpParameters=s,this._paused=!!c&&!i.enabled,this._maxSpatialLayer=void 0,this._stopTracks=o,this._disableTrackOnPause=c,this._zeroRtpOnPause=l,this._appData=d||{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){this._closed||(a.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(a.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new s.InvalidStateError("closed");return new Promise(((e,t)=>{this.safeEmit("@getstats",e,t)}))}pause(){a.debug("pause()"),this._closed?a.error("pause() | Producer closed"):(this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&new Promise(((e,t)=>{this.safeEmit("@pause",e,t)})).catch((()=>{})),this._observer.safeEmit("pause"))}resume(){a.debug("resume()"),this._closed?a.error("resume() | Producer closed"):(this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&new Promise(((e,t)=>{this.safeEmit("@resume",e,t)})).catch((()=>{})),this._observer.safeEmit("resume"))}async replaceTrack({track:e}){if(a.debug("replaceTrack() [track:%o]",e),this._closed){if(e&&this._stopTracks)try{e.stop()}catch(e){}throw new s.InvalidStateError("closed")}if(e&&"ended"===e.readyState)throw new s.InvalidStateError("track ended");e!==this._track?(await new Promise(((t,r)=>{this.safeEmit("@replacetrack",e,t,r)})),this.destroyTrack(),this._track=e,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this.handleTrack()):a.debug("replaceTrack() | same track, ignored")}async setMaxSpatialLayer(e){if(this._closed)throw new s.InvalidStateError("closed");if("video"!==this._kind)throw new s.UnsupportedError("not a video Producer");if("number"!=typeof e)throw new TypeError("invalid spatialLayer");e!==this._maxSpatialLayer&&(await new Promise(((t,r)=>{this.safeEmit("@setmaxspatiallayer",e,t,r)})).catch((()=>{})),this._maxSpatialLayer=e)}async setRtpEncodingParameters(e){if(this._closed)throw new s.InvalidStateError("closed");if("object"!=typeof e)throw new TypeError("invalid params");await new Promise(((t,r)=>{this.safeEmit("@setrtpencodingparameters",e,t,r)}))}onTrackEnded(){a.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track&&this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){if(this._track)try{this._track.removeEventListener("ended",this.onTrackEnded),this._stopTracks&&this._track.stop()}catch(e){}}}t.Producer=o},4879:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},7669:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},5202:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Transport=void 0;const o=r(2186),c=a(r(4375)),l=r(8562),d=r(4493),u=r(9992),h=s(r(3347)),p=s(r(5280)),f=r(6569),m=r(9514),g=r(5504),v=r(1623),_=new l.Logger("Transport");class y{constructor(e){this.consumerOptions=e,this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class b extends d.EnhancedEventEmitter{constructor({direction:e,id:t,iceParameters:r,iceCandidates:i,dtlsParameters:n,sctpParameters:s,iceServers:a,iceTransportPolicy:c,additionalSettings:l,proprietaryConstraints:u,appData:p,handlerFactory:f,extendedRtpCapabilities:m,canProduceByKind:g}){super(),this._closed=!1,this._connectionState="new",this._producers=new Map,this._consumers=new Map,this._dataProducers=new Map,this._dataConsumers=new Map,this._probatorConsumerCreated=!1,this._awaitQueue=new o.AwaitQueue,this._pendingConsumerTasks=[],this._consumerCreationInProgress=!1,this._pendingPauseConsumers=new Map,this._consumerPauseInProgress=!1,this._pendingResumeConsumers=new Map,this._consumerResumeInProgress=!1,this._pendingCloseConsumers=new Map,this._consumerCloseInProgress=!1,this._observer=new d.EnhancedEventEmitter,_.debug("constructor() [id:%s, direction:%s]",t,e),this._id=t,this._direction=e,this._extendedRtpCapabilities=m,this._canProduceByKind=g,this._maxSctpMessageSize=s?s.maxMessageSize:null,delete(l=h.clone(l,{})).iceServers,delete l.iceTransportPolicy,delete l.bundlePolicy,delete l.rtcpMuxPolicy,delete l.sdpSemantics,this._handler=f(),this._handler.run({direction:e,iceParameters:r,iceCandidates:i,dtlsParameters:n,sctpParameters:s,iceServers:a,iceTransportPolicy:c,additionalSettings:l,proprietaryConstraints:u,extendedRtpCapabilities:m}),this._appData=p||{},this.handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){if(!this._closed){_.debug("close()"),this._closed=!0,this._awaitQueue.stop(),this._handler.close();for(const e of this._producers.values())e.transportClosed();this._producers.clear();for(const e of this._consumers.values())e.transportClosed();this._consumers.clear();for(const e of this._dataProducers.values())e.transportClosed();this._dataProducers.clear();for(const e of this._dataConsumers.values())e.transportClosed();this._dataConsumers.clear(),this._observer.safeEmit("close")}}async getStats(){if(this._closed)throw new u.InvalidStateError("closed");return this._handler.getTransportStats()}async restartIce({iceParameters:e}){if(_.debug("restartIce()"),this._closed)throw new u.InvalidStateError("closed");if(!e)throw new TypeError("missing iceParameters");return this._awaitQueue.push((async()=>this._handler.restartIce(e)),"transport.restartIce()")}async updateIceServers({iceServers:e}={}){if(_.debug("updateIceServers()"),this._closed)throw new u.InvalidStateError("closed");if(!Array.isArray(e))throw new TypeError("missing iceServers");return this._awaitQueue.push((async()=>this._handler.updateIceServers(e)),"transport.updateIceServers()")}async produce({track:e,encodings:t,codecOptions:r,codec:i,stopTracks:n=!0,disableTrackOnPause:s=!0,zeroRtpOnPause:a=!1,appData:o={}}={}){if(_.debug("produce() [track:%o]",e),this._closed)throw new u.InvalidStateError("closed");if(!e)throw new TypeError("missing track");if("send"!==this._direction)throw new u.UnsupportedError("not a sending Transport");if(!this._canProduceByKind[e.kind])throw new u.UnsupportedError(`cannot produce ${e.kind}`);if("ended"===e.readyState)throw new u.InvalidStateError("track ended");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(0===this.listenerCount("produce"))throw new TypeError('no "produce" listener set into this transport');if(o&&"object"!=typeof o)throw new TypeError("if given, appData must be an object");return this._awaitQueue.push((async()=>{let c;if(t&&!Array.isArray(t))throw TypeError("encodings must be an array");t&&0===t.length?c=void 0:t&&(c=t.map((e=>{const t={active:!0};return!1===e.active&&(t.active=!1),"boolean"==typeof e.dtx&&(t.dtx=e.dtx),"string"==typeof e.scalabilityMode&&(t.scalabilityMode=e.scalabilityMode),"number"==typeof e.scaleResolutionDownBy&&(t.scaleResolutionDownBy=e.scaleResolutionDownBy),"number"==typeof e.maxBitrate&&(t.maxBitrate=e.maxBitrate),"number"==typeof e.maxFramerate&&(t.maxFramerate=e.maxFramerate),"boolean"==typeof e.adaptivePtime&&(t.adaptivePtime=e.adaptivePtime),"string"==typeof e.priority&&(t.priority=e.priority),"string"==typeof e.networkPriority&&(t.networkPriority=e.networkPriority),t})));const{localId:l,rtpParameters:d,rtpSender:u}=await this._handler.send({track:e,encodings:c,codecOptions:r,codec:i});try{p.validateRtpParameters(d);const{id:t}=await new Promise(((t,r)=>{this.safeEmit("produce",{kind:e.kind,rtpParameters:d,appData:o},t,r)})),r=new f.Producer({id:t,localId:l,rtpSender:u,track:e,rtpParameters:d,stopTracks:n,disableTrackOnPause:s,zeroRtpOnPause:a,appData:o});return this._producers.set(r.id,r),this.handleProducer(r),this._observer.safeEmit("newproducer",r),r}catch(e){throw this._handler.stopSending(l).catch((()=>{})),e}}),"transport.produce()").catch((t=>{if(n)try{e.stop()}catch(e){}throw t}))}async consume({id:e,producerId:t,kind:r,rtpParameters:i,streamId:n,appData:s={}}){if(_.debug("consume()"),i=h.clone(i,void 0),this._closed)throw new u.InvalidStateError("closed");if("recv"!==this._direction)throw new u.UnsupportedError("not a receiving Transport");if("string"!=typeof e)throw new TypeError("missing id");if("string"!=typeof t)throw new TypeError("missing producerId");if("audio"!==r&&"video"!==r)throw new TypeError(`invalid kind '${r}'`);if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(s&&"object"!=typeof s)throw new TypeError("if given, appData must be an object");if(!p.canReceive(i,this._extendedRtpCapabilities))throw new u.UnsupportedError("cannot consume this Producer");const a=new y({id:e,producerId:t,kind:r,rtpParameters:i,streamId:n,appData:s});return this._pendingConsumerTasks.push(a),(0,c.default)((()=>{this._closed||!1===this._consumerCreationInProgress&&this.createPendingConsumers()})),a.promise}async produceData({ordered:e=!0,maxPacketLifeTime:t,maxRetransmits:r,label:i="",protocol:n="",appData:s={}}={}){if(_.debug("produceData()"),this._closed)throw new u.InvalidStateError("closed");if("send"!==this._direction)throw new u.UnsupportedError("not a sending Transport");if(!this._maxSctpMessageSize)throw new u.UnsupportedError("SCTP not enabled by remote Transport");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(0===this.listenerCount("producedata"))throw new TypeError('no "producedata" listener set into this transport');if(s&&"object"!=typeof s)throw new TypeError("if given, appData must be an object");return(t||r)&&(e=!1),this._awaitQueue.push((async()=>{const{dataChannel:a,sctpStreamParameters:o}=await this._handler.sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:i,protocol:n});p.validateSctpStreamParameters(o);const{id:c}=await new Promise(((e,t)=>{this.safeEmit("producedata",{sctpStreamParameters:o,label:i,protocol:n,appData:s},e,t)})),l=new g.DataProducer({id:c,dataChannel:a,sctpStreamParameters:o,appData:s});return this._dataProducers.set(l.id,l),this.handleDataProducer(l),this._observer.safeEmit("newdataproducer",l),l}),"transport.produceData()")}async consumeData({id:e,dataProducerId:t,sctpStreamParameters:r,label:i="",protocol:n="",appData:s={}}){if(_.debug("consumeData()"),r=h.clone(r,void 0),this._closed)throw new u.InvalidStateError("closed");if("recv"!==this._direction)throw new u.UnsupportedError("not a receiving Transport");if(!this._maxSctpMessageSize)throw new u.UnsupportedError("SCTP not enabled by remote Transport");if("string"!=typeof e)throw new TypeError("missing id");if("string"!=typeof t)throw new TypeError("missing dataProducerId");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(s&&"object"!=typeof s)throw new TypeError("if given, appData must be an object");return p.validateSctpStreamParameters(r),this._awaitQueue.push((async()=>{const{dataChannel:a}=await this._handler.receiveDataChannel({sctpStreamParameters:r,label:i,protocol:n}),o=new v.DataConsumer({id:e,dataProducerId:t,dataChannel:a,sctpStreamParameters:r,appData:s});return this._dataConsumers.set(o.id,o),this.handleDataConsumer(o),this._observer.safeEmit("newdataconsumer",o),o}),"transport.consumeData()")}async createPendingConsumers(){this._consumerCreationInProgress=!0,this._awaitQueue.push((async()=>{if(0===this._pendingConsumerTasks.length)return void _.debug("createPendingConsumers() | there is no Consumer to be created");const e=[...this._pendingConsumerTasks];let t;this._pendingConsumerTasks=[];const r=[];for(const t of e){const{id:e,kind:i,rtpParameters:n,streamId:s}=t.consumerOptions;r.push({trackId:e,kind:i,rtpParameters:n,streamId:s})}try{const i=await this._handler.receive(r);for(let r=0;r<i.length;++r){const n=e[r],s=i[r],{id:a,producerId:o,kind:c,rtpParameters:l,appData:d}=n.consumerOptions,{localId:u,rtpReceiver:h,track:p}=s,f=new m.Consumer({id:a,localId:u,producerId:o,rtpReceiver:h,track:p,rtpParameters:l,appData:d});this._consumers.set(f.id,f),this.handleConsumer(f),this._probatorConsumerCreated||t||"video"!==c||(t=f),this._observer.safeEmit("newconsumer",f),n.resolve(f)}}catch(t){for(const r of e)r.reject(t)}if(t)try{const e=p.generateProbatorRtpParameters(t.rtpParameters);await this._handler.receive([{trackId:"probator",kind:"video",rtpParameters:e}]),_.debug("createPendingConsumers() | Consumer for RTP probation created"),this._probatorConsumerCreated=!0}catch(e){_.error("createPendingConsumers() | failed to create Consumer for RTP probation:%o",e)}}),"transport.createPendingConsumers()").then((()=>{this._consumerCreationInProgress=!1,this._pendingConsumerTasks.length>0&&this.createPendingConsumers()})).catch((()=>{}))}pausePendingConsumers(){this._consumerPauseInProgress=!0,this._awaitQueue.push((async()=>{if(0===this._pendingPauseConsumers.size)return void _.debug("pausePendingConsumers() | there is no Consumer to be paused");const e=Array.from(this._pendingPauseConsumers.values());this._pendingPauseConsumers.clear();try{const t=e.map((e=>e.localId));await this._handler.pauseReceiving(t)}catch(e){_.error("pausePendingConsumers() | failed to pause Consumers:",e)}}),"transport.pausePendingConsumers").then((()=>{this._consumerPauseInProgress=!1,this._pendingPauseConsumers.size>0&&this.pausePendingConsumers()})).catch((()=>{}))}resumePendingConsumers(){this._consumerResumeInProgress=!0,this._awaitQueue.push((async()=>{if(0===this._pendingResumeConsumers.size)return void _.debug("resumePendingConsumers() | there is no Consumer to be resumed");const e=Array.from(this._pendingResumeConsumers.values());this._pendingResumeConsumers.clear();try{const t=e.map((e=>e.localId));await this._handler.resumeReceiving(t)}catch(e){_.error("resumePendingConsumers() | failed to resume Consumers:",e)}}),"transport.resumePendingConsumers").then((()=>{this._consumerResumeInProgress=!1,this._pendingResumeConsumers.size>0&&this.resumePendingConsumers()})).catch((()=>{}))}closePendingConsumers(){this._consumerCloseInProgress=!0,this._awaitQueue.push((async()=>{if(0===this._pendingCloseConsumers.size)return void _.debug("closePendingConsumers() | there is no Consumer to be closed");const e=Array.from(this._pendingCloseConsumers.values());this._pendingCloseConsumers.clear();try{await this._handler.stopReceiving(e.map((e=>e.localId)))}catch(e){_.error("closePendingConsumers() | failed to close Consumers:",e)}}),"transport.closePendingConsumers").then((()=>{this._consumerCloseInProgress=!1,this._pendingCloseConsumers.size>0&&this.closePendingConsumers()})).catch((()=>{}))}handleHandler(){const e=this._handler;e.on("@connect",(({dtlsParameters:e},t,r)=>{this._closed?r(new u.InvalidStateError("closed")):this.safeEmit("connect",{dtlsParameters:e},t,r)})),e.on("@connectionstatechange",(e=>{e!==this._connectionState&&(_.debug("connection state changed to %s",e),this._connectionState=e,this._closed||this.safeEmit("connectionstatechange",e))}))}handleProducer(e){e.on("@close",(()=>{this._producers.delete(e.id),this._closed||this._awaitQueue.push((async()=>this._handler.stopSending(e.localId)),"producer @close event").catch((e=>_.warn("producer.close() failed:%o",e)))})),e.on("@pause",((t,r)=>{this._awaitQueue.push((async()=>this._handler.pauseSending(e.localId)),"producer @pause event").then(t).catch(r)})),e.on("@resume",((t,r)=>{this._awaitQueue.push((async()=>this._handler.resumeSending(e.localId)),"producer @resume event").then(t).catch(r)})),e.on("@replacetrack",((t,r,i)=>{this._awaitQueue.push((async()=>this._handler.replaceTrack(e.localId,t)),"producer @replacetrack event").then(r).catch(i)})),e.on("@setmaxspatiallayer",((t,r,i)=>{this._awaitQueue.push((async()=>this._handler.setMaxSpatialLayer(e.localId,t)),"producer @setmaxspatiallayer event").then(r).catch(i)})),e.on("@setrtpencodingparameters",((t,r,i)=>{this._awaitQueue.push((async()=>this._handler.setRtpEncodingParameters(e.localId,t)),"producer @setrtpencodingparameters event").then(r).catch(i)})),e.on("@getstats",((t,r)=>{if(this._closed)return r(new u.InvalidStateError("closed"));this._handler.getSenderStats(e.localId).then(t).catch(r)}))}handleConsumer(e){e.on("@close",(()=>{this._consumers.delete(e.id),this._pendingPauseConsumers.delete(e.id),this._pendingResumeConsumers.delete(e.id),this._closed||(this._pendingCloseConsumers.set(e.id,e),!1===this._consumerCloseInProgress&&this.closePendingConsumers())})),e.on("@pause",(()=>{this._pendingResumeConsumers.has(e.id)&&this._pendingResumeConsumers.delete(e.id),this._pendingPauseConsumers.set(e.id,e),(0,c.default)((()=>{this._closed||!1===this._consumerPauseInProgress&&this.pausePendingConsumers()}))})),e.on("@resume",(()=>{this._pendingPauseConsumers.has(e.id)&&this._pendingPauseConsumers.delete(e.id),this._pendingResumeConsumers.set(e.id,e),(0,c.default)((()=>{this._closed||!1===this._consumerResumeInProgress&&this.resumePendingConsumers()}))})),e.on("@getstats",((t,r)=>{if(this._closed)return r(new u.InvalidStateError("closed"));this._handler.getReceiverStats(e.localId).then(t).catch(r)}))}handleDataProducer(e){e.on("@close",(()=>{this._dataProducers.delete(e.id)}))}handleDataConsumer(e){e.on("@close",(()=>{this._dataConsumers.delete(e.id)}))}}t.Transport=b},9992:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidStateError=t.UnsupportedError=void 0;class r extends Error{constructor(e){super(e),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,r):this.stack=new Error(e).stack}}t.UnsupportedError=r;class i extends Error{constructor(e){super(e),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,i):this.stack=new Error(e).stack}}t.InvalidStateError=i},2960:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome111=void 0;const a=s(r(766)),o=r(8562),c=s(r(3347)),l=s(r(5280)),d=s(r(2267)),u=s(r(9072)),h=s(r(8954)),p=r(9316),f=r(7910),m=r(2770),g=new o.Logger("Chrome111"),v={OS:1024,MIS:1024};class _ extends p.HandlerInterface{static createFactory(){return()=>new _}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome111"}close(){if(g.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){g.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();try{e.close()}catch(e){}const r=a.parse(t.sdp),i=d.extractRtpCapabilities({sdpObject:r});return h.addNackSuppportForOpus(i),i}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return g.debug("getNativeSctpCapabilities()"),{numStreams:v}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n,iceServers:s,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){g.debug("run()"),this._direction=e,this._remoteSdp=new f.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n}),this._sendingRtpParametersByKind={audio:l.getSendingRtpParameters("audio",d),video:l.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:l.getSendingRemoteRtpParameters("audio",d),video:l.getSendingRemoteRtpParameters("video",d)},i.role&&"auto"!==i.role&&(this._forcedLocalDtlsRole="server"===i.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:s||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...o},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(()=>{this.emit("@connectionstatechange",this._pc.connectionState)})):(g.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})))}async updateIceServers(e){g.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(g.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});g.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();g.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:i}){var n;if(this.assertSendDirection(),g.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&t.length>1){t.forEach(((e,t)=>{e.rid=`r${t}`}));let e=1,r=1;for(const e of t){const t=e.scalabilityMode?(0,m.parse)(e.scalabilityMode).temporalLayers:3;t>r&&(r=t)}for(const i of t)i.rid="r"+e++,i.scalabilityMode=`L1T${r}`}const s=c.clone(this._sendingRtpParametersByKind[e.kind],{});s.codecs=l.reduceCodecs(s.codecs,i);const o=c.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});o.codecs=l.reduceCodecs(o.codecs,i);const h=this._remoteSdp.getNextMediaSectionIdx(),p=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t}),f=await this._pc.createOffer();let v=a.parse(f.sdp);this._transportReady||await this.setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:v}),g.debug("send() | calling pc.setLocalDescription() [offer:%o]",f),await this._pc.setLocalDescription(f);const _=p.mid;s.mid=_,v=a.parse(this._pc.localDescription.sdp);const y=v.media[h.idx];if(s.rtcp.cname=d.getCname({offerMediaObject:y}),t)if(1===t.length){const e=u.getRtpEncodings({offerMediaObject:y});Object.assign(e[0],t[0]),s.encodings=e}else s.encodings=t;else s.encodings=u.getRtpEncodings({offerMediaObject:y});this._remoteSdp.send({offerMediaObject:y,reuseMid:h.reuseMid,offerRtpParameters:s,answerRtpParameters:o,codecOptions:r,extmapAllowMixed:!0});const b={type:"answer",sdp:this._remoteSdp.getSdp()};return g.debug("send() | calling pc.setRemoteDescription() [answer:%o]",b),await this._pc.setRemoteDescription(b),this._mapMidTransceiver.set(_,p),{localId:_,rtpParameters:s,rtpSender:p.sender}}async stopSending(e){this.assertSendDirection(),g.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch(e){}const r=await this._pc.createOffer();g.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertSendDirection(),g.debug("pauseSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);const r=await this._pc.createOffer();g.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async resumeSending(e){this.assertSendDirection(),g.debug("resumeSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly";const r=await this._pc.createOffer();g.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(e,t){this.assertSendDirection(),t?g.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):g.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertSendDirection(),g.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const i=r.sender.getParameters();i.encodings.forEach(((e,r)=>{e.active=r<=t})),await r.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const n=await this._pc.createOffer();g.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const s={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async setRtpEncodingParameters(e,t){this.assertSendDirection(),g.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const i=r.sender.getParameters();i.encodings.forEach(((e,r)=>{i.encodings[r]={...e,...t}})),await r.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const n=await this._pc.createOffer();g.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const s={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async getSenderStats(e){this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:i,protocol:n}){var s;this.assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:n};g.debug("sendDataChannel() [options:%o]",o);const c=this._pc.createDataChannel(i,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%v.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=a.parse(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||await this.setupTransport({localDtlsRole:null!==(s=this._forcedLocalDtlsRole)&&void 0!==s?s:"client",localSdpObject:t}),g.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const i={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._hasDataChannelMediaSection=!0}return{dataChannel:c,sctpStreamParameters:{streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits}}}async receive(e){var t;this.assertRecvDirection();const r=[],i=new Map;for(const t of e){const{trackId:e,kind:r,rtpParameters:n,streamId:s}=t;g.debug("receive() [trackId:%s, kind:%s]",e,r);const a=n.mid||String(this._mapMidTransceiver.size);i.set(e,a),this._remoteSdp.receive({mid:a,kind:r,offerRtpParameters:n,streamId:s||n.rtcp.cname,trackId:e})}const n={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);let s=await this._pc.createAnswer();const o=a.parse(s.sdp);for(const t of e){const{trackId:e,rtpParameters:r}=t,n=i.get(e),s=o.media.find((e=>String(e.mid)===n));d.applyCodecParameters({offerRtpParameters:r,answerMediaObject:s})}s={type:"answer",sdp:a.write(o)},this._transportReady||await this.setupTransport({localDtlsRole:null!==(t=this._forcedLocalDtlsRole)&&void 0!==t?t:"client",localSdpObject:o}),g.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);for(const t of e){const{trackId:e}=t,n=i.get(e),s=this._pc.getTransceivers().find((e=>e.mid===n));if(!s)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(n,s),r.push({localId:n,track:s.receiver.track,rtpReceiver:s.receiver})}return r}async stopReceiving(e){this.assertRecvDirection();for(const t of e){g.debug("stopReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(e.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();g.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const t of e)this._mapMidTransceiver.delete(t)}async pauseReceiving(e){this.assertRecvDirection();for(const t of e){g.debug("pauseReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="inactive",this._remoteSdp.pauseMediaSection(t)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();g.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async resumeReceiving(e){this.assertRecvDirection();for(const t of e){g.debug("resumeReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(t)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();g.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async getReceiverStats(e){this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){var i;this.assertRecvDirection();const{streamId:n,ordered:s,maxPacketLifeTime:o,maxRetransmits:c}=e,l={negotiated:!0,id:n,ordered:s,maxPacketLifeTime:o,maxRetransmits:c,protocol:r};g.debug("receiveDataChannel() [options:%o]",l);const d=this._pc.createDataChannel(t,l);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=a.parse(t.sdp);await this.setupTransport({localDtlsRole:null!==(i=this._forcedLocalDtlsRole)&&void 0!==i?i:"client",localSdpObject:e})}g.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=a.parse(this._pc.localDescription.sdp));const r=d.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise(((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)})),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Chrome111=_},564:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome55=void 0;const a=s(r(766)),o=r(8562),c=r(9992),l=s(r(3347)),d=s(r(5280)),u=s(r(2267)),h=s(r(9875)),p=r(9316),f=r(7910),m=new o.Logger("Chrome55"),g={OS:1024,MIS:1024};class v extends p.HandlerInterface{static createFactory(){return()=>new v}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdTrack=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome55"}close(){if(m.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){m.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(e){}const r=a.parse(t.sdp);return u.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return m.debug("getNativeSctpCapabilities()"),{numStreams:g}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n,iceServers:s,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:l}){m.debug("run()"),this._direction=e,this._remoteSdp=new f.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n,planB:!0}),this._sendingRtpParametersByKind={audio:d.getSendingRtpParameters("audio",l),video:d.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:d.getSendingRemoteRtpParameters("audio",l),video:d.getSendingRemoteRtpParameters("video",l)},i.role&&"auto"!==i.role&&(this._forcedLocalDtlsRole="server"===i.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:s||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...o},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(()=>{this.emit("@connectionstatechange",this._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(m.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){m.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(m.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});m.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();m.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:i}){var n;this.assertSendDirection(),m.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),i&&m.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addStream(this._sendStream);let s,o=await this._pc.createOffer(),c=a.parse(o.sdp);const p=l.clone(this._sendingRtpParametersByKind[e.kind],{});p.codecs=d.reduceCodecs(p.codecs);const f=l.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(f.codecs=d.reduceCodecs(f.codecs),this._transportReady||await this.setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:c}),"video"===e.kind&&t&&t.length>1&&(m.debug("send() | enabling simulcast"),c=a.parse(o.sdp),s=c.media.find((e=>"video"===e.type)),h.addLegacySimulcast({offerMediaObject:s,track:e,numStreams:t.length}),o={type:"offer",sdp:a.write(c)}),m.debug("send() | calling pc.setLocalDescription() [offer:%o]",o),await this._pc.setLocalDescription(o),c=a.parse(this._pc.localDescription.sdp),s=c.media.find((t=>t.type===e.kind)),p.rtcp.cname=u.getCname({offerMediaObject:s}),p.encodings=h.getRtpEncodings({offerMediaObject:s,track:e}),t)for(let e=0;e<p.encodings.length;++e)t[e]&&Object.assign(p.encodings[e],t[e]);if(p.encodings.length>1&&"video/vp8"===p.codecs[0].mimeType.toLowerCase())for(const e of p.encodings)e.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:s,offerRtpParameters:p,answerRtpParameters:f,codecOptions:r});const g={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("send() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g);const v=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(v,e),{localId:v,rtpParameters:p}}async stopSending(e){this.assertSendDirection(),m.debug("stopSending() [localId:%s]",e);const t=this._mapSendLocalIdTrack.get(e);if(!t)throw new Error("track not found");this._mapSendLocalIdTrack.delete(e),this._sendStream.removeTrack(t),this._pc.addStream(this._sendStream);const r=await this._pc.createOffer();m.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r);try{await this._pc.setLocalDescription(r)}catch(e){if(0===this._sendStream.getTracks().length)return void m.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());throw e}if("stable"===this._pc.signalingState)return;const i={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){throw new c.UnsupportedError("not implemented")}async setMaxSpatialLayer(e,t){throw new c.UnsupportedError(" not implemented")}async setRtpEncodingParameters(e,t){throw new c.UnsupportedError("not supported")}async getSenderStats(e){throw new c.UnsupportedError("not implemented")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:i,protocol:n}){var s;this.assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:n};m.debug("sendDataChannel() [options:%o]",o);const c=this._pc.createDataChannel(i,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%g.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=a.parse(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||await this.setupTransport({localDtlsRole:null!==(s=this._forcedLocalDtlsRole)&&void 0!==s?s:"client",localSdpObject:t}),m.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const i={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._hasDataChannelMediaSection=!0}return{dataChannel:c,sctpStreamParameters:{streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits}}}async receive(e){var t;this.assertRecvDirection();const r=[];for(const t of e){const{trackId:e,kind:r,rtpParameters:i,streamId:n}=t;m.debug("receive() [trackId:%s, kind:%s]",e,r);const s=r;this._remoteSdp.receive({mid:s,kind:r,offerRtpParameters:i,streamId:n||i.rtcp.cname,trackId:e})}const i={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let n=await this._pc.createAnswer();const s=a.parse(n.sdp);for(const t of e){const{kind:e,rtpParameters:r}=t,i=e,n=s.media.find((e=>String(e.mid)===i));u.applyCodecParameters({offerRtpParameters:r,answerMediaObject:n})}n={type:"answer",sdp:a.write(s)},this._transportReady||await this.setupTransport({localDtlsRole:null!==(t=this._forcedLocalDtlsRole)&&void 0!==t?t:"client",localSdpObject:s}),m.debug("receive() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n);for(const t of e){const{kind:e,trackId:i,rtpParameters:n}=t,s=e,a=i,o=t.streamId||n.rtcp.cname,c=this._pc.getRemoteStreams().find((e=>e.id===o)).getTrackById(a);if(!c)throw new Error("remote track not found");this._mapRecvLocalIdInfo.set(a,{mid:s,rtpParameters:n}),r.push({localId:a,track:c})}return r}async stopReceiving(e){this.assertRecvDirection();for(const t of e){m.debug("stopReceiving() [localId:%s]",t);const{mid:e,rtpParameters:r}=this._mapRecvLocalIdInfo.get(t)||{};this._mapRecvLocalIdInfo.delete(t),this._remoteSdp.planBStopReceiving({mid:e,offerRtpParameters:r})}const t={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();m.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){throw new c.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){var i;this.assertRecvDirection();const{streamId:n,ordered:s,maxPacketLifeTime:o,maxRetransmits:c}=e,l={negotiated:!0,id:n,ordered:s,maxPacketLifeTime:o,maxRetransmitTime:o,maxRetransmits:c,protocol:r};m.debug("receiveDataChannel() [options:%o]",l);const d=this._pc.createDataChannel(t,l);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=a.parse(t.sdp);await this.setupTransport({localDtlsRole:null!==(i=this._forcedLocalDtlsRole)&&void 0!==i?i:"client",localSdpObject:e})}m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=a.parse(this._pc.localDescription.sdp));const r=u.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise(((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)})),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Chrome55=v},5697:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome67=void 0;const a=s(r(766)),o=r(8562),c=s(r(3347)),l=s(r(5280)),d=s(r(2267)),u=s(r(9875)),h=r(9316),p=r(7910),f=new o.Logger("Chrome67"),m={OS:1024,MIS:1024};class g extends h.HandlerInterface{static createFactory(){return()=>new g}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdRtpSender=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome67"}close(){if(f.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){f.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(e){}const r=a.parse(t.sdp);return d.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return f.debug("getNativeSctpCapabilities()"),{numStreams:m}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n,iceServers:s,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){f.debug("run()"),this._direction=e,this._remoteSdp=new p.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n,planB:!0}),this._sendingRtpParametersByKind={audio:l.getSendingRtpParameters("audio",d),video:l.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:l.getSendingRemoteRtpParameters("audio",d),video:l.getSendingRemoteRtpParameters("video",d)},i.role&&"auto"!==i.role&&(this._forcedLocalDtlsRole="server"===i.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:s||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...o},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(()=>{this.emit("@connectionstatechange",this._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(f.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){f.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(f.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});f.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();f.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:i}){var n;this.assertSendDirection(),f.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),i&&f.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addTrack(e,this._sendStream);let s,o=await this._pc.createOffer(),h=a.parse(o.sdp);const p=c.clone(this._sendingRtpParametersByKind[e.kind],{});p.codecs=l.reduceCodecs(p.codecs);const m=c.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(m.codecs=l.reduceCodecs(m.codecs),this._transportReady||await this.setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:h}),"video"===e.kind&&t&&t.length>1&&(f.debug("send() | enabling simulcast"),h=a.parse(o.sdp),s=h.media.find((e=>"video"===e.type)),u.addLegacySimulcast({offerMediaObject:s,track:e,numStreams:t.length}),o={type:"offer",sdp:a.write(h)}),f.debug("send() | calling pc.setLocalDescription() [offer:%o]",o),await this._pc.setLocalDescription(o),h=a.parse(this._pc.localDescription.sdp),s=h.media.find((t=>t.type===e.kind)),p.rtcp.cname=d.getCname({offerMediaObject:s}),p.encodings=u.getRtpEncodings({offerMediaObject:s,track:e}),t)for(let e=0;e<p.encodings.length;++e)t[e]&&Object.assign(p.encodings[e],t[e]);if(p.encodings.length>1&&"video/vp8"===p.codecs[0].mimeType.toLowerCase())for(const e of p.encodings)e.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:s,offerRtpParameters:p,answerRtpParameters:m,codecOptions:r});const g={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("send() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g);const v=String(this._nextSendLocalId);this._nextSendLocalId++;const _=this._pc.getSenders().find((t=>t.track===e));return this._mapSendLocalIdRtpSender.set(v,_),{localId:v,rtpParameters:p,rtpSender:_}}async stopSending(e){this.assertSendDirection(),f.debug("stopSending() [localId:%s]",e);const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");this._pc.removeTrack(t),t.track&&this._sendStream.removeTrack(t.track),this._mapSendLocalIdRtpSender.delete(e);const r=await this._pc.createOffer();f.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r);try{await this._pc.setLocalDescription(r)}catch(e){if(0===this._sendStream.getTracks().length)return void f.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());throw e}if("stable"===this._pc.signalingState)return;const i={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){this.assertSendDirection(),t?f.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):f.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");const i=r.track;await r.replaceTrack(t),i&&this._sendStream.removeTrack(i),t&&this._sendStream.addTrack(t)}async setMaxSpatialLayer(e,t){this.assertSendDirection(),f.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");const i=r.getParameters();i.encodings.forEach(((e,r)=>{e.active=r<=t})),await r.setParameters(i)}async setRtpEncodingParameters(e,t){this.assertSendDirection(),f.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");const i=r.getParameters();i.encodings.forEach(((e,r)=>{i.encodings[r]={...e,...t}})),await r.setParameters(i)}async getSenderStats(e){this.assertSendDirection();const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");return t.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:i,protocol:n}){var s;this.assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:n};f.debug("sendDataChannel() [options:%o]",o);const c=this._pc.createDataChannel(i,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%m.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=a.parse(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||await this.setupTransport({localDtlsRole:null!==(s=this._forcedLocalDtlsRole)&&void 0!==s?s:"client",localSdpObject:t}),f.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const i={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._hasDataChannelMediaSection=!0}return{dataChannel:c,sctpStreamParameters:{streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits}}}async receive(e){var t;this.assertRecvDirection();const r=[];for(const t of e){const{trackId:e,kind:r,rtpParameters:i,streamId:n}=t;f.debug("receive() [trackId:%s, kind:%s]",e,r);const s=r;this._remoteSdp.receive({mid:s,kind:r,offerRtpParameters:i,streamId:n||i.rtcp.cname,trackId:e})}const i={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let n=await this._pc.createAnswer();const s=a.parse(n.sdp);for(const t of e){const{kind:e,rtpParameters:r}=t,i=e,n=s.media.find((e=>String(e.mid)===i));d.applyCodecParameters({offerRtpParameters:r,answerMediaObject:n})}n={type:"answer",sdp:a.write(s)},this._transportReady||await this.setupTransport({localDtlsRole:null!==(t=this._forcedLocalDtlsRole)&&void 0!==t?t:"client",localSdpObject:s}),f.debug("receive() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n);for(const t of e){const{kind:e,trackId:i,rtpParameters:n}=t,s=i,a=e,o=this._pc.getReceivers().find((e=>e.track&&e.track.id===s));if(!o)throw new Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(s,{mid:a,rtpParameters:n,rtpReceiver:o}),r.push({localId:s,track:o.track,rtpReceiver:o})}return r}async stopReceiving(e){this.assertRecvDirection();for(const t of e){f.debug("stopReceiving() [localId:%s]",t);const{mid:e,rtpParameters:r}=this._mapRecvLocalIdInfo.get(t)||{};this._mapRecvLocalIdInfo.delete(t),this._remoteSdp.planBStopReceiving({mid:e,offerRtpParameters:r})}const t={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();f.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){this.assertRecvDirection();const{rtpReceiver:t}=this._mapRecvLocalIdInfo.get(e)||{};if(!t)throw new Error("associated RTCRtpReceiver not found");return t.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){var i;this.assertRecvDirection();const{streamId:n,ordered:s,maxPacketLifeTime:o,maxRetransmits:c}=e,l={negotiated:!0,id:n,ordered:s,maxPacketLifeTime:o,maxRetransmitTime:o,maxRetransmits:c,protocol:r};f.debug("receiveDataChannel() [options:%o]",l);const d=this._pc.createDataChannel(t,l);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const e={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=a.parse(t.sdp);await this.setupTransport({localDtlsRole:null!==(i=this._forcedLocalDtlsRole)&&void 0!==i?i:"client",localSdpObject:e})}f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=a.parse(this._pc.localDescription.sdp));const r=d.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise(((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)})),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Chrome67=g},5372:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome70=void 0;const a=s(r(766)),o=r(8562),c=s(r(3347)),l=s(r(5280)),d=s(r(2267)),u=s(r(9072)),h=r(9316),p=r(7910),f=r(2770),m=new o.Logger("Chrome70"),g={OS:1024,MIS:1024};class v extends h.HandlerInterface{static createFactory(){return()=>new v}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome70"}close(){if(m.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){m.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();try{e.close()}catch(e){}const r=a.parse(t.sdp);return d.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return m.debug("getNativeSctpCapabilities()"),{numStreams:g}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n,iceServers:s,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){m.debug("run()"),this._direction=e,this._remoteSdp=new p.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n}),this._sendingRtpParametersByKind={audio:l.getSendingRtpParameters("audio",d),video:l.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:l.getSendingRemoteRtpParameters("audio",d),video:l.getSendingRemoteRtpParameters("video",d)},i.role&&"auto"!==i.role&&(this._forcedLocalDtlsRole="server"===i.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:s||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...o},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(()=>{this.emit("@connectionstatechange",this._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(m.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){m.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(m.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});m.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();m.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:i}){var n;this.assertSendDirection(),m.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);const s=c.clone(this._sendingRtpParametersByKind[e.kind],{});s.codecs=l.reduceCodecs(s.codecs,i);const o=c.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});o.codecs=l.reduceCodecs(o.codecs,i);const h=this._remoteSdp.getNextMediaSectionIdx(),p=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});let g,v=await this._pc.createOffer(),_=a.parse(v.sdp);this._transportReady||await this.setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:_}),t&&t.length>1&&(m.debug("send() | enabling legacy simulcast"),_=a.parse(v.sdp),g=_.media[h.idx],u.addLegacySimulcast({offerMediaObject:g,numStreams:t.length}),v={type:"offer",sdp:a.write(_)});let y=!1;const b=(0,f.parse)((t||[{}])[0].scalabilityMode);if(t&&1===t.length&&b.spatialLayers>1&&"video/vp9"===s.codecs[0].mimeType.toLowerCase()&&(m.debug("send() | enabling legacy simulcast for VP9 SVC"),y=!0,_=a.parse(v.sdp),g=_.media[h.idx],u.addLegacySimulcast({offerMediaObject:g,numStreams:b.spatialLayers}),v={type:"offer",sdp:a.write(_)}),m.debug("send() | calling pc.setLocalDescription() [offer:%o]",v),await this._pc.setLocalDescription(v),t){m.debug("send() | applying given encodings");const e=p.sender.getParameters();for(let r=0;r<(e.encodings||[]).length;++r){const i=e.encodings[r],n=t[r];if(!n)break;e.encodings[r]=Object.assign(i,n)}await p.sender.setParameters(e)}const E=p.mid;if(s.mid=E,_=a.parse(this._pc.localDescription.sdp),g=_.media[h.idx],s.rtcp.cname=d.getCname({offerMediaObject:g}),s.encodings=u.getRtpEncodings({offerMediaObject:g}),t)for(let e=0;e<s.encodings.length;++e)t[e]&&Object.assign(s.encodings[e],t[e]);if(y&&(s.encodings=[s.encodings[0]]),s.encodings.length>1&&("video/vp8"===s.codecs[0].mimeType.toLowerCase()||"video/h264"===s.codecs[0].mimeType.toLowerCase()))for(const e of s.encodings)e.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:g,reuseMid:h.reuseMid,offerRtpParameters:s,answerRtpParameters:o,codecOptions:r});const S={type:"answer",sdp:this._remoteSdp.getSdp()};return m.debug("send() | calling pc.setRemoteDescription() [answer:%o]",S),await this._pc.setRemoteDescription(S),this._mapMidTransceiver.set(E,p),{localId:E,rtpParameters:s,rtpSender:p.sender}}async stopSending(e){this.assertSendDirection(),m.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch(e){}const r=await this._pc.createOffer();m.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._mapMidTransceiver.delete(e)}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){this.assertSendDirection(),t?m.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):m.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertSendDirection(),m.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const i=r.sender.getParameters();i.encodings.forEach(((e,r)=>{e.active=r<=t})),await r.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const n=await this._pc.createOffer();m.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const s={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async setRtpEncodingParameters(e,t){this.assertSendDirection(),m.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const i=r.sender.getParameters();i.encodings.forEach(((e,r)=>{i.encodings[r]={...e,...t}})),await r.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const n=await this._pc.createOffer();m.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const s={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async getSenderStats(e){this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:i,protocol:n}){var s;this.assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:n};m.debug("sendDataChannel() [options:%o]",o);const c=this._pc.createDataChannel(i,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%g.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=a.parse(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||await this.setupTransport({localDtlsRole:null!==(s=this._forcedLocalDtlsRole)&&void 0!==s?s:"client",localSdpObject:t}),m.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const i={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._hasDataChannelMediaSection=!0}return{dataChannel:c,sctpStreamParameters:{streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits}}}async receive(e){var t;this.assertRecvDirection();const r=[],i=new Map;for(const t of e){const{trackId:e,kind:r,rtpParameters:n,streamId:s}=t;m.debug("receive() [trackId:%s, kind:%s]",e,r);const a=n.mid||String(this._mapMidTransceiver.size);i.set(e,a),this._remoteSdp.receive({mid:a,kind:r,offerRtpParameters:n,streamId:s||n.rtcp.cname,trackId:e})}const n={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);let s=await this._pc.createAnswer();const o=a.parse(s.sdp);for(const t of e){const{trackId:e,rtpParameters:r}=t,n=i.get(e),s=o.media.find((e=>String(e.mid)===n));d.applyCodecParameters({offerRtpParameters:r,answerMediaObject:s})}s={type:"answer",sdp:a.write(o)},this._transportReady||await this.setupTransport({localDtlsRole:null!==(t=this._forcedLocalDtlsRole)&&void 0!==t?t:"client",localSdpObject:o}),m.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);for(const t of e){const{trackId:e}=t,n=i.get(e),s=this._pc.getTransceivers().find((e=>e.mid===n));if(!s)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(n,s),r.push({localId:n,track:s.receiver.track,rtpReceiver:s.receiver})}return r}async stopReceiving(e){this.assertRecvDirection();for(const t of e){m.debug("stopReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(e.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();m.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const t of e)this._mapMidTransceiver.delete(t)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){var i;this.assertRecvDirection();const{streamId:n,ordered:s,maxPacketLifeTime:o,maxRetransmits:c}=e,l={negotiated:!0,id:n,ordered:s,maxPacketLifeTime:o,maxRetransmitTime:o,maxRetransmits:c,protocol:r};m.debug("receiveDataChannel() [options:%o]",l);const d=this._pc.createDataChannel(t,l);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=a.parse(t.sdp);await this.setupTransport({localDtlsRole:null!==(i=this._forcedLocalDtlsRole)&&void 0!==i?i:"client",localSdpObject:e})}m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=a.parse(this._pc.localDescription.sdp));const r=d.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise(((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)})),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Chrome70=v},6656:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome74=void 0;const a=s(r(766)),o=r(8562),c=s(r(3347)),l=s(r(5280)),d=s(r(2267)),u=s(r(9072)),h=s(r(8954)),p=r(9316),f=r(7910),m=r(2770),g=new o.Logger("Chrome74"),v={OS:1024,MIS:1024};class _ extends p.HandlerInterface{static createFactory(){return()=>new _}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome74"}close(){if(g.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){g.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();try{e.close()}catch(e){}const r=a.parse(t.sdp),i=d.extractRtpCapabilities({sdpObject:r});return h.addNackSuppportForOpus(i),i}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return g.debug("getNativeSctpCapabilities()"),{numStreams:v}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n,iceServers:s,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){g.debug("run()"),this._direction=e,this._remoteSdp=new f.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n}),this._sendingRtpParametersByKind={audio:l.getSendingRtpParameters("audio",d),video:l.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:l.getSendingRemoteRtpParameters("audio",d),video:l.getSendingRemoteRtpParameters("video",d)},i.role&&"auto"!==i.role&&(this._forcedLocalDtlsRole="server"===i.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:s||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...o},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(()=>{this.emit("@connectionstatechange",this._pc.connectionState)})):(g.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})))}async updateIceServers(e){g.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(g.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});g.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();g.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:i}){var n;this.assertSendDirection(),g.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&t.length>1&&t.forEach(((e,t)=>{e.rid=`r${t}`}));const s=c.clone(this._sendingRtpParametersByKind[e.kind],{});s.codecs=l.reduceCodecs(s.codecs,i);const o=c.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});o.codecs=l.reduceCodecs(o.codecs,i);const h=this._remoteSdp.getNextMediaSectionIdx(),p=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t});let f,v=await this._pc.createOffer(),_=a.parse(v.sdp);this._transportReady||await this.setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:_});let y=!1;const b=(0,m.parse)((t||[{}])[0].scalabilityMode);t&&1===t.length&&b.spatialLayers>1&&"video/vp9"===s.codecs[0].mimeType.toLowerCase()&&(g.debug("send() | enabling legacy simulcast for VP9 SVC"),y=!0,_=a.parse(v.sdp),f=_.media[h.idx],u.addLegacySimulcast({offerMediaObject:f,numStreams:b.spatialLayers}),v={type:"offer",sdp:a.write(_)}),g.debug("send() | calling pc.setLocalDescription() [offer:%o]",v),await this._pc.setLocalDescription(v);const E=p.mid;if(s.mid=E,_=a.parse(this._pc.localDescription.sdp),f=_.media[h.idx],s.rtcp.cname=d.getCname({offerMediaObject:f}),t)if(1===t.length){let e=u.getRtpEncodings({offerMediaObject:f});Object.assign(e[0],t[0]),y&&(e=[e[0]]),s.encodings=e}else s.encodings=t;else s.encodings=u.getRtpEncodings({offerMediaObject:f});if(s.encodings.length>1&&("video/vp8"===s.codecs[0].mimeType.toLowerCase()||"video/h264"===s.codecs[0].mimeType.toLowerCase()))for(const e of s.encodings)e.scalabilityMode?e.scalabilityMode=`L1T${b.temporalLayers}`:e.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:f,reuseMid:h.reuseMid,offerRtpParameters:s,answerRtpParameters:o,codecOptions:r,extmapAllowMixed:!0});const S={type:"answer",sdp:this._remoteSdp.getSdp()};return g.debug("send() | calling pc.setRemoteDescription() [answer:%o]",S),await this._pc.setRemoteDescription(S),this._mapMidTransceiver.set(E,p),{localId:E,rtpParameters:s,rtpSender:p.sender}}async stopSending(e){this.assertSendDirection(),g.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch(e){}const r=await this._pc.createOffer();g.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertSendDirection(),g.debug("pauseSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);const r=await this._pc.createOffer();g.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async resumeSending(e){this.assertSendDirection(),g.debug("resumeSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly";const r=await this._pc.createOffer();g.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(e,t){this.assertSendDirection(),t?g.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):g.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertSendDirection(),g.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const i=r.sender.getParameters();i.encodings.forEach(((e,r)=>{e.active=r<=t})),await r.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const n=await this._pc.createOffer();g.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const s={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async setRtpEncodingParameters(e,t){this.assertSendDirection(),g.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const i=r.sender.getParameters();i.encodings.forEach(((e,r)=>{i.encodings[r]={...e,...t}})),await r.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const n=await this._pc.createOffer();g.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const s={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async getSenderStats(e){this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:i,protocol:n}){var s;this.assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:n};g.debug("sendDataChannel() [options:%o]",o);const c=this._pc.createDataChannel(i,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%v.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=a.parse(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||await this.setupTransport({localDtlsRole:null!==(s=this._forcedLocalDtlsRole)&&void 0!==s?s:"client",localSdpObject:t}),g.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const i={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._hasDataChannelMediaSection=!0}return{dataChannel:c,sctpStreamParameters:{streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits}}}async receive(e){var t;this.assertRecvDirection();const r=[],i=new Map;for(const t of e){const{trackId:e,kind:r,rtpParameters:n,streamId:s}=t;g.debug("receive() [trackId:%s, kind:%s]",e,r);const a=n.mid||String(this._mapMidTransceiver.size);i.set(e,a),this._remoteSdp.receive({mid:a,kind:r,offerRtpParameters:n,streamId:s||n.rtcp.cname,trackId:e})}const n={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);let s=await this._pc.createAnswer();const o=a.parse(s.sdp);for(const t of e){const{trackId:e,rtpParameters:r}=t,n=i.get(e),s=o.media.find((e=>String(e.mid)===n));d.applyCodecParameters({offerRtpParameters:r,answerMediaObject:s})}s={type:"answer",sdp:a.write(o)},this._transportReady||await this.setupTransport({localDtlsRole:null!==(t=this._forcedLocalDtlsRole)&&void 0!==t?t:"client",localSdpObject:o}),g.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);for(const t of e){const{trackId:e}=t,n=i.get(e),s=this._pc.getTransceivers().find((e=>e.mid===n));if(!s)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(n,s),r.push({localId:n,track:s.receiver.track,rtpReceiver:s.receiver})}return r}async stopReceiving(e){this.assertRecvDirection();for(const t of e){g.debug("stopReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(e.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();g.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const t of e)this._mapMidTransceiver.delete(t)}async pauseReceiving(e){this.assertRecvDirection();for(const t of e){g.debug("pauseReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="inactive",this._remoteSdp.pauseMediaSection(t)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();g.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async resumeReceiving(e){this.assertRecvDirection();for(const t of e){g.debug("resumeReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(t)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();g.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async getReceiverStats(e){this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){var i;this.assertRecvDirection();const{streamId:n,ordered:s,maxPacketLifeTime:o,maxRetransmits:c}=e,l={negotiated:!0,id:n,ordered:s,maxPacketLifeTime:o,maxRetransmits:c,protocol:r};g.debug("receiveDataChannel() [options:%o]",l);const d=this._pc.createDataChannel(t,l);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=a.parse(t.sdp);await this.setupTransport({localDtlsRole:null!==(i=this._forcedLocalDtlsRole)&&void 0!==i?i:"client",localSdpObject:e})}g.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=a.parse(this._pc.localDescription.sdp));const r=d.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise(((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)})),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Chrome74=_},9852:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Edge11=void 0;const a=r(8562),o=r(9992),c=s(r(3347)),l=s(r(5280)),d=s(r(3635)),u=r(9316),h=new a.Logger("Edge11");class p extends u.HandlerInterface{static createFactory(){return()=>new p}constructor(){super(),this._rtpSenders=new Map,this._rtpReceivers=new Map,this._nextSendLocalId=0,this._transportReady=!1}get name(){return"Edge11"}close(){h.debug("close()");try{this._iceGatherer.close()}catch(e){}try{this._iceTransport.stop()}catch(e){}try{this._dtlsTransport.stop()}catch(e){}for(const e of this._rtpSenders.values())try{e.stop()}catch(e){}for(const e of this._rtpReceivers.values())try{e.stop()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){return h.debug("getNativeRtpCapabilities()"),d.getCapabilities()}async getNativeSctpCapabilities(){return h.debug("getNativeSctpCapabilities()"),{numStreams:{OS:0,MIS:0}}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n,iceServers:s,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:d,extendedRtpCapabilities:u}){h.debug("run()"),this._sendingRtpParametersByKind={audio:l.getSendingRtpParameters("audio",u),video:l.getSendingRtpParameters("video",u)},this._remoteIceParameters=t,this._remoteIceCandidates=r,this._remoteDtlsParameters=i,this._cname=`CNAME-${c.generateRandomNumber()}`,this.setIceGatherer({iceServers:s,iceTransportPolicy:a}),this.setIceTransport(),this.setDtlsTransport()}async updateIceServers(e){throw new o.UnsupportedError("not supported")}async restartIce(e){if(h.debug("restartIce()"),this._remoteIceParameters=e,this._transportReady){h.debug("restartIce() | calling iceTransport.start()"),this._iceTransport.start(this._iceGatherer,e,"controlling");for(const e of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(e);this._iceTransport.addRemoteCandidate({})}}async getTransportStats(){return this._iceTransport.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:i}){h.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),this._transportReady||await this.setupTransport({localDtlsRole:"server"}),h.debug("send() | calling new RTCRtpSender()");const n=new RTCRtpSender(e,this._dtlsTransport),s=c.clone(this._sendingRtpParametersByKind[e.kind],{});s.codecs=l.reduceCodecs(s.codecs,i);const a=s.codecs.some((e=>/.+\/rtx$/i.test(e.mimeType)));t||(t=[{}]);for(const e of t)e.ssrc=c.generateRandomNumber(),a&&(e.rtx={ssrc:c.generateRandomNumber()});s.encodings=t,s.rtcp={cname:this._cname,reducedSize:!0,mux:!0};const o=d.mangleRtpParameters(s);h.debug("send() | calling rtpSender.send() [params:%o]",o),await n.send(o);const u=String(this._nextSendLocalId);return this._nextSendLocalId++,this._rtpSenders.set(u,n),{localId:u,rtpParameters:s,rtpSender:n}}async stopSending(e){h.debug("stopSending() [localId:%s]",e);const t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");this._rtpSenders.delete(e);try{h.debug("stopSending() | calling rtpSender.stop()"),t.stop()}catch(e){throw h.warn("stopSending() | rtpSender.stop() failed:%o",e),e}}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){t?h.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):h.debug("replaceTrack() [localId:%s, no track]",e);const r=this._rtpSenders.get(e);if(!r)throw new Error("RTCRtpSender not found");r.setTrack(t)}async setMaxSpatialLayer(e,t){h.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._rtpSenders.get(e);if(!r)throw new Error("RTCRtpSender not found");const i=r.getParameters();i.encodings.forEach(((e,r)=>{e.active=r<=t})),await r.setParameters(i)}async setRtpEncodingParameters(e,t){h.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._rtpSenders.get(e);if(!r)throw new Error("RTCRtpSender not found");const i=r.getParameters();i.encodings.forEach(((e,r)=>{i.encodings[r]={...e,...t}})),await r.setParameters(i)}async getSenderStats(e){const t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");return t.getStats()}async sendDataChannel(e){throw new o.UnsupportedError("not implemented")}async receive(e){const t=[];for(const t of e){const{trackId:e,kind:r}=t;h.debug("receive() [trackId:%s, kind:%s]",e,r)}this._transportReady||await this.setupTransport({localDtlsRole:"server"});for(const r of e){const{trackId:e,kind:i,rtpParameters:n}=r;h.debug("receive() | calling new RTCRtpReceiver()");const s=new RTCRtpReceiver(this._dtlsTransport,i);s.addEventListener("error",(e=>{h.error('rtpReceiver "error" event [event:%o]',e)}));const a=d.mangleRtpParameters(n);h.debug("receive() | calling rtpReceiver.receive() [params:%o]",a),await s.receive(a);const o=e;this._rtpReceivers.set(o,s),t.push({localId:o,track:s.track,rtpReceiver:s})}return t}async stopReceiving(e){for(const t of e){h.debug("stopReceiving() [localId:%s]",t);const e=this._rtpReceivers.get(t);if(!e)throw new Error("RTCRtpReceiver not found");this._rtpReceivers.delete(t);try{h.debug("stopReceiving() | calling rtpReceiver.stop()"),e.stop()}catch(e){h.warn("stopReceiving() | rtpReceiver.stop() failed:%o",e)}}}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){const t=this._rtpReceivers.get(e);if(!t)throw new Error("RTCRtpReceiver not found");return t.getStats()}async receiveDataChannel(e){throw new o.UnsupportedError("not implemented")}setIceGatherer({iceServers:e,iceTransportPolicy:t}){const r=new RTCIceGatherer({iceServers:e||[],gatherPolicy:t||"all"});r.addEventListener("error",(e=>{h.error('iceGatherer "error" event [event:%o]',e)}));try{r.gather()}catch(e){h.debug("setIceGatherer() | iceGatherer.gather() failed: %s",e.toString())}this._iceGatherer=r}setIceTransport(){const e=new RTCIceTransport(this._iceGatherer);e.addEventListener("statechange",(()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})),e.addEventListener("icestatechange",(()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})),e.addEventListener("candidatepairchange",(e=>{h.debug('iceTransport "candidatepairchange" event [pair:%o]',e.pair)})),this._iceTransport=e}setDtlsTransport(){const e=new RTCDtlsTransport(this._iceTransport);e.addEventListener("statechange",(()=>{h.debug('dtlsTransport "statechange" event [state:%s]',e.state)})),e.addEventListener("dtlsstatechange",(()=>{h.debug('dtlsTransport "dtlsstatechange" event [state:%s]',e.state),"closed"===e.state&&this.emit("@connectionstatechange","closed")})),e.addEventListener("error",(e=>{h.error('dtlsTransport "error" event [event:%o]',e)})),this._dtlsTransport=e}async setupTransport({localDtlsRole:e}){h.debug("setupTransport()");const t=this._dtlsTransport.getLocalParameters();t.role=e,await new Promise(((e,r)=>{this.safeEmit("@connect",{dtlsParameters:t},e,r)})),this._iceTransport.start(this._iceGatherer,this._remoteIceParameters,"controlling");for(const e of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(e);this._iceTransport.addRemoteCandidate({}),this._remoteDtlsParameters.fingerprints=this._remoteDtlsParameters.fingerprints.filter((e=>"sha-256"===e.algorithm||"sha-384"===e.algorithm||"sha-512"===e.algorithm)),this._dtlsTransport.start(this._remoteDtlsParameters),this._transportReady=!0}}t.Edge11=p},1419:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Firefox60=void 0;const a=s(r(766)),o=r(8562),c=r(9992),l=s(r(3347)),d=s(r(5280)),u=s(r(2267)),h=s(r(9072)),p=r(9316),f=r(7910),m=r(2770),g=new o.Logger("Firefox60"),v={OS:16,MIS:2048};class _ extends p.HandlerInterface{static createFactory(){return()=>new _}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Firefox60"}close(){if(g.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){g.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),t=document.createElement("canvas");t.getContext("2d");const r=t.captureStream().getVideoTracks()[0];try{e.addTransceiver("audio",{direction:"sendrecv"});const i=e.addTransceiver(r,{direction:"sendrecv"}),n=i.sender.getParameters(),s=[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}];n.encodings=s,await i.sender.setParameters(n);const o=await e.createOffer();try{t.remove()}catch(e){}try{r.stop()}catch(e){}try{e.close()}catch(e){}const c=a.parse(o.sdp);return u.extractRtpCapabilities({sdpObject:c})}catch(i){try{t.remove()}catch(e){}try{r.stop()}catch(e){}try{e.close()}catch(e){}throw i}}async getNativeSctpCapabilities(){return g.debug("getNativeSctpCapabilities()"),{numStreams:v}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n,iceServers:s,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:l}){g.debug("run()"),this._direction=e,this._remoteSdp=new f.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n}),this._sendingRtpParametersByKind={audio:d.getSendingRtpParameters("audio",l),video:d.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:d.getSendingRemoteRtpParameters("audio",l),video:d.getSendingRemoteRtpParameters("video",l)},this._pc=new RTCPeerConnection({iceServers:s||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...o},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(()=>{this.emit("@connectionstatechange",this._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(g.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){throw new c.UnsupportedError("not supported")}async restartIce(e){if(g.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});g.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();g.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:i}){this.assertSendDirection(),g.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&(t=l.clone(t,[])).length>1&&(t.forEach(((e,t)=>{e.rid=`r${t}`})),t.reverse());const n=l.clone(this._sendingRtpParametersByKind[e.kind],{});n.codecs=d.reduceCodecs(n.codecs,i);const s=l.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});s.codecs=d.reduceCodecs(s.codecs,i);const o=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});if(t){const e=o.sender.getParameters();e.encodings=t,await o.sender.setParameters(e)}const c=await this._pc.createOffer();let p=a.parse(c.sdp);this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:p});const f=(0,m.parse)((t||[{}])[0].scalabilityMode);g.debug("send() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);const v=o.mid;n.mid=v,p=a.parse(this._pc.localDescription.sdp);const _=p.media[p.media.length-1];if(n.rtcp.cname=u.getCname({offerMediaObject:_}),t)if(1===t.length){const e=h.getRtpEncodings({offerMediaObject:_});Object.assign(e[0],t[0]),n.encodings=e}else n.encodings=t.reverse();else n.encodings=h.getRtpEncodings({offerMediaObject:_});if(n.encodings.length>1&&("video/vp8"===n.codecs[0].mimeType.toLowerCase()||"video/h264"===n.codecs[0].mimeType.toLowerCase()))for(const e of n.encodings)e.scalabilityMode?e.scalabilityMode=`L1T${f.temporalLayers}`:e.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:_,offerRtpParameters:n,answerRtpParameters:s,codecOptions:r,extmapAllowMixed:!0});const y={type:"answer",sdp:this._remoteSdp.getSdp()};return g.debug("send() | calling pc.setRemoteDescription() [answer:%o]",y),await this._pc.setRemoteDescription(y),this._mapMidTransceiver.set(v,o),{localId:v,rtpParameters:n,rtpSender:o.sender}}async stopSending(e){g.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated transceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.disableMediaSection(t.mid);const r=await this._pc.createOffer();g.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertSendDirection(),g.debug("pauseSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);const r=await this._pc.createOffer();g.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async resumeSending(e){this.assertSendDirection(),g.debug("resumeSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(e);const r=await this._pc.createOffer();g.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(e,t){this.assertSendDirection(),t?g.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):g.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertSendDirection(),g.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated transceiver not found");const i=r.sender.getParameters();t=i.encodings.length-1-t,i.encodings.forEach(((e,r)=>{e.active=r>=t})),await r.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const n=await this._pc.createOffer();g.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const s={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async setRtpEncodingParameters(e,t){this.assertSendDirection(),g.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const i=r.sender.getParameters();i.encodings.forEach(((e,r)=>{i.encodings[r]={...e,...t}})),await r.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const n=await this._pc.createOffer();g.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const s={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async getSenderStats(e){this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:i,protocol:n}){this.assertSendDirection();const s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:n};g.debug("sendDataChannel() [options:%o]",s);const o=this._pc.createDataChannel(i,s);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%v.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=a.parse(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:t}),g.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const i={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._hasDataChannelMediaSection=!0}return{dataChannel:o,sctpStreamParameters:{streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits}}}async receive(e){this.assertRecvDirection();const t=[],r=new Map;for(const t of e){const{trackId:e,kind:i,rtpParameters:n,streamId:s}=t;g.debug("receive() [trackId:%s, kind:%s]",e,i);const a=n.mid||String(this._mapMidTransceiver.size);r.set(e,a),this._remoteSdp.receive({mid:a,kind:i,offerRtpParameters:n,streamId:s||n.rtcp.cname,trackId:e})}const i={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let n=await this._pc.createAnswer();const s=a.parse(n.sdp);for(const t of e){const{trackId:e,rtpParameters:i}=t,o=r.get(e),c=s.media.find((e=>String(e.mid)===o));u.applyCodecParameters({offerRtpParameters:i,answerMediaObject:c}),n={type:"answer",sdp:a.write(s)}}this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:s}),g.debug("receive() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n);for(const i of e){const{trackId:e}=i,n=r.get(e),s=this._pc.getTransceivers().find((e=>e.mid===n));if(!s)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(n,s),t.push({localId:n,track:s.receiver.track,rtpReceiver:s.receiver})}return t}async stopReceiving(e){this.assertRecvDirection();for(const t of e){g.debug("stopReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(e.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();g.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const t of e)this._mapMidTransceiver.delete(t)}async pauseReceiving(e){this.assertRecvDirection();for(const t of e){g.debug("pauseReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="inactive",this._remoteSdp.pauseMediaSection(t)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();g.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async resumeReceiving(e){this.assertRecvDirection();for(const t of e){g.debug("resumeReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(t)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();g.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async getReceiverStats(e){this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertRecvDirection();const{streamId:i,ordered:n,maxPacketLifeTime:s,maxRetransmits:o}=e,c={negotiated:!0,id:i,ordered:n,maxPacketLifeTime:s,maxRetransmits:o,protocol:r};g.debug("receiveDataChannel() [options:%o]",c);const l=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=a.parse(t.sdp);await this.setupTransport({localDtlsRole:"client",localSdpObject:e})}g.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:l}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=a.parse(this._pc.localDescription.sdp));const r=u.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise(((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)})),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Firefox60=_},9316:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HandlerInterface=void 0;const i=r(4493);class n extends i.EnhancedEventEmitter{constructor(){super()}}t.HandlerInterface=n},4770:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ReactNative=void 0;const a=s(r(766)),o=r(8562),c=r(9992),l=s(r(3347)),d=s(r(5280)),u=s(r(2267)),h=s(r(9875)),p=r(9316),f=r(7910),m=new o.Logger("ReactNative"),g={OS:1024,MIS:1024};class v extends p.HandlerInterface{static createFactory(){return()=>new v}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdTrack=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"ReactNative"}close(){if(m.debug("close()"),this._sendStream.release(!1),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){m.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(e){}const r=a.parse(t.sdp);return u.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return m.debug("getNativeSctpCapabilities()"),{numStreams:g}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n,iceServers:s,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:l}){m.debug("run()"),this._direction=e,this._remoteSdp=new f.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n,planB:!0}),this._sendingRtpParametersByKind={audio:d.getSendingRtpParameters("audio",l),video:d.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:d.getSendingRemoteRtpParameters("audio",l),video:d.getSendingRemoteRtpParameters("video",l)},i.role&&"auto"!==i.role&&(this._forcedLocalDtlsRole="server"===i.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:s||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...o},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(()=>{this.emit("@connectionstatechange",this._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(m.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){m.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(m.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});m.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();m.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:i}){var n;this.assertSendDirection(),m.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),i&&m.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addStream(this._sendStream);let s,o=await this._pc.createOffer(),c=a.parse(o.sdp);const p=l.clone(this._sendingRtpParametersByKind[e.kind],{});p.codecs=d.reduceCodecs(p.codecs);const f=l.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(f.codecs=d.reduceCodecs(f.codecs),this._transportReady||await this.setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:c}),"video"===e.kind&&t&&t.length>1&&(m.debug("send() | enabling simulcast"),c=a.parse(o.sdp),s=c.media.find((e=>"video"===e.type)),h.addLegacySimulcast({offerMediaObject:s,track:e,numStreams:t.length}),o={type:"offer",sdp:a.write(c)}),m.debug("send() | calling pc.setLocalDescription() [offer:%o]",o),await this._pc.setLocalDescription(o),c=a.parse(this._pc.localDescription.sdp),s=c.media.find((t=>t.type===e.kind)),p.rtcp.cname=u.getCname({offerMediaObject:s}),p.encodings=h.getRtpEncodings({offerMediaObject:s,track:e}),t)for(let e=0;e<p.encodings.length;++e)t[e]&&Object.assign(p.encodings[e],t[e]);if(p.encodings.length>1&&("video/vp8"===p.codecs[0].mimeType.toLowerCase()||"video/h264"===p.codecs[0].mimeType.toLowerCase()))for(const e of p.encodings)e.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:s,offerRtpParameters:p,answerRtpParameters:f,codecOptions:r});const g={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("send() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g);const v=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(v,e),{localId:v,rtpParameters:p}}async stopSending(e){this.assertSendDirection(),m.debug("stopSending() [localId:%s]",e);const t=this._mapSendLocalIdTrack.get(e);if(!t)throw new Error("track not found");this._mapSendLocalIdTrack.delete(e),this._sendStream.removeTrack(t),this._pc.addStream(this._sendStream);const r=await this._pc.createOffer();m.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r);try{await this._pc.setLocalDescription(r)}catch(e){if(0===this._sendStream.getTracks().length)return void m.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());throw e}if("stable"===this._pc.signalingState)return;const i={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){throw new c.UnsupportedError("not implemented")}async setMaxSpatialLayer(e,t){throw new c.UnsupportedError("not implemented")}async setRtpEncodingParameters(e,t){throw new c.UnsupportedError("not implemented")}async getSenderStats(e){throw new c.UnsupportedError("not implemented")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:i,protocol:n}){var s;this.assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:n};m.debug("sendDataChannel() [options:%o]",o);const c=this._pc.createDataChannel(i,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%g.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=a.parse(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||await this.setupTransport({localDtlsRole:null!==(s=this._forcedLocalDtlsRole)&&void 0!==s?s:"client",localSdpObject:t}),m.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const i={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._hasDataChannelMediaSection=!0}return{dataChannel:c,sctpStreamParameters:{streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits}}}async receive(e){var t;this.assertRecvDirection();const r=[],i=new Map;for(const t of e){const{trackId:e,kind:r,rtpParameters:n}=t;m.debug("receive() [trackId:%s, kind:%s]",e,r);const s=r;let a=t.streamId||n.rtcp.cname;m.debug("receive() | forcing a random remote streamId to avoid well known bug in react-native-webrtc"),a+=`-hack-${l.generateRandomNumber()}`,i.set(e,a),this._remoteSdp.receive({mid:s,kind:r,offerRtpParameters:n,streamId:a,trackId:e})}const n={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);let s=await this._pc.createAnswer();const o=a.parse(s.sdp);for(const t of e){const{kind:e,rtpParameters:r}=t,i=e,n=o.media.find((e=>String(e.mid)===i));u.applyCodecParameters({offerRtpParameters:r,answerMediaObject:n})}s={type:"answer",sdp:a.write(o)},this._transportReady||await this.setupTransport({localDtlsRole:null!==(t=this._forcedLocalDtlsRole)&&void 0!==t?t:"client",localSdpObject:o}),m.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);for(const t of e){const{kind:e,trackId:n,rtpParameters:s}=t,a=n,o=e,c=i.get(n),l=this._pc.getRemoteStreams().find((e=>e.id===c)).getTrackById(a);if(!l)throw new Error("remote track not found");this._mapRecvLocalIdInfo.set(a,{mid:o,rtpParameters:s}),r.push({localId:a,track:l})}return r}async stopReceiving(e){this.assertRecvDirection();for(const t of e){m.debug("stopReceiving() [localId:%s]",t);const{mid:e,rtpParameters:r}=this._mapRecvLocalIdInfo.get(t)||{};this._mapRecvLocalIdInfo.delete(t),this._remoteSdp.planBStopReceiving({mid:e,offerRtpParameters:r})}const t={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();m.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){throw new c.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){var i;this.assertRecvDirection();const{streamId:n,ordered:s,maxPacketLifeTime:o,maxRetransmits:c}=e,l={negotiated:!0,id:n,ordered:s,maxPacketLifeTime:o,maxRetransmitTime:o,maxRetransmits:c,protocol:r};m.debug("receiveDataChannel() [options:%o]",l);const d=this._pc.createDataChannel(t,l);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=a.parse(t.sdp);await this.setupTransport({localDtlsRole:null!==(i=this._forcedLocalDtlsRole)&&void 0!==i?i:"client",localSdpObject:e})}m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=a.parse(this._pc.localDescription.sdp));const r=u.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise(((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)})),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.ReactNative=v},3433:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ReactNativeUnifiedPlan=void 0;const a=s(r(766)),o=r(8562),c=s(r(3347)),l=s(r(5280)),d=s(r(2267)),u=s(r(9072)),h=s(r(8954)),p=r(9316),f=r(7910),m=r(2770),g=new o.Logger("ReactNativeUnifiedPlan"),v={OS:1024,MIS:1024};class _ extends p.HandlerInterface{static createFactory(){return()=>new _}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"ReactNativeUnifiedPlan"}close(){if(g.debug("close()"),this._sendStream.release(!1),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){g.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();try{e.close()}catch(e){}const r=a.parse(t.sdp),i=d.extractRtpCapabilities({sdpObject:r});return h.addNackSuppportForOpus(i),i}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return g.debug("getNativeSctpCapabilities()"),{numStreams:v}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n,iceServers:s,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){g.debug("run()"),this._direction=e,this._remoteSdp=new f.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n}),this._sendingRtpParametersByKind={audio:l.getSendingRtpParameters("audio",d),video:l.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:l.getSendingRemoteRtpParameters("audio",d),video:l.getSendingRemoteRtpParameters("video",d)},i.role&&"auto"!==i.role&&(this._forcedLocalDtlsRole="server"===i.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:s||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...o},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(()=>{this.emit("@connectionstatechange",this._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(g.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){g.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(g.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});g.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();g.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:i}){var n;this.assertSendDirection(),g.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&t.length>1&&t.forEach(((e,t)=>{e.rid=`r${t}`}));const s=c.clone(this._sendingRtpParametersByKind[e.kind],{});s.codecs=l.reduceCodecs(s.codecs,i);const o=c.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});o.codecs=l.reduceCodecs(o.codecs,i);const h=this._remoteSdp.getNextMediaSectionIdx(),p=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t});let f,v=await this._pc.createOffer(),_=a.parse(v.sdp);this._transportReady||await this.setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:_});let y=!1;const b=(0,m.parse)((t||[{}])[0].scalabilityMode);t&&1===t.length&&b.spatialLayers>1&&"video/vp9"===s.codecs[0].mimeType.toLowerCase()&&(g.debug("send() | enabling legacy simulcast for VP9 SVC"),y=!0,_=a.parse(v.sdp),f=_.media[h.idx],u.addLegacySimulcast({offerMediaObject:f,numStreams:b.spatialLayers}),v={type:"offer",sdp:a.write(_)}),g.debug("send() | calling pc.setLocalDescription() [offer:%o]",v),await this._pc.setLocalDescription(v);const E=p.mid;if(s.mid=E,_=a.parse(this._pc.localDescription.sdp),f=_.media[h.idx],s.rtcp.cname=d.getCname({offerMediaObject:f}),t)if(1===t.length){let e=u.getRtpEncodings({offerMediaObject:f});Object.assign(e[0],t[0]),y&&(e=[e[0]]),s.encodings=e}else s.encodings=t;else s.encodings=u.getRtpEncodings({offerMediaObject:f});if(s.encodings.length>1&&("video/vp8"===s.codecs[0].mimeType.toLowerCase()||"video/h264"===s.codecs[0].mimeType.toLowerCase()))for(const e of s.encodings)e.scalabilityMode?e.scalabilityMode=`L1T${b.temporalLayers}`:e.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:f,reuseMid:h.reuseMid,offerRtpParameters:s,answerRtpParameters:o,codecOptions:r,extmapAllowMixed:!0});const S={type:"answer",sdp:this._remoteSdp.getSdp()};return g.debug("send() | calling pc.setRemoteDescription() [answer:%o]",S),await this._pc.setRemoteDescription(S),this._mapMidTransceiver.set(E,p),{localId:E,rtpParameters:s,rtpSender:p.sender}}async stopSending(e){this.assertSendDirection(),g.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch(e){}const r=await this._pc.createOffer();g.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertSendDirection(),g.debug("pauseSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);const r=await this._pc.createOffer();g.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async resumeSending(e){this.assertSendDirection(),g.debug("resumeSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly";const r=await this._pc.createOffer();g.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(e,t){this.assertSendDirection(),t?g.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):g.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertSendDirection(),g.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const i=r.sender.getParameters();i.encodings.forEach(((e,r)=>{e.active=r<=t})),await r.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const n=await this._pc.createOffer();g.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const s={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async setRtpEncodingParameters(e,t){this.assertSendDirection(),g.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const i=r.sender.getParameters();i.encodings.forEach(((e,r)=>{i.encodings[r]={...e,...t}})),await r.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const n=await this._pc.createOffer();g.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const s={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async getSenderStats(e){this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:i,protocol:n}){var s;this.assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:n};g.debug("sendDataChannel() [options:%o]",o);const c=this._pc.createDataChannel(i,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%v.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=a.parse(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||await this.setupTransport({localDtlsRole:null!==(s=this._forcedLocalDtlsRole)&&void 0!==s?s:"client",localSdpObject:t}),g.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const i={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._hasDataChannelMediaSection=!0}return{dataChannel:c,sctpStreamParameters:{streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits}}}async receive(e){var t;this.assertRecvDirection();const r=[],i=new Map;for(const t of e){const{trackId:e,kind:r,rtpParameters:n,streamId:s}=t;g.debug("receive() [trackId:%s, kind:%s]",e,r);const a=n.mid||String(this._mapMidTransceiver.size);i.set(e,a),this._remoteSdp.receive({mid:a,kind:r,offerRtpParameters:n,streamId:s||n.rtcp.cname,trackId:e})}const n={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);let s=await this._pc.createAnswer();const o=a.parse(s.sdp);for(const t of e){const{trackId:e,rtpParameters:r}=t,n=i.get(e),s=o.media.find((e=>String(e.mid)===n));d.applyCodecParameters({offerRtpParameters:r,answerMediaObject:s})}s={type:"answer",sdp:a.write(o)},this._transportReady||await this.setupTransport({localDtlsRole:null!==(t=this._forcedLocalDtlsRole)&&void 0!==t?t:"client",localSdpObject:o}),g.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);for(const t of e){const{trackId:e}=t,n=i.get(e),s=this._pc.getTransceivers().find((e=>e.mid===n));if(!s)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(n,s),r.push({localId:n,track:s.receiver.track,rtpReceiver:s.receiver})}return r}async stopReceiving(e){this.assertRecvDirection();for(const t of e){g.debug("stopReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(e.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();g.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const t of e)this._mapMidTransceiver.delete(t)}async pauseReceiving(e){this.assertRecvDirection();for(const t of e){g.debug("pauseReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="inactive",this._remoteSdp.pauseMediaSection(t)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();g.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async resumeReceiving(e){this.assertRecvDirection();for(const t of e){g.debug("resumeReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(t)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();g.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async getReceiverStats(e){this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){var i;this.assertRecvDirection();const{streamId:n,ordered:s,maxPacketLifeTime:o,maxRetransmits:c}=e,l={negotiated:!0,id:n,ordered:s,maxPacketLifeTime:o,maxRetransmits:c,protocol:r};g.debug("receiveDataChannel() [options:%o]",l);const d=this._pc.createDataChannel(t,l);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=a.parse(t.sdp);await this.setupTransport({localDtlsRole:null!==(i=this._forcedLocalDtlsRole)&&void 0!==i?i:"client",localSdpObject:e})}g.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=a.parse(this._pc.localDescription.sdp));const r=d.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise(((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)})),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.ReactNativeUnifiedPlan=_},2205:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Safari11=void 0;const a=s(r(766)),o=r(8562),c=s(r(3347)),l=s(r(5280)),d=s(r(2267)),u=s(r(9875)),h=r(9316),p=r(7910),f=new o.Logger("Safari11"),m={OS:1024,MIS:1024};class g extends h.HandlerInterface{static createFactory(){return()=>new g}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdRtpSender=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Safari11"}close(){if(f.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){f.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(e){}const r=a.parse(t.sdp);return d.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return f.debug("getNativeSctpCapabilities()"),{numStreams:m}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n,iceServers:s,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){f.debug("run()"),this._direction=e,this._remoteSdp=new p.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n,planB:!0}),this._sendingRtpParametersByKind={audio:l.getSendingRtpParameters("audio",d),video:l.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:l.getSendingRemoteRtpParameters("audio",d),video:l.getSendingRemoteRtpParameters("video",d)},i.role&&"auto"!==i.role&&(this._forcedLocalDtlsRole="server"===i.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:s||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...o},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(()=>{this.emit("@connectionstatechange",this._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(f.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){f.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(f.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});f.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();f.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:i}){var n;this.assertSendDirection(),f.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),i&&f.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addTrack(e,this._sendStream);let s,o=await this._pc.createOffer(),h=a.parse(o.sdp);const p=c.clone(this._sendingRtpParametersByKind[e.kind],{});p.codecs=l.reduceCodecs(p.codecs);const m=c.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(m.codecs=l.reduceCodecs(m.codecs),this._transportReady||await this.setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:h}),"video"===e.kind&&t&&t.length>1&&(f.debug("send() | enabling simulcast"),h=a.parse(o.sdp),s=h.media.find((e=>"video"===e.type)),u.addLegacySimulcast({offerMediaObject:s,track:e,numStreams:t.length}),o={type:"offer",sdp:a.write(h)}),f.debug("send() | calling pc.setLocalDescription() [offer:%o]",o),await this._pc.setLocalDescription(o),h=a.parse(this._pc.localDescription.sdp),s=h.media.find((t=>t.type===e.kind)),p.rtcp.cname=d.getCname({offerMediaObject:s}),p.encodings=u.getRtpEncodings({offerMediaObject:s,track:e}),t)for(let e=0;e<p.encodings.length;++e)t[e]&&Object.assign(p.encodings[e],t[e]);if(p.encodings.length>1&&"video/vp8"===p.codecs[0].mimeType.toLowerCase())for(const e of p.encodings)e.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:s,offerRtpParameters:p,answerRtpParameters:m,codecOptions:r});const g={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("send() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g);const v=String(this._nextSendLocalId);this._nextSendLocalId++;const _=this._pc.getSenders().find((t=>t.track===e));return this._mapSendLocalIdRtpSender.set(v,_),{localId:v,rtpParameters:p,rtpSender:_}}async stopSending(e){this.assertSendDirection();const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");t.track&&this._sendStream.removeTrack(t.track),this._mapSendLocalIdRtpSender.delete(e);const r=await this._pc.createOffer();f.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r);try{await this._pc.setLocalDescription(r)}catch(e){if(0===this._sendStream.getTracks().length)return void f.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());throw e}if("stable"===this._pc.signalingState)return;const i={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){this.assertSendDirection(),t?f.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):f.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");const i=r.track;await r.replaceTrack(t),i&&this._sendStream.removeTrack(i),t&&this._sendStream.addTrack(t)}async setMaxSpatialLayer(e,t){this.assertSendDirection(),f.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");const i=r.getParameters();i.encodings.forEach(((e,r)=>{e.active=r<=t})),await r.setParameters(i)}async setRtpEncodingParameters(e,t){this.assertSendDirection(),f.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");const i=r.getParameters();i.encodings.forEach(((e,r)=>{i.encodings[r]={...e,...t}})),await r.setParameters(i)}async getSenderStats(e){this.assertSendDirection();const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");return t.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:i,protocol:n}){var s;this.assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:n};f.debug("sendDataChannel() [options:%o]",o);const c=this._pc.createDataChannel(i,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%m.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=a.parse(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||await this.setupTransport({localDtlsRole:null!==(s=this._forcedLocalDtlsRole)&&void 0!==s?s:"client",localSdpObject:t}),f.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const i={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._hasDataChannelMediaSection=!0}return{dataChannel:c,sctpStreamParameters:{streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits}}}async receive(e){var t;this.assertRecvDirection();const r=[];for(const t of e){const{trackId:e,kind:r,rtpParameters:i,streamId:n}=t;f.debug("receive() [trackId:%s, kind:%s]",e,r);const s=r;this._remoteSdp.receive({mid:s,kind:r,offerRtpParameters:i,streamId:n||i.rtcp.cname,trackId:e})}const i={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let n=await this._pc.createAnswer();const s=a.parse(n.sdp);for(const t of e){const{kind:e,rtpParameters:r}=t,i=e,n=s.media.find((e=>String(e.mid)===i));d.applyCodecParameters({offerRtpParameters:r,answerMediaObject:n})}n={type:"answer",sdp:a.write(s)},this._transportReady||await this.setupTransport({localDtlsRole:null!==(t=this._forcedLocalDtlsRole)&&void 0!==t?t:"client",localSdpObject:s}),f.debug("receive() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n);for(const t of e){const{kind:e,trackId:i,rtpParameters:n}=t,s=e,a=i,o=this._pc.getReceivers().find((e=>e.track&&e.track.id===a));if(!o)throw new Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(a,{mid:s,rtpParameters:n,rtpReceiver:o}),r.push({localId:a,track:o.track,rtpReceiver:o})}return r}async stopReceiving(e){this.assertRecvDirection();for(const t of e){f.debug("stopReceiving() [localId:%s]",t);const{mid:e,rtpParameters:r}=this._mapRecvLocalIdInfo.get(t)||{};this._mapRecvLocalIdInfo.delete(t),this._remoteSdp.planBStopReceiving({mid:e,offerRtpParameters:r})}const t={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();f.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async getReceiverStats(e){this.assertRecvDirection();const{rtpReceiver:t}=this._mapRecvLocalIdInfo.get(e)||{};if(!t)throw new Error("associated RTCRtpReceiver not found");return t.getStats()}async pauseReceiving(e){}async resumeReceiving(e){}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){var i;this.assertRecvDirection();const{streamId:n,ordered:s,maxPacketLifeTime:o,maxRetransmits:c}=e,l={negotiated:!0,id:n,ordered:s,maxPacketLifeTime:o,maxRetransmits:c,protocol:r};f.debug("receiveDataChannel() [options:%o]",l);const d=this._pc.createDataChannel(t,l);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const e={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=a.parse(t.sdp);await this.setupTransport({localDtlsRole:null!==(i=this._forcedLocalDtlsRole)&&void 0!==i?i:"client",localSdpObject:e})}f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=a.parse(this._pc.localDescription.sdp));const r=d.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise(((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)})),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Safari11=g},9862:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Safari12=void 0;const a=s(r(766)),o=r(8562),c=s(r(3347)),l=s(r(5280)),d=s(r(2267)),u=s(r(9072)),h=s(r(8954)),p=r(9316),f=r(7910),m=r(2770),g=new o.Logger("Safari12"),v={OS:1024,MIS:1024};class _ extends p.HandlerInterface{static createFactory(){return()=>new _}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Safari12"}close(){if(g.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){g.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();try{e.close()}catch(e){}const r=a.parse(t.sdp),i=d.extractRtpCapabilities({sdpObject:r});return h.addNackSuppportForOpus(i),i}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return g.debug("getNativeSctpCapabilities()"),{numStreams:v}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n,iceServers:s,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){g.debug("run()"),this._direction=e,this._remoteSdp=new f.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n}),this._sendingRtpParametersByKind={audio:l.getSendingRtpParameters("audio",d),video:l.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:l.getSendingRemoteRtpParameters("audio",d),video:l.getSendingRemoteRtpParameters("video",d)},i.role&&"auto"!==i.role&&(this._forcedLocalDtlsRole="server"===i.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:s||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...o},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(()=>{this.emit("@connectionstatechange",this._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(g.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){g.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(g.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});g.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();g.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:i}){var n;this.assertSendDirection(),g.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);const s=c.clone(this._sendingRtpParametersByKind[e.kind],{});s.codecs=l.reduceCodecs(s.codecs,i);const o=c.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});o.codecs=l.reduceCodecs(o.codecs,i);const h=this._remoteSdp.getNextMediaSectionIdx(),p=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});let f,v=await this._pc.createOffer(),_=a.parse(v.sdp);this._transportReady||await this.setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:_});const y=(0,m.parse)((t||[{}])[0].scalabilityMode);t&&t.length>1&&(g.debug("send() | enabling legacy simulcast"),_=a.parse(v.sdp),f=_.media[h.idx],u.addLegacySimulcast({offerMediaObject:f,numStreams:t.length}),v={type:"offer",sdp:a.write(_)}),g.debug("send() | calling pc.setLocalDescription() [offer:%o]",v),await this._pc.setLocalDescription(v);const b=p.mid;if(s.mid=b,_=a.parse(this._pc.localDescription.sdp),f=_.media[h.idx],s.rtcp.cname=d.getCname({offerMediaObject:f}),s.encodings=u.getRtpEncodings({offerMediaObject:f}),t)for(let e=0;e<s.encodings.length;++e)t[e]&&Object.assign(s.encodings[e],t[e]);if(s.encodings.length>1&&("video/vp8"===s.codecs[0].mimeType.toLowerCase()||"video/h264"===s.codecs[0].mimeType.toLowerCase()))for(const e of s.encodings)e.scalabilityMode?e.scalabilityMode=`L1T${y.temporalLayers}`:e.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:f,reuseMid:h.reuseMid,offerRtpParameters:s,answerRtpParameters:o,codecOptions:r});const E={type:"answer",sdp:this._remoteSdp.getSdp()};return g.debug("send() | calling pc.setRemoteDescription() [answer:%o]",E),await this._pc.setRemoteDescription(E),this._mapMidTransceiver.set(b,p),{localId:b,rtpParameters:s,rtpSender:p.sender}}async stopSending(e){this.assertSendDirection(),g.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch(e){}const r=await this._pc.createOffer();g.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertSendDirection(),g.debug("pauseSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);const r=await this._pc.createOffer();g.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async resumeSending(e){this.assertSendDirection(),g.debug("resumeSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(e);const r=await this._pc.createOffer();g.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(e,t){this.assertSendDirection(),t?g.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):g.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertSendDirection(),g.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const i=r.sender.getParameters();i.encodings.forEach(((e,r)=>{e.active=r<=t})),await r.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const n=await this._pc.createOffer();g.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const s={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async setRtpEncodingParameters(e,t){this.assertSendDirection(),g.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const i=r.sender.getParameters();i.encodings.forEach(((e,r)=>{i.encodings[r]={...e,...t}})),await r.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const n=await this._pc.createOffer();g.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const s={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async getSenderStats(e){this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:i,protocol:n}){var s;this.assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:n};g.debug("sendDataChannel() [options:%o]",o);const c=this._pc.createDataChannel(i,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%v.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=a.parse(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||await this.setupTransport({localDtlsRole:null!==(s=this._forcedLocalDtlsRole)&&void 0!==s?s:"client",localSdpObject:t}),g.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const i={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._hasDataChannelMediaSection=!0}return{dataChannel:c,sctpStreamParameters:{streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits}}}async receive(e){var t;this.assertRecvDirection();const r=[],i=new Map;for(const t of e){const{trackId:e,kind:r,rtpParameters:n,streamId:s}=t;g.debug("receive() [trackId:%s, kind:%s]",e,r);const a=n.mid||String(this._mapMidTransceiver.size);i.set(e,a),this._remoteSdp.receive({mid:a,kind:r,offerRtpParameters:n,streamId:s||n.rtcp.cname,trackId:e})}const n={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);let s=await this._pc.createAnswer();const o=a.parse(s.sdp);for(const t of e){const{trackId:e,rtpParameters:r}=t,n=i.get(e),s=o.media.find((e=>String(e.mid)===n));d.applyCodecParameters({offerRtpParameters:r,answerMediaObject:s})}s={type:"answer",sdp:a.write(o)},this._transportReady||await this.setupTransport({localDtlsRole:null!==(t=this._forcedLocalDtlsRole)&&void 0!==t?t:"client",localSdpObject:o}),g.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);for(const t of e){const{trackId:e}=t,n=i.get(e),s=this._pc.getTransceivers().find((e=>e.mid===n));if(!s)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(n,s),r.push({localId:n,track:s.receiver.track,rtpReceiver:s.receiver})}return r}async stopReceiving(e){this.assertRecvDirection();for(const t of e){g.debug("stopReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(e.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();g.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const t of e)this._mapMidTransceiver.delete(t)}async pauseReceiving(e){this.assertRecvDirection();for(const t of e){g.debug("pauseReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="inactive",this._remoteSdp.pauseMediaSection(t)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();g.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async resumeReceiving(e){this.assertRecvDirection();for(const t of e){g.debug("resumeReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(t)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();g.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async getReceiverStats(e){this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){var i;this.assertRecvDirection();const{streamId:n,ordered:s,maxPacketLifeTime:o,maxRetransmits:c}=e,l={negotiated:!0,id:n,ordered:s,maxPacketLifeTime:o,maxRetransmits:c,protocol:r};g.debug("receiveDataChannel() [options:%o]",l);const d=this._pc.createDataChannel(t,l);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=a.parse(t.sdp);await this.setupTransport({localDtlsRole:null!==(i=this._forcedLocalDtlsRole)&&void 0!==i?i:"client",localSdpObject:e})}g.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=a.parse(this._pc.localDescription.sdp));const r=d.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise(((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)})),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Safari12=_},3635:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.mangleRtpParameters=t.getCapabilities=void 0;const a=s(r(3347));t.getCapabilities=function(){const e=RTCRtpReceiver.getCapabilities(),t=a.clone(e,{});for(const e of t.codecs){if(e.channels=e.numChannels,delete e.numChannels,e.mimeType=e.mimeType||`${e.kind}/${e.name}`,e.parameters){const t=e.parameters;t.apt&&(t.apt=Number(t.apt)),t["packetization-mode"]&&(t["packetization-mode"]=Number(t["packetization-mode"]))}for(const t of e.rtcpFeedback||[])t.parameter||(t.parameter="")}return t},t.mangleRtpParameters=function(e){const t=a.clone(e,{});t.mid&&(t.muxId=t.mid,delete t.mid);for(const e of t.codecs)e.channels&&(e.numChannels=e.channels,delete e.channels),e.mimeType&&!e.name&&(e.name=e.mimeType.split("/")[1]),delete e.mimeType;return t}},8954:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addNackSuppportForOpus=void 0,t.addNackSuppportForOpus=function(e){var t;for(const r of e.codecs||[])"audio/opus"!==r.mimeType.toLowerCase()&&"audio/multiopus"!==r.mimeType.toLowerCase()||(null===(t=r.rtcpFeedback)||void 0===t?void 0:t.some((e=>"nack"===e.type&&!e.parameter)))||(r.rtcpFeedback||(r.rtcpFeedback=[]),r.rtcpFeedback.push({type:"nack"}))}},6698:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.OfferMediaSection=t.AnswerMediaSection=t.MediaSection=void 0;const a=s(r(766)),o=s(r(3347));class c{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:i=!1}){if(this._mediaObject={},this._planB=i,e&&this.setIceParameters(e),t){this._mediaObject.candidates=[];for(const e of t){const t={component:1};t.foundation=e.foundation,t.ip=e.ip,t.port=e.port,t.priority=e.priority,t.transport=e.protocol,t.type=e.type,e.tcpType&&(t.tcptype=e.tcpType),this._mediaObject.candidates.push(t)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}r&&this.setDtlsRole(r.role)}get mid(){return String(this._mediaObject.mid)}get closed(){return 0===this._mediaObject.port}getObject(){return this._mediaObject}setIceParameters(e){this._mediaObject.iceUfrag=e.usernameFragment,this._mediaObject.icePwd=e.password}pause(){this._mediaObject.direction="inactive"}disable(){this.pause(),delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}close(){this.disable(),this._mediaObject.port=0}}function l(e){const t=new RegExp("^(audio|video)/(.+)","i").exec(e.mimeType);if(!t)throw new TypeError("invalid codec.mimeType");return t[2]}t.MediaSection=c,t.AnswerMediaSection=class extends c{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:i,plainRtpParameters:n,planB:s=!1,offerMediaObject:a,offerRtpParameters:c,answerRtpParameters:d,codecOptions:u,extmapAllowMixed:h=!1}){switch(super({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:s}),this._mediaObject.mid=String(a.mid),this._mediaObject.type=a.type,this._mediaObject.protocol=a.protocol,n?(this._mediaObject.connection={ip:n.ip,version:n.ipVersion},this._mediaObject.port=n.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),a.type){case"audio":case"video":this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];for(const e of d.codecs){const t={payload:e.payloadType,codec:l(e),rate:e.clockRate};e.channels>1&&(t.encoding=e.channels),this._mediaObject.rtp.push(t);const r=o.clone(e.parameters,{});let i=o.clone(e.rtcpFeedback,[]);if(u){const{opusStereo:t,opusFec:n,opusDtx:s,opusMaxPlaybackRate:a,opusMaxAverageBitrate:o,opusPtime:l,opusNack:d,videoGoogleStartBitrate:h,videoGoogleMaxBitrate:p,videoGoogleMinBitrate:f}=u,m=c.codecs.find((t=>t.payloadType===e.payloadType));switch(e.mimeType.toLowerCase()){case"audio/opus":case"audio/multiopus":void 0!==t&&(m.parameters["sprop-stereo"]=t?1:0,r.stereo=t?1:0),void 0!==n&&(m.parameters.useinbandfec=n?1:0,r.useinbandfec=n?1:0),void 0!==s&&(m.parameters.usedtx=s?1:0,r.usedtx=s?1:0),void 0!==a&&(r.maxplaybackrate=a),void 0!==o&&(r.maxaveragebitrate=o),void 0!==l&&(m.parameters.ptime=l,r.ptime=l),d||(m.rtcpFeedback=m.rtcpFeedback.filter((e=>"nack"!==e.type||e.parameter)),i=i.filter((e=>"nack"!==e.type||e.parameter)));break;case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":void 0!==h&&(r["x-google-start-bitrate"]=h),void 0!==p&&(r["x-google-max-bitrate"]=p),void 0!==f&&(r["x-google-min-bitrate"]=f)}}const n={payload:e.payloadType,config:""};for(const e of Object.keys(r))n.config&&(n.config+=";"),n.config+=`${e}=${r[e]}`;n.config&&this._mediaObject.fmtp.push(n);for(const t of i)this._mediaObject.rtcpFb.push({payload:e.payloadType,type:t.type,subtype:t.parameter})}this._mediaObject.payloads=d.codecs.map((e=>e.payloadType)).join(" "),this._mediaObject.ext=[];for(const e of d.headerExtensions)(a.ext||[]).some((t=>t.uri===e.uri))&&this._mediaObject.ext.push({uri:e.uri,value:e.id});if(h&&"extmap-allow-mixed"===a.extmapAllowMixed&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),a.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:a.simulcast.list1},this._mediaObject.rids=[];for(const e of a.rids||[])"send"===e.direction&&this._mediaObject.rids.push({id:e.id,direction:"recv"})}else if(a.simulcast_03){this._mediaObject.simulcast_03={value:a.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];for(const e of a.rids||[])"send"===e.direction&&this._mediaObject.rids.push({id:e.id,direction:"recv"})}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize",this._planB&&"video"===this._mediaObject.type&&(this._mediaObject.xGoogleFlag="conference");break;case"application":"number"==typeof a.sctpPort?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=i.port,this._mediaObject.maxMessageSize=i.maxMessageSize):a.sctpmap&&(this._mediaObject.payloads=i.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:i.port,maxMessageSize:i.maxMessageSize})}}setDtlsRole(e){switch(e){case"client":this._mediaObject.setup="active";break;case"server":this._mediaObject.setup="passive";break;case"auto":this._mediaObject.setup="actpass"}}resume(){this._mediaObject.direction="recvonly"}muxSimulcastStreams(e){var t;if(!this._mediaObject.simulcast||!this._mediaObject.simulcast.list1)return;const r={};for(const t of e)t.rid&&(r[t.rid]=t);const i=this._mediaObject.simulcast.list1,n=a.parseSimulcastStreamList(i);for(const e of n)for(const i of e)i.paused=!(null===(t=r[i.scid])||void 0===t?void 0:t.active);this._mediaObject.simulcast.list1=n.map((e=>e.map((e=>`${e.paused?"~":""}${e.scid}`)).join(","))).join(";")}},t.OfferMediaSection=class extends c{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:i,plainRtpParameters:n,planB:s=!1,mid:a,kind:o,offerRtpParameters:c,streamId:d,trackId:u,oldDataChannelSpec:h=!1}){switch(super({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:s}),this._mediaObject.mid=String(a),this._mediaObject.type=o,n?(this._mediaObject.connection={ip:n.ip,version:n.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=n.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.protocol=i?"UDP/DTLS/SCTP":"UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),o){case"audio":case"video":{this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._planB||(this._mediaObject.msid=`${d||"-"} ${u}`);for(const e of c.codecs){const t={payload:e.payloadType,codec:l(e),rate:e.clockRate};e.channels>1&&(t.encoding=e.channels),this._mediaObject.rtp.push(t);const r={payload:e.payloadType,config:""};for(const t of Object.keys(e.parameters))r.config&&(r.config+=";"),r.config+=`${t}=${e.parameters[t]}`;r.config&&this._mediaObject.fmtp.push(r);for(const t of e.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:e.payloadType,type:t.type,subtype:t.parameter})}this._mediaObject.payloads=c.codecs.map((e=>e.payloadType)).join(" "),this._mediaObject.ext=[];for(const e of c.headerExtensions)this._mediaObject.ext.push({uri:e.uri,value:e.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";const e=c.encodings[0],t=e.ssrc,r=e.rtx&&e.rtx.ssrc?e.rtx.ssrc:void 0;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],c.rtcp.cname&&this._mediaObject.ssrcs.push({id:t,attribute:"cname",value:c.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:t,attribute:"msid",value:`${d||"-"} ${u}`}),r&&(c.rtcp.cname&&this._mediaObject.ssrcs.push({id:r,attribute:"cname",value:c.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:r,attribute:"msid",value:`${d||"-"} ${u}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${t} ${r}`}));break}case"application":h?(this._mediaObject.payloads=i.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:i.port,maxMessageSize:i.maxMessageSize}):(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=i.port,this._mediaObject.maxMessageSize=i.maxMessageSize)}}setDtlsRole(e){this._mediaObject.setup="actpass"}resume(){this._mediaObject.direction="sendonly"}planBReceive({offerRtpParameters:e,streamId:t,trackId:r}){const i=e.encodings[0],n=i.ssrc,s=i.rtx&&i.rtx.ssrc?i.rtx.ssrc:void 0,a=this._mediaObject.payloads.split(" ");for(const t of e.codecs){if(a.includes(String(t.payloadType)))continue;const e={payload:t.payloadType,codec:l(t),rate:t.clockRate};t.channels>1&&(e.encoding=t.channels),this._mediaObject.rtp.push(e);const r={payload:t.payloadType,config:""};for(const e of Object.keys(t.parameters))r.config&&(r.config+=";"),r.config+=`${e}=${t.parameters[e]}`;r.config&&this._mediaObject.fmtp.push(r);for(const e of t.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:t.payloadType,type:e.type,subtype:e.parameter})}this._mediaObject.payloads+=` ${e.codecs.filter((e=>!this._mediaObject.payloads.includes(e.payloadType))).map((e=>e.payloadType)).join(" ")}`,this._mediaObject.payloads=this._mediaObject.payloads.trim(),e.rtcp.cname&&this._mediaObject.ssrcs.push({id:n,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:n,attribute:"msid",value:`${t||"-"} ${r}`}),s&&(e.rtcp.cname&&this._mediaObject.ssrcs.push({id:s,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:s,attribute:"msid",value:`${t||"-"} ${r}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${n} ${s}`}))}planBStopReceiving({offerRtpParameters:e}){const t=e.encodings[0],r=t.ssrc,i=t.rtx&&t.rtx.ssrc?t.rtx.ssrc:void 0;this._mediaObject.ssrcs=this._mediaObject.ssrcs.filter((e=>e.id!==r&&e.id!==i)),i&&(this._mediaObject.ssrcGroups=this._mediaObject.ssrcGroups.filter((e=>e.ssrcs!==`${r} ${i}`)))}}},7910:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteSdp=void 0;const a=s(r(766)),o=r(8562),c=r(6698),l=new o.Logger("RemoteSdp");t.RemoteSdp=class{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:i,plainRtpParameters:n,planB:s=!1}){if(this._mediaSections=[],this._midToIndex=new Map,this._iceParameters=e,this._iceCandidates=t,this._dtlsParameters=r,this._sctpParameters=i,this._plainRtpParameters=n,this._planB=s,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:1e4,sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},e&&e.iceLite&&(this._sdpObject.icelite="ice-lite"),r){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};const e=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:r.fingerprints[e-1].algorithm,hash:r.fingerprints[e-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}n&&(this._sdpObject.origin.address=n.ip,this._sdpObject.origin.ipVer=n.ipVersion)}updateIceParameters(e){l.debug("updateIceParameters() [iceParameters:%o]",e),this._iceParameters=e,this._sdpObject.icelite=e.iceLite?"ice-lite":void 0;for(const t of this._mediaSections)t.setIceParameters(e)}updateDtlsRole(e){l.debug("updateDtlsRole() [role:%s]",e),this._dtlsParameters.role=e;for(const t of this._mediaSections)t.setDtlsRole(e)}getNextMediaSectionIdx(){for(let e=0;e<this._mediaSections.length;++e){const t=this._mediaSections[e];if(t.closed)return{idx:e,reuseMid:t.mid}}return{idx:this._mediaSections.length}}send({offerMediaObject:e,reuseMid:t,offerRtpParameters:r,answerRtpParameters:i,codecOptions:n,extmapAllowMixed:s=!1}){const a=new c.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,offerMediaObject:e,offerRtpParameters:r,answerRtpParameters:i,codecOptions:n,extmapAllowMixed:s});t?this._replaceMediaSection(a,t):this._midToIndex.has(a.mid)?this._replaceMediaSection(a):this._addMediaSection(a)}receive({mid:e,kind:t,offerRtpParameters:r,streamId:i,trackId:n}){const s=this._midToIndex.get(e);let a;if(void 0!==s&&(a=this._mediaSections[s]),a)a.planBReceive({offerRtpParameters:r,streamId:i,trackId:n}),this._replaceMediaSection(a);else{a=new c.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:e,kind:t,offerRtpParameters:r,streamId:i,trackId:n});const s=this._mediaSections.find((e=>e.closed));s?this._replaceMediaSection(a,s.mid):this._addMediaSection(a)}}pauseMediaSection(e){this._findMediaSection(e).pause()}resumeSendingMediaSection(e){this._findMediaSection(e).resume()}resumeReceivingMediaSection(e){this._findMediaSection(e).resume()}disableMediaSection(e){this._findMediaSection(e).disable()}closeMediaSection(e){const t=this._findMediaSection(e);return e===this._firstMid?(l.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",e),this.disableMediaSection(e),!1):(t.close(),this._regenerateBundleMids(),!0)}muxMediaSectionSimulcast(e,t){const r=this._findMediaSection(e);r.muxSimulcastStreams(t),this._replaceMediaSection(r)}planBStopReceiving({mid:e,offerRtpParameters:t}){const r=this._findMediaSection(e);r.planBStopReceiving({offerRtpParameters:t}),this._replaceMediaSection(r)}sendSctpAssociation({offerMediaObject:e}){const t=new c.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:e});this._addMediaSection(t)}receiveSctpAssociation({oldDataChannelSpec:e=!1}={}){const t=new c.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application",oldDataChannelSpec:e});this._addMediaSection(t)}getSdp(){return this._sdpObject.origin.sessionVersion++,a.write(this._sdpObject)}_addMediaSection(e){this._firstMid||(this._firstMid=e.mid),this._mediaSections.push(e),this._midToIndex.set(e.mid,this._mediaSections.length-1),this._sdpObject.media.push(e.getObject()),this._regenerateBundleMids()}_replaceMediaSection(e,t){if("string"==typeof t){const r=this._midToIndex.get(t);if(void 0===r)throw new Error(`no media section found for reuseMid '${t}'`);const i=this._mediaSections[r];this._mediaSections[r]=e,this._midToIndex.delete(i.mid),this._midToIndex.set(e.mid,r),this._sdpObject.media[r]=e.getObject(),this._regenerateBundleMids()}else{const t=this._midToIndex.get(e.mid);if(void 0===t)throw new Error(`no media section found with mid '${e.mid}'`);this._mediaSections[t]=e,this._sdpObject.media[t]=e.getObject()}}_findMediaSection(e){const t=this._midToIndex.get(e);if(void 0===t)throw new Error(`no media section found with mid '${e}'`);return this._mediaSections[t]}_regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter((e=>!e.closed)).map((e=>e.mid)).join(" "))}}},2267:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.applyCodecParameters=t.getCname=t.extractDtlsParameters=t.extractRtpCapabilities=void 0;const a=s(r(766));t.extractRtpCapabilities=function({sdpObject:e}){const t=new Map,r=[];let i=!1,n=!1;for(const s of e.media){const e=s.type;switch(e){case"audio":if(i)continue;i=!0;break;case"video":if(n)continue;n=!0;break;default:continue}for(const r of s.rtp){const i={kind:e,mimeType:`${e}/${r.codec}`,preferredPayloadType:r.payload,clockRate:r.rate,channels:r.encoding,parameters:{},rtcpFeedback:[]};t.set(i.preferredPayloadType,i)}for(const e of s.fmtp||[]){const r=a.parseParams(e.config),i=t.get(e.payload);i&&(r&&r.hasOwnProperty("profile-level-id")&&(r["profile-level-id"]=String(r["profile-level-id"])),i.parameters=r)}for(const r of s.rtcpFb||[]){const i={type:r.type,parameter:r.subtype};if(i.parameter||delete i.parameter,"*"!==r.payload){const e=t.get(r.payload);if(!e)continue;e.rtcpFeedback.push(i)}else for(const r of t.values())r.kind!==e||/.+\/rtx$/i.test(r.mimeType)||r.rtcpFeedback.push(i)}for(const t of s.ext||[]){if(t["encrypt-uri"])continue;const i={kind:e,uri:t.uri,preferredId:t.value};r.push(i)}}return{codecs:Array.from(t.values()),headerExtensions:r}},t.extractDtlsParameters=function({sdpObject:e}){const t=(e.media||[]).find((e=>e.iceUfrag&&0!==e.port));if(!t)throw new Error("no active media section found");const r=t.fingerprint||e.fingerprint;let i;switch(t.setup){case"active":i="client";break;case"passive":i="server";break;case"actpass":i="auto"}return{role:i,fingerprints:[{algorithm:r.type,value:r.hash}]}},t.getCname=function({offerMediaObject:e}){const t=(e.ssrcs||[]).find((e=>"cname"===e.attribute));return t?t.value:""},t.applyCodecParameters=function({offerRtpParameters:e,answerMediaObject:t}){for(const r of e.codecs){const e=r.mimeType.toLowerCase();if("audio/opus"!==e)continue;if(!(t.rtp||[]).find((e=>e.payload===r.payloadType)))continue;t.fmtp=t.fmtp||[];let i=t.fmtp.find((e=>e.payload===r.payloadType));i||(i={payload:r.payloadType,config:""},t.fmtp.push(i));const n=a.parseParams(i.config);switch(e){case"audio/opus":{const e=r.parameters["sprop-stereo"];void 0!==e&&(n.stereo=e?1:0);break}}i.config="";for(const e of Object.keys(n))i.config&&(i.config+=";"),i.config+=`${e}=${n[e]}`}}},9875:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addLegacySimulcast=t.getRtpEncodings=void 0,t.getRtpEncodings=function({offerMediaObject:e,track:t}){let r;const i=new Set;for(const n of e.ssrcs||[])if("msid"===n.attribute&&n.value.split(" ")[1]===t.id){const e=n.id;i.add(e),r||(r=e)}if(0===i.size)throw new Error(`a=ssrc line with msid information not found [track.id:${t.id}]`);const n=new Map;for(const t of e.ssrcGroups||[]){if("FID"!==t.semantics)continue;let[e,r]=t.ssrcs.split(/\s+/);e=Number(e),r=Number(r),i.has(e)&&(i.delete(e),i.delete(r),n.set(e,r))}for(const e of i)n.set(e,null);const s=[];for(const[e,t]of n){const r={ssrc:e};t&&(r.rtx={ssrc:t}),s.push(r)}return s},t.addLegacySimulcast=function({offerMediaObject:e,track:t,numStreams:r}){if(r<=1)throw new TypeError("numStreams must be greater than 1");let i,n,s;if(!(e.ssrcs||[]).find((e=>"msid"===e.attribute&&(e.value.split(" ")[1]===t.id&&(i=e.id,s=e.value.split(" ")[0],!0)))))throw new Error(`a=ssrc line with msid information not found [track.id:${t.id}]`);(e.ssrcGroups||[]).some((e=>{if("FID"!==e.semantics)return!1;const t=e.ssrcs.split(/\s+/);return Number(t[0])===i&&(n=Number(t[1]),!0)}));const a=e.ssrcs.find((e=>"cname"===e.attribute&&e.id===i));if(!a)throw new Error(`a=ssrc line with cname information not found [track.id:${t.id}]`);const o=a.value,c=[],l=[];for(let e=0;e<r;++e)c.push(i+e),n&&l.push(n+e);e.ssrcGroups=e.ssrcGroups||[],e.ssrcs=e.ssrcs||[],e.ssrcGroups.push({semantics:"SIM",ssrcs:c.join(" ")});for(let r=0;r<c.length;++r){const i=c[r];e.ssrcs.push({id:i,attribute:"cname",value:o}),e.ssrcs.push({id:i,attribute:"msid",value:`${s} ${t.id}`})}for(let r=0;r<l.length;++r){const i=c[r],n=l[r];e.ssrcs.push({id:n,attribute:"cname",value:o}),e.ssrcs.push({id:n,attribute:"msid",value:`${s} ${t.id}`}),e.ssrcGroups.push({semantics:"FID",ssrcs:`${i} ${n}`})}}},9072:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addLegacySimulcast=t.getRtpEncodings=void 0,t.getRtpEncodings=function({offerMediaObject:e}){const t=new Set;for(const r of e.ssrcs||[]){const e=r.id;t.add(e)}if(0===t.size)throw new Error("no a=ssrc lines found");const r=new Map;for(const i of e.ssrcGroups||[]){if("FID"!==i.semantics)continue;let[e,n]=i.ssrcs.split(/\s+/);e=Number(e),n=Number(n),t.has(e)&&(t.delete(e),t.delete(n),r.set(e,n))}for(const e of t)r.set(e,null);const i=[];for(const[e,t]of r){const r={ssrc:e};t&&(r.rtx={ssrc:t}),i.push(r)}return i},t.addLegacySimulcast=function({offerMediaObject:e,numStreams:t}){if(t<=1)throw new TypeError("numStreams must be greater than 1");const r=(e.ssrcs||[]).find((e=>"msid"===e.attribute));if(!r)throw new Error("a=ssrc line with msid information not found");const[i,n]=r.value.split(" "),s=r.id;let a;(e.ssrcGroups||[]).some((e=>{if("FID"!==e.semantics)return!1;const t=e.ssrcs.split(/\s+/);return Number(t[0])===s&&(a=Number(t[1]),!0)}));const o=e.ssrcs.find((e=>"cname"===e.attribute));if(!o)throw new Error("a=ssrc line with cname information not found");const c=o.value,l=[],d=[];for(let e=0;e<t;++e)l.push(s+e),a&&d.push(a+e);e.ssrcGroups=[],e.ssrcs=[],e.ssrcGroups.push({semantics:"SIM",ssrcs:l.join(" ")});for(let t=0;t<l.length;++t){const r=l[t];e.ssrcs.push({id:r,attribute:"cname",value:c}),e.ssrcs.push({id:r,attribute:"msid",value:`${i} ${n}`})}for(let t=0;t<d.length;++t){const r=l[t],s=d[t];e.ssrcs.push({id:s,attribute:"cname",value:c}),e.ssrcs.push({id:s,attribute:"msid",value:`${i} ${n}`}),e.ssrcGroups.push({semantics:"FID",ssrcs:`${r} ${s}`})}}},960:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.debug=t.parseScalabilityMode=t.detectDevice=t.Device=t.version=t.types=void 0;const o=a(r(388));t.debug=o.default;const c=r(3120);Object.defineProperty(t,"Device",{enumerable:!0,get:function(){return c.Device}}),Object.defineProperty(t,"detectDevice",{enumerable:!0,get:function(){return c.detectDevice}});const l=s(r(53));t.types=l,t.version="3.6.84";var d=r(2770);Object.defineProperty(t,"parseScalabilityMode",{enumerable:!0,get:function(){return d.parse}})},5280:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.canReceive=t.canSend=t.generateProbatorRtpParameters=t.reduceCodecs=t.getSendingRemoteRtpParameters=t.getSendingRtpParameters=t.getRecvRtpCapabilities=t.getExtendedRtpCapabilities=t.validateSctpStreamParameters=t.validateSctpParameters=t.validateNumSctpStreams=t.validateSctpCapabilities=t.validateRtcpParameters=t.validateRtpEncodingParameters=t.validateRtpHeaderExtensionParameters=t.validateRtpCodecParameters=t.validateRtpParameters=t.validateRtpHeaderExtension=t.validateRtcpFeedback=t.validateRtpCodecCapability=t.validateRtpCapabilities=void 0;const a=s(r(7855)),o=s(r(3347));function c(e){const t=new RegExp("^(audio|video)/(.+)","i");if("object"!=typeof e)throw new TypeError("codec is not an object");if(!e.mimeType||"string"!=typeof e.mimeType)throw new TypeError("missing codec.mimeType");const r=t.exec(e.mimeType);if(!r)throw new TypeError("invalid codec.mimeType");if(e.kind=r[1].toLowerCase(),e.preferredPayloadType&&"number"!=typeof e.preferredPayloadType)throw new TypeError("invalid codec.preferredPayloadType");if("number"!=typeof e.clockRate)throw new TypeError("missing codec.clockRate");"audio"===e.kind?"number"!=typeof e.channels&&(e.channels=1):delete e.channels,e.parameters&&"object"==typeof e.parameters||(e.parameters={});for(const t of Object.keys(e.parameters)){let r=e.parameters[t];if(void 0===r&&(e.parameters[t]="",r=""),"string"!=typeof r&&"number"!=typeof r)throw new TypeError(`invalid codec parameter [key:${t}s, value:${r}]`);if("apt"===t&&"number"!=typeof r)throw new TypeError("invalid codec apt parameter")}e.rtcpFeedback&&Array.isArray(e.rtcpFeedback)||(e.rtcpFeedback=[]);for(const t of e.rtcpFeedback)l(t)}function l(e){if("object"!=typeof e)throw new TypeError("fb is not an object");if(!e.type||"string"!=typeof e.type)throw new TypeError("missing fb.type");e.parameter&&"string"==typeof e.parameter||(e.parameter="")}function d(e){if("object"!=typeof e)throw new TypeError("ext is not an object");if("audio"!==e.kind&&"video"!==e.kind)throw new TypeError("invalid ext.kind");if(!e.uri||"string"!=typeof e.uri)throw new TypeError("missing ext.uri");if("number"!=typeof e.preferredId)throw new TypeError("missing ext.preferredId");if(e.preferredEncrypt&&"boolean"!=typeof e.preferredEncrypt)throw new TypeError("invalid ext.preferredEncrypt");if(e.preferredEncrypt||(e.preferredEncrypt=!1),e.direction&&"string"!=typeof e.direction)throw new TypeError("invalid ext.direction");e.direction||(e.direction="sendrecv")}function u(e){if("object"!=typeof e)throw new TypeError("params is not an object");if(e.mid&&"string"!=typeof e.mid)throw new TypeError("params.mid is not a string");if(!Array.isArray(e.codecs))throw new TypeError("missing params.codecs");for(const t of e.codecs)h(t);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("params.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);for(const t of e.headerExtensions)p(t);if(e.encodings&&!Array.isArray(e.encodings))throw new TypeError("params.encodings is not an array");e.encodings||(e.encodings=[]);for(const t of e.encodings)f(t);if(e.rtcp&&"object"!=typeof e.rtcp)throw new TypeError("params.rtcp is not an object");e.rtcp||(e.rtcp={}),m(e.rtcp)}function h(e){const t=new RegExp("^(audio|video)/(.+)","i");if("object"!=typeof e)throw new TypeError("codec is not an object");if(!e.mimeType||"string"!=typeof e.mimeType)throw new TypeError("missing codec.mimeType");const r=t.exec(e.mimeType);if(!r)throw new TypeError("invalid codec.mimeType");if("number"!=typeof e.payloadType)throw new TypeError("missing codec.payloadType");if("number"!=typeof e.clockRate)throw new TypeError("missing codec.clockRate");"audio"===r[1].toLowerCase()?"number"!=typeof e.channels&&(e.channels=1):delete e.channels,e.parameters&&"object"==typeof e.parameters||(e.parameters={});for(const t of Object.keys(e.parameters)){let r=e.parameters[t];if(void 0===r&&(e.parameters[t]="",r=""),"string"!=typeof r&&"number"!=typeof r)throw new TypeError(`invalid codec parameter [key:${t}s, value:${r}]`);if("apt"===t&&"number"!=typeof r)throw new TypeError("invalid codec apt parameter")}e.rtcpFeedback&&Array.isArray(e.rtcpFeedback)||(e.rtcpFeedback=[]);for(const t of e.rtcpFeedback)l(t)}function p(e){if("object"!=typeof e)throw new TypeError("ext is not an object");if(!e.uri||"string"!=typeof e.uri)throw new TypeError("missing ext.uri");if("number"!=typeof e.id)throw new TypeError("missing ext.id");if(e.encrypt&&"boolean"!=typeof e.encrypt)throw new TypeError("invalid ext.encrypt");e.encrypt||(e.encrypt=!1),e.parameters&&"object"==typeof e.parameters||(e.parameters={});for(const t of Object.keys(e.parameters)){let r=e.parameters[t];if(void 0===r&&(e.parameters[t]="",r=""),"string"!=typeof r&&"number"!=typeof r)throw new TypeError("invalid header extension parameter")}}function f(e){if("object"!=typeof e)throw new TypeError("encoding is not an object");if(e.ssrc&&"number"!=typeof e.ssrc)throw new TypeError("invalid encoding.ssrc");if(e.rid&&"string"!=typeof e.rid)throw new TypeError("invalid encoding.rid");if(e.rtx&&"object"!=typeof e.rtx)throw new TypeError("invalid encoding.rtx");if(e.rtx&&"number"!=typeof e.rtx.ssrc)throw new TypeError("missing encoding.rtx.ssrc");if(e.dtx&&"boolean"==typeof e.dtx||(e.dtx=!1),e.scalabilityMode&&"string"!=typeof e.scalabilityMode)throw new TypeError("invalid encoding.scalabilityMode")}function m(e){if("object"!=typeof e)throw new TypeError("rtcp is not an object");if(e.cname&&"string"!=typeof e.cname)throw new TypeError("invalid rtcp.cname");e.reducedSize&&"boolean"==typeof e.reducedSize||(e.reducedSize=!0)}function g(e){if("object"!=typeof e)throw new TypeError("numStreams is not an object");if("number"!=typeof e.OS)throw new TypeError("missing numStreams.OS");if("number"!=typeof e.MIS)throw new TypeError("missing numStreams.MIS")}function v(e){return!!e&&/.+\/rtx$/i.test(e.mimeType)}function _(e,t,{strict:r=!1,modify:i=!1}={}){const n=e.mimeType.toLowerCase();if(n!==t.mimeType.toLowerCase())return!1;if(e.clockRate!==t.clockRate)return!1;if(e.channels!==t.channels)return!1;switch(n){case"video/h264":if(r){if((e.parameters["packetization-mode"]||0)!==(t.parameters["packetization-mode"]||0))return!1;if(!a.isSameProfile(e.parameters,t.parameters))return!1;let r;try{r=a.generateProfileLevelIdForAnswer(e.parameters,t.parameters)}catch(e){return!1}i&&(r?(e.parameters["profile-level-id"]=r,t.parameters["profile-level-id"]=r):(delete e.parameters["profile-level-id"],delete t.parameters["profile-level-id"]))}break;case"video/vp9":if(r&&(e.parameters["profile-id"]||0)!==(t.parameters["profile-id"]||0))return!1}return!0}function y(e,t){const r=[];for(const i of e.rtcpFeedback||[]){const e=(t.rtcpFeedback||[]).find((e=>e.type===i.type&&(e.parameter===i.parameter||!e.parameter&&!i.parameter)));e&&r.push(e)}return r}t.validateRtpCapabilities=function(e){if("object"!=typeof e)throw new TypeError("caps is not an object");if(e.codecs&&!Array.isArray(e.codecs))throw new TypeError("caps.codecs is not an array");e.codecs||(e.codecs=[]);for(const t of e.codecs)c(t);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);for(const t of e.headerExtensions)d(t)},t.validateRtpCodecCapability=c,t.validateRtcpFeedback=l,t.validateRtpHeaderExtension=d,t.validateRtpParameters=u,t.validateRtpCodecParameters=h,t.validateRtpHeaderExtensionParameters=p,t.validateRtpEncodingParameters=f,t.validateRtcpParameters=m,t.validateSctpCapabilities=function(e){if("object"!=typeof e)throw new TypeError("caps is not an object");if(!e.numStreams||"object"!=typeof e.numStreams)throw new TypeError("missing caps.numStreams");g(e.numStreams)},t.validateNumSctpStreams=g,t.validateSctpParameters=function(e){if("object"!=typeof e)throw new TypeError("params is not an object");if("number"!=typeof e.port)throw new TypeError("missing params.port");if("number"!=typeof e.OS)throw new TypeError("missing params.OS");if("number"!=typeof e.MIS)throw new TypeError("missing params.MIS");if("number"!=typeof e.maxMessageSize)throw new TypeError("missing params.maxMessageSize")},t.validateSctpStreamParameters=function(e){if("object"!=typeof e)throw new TypeError("params is not an object");if("number"!=typeof e.streamId)throw new TypeError("missing params.streamId");let t=!1;if("boolean"==typeof e.ordered?t=!0:e.ordered=!0,e.maxPacketLifeTime&&"number"!=typeof e.maxPacketLifeTime)throw new TypeError("invalid params.maxPacketLifeTime");if(e.maxRetransmits&&"number"!=typeof e.maxRetransmits)throw new TypeError("invalid params.maxRetransmits");if(e.maxPacketLifeTime&&e.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(t&&e.ordered&&(e.maxPacketLifeTime||e.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(t||!e.maxPacketLifeTime&&!e.maxRetransmits||(e.ordered=!1),e.label&&"string"!=typeof e.label)throw new TypeError("invalid params.label");if(e.protocol&&"string"!=typeof e.protocol)throw new TypeError("invalid params.protocol")},t.getExtendedRtpCapabilities=function(e,t){const r={codecs:[],headerExtensions:[]};for(const i of t.codecs||[]){if(v(i))continue;const t=(e.codecs||[]).find((e=>_(e,i,{strict:!0,modify:!0})));if(!t)continue;const n={mimeType:t.mimeType,kind:t.kind,clockRate:t.clockRate,channels:t.channels,localPayloadType:t.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:i.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:t.parameters,remoteParameters:i.parameters,rtcpFeedback:y(t,i)};r.codecs.push(n)}for(const i of r.codecs){const r=e.codecs.find((e=>v(e)&&e.parameters.apt===i.localPayloadType)),n=t.codecs.find((e=>v(e)&&e.parameters.apt===i.remotePayloadType));r&&n&&(i.localRtxPayloadType=r.preferredPayloadType,i.remoteRtxPayloadType=n.preferredPayloadType)}for(const i of t.headerExtensions){const t=e.headerExtensions.find((e=>{return r=i,!((t=e).kind&&r.kind&&t.kind!==r.kind||t.uri!==r.uri);var t,r}));if(!t)continue;const n={kind:i.kind,uri:i.uri,sendId:t.preferredId,recvId:i.preferredId,encrypt:t.preferredEncrypt,direction:"sendrecv"};switch(i.direction){case"sendrecv":n.direction="sendrecv";break;case"recvonly":n.direction="sendonly";break;case"sendonly":n.direction="recvonly";break;case"inactive":n.direction="inactive"}r.headerExtensions.push(n)}return r},t.getRecvRtpCapabilities=function(e){const t={codecs:[],headerExtensions:[]};for(const r of e.codecs){const e={mimeType:r.mimeType,kind:r.kind,preferredPayloadType:r.remotePayloadType,clockRate:r.clockRate,channels:r.channels,parameters:r.localParameters,rtcpFeedback:r.rtcpFeedback};if(t.codecs.push(e),!r.remoteRtxPayloadType)continue;const i={mimeType:`${r.kind}/rtx`,kind:r.kind,preferredPayloadType:r.remoteRtxPayloadType,clockRate:r.clockRate,parameters:{apt:r.remotePayloadType},rtcpFeedback:[]};t.codecs.push(i)}for(const r of e.headerExtensions){if("sendrecv"!==r.direction&&"recvonly"!==r.direction)continue;const e={kind:r.kind,uri:r.uri,preferredId:r.recvId,preferredEncrypt:r.encrypt,direction:r.direction};t.headerExtensions.push(e)}return t},t.getSendingRtpParameters=function(e,t){const r={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const i of t.codecs){if(i.kind!==e)continue;const t={mimeType:i.mimeType,payloadType:i.localPayloadType,clockRate:i.clockRate,channels:i.channels,parameters:i.localParameters,rtcpFeedback:i.rtcpFeedback};if(r.codecs.push(t),i.localRtxPayloadType){const e={mimeType:`${i.kind}/rtx`,payloadType:i.localRtxPayloadType,clockRate:i.clockRate,parameters:{apt:i.localPayloadType},rtcpFeedback:[]};r.codecs.push(e)}}for(const i of t.headerExtensions){if(i.kind&&i.kind!==e||"sendrecv"!==i.direction&&"sendonly"!==i.direction)continue;const t={uri:i.uri,id:i.sendId,encrypt:i.encrypt,parameters:{}};r.headerExtensions.push(t)}return r},t.getSendingRemoteRtpParameters=function(e,t){const r={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const i of t.codecs){if(i.kind!==e)continue;const t={mimeType:i.mimeType,payloadType:i.localPayloadType,clockRate:i.clockRate,channels:i.channels,parameters:i.remoteParameters,rtcpFeedback:i.rtcpFeedback};if(r.codecs.push(t),i.localRtxPayloadType){const e={mimeType:`${i.kind}/rtx`,payloadType:i.localRtxPayloadType,clockRate:i.clockRate,parameters:{apt:i.localPayloadType},rtcpFeedback:[]};r.codecs.push(e)}}for(const i of t.headerExtensions){if(i.kind&&i.kind!==e||"sendrecv"!==i.direction&&"sendonly"!==i.direction)continue;const t={uri:i.uri,id:i.sendId,encrypt:i.encrypt,parameters:{}};r.headerExtensions.push(t)}if(r.headerExtensions.some((e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.uri)))for(const e of r.codecs)e.rtcpFeedback=(e.rtcpFeedback||[]).filter((e=>"goog-remb"!==e.type));else if(r.headerExtensions.some((e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.uri)))for(const e of r.codecs)e.rtcpFeedback=(e.rtcpFeedback||[]).filter((e=>"transport-cc"!==e.type));else for(const e of r.codecs)e.rtcpFeedback=(e.rtcpFeedback||[]).filter((e=>"transport-cc"!==e.type&&"goog-remb"!==e.type));return r},t.reduceCodecs=function(e,t){const r=[];if(t){for(let i=0;i<e.length;++i)if(_(e[i],t)){r.push(e[i]),v(e[i+1])&&r.push(e[i+1]);break}if(0===r.length)throw new TypeError("no matching codec found")}else r.push(e[0]),v(e[1])&&r.push(e[1]);return r},t.generateProbatorRtpParameters=function(e){u(e=o.clone(e,{}));const t={mid:"probator",codecs:[],headerExtensions:[],encodings:[{ssrc:1234}],rtcp:{cname:"probator"}};return t.codecs.push(e.codecs[0]),t.codecs[0].payloadType=127,t.headerExtensions=e.headerExtensions,t},t.canSend=function(e,t){return t.codecs.some((t=>t.kind===e))},t.canReceive=function(e,t){if(u(e),0===e.codecs.length)return!1;const r=e.codecs[0];return t.codecs.some((e=>e.remotePayloadType===r.payloadType))}},2770:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parse=void 0;const r=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");t.parse=function(e){const t=r.exec(e||"");return t?{spatialLayers:Number(t[1]),temporalLayers:Number(t[2])}:{spatialLayers:1,temporalLayers:1}}},53:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(3120),t),n(r(5202),t),n(r(6569),t),n(r(9514),t),n(r(5504),t),n(r(1623),t),n(r(4879),t),n(r(7669),t),n(r(9316),t),n(r(9992),t)},3347:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateRandomNumber=t.clone=void 0,t.clone=function(e,t){return void 0===e?t:JSON.parse(JSON.stringify(e))},t.generateRandomNumber=function(){return Math.round(1e7*Math.random())}},388:(e,t,r)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let i=0,n=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(i++,"%c"===e&&(n=i))})),t.splice(n,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=!1),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=r(4455)(t);const{formatters:i}=e.exports;i.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},4455:(e,t,r)=>{e.exports=function(e){function t(e){let r,n,s,a=null;function o(...e){if(!o.enabled)return;const i=o,n=Number(new Date),s=n-(r||n);i.diff=s,i.prev=r,i.curr=n,r=n,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let a=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((r,n)=>{if("%%"===r)return"%";a++;const s=t.formatters[n];if("function"==typeof s){const t=e[a];r=s.call(i,t),e.splice(a,1),a--}return r})),t.formatArgs.call(i,e),(i.log||t.log).apply(i,e)}return o.namespace=e,o.useColors=t.useColors(),o.color=t.selectColor(e),o.extend=i,o.destroy=t.destroy,Object.defineProperty(o,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==a?a:(n!==t.namespaces&&(n=t.namespaces,s=t.enabled(e)),s),set:e=>{a=e}}),"function"==typeof t.init&&t.init(o),o}function i(e,r){const i=t(this.namespace+(void 0===r?":":r)+e);return i.log=this.log,i}function n(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(n),...t.skips.map(n).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const i=("string"==typeof e?e:"").split(/[\s,]+/),n=i.length;for(r=0;r<n;r++)i[r]&&("-"===(e=i[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let r,i;for(r=0,i=t.skips.length;r<i;r++)if(t.skips[r].test(e))return!1;for(r=0,i=t.names.length;r<i;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(1438),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((r=>{t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}},1438:e=>{var t=1e3,r=60*t,i=60*r,n=24*i;function s(e,t,r,i){var n=t>=1.5*r;return Math.round(e/r)+" "+i+(n?"s":"")}e.exports=function(e,a){a=a||{};var o,c,l=typeof e;if("string"===l&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var s=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(s){var a=parseFloat(s[1]);switch((s[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*a;case"weeks":case"week":case"w":return 6048e5*a;case"days":case"day":case"d":return a*n;case"hours":case"hour":case"hrs":case"hr":case"h":return a*i;case"minutes":case"minute":case"mins":case"min":case"m":return a*r;case"seconds":case"second":case"secs":case"sec":case"s":return a*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}}}(e);if("number"===l&&isFinite(e))return a.long?(o=e,(c=Math.abs(o))>=n?s(o,c,n,"day"):c>=i?s(o,c,i,"hour"):c>=r?s(o,c,r,"minute"):c>=t?s(o,c,t,"second"):o+" ms"):function(e){var s=Math.abs(e);return s>=n?Math.round(e/n)+"d":s>=i?Math.round(e/i)+"h":s>=r?Math.round(e/r)+"m":s>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},8949:(e,t,r)=>{"use strict";function i(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];throw new Error("number"==typeof e?"[MobX] minified error nr: "+e+(r.length?" "+r.map(String).join(","):"")+". Find the full error at: https://github.com/mobxjs/mobx/blob/main/packages/mobx/src/errors.ts":"[MobX] "+e)}r.r(t),r.d(t,{$mobx:()=>H,FlowCancellationError:()=>lr,ObservableMap:()=>_i,ObservableSet:()=>Ei,Reaction:()=>Tt,_allowStateChanges:()=>Ge,_allowStateChangesInsideComputed:()=>Gt,_allowStateReadsEnd:()=>ct,_allowStateReadsStart:()=>ot,_autoAction:()=>Vt,_endAction:()=>Ve,_getAdministration:()=>Hi,_getGlobalState:()=>mt,_interceptReads:()=>vr,_isComputingDerivation:()=>tt,_resetGlobalState:()=>gt,_startAction:()=>Ue,action:()=>Ut,autorun:()=>Kt,comparer:()=>z,computed:()=>Ie,configure:()=>rr,createAtom:()=>W,defineProperty:()=>Ir,entries:()=>Ar,extendObservable:()=>ir,flow:()=>pr,flowResult:()=>mr,get:()=>kr,getAtom:()=>Gi,getDebugName:()=>Ki,getDependencyTree:()=>nr,getObserverTree:()=>ar,has:()=>Lr,intercept:()=>_r,isAction:()=>Ht,isBoxedObservable:()=>ze,isComputed:()=>br,isComputedProp:()=>Er,isFlow:()=>gr,isFlowCancellationError:()=>dr,isObservable:()=>wr,isObservableArray:()=>hi,isObservableMap:()=>yi,isObservableObject:()=>Di,isObservableProp:()=>Tr,isObservableSet:()=>Si,keys:()=>Rr,makeAutoObservable:()=>Xr,makeObservable:()=>Qr,observable:()=>Pe,observe:()=>Mr,onBecomeObserved:()=>Qt,onBecomeUnobserved:()=>Jt,onReactionError:()=>Rt,override:()=>J,ownKeys:()=>Or,reaction:()=>zt,remove:()=>Dr,runInAction:()=>Gt,set:()=>Pr,spy:()=>kt,toJS:()=>Fr,trace:()=>Br,transaction:()=>jr,untracked:()=>nt,values:()=>Cr,when:()=>Ur});var n={};function s(){return"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==r.g?r.g:"undefined"!=typeof self?self:n}var a=Object.assign,o=Object.getOwnPropertyDescriptor,c=Object.defineProperty,l=Object.prototype,d=[];Object.freeze(d);var u={};Object.freeze(u);var h="undefined"!=typeof Proxy,p=Object.toString();function f(){h||i("Proxy not available")}function m(e){var t=!1;return function(){if(!t)return t=!0,e.apply(this,arguments)}}var g=function(){};function v(e){return"function"==typeof e}function _(e){switch(typeof e){case"string":case"symbol":case"number":return!0}return!1}function y(e){return null!==e&&"object"==typeof e}function b(e){if(!y(e))return!1;var t=Object.getPrototypeOf(e);if(null==t)return!0;var r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r.toString()===p}function E(e){var t=null==e?void 0:e.constructor;return!!t&&("GeneratorFunction"===t.name||"GeneratorFunction"===t.displayName)}function S(e,t,r){c(e,t,{enumerable:!1,writable:!0,configurable:!0,value:r})}function w(e,t,r){c(e,t,{enumerable:!1,writable:!1,configurable:!0,value:r})}function T(e,t){var r="isMobX"+e;return t.prototype[r]=!0,function(e){return y(e)&&!0===e[r]}}function R(e){return e instanceof Map}function C(e){return e instanceof Set}var A=void 0!==Object.getOwnPropertySymbols,P="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:A?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames;function D(e){return null===e?null:"object"==typeof e?""+e:e}function L(e,t){return l.hasOwnProperty.call(e,t)}var k=Object.getOwnPropertyDescriptors||function(e){var t={};return P(e).forEach((function(r){t[r]=o(e,r)})),t};function I(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,"symbol"==typeof(n=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key))?n:String(n)),i)}var n}function O(e,t,r){return t&&I(e.prototype,t),r&&I(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function M(){return M=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},M.apply(this,arguments)}function x(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,N(e,t)}function N(e,t){return N=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},N(e,t)}function F(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function B(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function j(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return B(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?B(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var U=Symbol("mobx-stored-annotations");function V(e){return Object.assign((function(t,r){G(t,r,e)}),e)}function G(e,t,r){L(e,U)||S(e,U,M({},e[U])),function(e){return e.annotationType_===Q}(r)||(e[U][t]=r)}var H=Symbol("mobx administration"),K=function(){function e(e){void 0===e&&(e="Atom"),this.name_=void 0,this.isPendingUnobservation_=!1,this.isBeingObserved_=!1,this.observers_=new Set,this.batchId_=void 0,this.diffValue_=0,this.lastAccessedBy_=0,this.lowestObserverState_=$e.NOT_TRACKING_,this.onBOL=void 0,this.onBUOL=void 0,this.name_=e,this.batchId_=ft.inBatch?ft.batchId:NaN}var t=e.prototype;return t.onBO=function(){this.onBOL&&this.onBOL.forEach((function(e){return e()}))},t.onBUO=function(){this.onBUOL&&this.onBUOL.forEach((function(e){return e()}))},t.reportObserved=function(){return St(this)},t.reportChanged=function(){ft.inBatch&&this.batchId_===ft.batchId||(ft.stateVersion=ft.stateVersion<Number.MAX_SAFE_INTEGER?ft.stateVersion+1:Number.MIN_SAFE_INTEGER,this.batchId_=NaN),bt(),wt(this),Et()},t.toString=function(){return this.name_},e}(),q=T("Atom",K);function W(e,t,r){void 0===t&&(t=g),void 0===r&&(r=g);var i=new K(e);return t!==g&&Qt(i,t),r!==g&&Jt(i,r),i}var z={identity:function(e,t){return e===t},structural:function(e,t){return zi(e,t)},default:function(e,t){return Object.is?Object.is(e,t):e===t?0!==e||1/e==1/t:e!=e&&t!=t},shallow:function(e,t){return zi(e,t,1)}};function $(e,t,r){return wr(e)?e:Array.isArray(e)?Pe.array(e,{name:r}):b(e)?Pe.object(e,void 0,{name:r}):R(e)?Pe.map(e,{name:r}):C(e)?Pe.set(e,{name:r}):"function"!=typeof e||Ht(e)||gr(e)?e:E(e)?pr(e):Vt(r,e)}function Y(e){return e}var Q="override",J=V({annotationType_:Q,make_:function(e,t){return 0},extend_:function(e,t,r,n){i("'"+this.annotationType_+"' can only be used with 'makeObservable'")}});function X(e,t){return{annotationType_:e,options_:t,make_:Z,extend_:ee}}function Z(e,t,r,i){var n;if(null!=(n=this.options_)&&n.bound)return null===this.extend_(e,t,r,!1)?0:1;if(i===e.target_)return null===this.extend_(e,t,r,!1)?0:2;if(Ht(r.value))return 1;var s=te(e,this,t,r,!1);return c(i,t,s),2}function ee(e,t,r,i){var n=te(e,this,t,r);return e.defineProperty_(t,n,i)}function te(e,t,r,i,n){var s,a,o,c,l,d,u,h;void 0===n&&(n=ft.safeDescriptors),h=i,t.annotationType_,h.value;var p,f=i.value;return null!=(s=t.options_)&&s.bound&&(f=f.bind(null!=(p=e.proxy_)?p:e.target_)),{value:Be(null!=(a=null==(o=t.options_)?void 0:o.name)?a:r.toString(),f,null!=(c=null==(l=t.options_)?void 0:l.autoAction)&&c,null!=(d=t.options_)&&d.bound?null!=(u=e.proxy_)?u:e.target_:void 0),configurable:!n||e.isPlainObject_,enumerable:!1,writable:!n}}function re(e,t){return{annotationType_:e,options_:t,make_:ie,extend_:ne}}function ie(e,t,r,i){var n;if(i===e.target_)return null===this.extend_(e,t,r,!1)?0:2;if(null!=(n=this.options_)&&n.bound&&(!L(e.target_,t)||!gr(e.target_[t]))&&null===this.extend_(e,t,r,!1))return 0;if(gr(r.value))return 1;var s=se(e,this,0,r,!1,!1);return c(i,t,s),2}function ne(e,t,r,i){var n,s=se(e,this,0,r,null==(n=this.options_)?void 0:n.bound);return e.defineProperty_(t,s,i)}function se(e,t,r,i,n,s){var a;void 0===s&&(s=ft.safeDescriptors),a=i,t.annotationType_,a.value;var o,c=i.value;return gr(c)||(c=pr(c)),n&&((c=c.bind(null!=(o=e.proxy_)?o:e.target_)).isMobXFlow=!0),{value:c,configurable:!s||e.isPlainObject_,enumerable:!1,writable:!s}}function ae(e,t){return{annotationType_:e,options_:t,make_:oe,extend_:ce}}function oe(e,t,r){return null===this.extend_(e,t,r,!1)?0:1}function ce(e,t,r,i){return n=r,this.annotationType_,n.get,e.defineComputedProperty_(t,M({},this.options_,{get:r.get,set:r.set}),i);var n}function le(e,t){return{annotationType_:e,options_:t,make_:de,extend_:ue}}function de(e,t,r){return null===this.extend_(e,t,r,!1)?0:1}function ue(e,t,r,i){var n,s;return this.annotationType_,e.defineObservableProperty_(t,r.value,null!=(n=null==(s=this.options_)?void 0:s.enhancer)?n:$,i)}var he="true",pe=fe();function fe(e){return{annotationType_:he,options_:e,make_:me,extend_:ge}}function me(e,t,r,i){var n,s,a,o;if(r.get)return Ie.make_(e,t,r,i);if(r.set){var l=Be(t.toString(),r.set);return i===e.target_?null===e.defineProperty_(t,{configurable:!ft.safeDescriptors||e.isPlainObject_,set:l})?0:2:(c(i,t,{configurable:!0,set:l}),2)}if(i!==e.target_&&"function"==typeof r.value)return E(r.value)?(null!=(o=this.options_)&&o.autoBind?pr.bound:pr).make_(e,t,r,i):(null!=(a=this.options_)&&a.autoBind?Vt.bound:Vt).make_(e,t,r,i);var d,u=!1===(null==(n=this.options_)?void 0:n.deep)?Pe.ref:Pe;return"function"==typeof r.value&&null!=(s=this.options_)&&s.autoBind&&(r.value=r.value.bind(null!=(d=e.proxy_)?d:e.target_)),u.make_(e,t,r,i)}function ge(e,t,r,i){var n,s,a;return r.get?Ie.extend_(e,t,r,i):r.set?e.defineProperty_(t,{configurable:!ft.safeDescriptors||e.isPlainObject_,set:Be(t.toString(),r.set)},i):("function"==typeof r.value&&null!=(n=this.options_)&&n.autoBind&&(r.value=r.value.bind(null!=(a=e.proxy_)?a:e.target_)),(!1===(null==(s=this.options_)?void 0:s.deep)?Pe.ref:Pe).extend_(e,t,r,i))}var ve={deep:!0,name:void 0,defaultDecorator:void 0,proxy:!0};function _e(e){return e||ve}Object.freeze(ve);var ye=le("observable"),be=le("observable.ref",{enhancer:Y}),Ee=le("observable.shallow",{enhancer:function(e,t,r){return null==e||Di(e)||hi(e)||yi(e)||Si(e)?e:Array.isArray(e)?Pe.array(e,{name:r,deep:!1}):b(e)?Pe.object(e,void 0,{name:r,deep:!1}):R(e)?Pe.map(e,{name:r,deep:!1}):C(e)?Pe.set(e,{name:r,deep:!1}):void 0}}),Se=le("observable.struct",{enhancer:function(e,t){return zi(e,t)?t:e}}),we=V(ye);function Te(e){return!0===e.deep?$:!1===e.deep?Y:(t=e.defaultDecorator)&&null!=(r=null==(i=t.options_)?void 0:i.enhancer)?r:$;var t,r,i}function Re(e,t,r){if(!_(t))return wr(e)?e:b(e)?Pe.object(e,t,r):Array.isArray(e)?Pe.array(e,t):R(e)?Pe.map(e,t):C(e)?Pe.set(e,t):"object"==typeof e&&null!==e?e:Pe.box(e,t);G(e,t,ye)}a(Re,we);var Ce,Ae,Pe=a(Re,{box:function(e,t){var r=_e(t);return new We(e,Te(r),r.name,!0,r.equals)},array:function(e,t){var r=_e(t);return(!1===ft.useProxies||!1===r.proxy?Vi:ii)(e,Te(r),r.name)},map:function(e,t){var r=_e(t);return new _i(e,Te(r),r.name)},set:function(e,t){var r=_e(t);return new Ei(e,Te(r),r.name)},object:function(e,t,r){return qi((function(){return ir(!1===ft.useProxies||!1===(null==r?void 0:r.proxy)?Ci({},r):function(e,t){var r,i;return f(),null!=(i=(r=(e=Ci(e,t))[H]).proxy_)?i:r.proxy_=new Proxy(e,Hr)}({},r),e,t)}))},ref:V(be),shallow:V(Ee),deep:we,struct:V(Se)}),De="computed",Le=ae(De),ke=ae("computed.struct",{equals:z.structural}),Ie=function(e,t){if(_(t))return G(e,t,Le);if(b(e))return V(ae(De,e));var r=b(t)?t:{};return r.get=e,r.name||(r.name=e.name||""),new Qe(r)};Object.assign(Ie,Le),Ie.struct=V(ke);var Oe,Me=0,xe=1,Ne=null!=(Ce=null==(Ae=o((function(){}),"name"))?void 0:Ae.configurable)&&Ce,Fe={value:"action",configurable:!0,writable:!1,enumerable:!1};function Be(e,t,r,i){function n(){return je(e,r,t,i||this,arguments)}return void 0===r&&(r=!1),n.isMobxAction=!0,Ne&&(Fe.value=e,c(n,"name",Fe)),n}function je(e,t,r,i,n){var s=Ue(0,t);try{return r.apply(i,n)}catch(e){throw s.error_=e,e}finally{Ve(s)}}function Ue(e,t,r,i){var n=ft.trackingDerivation,s=!t||!n;bt();var a=ft.allowStateChanges;s&&(st(),a=He(!0));var o={runAsAction_:s,prevDerivation_:n,prevAllowStateChanges_:a,prevAllowStateReads_:ot(!0),notifySpy_:!1,startTime_:0,actionId_:xe++,parentActionId_:Me};return Me=o.actionId_,o}function Ve(e){Me!==e.actionId_&&i(30),Me=e.parentActionId_,void 0!==e.error_&&(ft.suppressReactionErrors=!0),Ke(e.prevAllowStateChanges_),ct(e.prevAllowStateReads_),Et(),e.runAsAction_&&at(e.prevDerivation_),ft.suppressReactionErrors=!1}function Ge(e,t){var r=He(e);try{return t()}finally{Ke(r)}}function He(e){var t=ft.allowStateChanges;return ft.allowStateChanges=e,t}function Ke(e){ft.allowStateChanges=e}Oe=Symbol.toPrimitive;var qe,We=function(e){function t(t,r,i,n,s){var a;return void 0===i&&(i="ObservableValue"),void 0===n&&(n=!0),void 0===s&&(s=z.default),(a=e.call(this,i)||this).enhancer=void 0,a.name_=void 0,a.equals=void 0,a.hasUnreportedChange_=!1,a.interceptors_=void 0,a.changeListeners_=void 0,a.value_=void 0,a.dehancer=void 0,a.enhancer=r,a.name_=i,a.equals=s,a.value_=r(t,void 0,i),a}x(t,e);var r=t.prototype;return r.dehanceValue=function(e){return void 0!==this.dehancer?this.dehancer(e):e},r.set=function(e){this.value_,(e=this.prepareNewValue_(e))!==ft.UNCHANGED&&this.setNewValue_(e)},r.prepareNewValue_=function(e){if(Kr(this)){var t=Wr(this,{object:this,type:ei,newValue:e});if(!t)return ft.UNCHANGED;e=t.newValue}return e=this.enhancer(e,this.value_,this.name_),this.equals(this.value_,e)?ft.UNCHANGED:e},r.setNewValue_=function(e){var t=this.value_;this.value_=e,this.reportChanged(),zr(this)&&Yr(this,{type:ei,object:this,newValue:e,oldValue:t})},r.get=function(){return this.reportObserved(),this.dehanceValue(this.value_)},r.intercept_=function(e){return qr(this,e)},r.observe_=function(e,t){return t&&e({observableKind:"value",debugObjectName:this.name_,object:this,type:ei,newValue:this.value_,oldValue:void 0}),$r(this,e)},r.raw=function(){return this.value_},r.toJSON=function(){return this.get()},r.toString=function(){return this.name_+"["+this.value_+"]"},r.valueOf=function(){return D(this.get())},r[Oe]=function(){return this.valueOf()},t}(K),ze=T("ObservableValue",We);qe=Symbol.toPrimitive;var $e,Ye,Qe=function(){function e(e){this.dependenciesState_=$e.NOT_TRACKING_,this.observing_=[],this.newObserving_=null,this.isBeingObserved_=!1,this.isPendingUnobservation_=!1,this.observers_=new Set,this.diffValue_=0,this.runId_=0,this.lastAccessedBy_=0,this.lowestObserverState_=$e.UP_TO_DATE_,this.unboundDepsCount_=0,this.value_=new Xe(null),this.name_=void 0,this.triggeredBy_=void 0,this.isComputing_=!1,this.isRunningSetter_=!1,this.derivation=void 0,this.setter_=void 0,this.isTracing_=Ye.NONE,this.scope_=void 0,this.equals_=void 0,this.requiresReaction_=void 0,this.keepAlive_=void 0,this.onBOL=void 0,this.onBUOL=void 0,e.get||i(31),this.derivation=e.get,this.name_=e.name||"ComputedValue",e.set&&(this.setter_=Be("ComputedValue-setter",e.set)),this.equals_=e.equals||(e.compareStructural||e.struct?z.structural:z.default),this.scope_=e.context,this.requiresReaction_=e.requiresReaction,this.keepAlive_=!!e.keepAlive}var t=e.prototype;return t.onBecomeStale_=function(){!function(e){e.lowestObserverState_===$e.UP_TO_DATE_&&(e.lowestObserverState_=$e.POSSIBLY_STALE_,e.observers_.forEach((function(e){e.dependenciesState_===$e.UP_TO_DATE_&&(e.dependenciesState_=$e.POSSIBLY_STALE_,e.onBecomeStale_())})))}(this)},t.onBO=function(){this.onBOL&&this.onBOL.forEach((function(e){return e()}))},t.onBUO=function(){this.onBUOL&&this.onBUOL.forEach((function(e){return e()}))},t.get=function(){if(this.isComputing_&&i(32,this.name_,this.derivation),0!==ft.inBatch||0!==this.observers_.size||this.keepAlive_){if(St(this),et(this)){var e=ft.trackingContext;this.keepAlive_&&!e&&(ft.trackingContext=this),this.trackAndCompute()&&function(e){e.lowestObserverState_!==$e.STALE_&&(e.lowestObserverState_=$e.STALE_,e.observers_.forEach((function(t){t.dependenciesState_===$e.POSSIBLY_STALE_?t.dependenciesState_=$e.STALE_:t.dependenciesState_===$e.UP_TO_DATE_&&(e.lowestObserverState_=$e.UP_TO_DATE_)})))}(this),ft.trackingContext=e}}else et(this)&&(this.warnAboutUntrackedRead_(),bt(),this.value_=this.computeValue_(!1),Et());var t=this.value_;if(Ze(t))throw t.cause;return t},t.set=function(e){if(this.setter_){this.isRunningSetter_&&i(33,this.name_),this.isRunningSetter_=!0;try{this.setter_.call(this.scope_,e)}finally{this.isRunningSetter_=!1}}else i(34,this.name_)},t.trackAndCompute=function(){var e=this.value_,t=this.dependenciesState_===$e.NOT_TRACKING_,r=this.computeValue_(!0),i=t||Ze(e)||Ze(r)||!this.equals_(e,r);return i&&(this.value_=r),i},t.computeValue_=function(e){this.isComputing_=!0;var t,r=He(!1);if(e)t=rt(this,this.derivation,this.scope_);else if(!0===ft.disableErrorBoundaries)t=this.derivation.call(this.scope_);else try{t=this.derivation.call(this.scope_)}catch(e){t=new Xe(e)}return Ke(r),this.isComputing_=!1,t},t.suspend_=function(){this.keepAlive_||(it(this),this.value_=void 0)},t.observe_=function(e,t){var r=this,i=!0,n=void 0;return Kt((function(){var s=r.get();if(!i||t){var a=st();e({observableKind:"computed",debugObjectName:r.name_,type:ei,object:r,newValue:s,oldValue:n}),at(a)}i=!1,n=s}))},t.warnAboutUntrackedRead_=function(){},t.toString=function(){return this.name_+"["+this.derivation.toString()+"]"},t.valueOf=function(){return D(this.get())},t[qe]=function(){return this.valueOf()},e}(),Je=T("ComputedValue",Qe);!function(e){e[e.NOT_TRACKING_=-1]="NOT_TRACKING_",e[e.UP_TO_DATE_=0]="UP_TO_DATE_",e[e.POSSIBLY_STALE_=1]="POSSIBLY_STALE_",e[e.STALE_=2]="STALE_"}($e||($e={})),function(e){e[e.NONE=0]="NONE",e[e.LOG=1]="LOG",e[e.BREAK=2]="BREAK"}(Ye||(Ye={}));var Xe=function(e){this.cause=void 0,this.cause=e};function Ze(e){return e instanceof Xe}function et(e){switch(e.dependenciesState_){case $e.UP_TO_DATE_:return!1;case $e.NOT_TRACKING_:case $e.STALE_:return!0;case $e.POSSIBLY_STALE_:for(var t=ot(!0),r=st(),i=e.observing_,n=i.length,s=0;s<n;s++){var a=i[s];if(Je(a)){if(ft.disableErrorBoundaries)a.get();else try{a.get()}catch(e){return at(r),ct(t),!0}if(e.dependenciesState_===$e.STALE_)return at(r),ct(t),!0}}return lt(e),at(r),ct(t),!1}}function tt(){return null!==ft.trackingDerivation}function rt(e,t,r){var i=ot(!0);lt(e),e.newObserving_=new Array(e.observing_.length+100),e.unboundDepsCount_=0,e.runId_=++ft.runId;var n,s=ft.trackingDerivation;if(ft.trackingDerivation=e,ft.inBatch++,!0===ft.disableErrorBoundaries)n=t.call(r);else try{n=t.call(r)}catch(e){n=new Xe(e)}return ft.inBatch--,ft.trackingDerivation=s,function(e){for(var t=e.observing_,r=e.observing_=e.newObserving_,i=$e.UP_TO_DATE_,n=0,s=e.unboundDepsCount_,a=0;a<s;a++){var o=r[a];0===o.diffValue_&&(o.diffValue_=1,n!==a&&(r[n]=o),n++),o.dependenciesState_>i&&(i=o.dependenciesState_)}for(r.length=n,e.newObserving_=null,s=t.length;s--;){var c=t[s];0===c.diffValue_&&_t(c,e),c.diffValue_=0}for(;n--;){var l=r[n];1===l.diffValue_&&(l.diffValue_=0,vt(l,e))}i!==$e.UP_TO_DATE_&&(e.dependenciesState_=i,e.onBecomeStale_())}(e),ct(i),n}function it(e){var t=e.observing_;e.observing_=[];for(var r=t.length;r--;)_t(t[r],e);e.dependenciesState_=$e.NOT_TRACKING_}function nt(e){var t=st();try{return e()}finally{at(t)}}function st(){var e=ft.trackingDerivation;return ft.trackingDerivation=null,e}function at(e){ft.trackingDerivation=e}function ot(e){var t=ft.allowStateReads;return ft.allowStateReads=e,t}function ct(e){ft.allowStateReads=e}function lt(e){if(e.dependenciesState_!==$e.UP_TO_DATE_){e.dependenciesState_=$e.UP_TO_DATE_;for(var t=e.observing_,r=t.length;r--;)t[r].lowestObserverState_=$e.UP_TO_DATE_}}var dt=["mobxGuid","spyListeners","enforceActions","computedRequiresReaction","reactionRequiresObservable","observableRequiresReaction","allowStateReads","disableErrorBoundaries","runId","UNCHANGED","useProxies"],ut=function(){this.version=6,this.UNCHANGED={},this.trackingDerivation=null,this.trackingContext=null,this.runId=0,this.mobxGuid=0,this.inBatch=0,this.batchId=Number.MIN_SAFE_INTEGER,this.pendingUnobservations=[],this.pendingReactions=[],this.isRunningReactions=!1,this.allowStateChanges=!1,this.allowStateReads=!0,this.enforceActions=!0,this.spyListeners=[],this.globalReactionErrorHandlers=[],this.computedRequiresReaction=!1,this.reactionRequiresObservable=!1,this.observableRequiresReaction=!1,this.disableErrorBoundaries=!1,this.suppressReactionErrors=!1,this.useProxies=!0,this.verifyProxies=!1,this.safeDescriptors=!0,this.stateVersion=Number.MIN_SAFE_INTEGER},ht=!0,pt=!1,ft=function(){var e=s();return e.__mobxInstanceCount>0&&!e.__mobxGlobals&&(ht=!1),e.__mobxGlobals&&e.__mobxGlobals.version!==(new ut).version&&(ht=!1),ht?e.__mobxGlobals?(e.__mobxInstanceCount+=1,e.__mobxGlobals.UNCHANGED||(e.__mobxGlobals.UNCHANGED={}),e.__mobxGlobals):(e.__mobxInstanceCount=1,e.__mobxGlobals=new ut):(setTimeout((function(){pt||i(35)}),1),new ut)}();function mt(){return ft}function gt(){var e=new ut;for(var t in e)-1===dt.indexOf(t)&&(ft[t]=e[t]);ft.allowStateChanges=!ft.enforceActions}function vt(e,t){e.observers_.add(t),e.lowestObserverState_>t.dependenciesState_&&(e.lowestObserverState_=t.dependenciesState_)}function _t(e,t){e.observers_.delete(t),0===e.observers_.size&&yt(e)}function yt(e){!1===e.isPendingUnobservation_&&(e.isPendingUnobservation_=!0,ft.pendingUnobservations.push(e))}function bt(){0===ft.inBatch&&(ft.batchId=ft.batchId<Number.MAX_SAFE_INTEGER?ft.batchId+1:Number.MIN_SAFE_INTEGER),ft.inBatch++}function Et(){if(0==--ft.inBatch){Pt();for(var e=ft.pendingUnobservations,t=0;t<e.length;t++){var r=e[t];r.isPendingUnobservation_=!1,0===r.observers_.size&&(r.isBeingObserved_&&(r.isBeingObserved_=!1,r.onBUO()),r instanceof Qe&&r.suspend_())}ft.pendingUnobservations=[]}}function St(e){var t=ft.trackingDerivation;return null!==t?(t.runId_!==e.lastAccessedBy_&&(e.lastAccessedBy_=t.runId_,t.newObserving_[t.unboundDepsCount_++]=e,!e.isBeingObserved_&&ft.trackingContext&&(e.isBeingObserved_=!0,e.onBO())),e.isBeingObserved_):(0===e.observers_.size&&ft.inBatch>0&&yt(e),!1)}function wt(e){e.lowestObserverState_!==$e.STALE_&&(e.lowestObserverState_=$e.STALE_,e.observers_.forEach((function(e){e.dependenciesState_===$e.UP_TO_DATE_&&e.onBecomeStale_(),e.dependenciesState_=$e.STALE_})))}var Tt=function(){function e(e,t,r,i){void 0===e&&(e="Reaction"),this.name_=void 0,this.onInvalidate_=void 0,this.errorHandler_=void 0,this.requiresObservable_=void 0,this.observing_=[],this.newObserving_=[],this.dependenciesState_=$e.NOT_TRACKING_,this.diffValue_=0,this.runId_=0,this.unboundDepsCount_=0,this.isDisposed_=!1,this.isScheduled_=!1,this.isTrackPending_=!1,this.isRunning_=!1,this.isTracing_=Ye.NONE,this.name_=e,this.onInvalidate_=t,this.errorHandler_=r,this.requiresObservable_=i}var t=e.prototype;return t.onBecomeStale_=function(){this.schedule_()},t.schedule_=function(){this.isScheduled_||(this.isScheduled_=!0,ft.pendingReactions.push(this),Pt())},t.isScheduled=function(){return this.isScheduled_},t.runReaction_=function(){if(!this.isDisposed_){bt(),this.isScheduled_=!1;var e=ft.trackingContext;if(ft.trackingContext=this,et(this)){this.isTrackPending_=!0;try{this.onInvalidate_()}catch(e){this.reportExceptionInDerivation_(e)}}ft.trackingContext=e,Et()}},t.track=function(e){if(!this.isDisposed_){bt(),this.isRunning_=!0;var t=ft.trackingContext;ft.trackingContext=this;var r=rt(this,e,void 0);ft.trackingContext=t,this.isRunning_=!1,this.isTrackPending_=!1,this.isDisposed_&&it(this),Ze(r)&&this.reportExceptionInDerivation_(r.cause),Et()}},t.reportExceptionInDerivation_=function(e){var t=this;if(this.errorHandler_)this.errorHandler_(e,this);else{if(ft.disableErrorBoundaries)throw e;var r="[mobx] uncaught error in '"+this+"'";ft.suppressReactionErrors||console.error(r,e),ft.globalReactionErrorHandlers.forEach((function(r){return r(e,t)}))}},t.dispose=function(){this.isDisposed_||(this.isDisposed_=!0,this.isRunning_||(bt(),it(this),Et()))},t.getDisposer_=function(e){var t=this,r=function r(){t.dispose(),null==e||null==e.removeEventListener||e.removeEventListener("abort",r)};return null==e||null==e.addEventListener||e.addEventListener("abort",r),r[H]=this,r},t.toString=function(){return"Reaction["+this.name_+"]"},t.trace=function(e){void 0===e&&(e=!1)},e}();function Rt(e){return ft.globalReactionErrorHandlers.push(e),function(){var t=ft.globalReactionErrorHandlers.indexOf(e);t>=0&&ft.globalReactionErrorHandlers.splice(t,1)}}var Ct=100,At=function(e){return e()};function Pt(){ft.inBatch>0||ft.isRunningReactions||At(Dt)}function Dt(){ft.isRunningReactions=!0;for(var e=ft.pendingReactions,t=0;e.length>0;){++t===Ct&&(console.error("[mobx] cycle in reaction: "+e[0]),e.splice(0));for(var r=e.splice(0),i=0,n=r.length;i<n;i++)r[i].runReaction_()}ft.isRunningReactions=!1}var Lt=T("Reaction",Tt);function kt(e){return console.warn("[mobx.spy] Is a no-op in production builds"),function(){}}var It="action",Ot="autoAction",Mt="<unnamed action>",xt=X(It),Nt=X("action.bound",{bound:!0}),Ft=X(Ot,{autoAction:!0}),Bt=X("autoAction.bound",{autoAction:!0,bound:!0});function jt(e){return function(t,r){return v(t)?Be(t.name||Mt,t,e):v(r)?Be(t,r,e):_(r)?G(t,r,e?Ft:xt):_(t)?V(X(e?Ot:It,{name:t,autoAction:e})):void 0}}var Ut=jt(!1);Object.assign(Ut,xt);var Vt=jt(!0);function Gt(e){return je(e.name,!1,e,this,void 0)}function Ht(e){return v(e)&&!0===e.isMobxAction}function Kt(e,t){var r,i,n,s,a;void 0===t&&(t=u);var o,c=null!=(r=null==(i=t)?void 0:i.name)?r:"Autorun";if(t.scheduler||t.delay){var l=Wt(t),d=!1;o=new Tt(c,(function(){d||(d=!0,l((function(){d=!1,o.isDisposed_||o.track(h)})))}),t.onError,t.requiresObservable)}else o=new Tt(c,(function(){this.track(h)}),t.onError,t.requiresObservable);function h(){e(o)}return null!=(n=t)&&null!=(s=n.signal)&&s.aborted||o.schedule_(),o.getDisposer_(null==(a=t)?void 0:a.signal)}Object.assign(Vt,Ft),Ut.bound=V(Nt),Vt.bound=V(Bt);var qt=function(e){return e()};function Wt(e){return e.scheduler?e.scheduler:e.delay?function(t){return setTimeout(t,e.delay)}:qt}function zt(e,t,r){var i,n,s,a;void 0===r&&(r=u);var o,c,l,d,h=null!=(i=r.name)?i:"Reaction",p=Ut(h,r.onError?(o=r.onError,c=t,function(){try{return c.apply(this,arguments)}catch(e){o.call(this,e)}}):t),f=!r.scheduler&&!r.delay,m=Wt(r),g=!0,v=!1,_=r.compareStructural?z.structural:r.equals||z.default,y=new Tt(h,(function(){g||f?b():v||(v=!0,m(b))}),r.onError,r.requiresObservable);function b(){if(v=!1,!y.isDisposed_){var t=!1;y.track((function(){var r=Ge(!1,(function(){return e(y)}));t=g||!_(l,r),d=l,l=r})),(g&&r.fireImmediately||!g&&t)&&p(l,d,y),g=!1}}return null!=(n=r)&&null!=(s=n.signal)&&s.aborted||y.schedule_(),y.getDisposer_(null==(a=r)?void 0:a.signal)}var $t="onBO",Yt="onBUO";function Qt(e,t,r){return Xt($t,e,t,r)}function Jt(e,t,r){return Xt(Yt,e,t,r)}function Xt(e,t,r,i){var n="function"==typeof i?Gi(t,r):Gi(t),s=v(i)?i:r,a=e+"L";return n[a]?n[a].add(s):n[a]=new Set([s]),function(){var e=n[a];e&&(e.delete(s),0===e.size&&delete n[a])}}var Zt="never",er="always",tr="observed";function rr(e){!0===e.isolateGlobalState&&function(){if((ft.pendingReactions.length||ft.inBatch||ft.isRunningReactions)&&i(36),pt=!0,ht){var e=s();0==--e.__mobxInstanceCount&&(e.__mobxGlobals=void 0),ft=new ut}}();var t,r,n=e.useProxies,a=e.enforceActions;if(void 0!==n&&(ft.useProxies=n===er||n!==Zt&&"undefined"!=typeof Proxy),"ifavailable"===n&&(ft.verifyProxies=!0),void 0!==a){var o=a===er?er:a===tr;ft.enforceActions=o,ft.allowStateChanges=!0!==o&&o!==er}["computedRequiresReaction","reactionRequiresObservable","observableRequiresReaction","disableErrorBoundaries","safeDescriptors"].forEach((function(t){t in e&&(ft[t]=!!e[t])})),ft.allowStateReads=!ft.observableRequiresReaction,e.reactionScheduler&&(t=e.reactionScheduler,r=At,At=function(e){return t((function(){return r(e)}))})}function ir(e,t,r,i){var n=k(t);return qi((function(){var t=Ci(e,i)[H];P(n).forEach((function(e){t.extend_(e,n[e],!r||!(e in r)||r[e])}))})),e}function nr(e,t){return sr(Gi(e,t))}function sr(e){var t,r={name:e.name_};return e.observing_&&e.observing_.length>0&&(r.dependencies=(t=e.observing_,Array.from(new Set(t))).map(sr)),r}function ar(e,t){return or(Gi(e,t))}function or(e){var t={name:e.name_};return function(e){return e.observers_&&e.observers_.size>0}(e)&&(t.observers=Array.from(function(e){return e.observers_}(e)).map(or)),t}var cr=0;function lr(){this.message="FLOW_CANCELLED"}function dr(e){return e instanceof lr}lr.prototype=Object.create(Error.prototype);var ur=re("flow"),hr=re("flow.bound",{bound:!0}),pr=Object.assign((function(e,t){if(_(t))return G(e,t,ur);var r=e,i=r.name||"<unnamed flow>",n=function(){var e,t=arguments,n=++cr,s=Ut(i+" - runid: "+n+" - init",r).apply(this,t),a=void 0,o=new Promise((function(t,r){var o=0;function c(e){var t;a=void 0;try{t=Ut(i+" - runid: "+n+" - yield "+o++,s.next).call(s,e)}catch(e){return r(e)}d(t)}function l(e){var t;a=void 0;try{t=Ut(i+" - runid: "+n+" - yield "+o++,s.throw).call(s,e)}catch(e){return r(e)}d(t)}function d(e){if(!v(null==e?void 0:e.then))return e.done?t(e.value):(a=Promise.resolve(e.value)).then(c,l);e.then(d,r)}e=r,c(void 0)}));return o.cancel=Ut(i+" - runid: "+n+" - cancel",(function(){try{a&&fr(a);var t=s.return(void 0),r=Promise.resolve(t.value);r.then(g,g),fr(r),e(new lr)}catch(t){e(t)}})),o};return n.isMobXFlow=!0,n}),ur);function fr(e){v(e.cancel)&&e.cancel()}function mr(e){return e}function gr(e){return!0===(null==e?void 0:e.isMobXFlow)}function vr(e,t,r){var i;return yi(e)||hi(e)||ze(e)?i=Hi(e):Di(e)&&(i=Hi(e,t)),i.dehancer="function"==typeof t?t:r,function(){i.dehancer=void 0}}function _r(e,t,r){return v(r)?function(e,t,r){return Hi(e,t).intercept_(r)}(e,t,r):function(e,t){return Hi(e).intercept_(t)}(e,t)}function yr(e,t){if(void 0===t)return Je(e);if(!1===Di(e))return!1;if(!e[H].values_.has(t))return!1;var r=Gi(e,t);return Je(r)}function br(e){return yr(e)}function Er(e,t){return yr(e,t)}function Sr(e,t){return!!e&&(void 0!==t?!!Di(e)&&e[H].values_.has(t):Di(e)||!!e[H]||q(e)||Lt(e)||Je(e))}function wr(e){return Sr(e)}function Tr(e,t){return Sr(e,t)}function Rr(e){return Di(e)?e[H].keys_():yi(e)||Si(e)?Array.from(e.keys()):hi(e)?e.map((function(e,t){return t})):void i(5)}function Cr(e){return Di(e)?Rr(e).map((function(t){return e[t]})):yi(e)?Rr(e).map((function(t){return e.get(t)})):Si(e)?Array.from(e.values()):hi(e)?e.slice():void i(6)}function Ar(e){return Di(e)?Rr(e).map((function(t){return[t,e[t]]})):yi(e)?Rr(e).map((function(t){return[t,e.get(t)]})):Si(e)?Array.from(e.entries()):hi(e)?e.map((function(e,t){return[t,e]})):void i(7)}function Pr(e,t,r){if(2!==arguments.length||Si(e))Di(e)?e[H].set_(t,r):yi(e)?e.set(t,r):Si(e)?e.add(t):hi(e)?("number"!=typeof t&&(t=parseInt(t,10)),t<0&&i("Invalid index: '"+t+"'"),bt(),t>=e.length&&(e.length=t+1),e[t]=r,Et()):i(8);else{bt();var n=t;try{for(var s in n)Pr(e,s,n[s])}finally{Et()}}}function Dr(e,t){Di(e)?e[H].delete_(t):yi(e)||Si(e)?e.delete(t):hi(e)?("number"!=typeof t&&(t=parseInt(t,10)),e.splice(t,1)):i(9)}function Lr(e,t){return Di(e)?e[H].has_(t):yi(e)||Si(e)?e.has(t):hi(e)?t>=0&&t<e.length:void i(10)}function kr(e,t){if(Lr(e,t))return Di(e)?e[H].get_(t):yi(e)?e.get(t):hi(e)?e[t]:void i(11)}function Ir(e,t,r){if(Di(e))return e[H].defineProperty_(t,r);i(39)}function Or(e){if(Di(e))return e[H].ownKeys_();i(38)}function Mr(e,t,r,i){return v(r)?function(e,t,r,i){return Hi(e,t).observe_(r,i)}(e,t,r,i):function(e,t,r){return Hi(e).observe_(t,r)}(e,t,r)}function xr(e,t,r){return e.set(t,r),r}function Nr(e,t){if(null==e||"object"!=typeof e||e instanceof Date||!wr(e))return e;if(ze(e)||Je(e))return Nr(e.get(),t);if(t.has(e))return t.get(e);if(hi(e)){var r=xr(t,e,new Array(e.length));return e.forEach((function(e,i){r[i]=Nr(e,t)})),r}if(Si(e)){var i=xr(t,e,new Set);return e.forEach((function(e){i.add(Nr(e,t))})),i}if(yi(e)){var n=xr(t,e,new Map);return e.forEach((function(e,r){n.set(r,Nr(e,t))})),n}var s=xr(t,e,{});return Or(e).forEach((function(r){l.propertyIsEnumerable.call(e,r)&&(s[r]=Nr(e[r],t))})),s}function Fr(e,t){return Nr(e,new Map)}function Br(){}function jr(e,t){void 0===t&&(t=void 0),bt();try{return e.apply(t)}finally{Et()}}function Ur(e,t,r){return 1===arguments.length||t&&"object"==typeof t?function(e,t){var r,i,n;if(null!=t&&null!=(r=t.signal)&&r.aborted)return Object.assign(Promise.reject(new Error("WHEN_ABORTED")),{cancel:function(){return null}});var s=new Promise((function(r,s){var a,o=Vr(e,r,M({},t,{onError:s}));i=function(){o(),s(new Error("WHEN_CANCELLED"))},n=function(){o(),s(new Error("WHEN_ABORTED"))},null==t||null==(a=t.signal)||null==a.addEventListener||a.addEventListener("abort",n)})).finally((function(){var e;return null==t||null==(e=t.signal)||null==e.removeEventListener?void 0:e.removeEventListener("abort",n)}));return s.cancel=i,s}(e,t):Vr(e,t,r||{})}function Vr(e,t,r){var i;if("number"==typeof r.timeout){var n=new Error("WHEN_TIMEOUT");i=setTimeout((function(){if(!a[H].isDisposed_){if(a(),!r.onError)throw n;r.onError(n)}}),r.timeout)}r.name="When";var s=Be("When-effect",t),a=Kt((function(t){Ge(!1,e)&&(t.dispose(),i&&clearTimeout(i),s())}),r);return a}function Gr(e){return e[H]}pr.bound=V(hr);var Hr={has:function(e,t){return Gr(e).has_(t)},get:function(e,t){return Gr(e).get_(t)},set:function(e,t,r){var i;return!!_(t)&&(null==(i=Gr(e).set_(t,r,!0))||i)},deleteProperty:function(e,t){var r;return!!_(t)&&(null==(r=Gr(e).delete_(t,!0))||r)},defineProperty:function(e,t,r){var i;return null==(i=Gr(e).defineProperty_(t,r))||i},ownKeys:function(e){return Gr(e).ownKeys_()},preventExtensions:function(e){i(13)}};function Kr(e){return void 0!==e.interceptors_&&e.interceptors_.length>0}function qr(e,t){var r=e.interceptors_||(e.interceptors_=[]);return r.push(t),m((function(){var e=r.indexOf(t);-1!==e&&r.splice(e,1)}))}function Wr(e,t){var r=st();try{for(var n=[].concat(e.interceptors_||[]),s=0,a=n.length;s<a&&((t=n[s](t))&&!t.type&&i(14),t);s++);return t}finally{at(r)}}function zr(e){return void 0!==e.changeListeners_&&e.changeListeners_.length>0}function $r(e,t){var r=e.changeListeners_||(e.changeListeners_=[]);return r.push(t),m((function(){var e=r.indexOf(t);-1!==e&&r.splice(e,1)}))}function Yr(e,t){var r=st(),i=e.changeListeners_;if(i){for(var n=0,s=(i=i.slice()).length;n<s;n++)i[n](t);at(r)}}function Qr(e,t,r){return qi((function(){var i=Ci(e,r)[H];null!=t||(t=function(e){return L(e,U)||S(e,U,M({},e[U])),e[U]}(e)),P(t).forEach((function(e){return i.make_(e,t[e])}))})),e}var Jr=Symbol("mobx-keys");function Xr(e,t,r){return b(e)?ir(e,e,t,r):(qi((function(){var i=Ci(e,r)[H];if(!e[Jr]){var n=Object.getPrototypeOf(e),s=new Set([].concat(P(e),P(n)));s.delete("constructor"),s.delete(H),S(n,Jr,s)}e[Jr].forEach((function(e){return i.make_(e,!t||!(e in t)||t[e])}))})),e)}var Zr="splice",ei="update",ti={get:function(e,t){var r=e[H];return t===H?r:"length"===t?r.getArrayLength_():"string"!=typeof t||isNaN(t)?L(ni,t)?ni[t]:e[t]:r.get_(parseInt(t))},set:function(e,t,r){var i=e[H];return"length"===t&&i.setArrayLength_(r),"symbol"==typeof t||isNaN(t)?e[t]=r:i.set_(parseInt(t),r),!0},preventExtensions:function(){i(15)}},ri=function(){function e(e,t,r,i){void 0===e&&(e="ObservableArray"),this.owned_=void 0,this.legacyMode_=void 0,this.atom_=void 0,this.values_=[],this.interceptors_=void 0,this.changeListeners_=void 0,this.enhancer_=void 0,this.dehancer=void 0,this.proxy_=void 0,this.lastKnownLength_=0,this.owned_=r,this.legacyMode_=i,this.atom_=new K(e),this.enhancer_=function(e,r){return t(e,r,"ObservableArray[..]")}}var t=e.prototype;return t.dehanceValue_=function(e){return void 0!==this.dehancer?this.dehancer(e):e},t.dehanceValues_=function(e){return void 0!==this.dehancer&&e.length>0?e.map(this.dehancer):e},t.intercept_=function(e){return qr(this,e)},t.observe_=function(e,t){return void 0===t&&(t=!1),t&&e({observableKind:"array",object:this.proxy_,debugObjectName:this.atom_.name_,type:"splice",index:0,added:this.values_.slice(),addedCount:this.values_.length,removed:[],removedCount:0}),$r(this,e)},t.getArrayLength_=function(){return this.atom_.reportObserved(),this.values_.length},t.setArrayLength_=function(e){("number"!=typeof e||isNaN(e)||e<0)&&i("Out of range: "+e);var t=this.values_.length;if(e!==t)if(e>t){for(var r=new Array(e-t),n=0;n<e-t;n++)r[n]=void 0;this.spliceWithArray_(t,0,r)}else this.spliceWithArray_(e,t-e)},t.updateArrayLength_=function(e,t){e!==this.lastKnownLength_&&i(16),this.lastKnownLength_+=t,this.legacyMode_&&t>0&&Ui(e+t+1)},t.spliceWithArray_=function(e,t,r){var i=this;this.atom_;var n=this.values_.length;if(void 0===e?e=0:e>n?e=n:e<0&&(e=Math.max(0,n+e)),t=1===arguments.length?n-e:null==t?0:Math.max(0,Math.min(t,n-e)),void 0===r&&(r=d),Kr(this)){var s=Wr(this,{object:this.proxy_,type:Zr,index:e,removedCount:t,added:r});if(!s)return d;t=s.removedCount,r=s.added}if(r=0===r.length?r:r.map((function(e){return i.enhancer_(e,void 0)})),this.legacyMode_){var a=r.length-t;this.updateArrayLength_(n,a)}var o=this.spliceItemsIntoValues_(e,t,r);return 0===t&&0===r.length||this.notifyArraySplice_(e,r,o),this.dehanceValues_(o)},t.spliceItemsIntoValues_=function(e,t,r){var i;if(r.length<1e4)return(i=this.values_).splice.apply(i,[e,t].concat(r));var n=this.values_.slice(e,e+t),s=this.values_.slice(e+t);this.values_.length+=r.length-t;for(var a=0;a<r.length;a++)this.values_[e+a]=r[a];for(var o=0;o<s.length;o++)this.values_[e+r.length+o]=s[o];return n},t.notifyArrayChildUpdate_=function(e,t,r){var i=!this.owned_&&!1,n=zr(this),s=n||i?{observableKind:"array",object:this.proxy_,type:ei,debugObjectName:this.atom_.name_,index:e,newValue:t,oldValue:r}:null;this.atom_.reportChanged(),n&&Yr(this,s)},t.notifyArraySplice_=function(e,t,r){var i=!this.owned_&&!1,n=zr(this),s=n||i?{observableKind:"array",object:this.proxy_,debugObjectName:this.atom_.name_,type:Zr,index:e,removed:r,added:t,removedCount:r.length,addedCount:t.length}:null;this.atom_.reportChanged(),n&&Yr(this,s)},t.get_=function(e){if(!(this.legacyMode_&&e>=this.values_.length))return this.atom_.reportObserved(),this.dehanceValue_(this.values_[e]);console.warn("[mobx] Out of bounds read: "+e)},t.set_=function(e,t){var r=this.values_;if(this.legacyMode_&&e>r.length&&i(17,e,r.length),e<r.length){this.atom_;var n=r[e];if(Kr(this)){var s=Wr(this,{type:ei,object:this.proxy_,index:e,newValue:t});if(!s)return;t=s.newValue}(t=this.enhancer_(t,n))!==n&&(r[e]=t,this.notifyArrayChildUpdate_(e,t,n))}else{for(var a=new Array(e+1-r.length),o=0;o<a.length-1;o++)a[o]=void 0;a[a.length-1]=t,this.spliceWithArray_(r.length,0,a)}},e}();function ii(e,t,r,i){return void 0===r&&(r="ObservableArray"),void 0===i&&(i=!1),f(),qi((function(){var n=new ri(r,t,i,!1);w(n.values_,H,n);var s=new Proxy(n.values_,ti);return n.proxy_=s,e&&e.length&&n.spliceWithArray_(0,0,e),s}))}var ni={clear:function(){return this.splice(0)},replace:function(e){var t=this[H];return t.spliceWithArray_(0,t.values_.length,e)},toJSON:function(){return this.slice()},splice:function(e,t){for(var r=arguments.length,i=new Array(r>2?r-2:0),n=2;n<r;n++)i[n-2]=arguments[n];var s=this[H];switch(arguments.length){case 0:return[];case 1:return s.spliceWithArray_(e);case 2:return s.spliceWithArray_(e,t)}return s.spliceWithArray_(e,t,i)},spliceWithArray:function(e,t,r){return this[H].spliceWithArray_(e,t,r)},push:function(){for(var e=this[H],t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return e.spliceWithArray_(e.values_.length,0,r),e.values_.length},pop:function(){return this.splice(Math.max(this[H].values_.length-1,0),1)[0]},shift:function(){return this.splice(0,1)[0]},unshift:function(){for(var e=this[H],t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return e.spliceWithArray_(0,0,r),e.values_.length},reverse:function(){return ft.trackingDerivation&&i(37,"reverse"),this.replace(this.slice().reverse()),this},sort:function(){ft.trackingDerivation&&i(37,"sort");var e=this.slice();return e.sort.apply(e,arguments),this.replace(e),this},remove:function(e){var t=this[H],r=t.dehanceValues_(t.values_).indexOf(e);return r>-1&&(this.splice(r,1),!0)}};function si(e,t){"function"==typeof Array.prototype[e]&&(ni[e]=t(e))}function ai(e){return function(){var t=this[H];t.atom_.reportObserved();var r=t.dehanceValues_(t.values_);return r[e].apply(r,arguments)}}function oi(e){return function(t,r){var i=this,n=this[H];return n.atom_.reportObserved(),n.dehanceValues_(n.values_)[e]((function(e,n){return t.call(r,e,n,i)}))}}function ci(e){return function(){var t=this,r=this[H];r.atom_.reportObserved();var i=r.dehanceValues_(r.values_),n=arguments[0];return arguments[0]=function(e,r,i){return n(e,r,i,t)},i[e].apply(i,arguments)}}si("concat",ai),si("flat",ai),si("includes",ai),si("indexOf",ai),si("join",ai),si("lastIndexOf",ai),si("slice",ai),si("toString",ai),si("toLocaleString",ai),si("every",oi),si("filter",oi),si("find",oi),si("findIndex",oi),si("flatMap",oi),si("forEach",oi),si("map",oi),si("some",oi),si("reduce",ci),si("reduceRight",ci);var li,di,ui=T("ObservableArrayAdministration",ri);function hi(e){return y(e)&&ui(e[H])}var pi={},fi="add",mi="delete";li=Symbol.iterator,di=Symbol.toStringTag;var gi,vi,_i=function(){function e(e,t,r){var n=this;void 0===t&&(t=$),void 0===r&&(r="ObservableMap"),this.enhancer_=void 0,this.name_=void 0,this[H]=pi,this.data_=void 0,this.hasMap_=void 0,this.keysAtom_=void 0,this.interceptors_=void 0,this.changeListeners_=void 0,this.dehancer=void 0,this.enhancer_=t,this.name_=r,v(Map)||i(18),qi((function(){n.keysAtom_=W("ObservableMap.keys()"),n.data_=new Map,n.hasMap_=new Map,e&&n.merge(e)}))}var t=e.prototype;return t.has_=function(e){return this.data_.has(e)},t.has=function(e){var t=this;if(!ft.trackingDerivation)return this.has_(e);var r=this.hasMap_.get(e);if(!r){var i=r=new We(this.has_(e),Y,"ObservableMap.key?",!1);this.hasMap_.set(e,i),Jt(i,(function(){return t.hasMap_.delete(e)}))}return r.get()},t.set=function(e,t){var r=this.has_(e);if(Kr(this)){var i=Wr(this,{type:r?ei:fi,object:this,newValue:t,name:e});if(!i)return this;t=i.newValue}return r?this.updateValue_(e,t):this.addValue_(e,t),this},t.delete=function(e){var t=this;if(this.keysAtom_,Kr(this)&&!Wr(this,{type:mi,object:this,name:e}))return!1;if(this.has_(e)){var r=zr(this),i=r?{observableKind:"map",debugObjectName:this.name_,type:mi,object:this,oldValue:this.data_.get(e).value_,name:e}:null;return jr((function(){var r;t.keysAtom_.reportChanged(),null==(r=t.hasMap_.get(e))||r.setNewValue_(!1),t.data_.get(e).setNewValue_(void 0),t.data_.delete(e)})),r&&Yr(this,i),!0}return!1},t.updateValue_=function(e,t){var r=this.data_.get(e);if((t=r.prepareNewValue_(t))!==ft.UNCHANGED){var i=zr(this),n=i?{observableKind:"map",debugObjectName:this.name_,type:ei,object:this,oldValue:r.value_,name:e,newValue:t}:null;r.setNewValue_(t),i&&Yr(this,n)}},t.addValue_=function(e,t){var r=this;this.keysAtom_,jr((function(){var i,n=new We(t,r.enhancer_,"ObservableMap.key",!1);r.data_.set(e,n),t=n.value_,null==(i=r.hasMap_.get(e))||i.setNewValue_(!0),r.keysAtom_.reportChanged()}));var i=zr(this),n=i?{observableKind:"map",debugObjectName:this.name_,type:fi,object:this,name:e,newValue:t}:null;i&&Yr(this,n)},t.get=function(e){return this.has(e)?this.dehanceValue_(this.data_.get(e).get()):this.dehanceValue_(void 0)},t.dehanceValue_=function(e){return void 0!==this.dehancer?this.dehancer(e):e},t.keys=function(){return this.keysAtom_.reportObserved(),this.data_.keys()},t.values=function(){var e=this,t=this.keys();return Qi({next:function(){var r=t.next(),i=r.done,n=r.value;return{done:i,value:i?void 0:e.get(n)}}})},t.entries=function(){var e=this,t=this.keys();return Qi({next:function(){var r=t.next(),i=r.done,n=r.value;return{done:i,value:i?void 0:[n,e.get(n)]}}})},t[li]=function(){return this.entries()},t.forEach=function(e,t){for(var r,i=j(this);!(r=i()).done;){var n=r.value,s=n[0],a=n[1];e.call(t,a,s,this)}},t.merge=function(e){var t=this;return yi(e)&&(e=new Map(e)),jr((function(){b(e)?function(e){var t=Object.keys(e);if(!A)return t;var r=Object.getOwnPropertySymbols(e);return r.length?[].concat(t,r.filter((function(t){return l.propertyIsEnumerable.call(e,t)}))):t}(e).forEach((function(r){return t.set(r,e[r])})):Array.isArray(e)?e.forEach((function(e){var r=e[0],i=e[1];return t.set(r,i)})):R(e)?(e.constructor!==Map&&i(19,e),e.forEach((function(e,r){return t.set(r,e)}))):null!=e&&i(20,e)})),this},t.clear=function(){var e=this;jr((function(){nt((function(){for(var t,r=j(e.keys());!(t=r()).done;){var i=t.value;e.delete(i)}}))}))},t.replace=function(e){var t=this;return jr((function(){for(var r,n=function(e){if(R(e)||yi(e))return e;if(Array.isArray(e))return new Map(e);if(b(e)){var t=new Map;for(var r in e)t.set(r,e[r]);return t}return i(21,e)}(e),s=new Map,a=!1,o=j(t.data_.keys());!(r=o()).done;){var c=r.value;if(!n.has(c))if(t.delete(c))a=!0;else{var l=t.data_.get(c);s.set(c,l)}}for(var d,u=j(n.entries());!(d=u()).done;){var h=d.value,p=h[0],f=h[1],m=t.data_.has(p);if(t.set(p,f),t.data_.has(p)){var g=t.data_.get(p);s.set(p,g),m||(a=!0)}}if(!a)if(t.data_.size!==s.size)t.keysAtom_.reportChanged();else for(var v=t.data_.keys(),_=s.keys(),y=v.next(),E=_.next();!y.done;){if(y.value!==E.value){t.keysAtom_.reportChanged();break}y=v.next(),E=_.next()}t.data_=s})),this},t.toString=function(){return"[object ObservableMap]"},t.toJSON=function(){return Array.from(this)},t.observe_=function(e,t){return $r(this,e)},t.intercept_=function(e){return qr(this,e)},O(e,[{key:"size",get:function(){return this.keysAtom_.reportObserved(),this.data_.size}},{key:di,get:function(){return"Map"}}]),e}(),yi=T("ObservableMap",_i),bi={};gi=Symbol.iterator,vi=Symbol.toStringTag;var Ei=function(){function e(e,t,r){var n=this;void 0===t&&(t=$),void 0===r&&(r="ObservableSet"),this.name_=void 0,this[H]=bi,this.data_=new Set,this.atom_=void 0,this.changeListeners_=void 0,this.interceptors_=void 0,this.dehancer=void 0,this.enhancer_=void 0,this.name_=r,v(Set)||i(22),this.enhancer_=function(e,i){return t(e,i,r)},qi((function(){n.atom_=W(n.name_),e&&n.replace(e)}))}var t=e.prototype;return t.dehanceValue_=function(e){return void 0!==this.dehancer?this.dehancer(e):e},t.clear=function(){var e=this;jr((function(){nt((function(){for(var t,r=j(e.data_.values());!(t=r()).done;){var i=t.value;e.delete(i)}}))}))},t.forEach=function(e,t){for(var r,i=j(this);!(r=i()).done;){var n=r.value;e.call(t,n,n,this)}},t.add=function(e){var t=this;if(this.atom_,Kr(this)&&!Wr(this,{type:fi,object:this,newValue:e}))return this;if(!this.has(e)){jr((function(){t.data_.add(t.enhancer_(e,void 0)),t.atom_.reportChanged()}));var r=zr(this),i=r?{observableKind:"set",debugObjectName:this.name_,type:fi,object:this,newValue:e}:null;r&&Yr(this,i)}return this},t.delete=function(e){var t=this;if(Kr(this)&&!Wr(this,{type:mi,object:this,oldValue:e}))return!1;if(this.has(e)){var r=zr(this),i=r?{observableKind:"set",debugObjectName:this.name_,type:mi,object:this,oldValue:e}:null;return jr((function(){t.atom_.reportChanged(),t.data_.delete(e)})),r&&Yr(this,i),!0}return!1},t.has=function(e){return this.atom_.reportObserved(),this.data_.has(this.dehanceValue_(e))},t.entries=function(){var e=0,t=Array.from(this.keys()),r=Array.from(this.values());return Qi({next:function(){var i=e;return e+=1,i<r.length?{value:[t[i],r[i]],done:!1}:{done:!0}}})},t.keys=function(){return this.values()},t.values=function(){this.atom_.reportObserved();var e=this,t=0,r=Array.from(this.data_.values());return Qi({next:function(){return t<r.length?{value:e.dehanceValue_(r[t++]),done:!1}:{done:!0}}})},t.replace=function(e){var t=this;return Si(e)&&(e=new Set(e)),jr((function(){Array.isArray(e)||C(e)?(t.clear(),e.forEach((function(e){return t.add(e)}))):null!=e&&i("Cannot initialize set from "+e)})),this},t.observe_=function(e,t){return $r(this,e)},t.intercept_=function(e){return qr(this,e)},t.toJSON=function(){return Array.from(this)},t.toString=function(){return"[object ObservableSet]"},t[gi]=function(){return this.values()},O(e,[{key:"size",get:function(){return this.atom_.reportObserved(),this.data_.size}},{key:vi,get:function(){return"Set"}}]),e}(),Si=T("ObservableSet",Ei),wi=Object.create(null),Ti="remove",Ri=function(){function e(e,t,r,i){void 0===t&&(t=new Map),void 0===i&&(i=pe),this.target_=void 0,this.values_=void 0,this.name_=void 0,this.defaultAnnotation_=void 0,this.keysAtom_=void 0,this.changeListeners_=void 0,this.interceptors_=void 0,this.proxy_=void 0,this.isPlainObject_=void 0,this.appliedAnnotations_=void 0,this.pendingKeys_=void 0,this.target_=e,this.values_=t,this.name_=r,this.defaultAnnotation_=i,this.keysAtom_=new K("ObservableObject.keys"),this.isPlainObject_=b(this.target_)}var t=e.prototype;return t.getObservablePropValue_=function(e){return this.values_.get(e).get()},t.setObservablePropValue_=function(e,t){var r=this.values_.get(e);if(r instanceof Qe)return r.set(t),!0;if(Kr(this)){var i=Wr(this,{type:ei,object:this.proxy_||this.target_,name:e,newValue:t});if(!i)return null;t=i.newValue}if((t=r.prepareNewValue_(t))!==ft.UNCHANGED){var n=zr(this),s=n?{type:ei,observableKind:"object",debugObjectName:this.name_,object:this.proxy_||this.target_,oldValue:r.value_,name:e,newValue:t}:null;r.setNewValue_(t),n&&Yr(this,s)}return!0},t.get_=function(e){return ft.trackingDerivation&&!L(this.target_,e)&&this.has_(e),this.target_[e]},t.set_=function(e,t,r){return void 0===r&&(r=!1),L(this.target_,e)?this.values_.has(e)?this.setObservablePropValue_(e,t):r?Reflect.set(this.target_,e,t):(this.target_[e]=t,!0):this.extend_(e,{value:t,enumerable:!0,writable:!0,configurable:!0},this.defaultAnnotation_,r)},t.has_=function(e){if(!ft.trackingDerivation)return e in this.target_;this.pendingKeys_||(this.pendingKeys_=new Map);var t=this.pendingKeys_.get(e);return t||(t=new We(e in this.target_,Y,"ObservableObject.key?",!1),this.pendingKeys_.set(e,t)),t.get()},t.make_=function(e,t){if(!0===t&&(t=this.defaultAnnotation_),!1!==t){if(!(e in this.target_)){var r;if(null!=(r=this.target_[U])&&r[e])return;i(1,t.annotationType_,this.name_+"."+e.toString())}for(var n=this.target_;n&&n!==l;){var s=o(n,e);if(s){var a=t.make_(this,e,s,n);if(0===a)return;if(1===a)break}n=Object.getPrototypeOf(n)}Li(this,0,e)}},t.extend_=function(e,t,r,i){if(void 0===i&&(i=!1),!0===r&&(r=this.defaultAnnotation_),!1===r)return this.defineProperty_(e,t,i);var n=r.extend_(this,e,t,i);return n&&Li(this,0,e),n},t.defineProperty_=function(e,t,r){void 0===r&&(r=!1),this.keysAtom_;try{bt();var i=this.delete_(e);if(!i)return i;if(Kr(this)){var n=Wr(this,{object:this.proxy_||this.target_,name:e,type:fi,newValue:t.value});if(!n)return null;var s=n.newValue;t.value!==s&&(t=M({},t,{value:s}))}if(r){if(!Reflect.defineProperty(this.target_,e,t))return!1}else c(this.target_,e,t);this.notifyPropertyAddition_(e,t.value)}finally{Et()}return!0},t.defineObservableProperty_=function(e,t,r,i){void 0===i&&(i=!1),this.keysAtom_;try{bt();var n=this.delete_(e);if(!n)return n;if(Kr(this)){var s=Wr(this,{object:this.proxy_||this.target_,name:e,type:fi,newValue:t});if(!s)return null;t=s.newValue}var a=Pi(e),o={configurable:!ft.safeDescriptors||this.isPlainObject_,enumerable:!0,get:a.get,set:a.set};if(i){if(!Reflect.defineProperty(this.target_,e,o))return!1}else c(this.target_,e,o);var l=new We(t,r,"ObservableObject.key",!1);this.values_.set(e,l),this.notifyPropertyAddition_(e,l.value_)}finally{Et()}return!0},t.defineComputedProperty_=function(e,t,r){void 0===r&&(r=!1),this.keysAtom_;try{bt();var i=this.delete_(e);if(!i)return i;if(Kr(this)&&!Wr(this,{object:this.proxy_||this.target_,name:e,type:fi,newValue:void 0}))return null;t.name||(t.name="ObservableObject.key"),t.context=this.proxy_||this.target_;var n=Pi(e),s={configurable:!ft.safeDescriptors||this.isPlainObject_,enumerable:!1,get:n.get,set:n.set};if(r){if(!Reflect.defineProperty(this.target_,e,s))return!1}else c(this.target_,e,s);this.values_.set(e,new Qe(t)),this.notifyPropertyAddition_(e,void 0)}finally{Et()}return!0},t.delete_=function(e,t){if(void 0===t&&(t=!1),this.keysAtom_,!L(this.target_,e))return!0;if(Kr(this)&&!Wr(this,{object:this.proxy_||this.target_,name:e,type:Ti}))return null;try{var r,i;bt();var n,s=zr(this),a=this.values_.get(e),c=void 0;if(!a&&s&&(c=null==(n=o(this.target_,e))?void 0:n.value),t){if(!Reflect.deleteProperty(this.target_,e))return!1}else delete this.target_[e];if(a&&(this.values_.delete(e),a instanceof We&&(c=a.value_),wt(a)),this.keysAtom_.reportChanged(),null==(r=this.pendingKeys_)||null==(i=r.get(e))||i.set(e in this.target_),s){var l={type:Ti,observableKind:"object",object:this.proxy_||this.target_,debugObjectName:this.name_,oldValue:c,name:e};s&&Yr(this,l)}}finally{Et()}return!0},t.observe_=function(e,t){return $r(this,e)},t.intercept_=function(e){return qr(this,e)},t.notifyPropertyAddition_=function(e,t){var r,i,n=zr(this);if(n){var s=n?{type:fi,observableKind:"object",debugObjectName:this.name_,object:this.proxy_||this.target_,name:e,newValue:t}:null;n&&Yr(this,s)}null==(r=this.pendingKeys_)||null==(i=r.get(e))||i.set(!0),this.keysAtom_.reportChanged()},t.ownKeys_=function(){return this.keysAtom_.reportObserved(),P(this.target_)},t.keys_=function(){return this.keysAtom_.reportObserved(),Object.keys(this.target_)},e}();function Ci(e,t){var r;if(L(e,H))return e;var i=null!=(r=null==t?void 0:t.name)?r:"ObservableObject",n=new Ri(e,new Map,String(i),function(e){var t;return e?null!=(t=e.defaultDecorator)?t:fe(e):void 0}(t));return S(e,H,n),e}var Ai=T("ObservableObjectAdministration",Ri);function Pi(e){return wi[e]||(wi[e]={get:function(){return this[H].getObservablePropValue_(e)},set:function(t){return this[H].setObservablePropValue_(e,t)}})}function Di(e){return!!y(e)&&Ai(e[H])}function Li(e,t,r){var i;null==(i=e.target_[U])||delete i[r]}var ki,Ii,Oi=Bi(0),Mi=function(){var e=!1,t={};return Object.defineProperty(t,"0",{set:function(){e=!0}}),Object.create(t)[0]=1,!1===e}(),xi=0,Ni=function(){};ki=Ni,Ii=Array.prototype,Object.setPrototypeOf?Object.setPrototypeOf(ki.prototype,Ii):void 0!==ki.prototype.__proto__?ki.prototype.__proto__=Ii:ki.prototype=Ii;var Fi=function(e,t,r){function i(t,r,i,n){var s;return void 0===i&&(i="ObservableArray"),void 0===n&&(n=!1),s=e.call(this)||this,qi((function(){var e=new ri(i,r,n,!0);e.proxy_=F(s),w(F(s),H,e),t&&t.length&&s.spliceWithArray(0,0,t),Mi&&Object.defineProperty(F(s),"0",Oi)})),s}x(i,e);var n=i.prototype;return n.concat=function(){this[H].atom_.reportObserved();for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Array.prototype.concat.apply(this.slice(),t.map((function(e){return hi(e)?e.slice():e})))},n[r]=function(){var e=this,t=0;return Qi({next:function(){return t<e.length?{value:e[t++],done:!1}:{done:!0,value:void 0}}})},O(i,[{key:"length",get:function(){return this[H].getArrayLength_()},set:function(e){this[H].setArrayLength_(e)}},{key:t,get:function(){return"Array"}}]),i}(Ni,Symbol.toStringTag,Symbol.iterator);function Bi(e){return{enumerable:!1,configurable:!0,get:function(){return this[H].get_(e)},set:function(t){this[H].set_(e,t)}}}function ji(e){c(Fi.prototype,""+e,Bi(e))}function Ui(e){if(e>xi){for(var t=xi;t<e+100;t++)ji(t);xi=e}}function Vi(e,t,r){return new Fi(e,t,r)}function Gi(e,t){if("object"==typeof e&&null!==e){if(hi(e))return void 0!==t&&i(23),e[H].atom_;if(Si(e))return e.atom_;if(yi(e)){if(void 0===t)return e.keysAtom_;var r=e.data_.get(t)||e.hasMap_.get(t);return r||i(25,t,Ki(e)),r}if(Di(e)){if(!t)return i(26);var n=e[H].values_.get(t);return n||i(27,t,Ki(e)),n}if(q(e)||Je(e)||Lt(e))return e}else if(v(e)&&Lt(e[H]))return e[H];i(28)}function Hi(e,t){return e||i(29),void 0!==t?Hi(Gi(e,t)):q(e)||Je(e)||Lt(e)||yi(e)||Si(e)?e:e[H]?e[H]:void i(24,e)}function Ki(e,t){var r;if(void 0!==t)r=Gi(e,t);else{if(Ht(e))return e.name;r=Di(e)||yi(e)||Si(e)?Hi(e):Gi(e)}return r.name_}function qi(e){var t=st(),r=He(!0);bt();try{return e()}finally{Et(),Ke(r),at(t)}}Object.entries(ni).forEach((function(e){var t=e[0],r=e[1];"concat"!==t&&S(Fi.prototype,t,r)})),Ui(1e3);var Wi=l.toString;function zi(e,t,r){return void 0===r&&(r=-1),$i(e,t,r)}function $i(e,t,r,i,n){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return!1;if(e!=e)return t!=t;var s=typeof e;if("function"!==s&&"object"!==s&&"object"!=typeof t)return!1;var a=Wi.call(e);if(a!==Wi.call(t))return!1;switch(a){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object Symbol]":return"undefined"!=typeof Symbol&&Symbol.valueOf.call(e)===Symbol.valueOf.call(t);case"[object Map]":case"[object Set]":r>=0&&r++}e=Yi(e),t=Yi(t);var o="[object Array]"===a;if(!o){if("object"!=typeof e||"object"!=typeof t)return!1;var c=e.constructor,l=t.constructor;if(c!==l&&!(v(c)&&c instanceof c&&v(l)&&l instanceof l)&&"constructor"in e&&"constructor"in t)return!1}if(0===r)return!1;r<0&&(r=-1),n=n||[];for(var d=(i=i||[]).length;d--;)if(i[d]===e)return n[d]===t;if(i.push(e),n.push(t),o){if((d=e.length)!==t.length)return!1;for(;d--;)if(!$i(e[d],t[d],r-1,i,n))return!1}else{var u,h=Object.keys(e);if(d=h.length,Object.keys(t).length!==d)return!1;for(;d--;)if(!L(t,u=h[d])||!$i(e[u],t[u],r-1,i,n))return!1}return i.pop(),n.pop(),!0}function Yi(e){return hi(e)?e.slice():R(e)||yi(e)||C(e)||Si(e)?Array.from(e.entries()):e}function Qi(e){return e[Symbol.iterator]=Ji,e}function Ji(){return this}["Symbol","Map","Set"].forEach((function(e){void 0===s()[e]&&i("MobX requires global '"+e+"' to be available or polyfilled")})),"object"==typeof __MOBX_DEVTOOLS_GLOBAL_HOOK__&&__MOBX_DEVTOOLS_GLOBAL_HOOK__.injectMobx({spy:kt,extras:{getDebugName:Ki},$mobx:H})},2527:e=>{window,e.exports=function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=14)}([function(e,t,r){"use strict";var i=r(6),n=r.n(i),s=function(){function e(){}return e.e=function(t,r){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var i="["+t+"] > "+r;e.ENABLE_CALLBACK&&e.emitter.emit("log","error",i),e.ENABLE_ERROR&&(console.error?console.error(i):console.warn?console.warn(i):console.log(i))},e.i=function(t,r){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var i="["+t+"] > "+r;e.ENABLE_CALLBACK&&e.emitter.emit("log","info",i),e.ENABLE_INFO&&(console.info?console.info(i):console.log(i))},e.w=function(t,r){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var i="["+t+"] > "+r;e.ENABLE_CALLBACK&&e.emitter.emit("log","warn",i),e.ENABLE_WARN&&(console.warn?console.warn(i):console.log(i))},e.d=function(t,r){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var i="["+t+"] > "+r;e.ENABLE_CALLBACK&&e.emitter.emit("log","debug",i),e.ENABLE_DEBUG&&(console.debug?console.debug(i):console.log(i))},e.v=function(t,r){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var i="["+t+"] > "+r;e.ENABLE_CALLBACK&&e.emitter.emit("log","verbose",i),e.ENABLE_VERBOSE&&console.log(i)},e}();s.GLOBAL_TAG="mpegts.js",s.FORCE_GLOBAL_TAG=!1,s.ENABLE_ERROR=!0,s.ENABLE_INFO=!0,s.ENABLE_WARN=!0,s.ENABLE_DEBUG=!0,s.ENABLE_VERBOSE=!0,s.ENABLE_CALLBACK=!1,s.emitter=new n.a,t.a=s},function(e,t,r){"use strict";t.a={IO_ERROR:"io_error",DEMUX_ERROR:"demux_error",INIT_SEGMENT:"init_segment",MEDIA_SEGMENT:"media_segment",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",TIMED_ID3_METADATA_ARRIVED:"timed_id3_metadata_arrived",SMPTE2038_METADATA_ARRIVED:"smpte2038_metadata_arrived",SCTE35_METADATA_ARRIVED:"scte35_metadata_arrived",PES_PRIVATE_DATA_DESCRIPTOR:"pes_private_data_descriptor",PES_PRIVATE_DATA_ARRIVED:"pes_private_data_arrived",STATISTICS_INFO:"statistics_info",RECOMMEND_SEEKPOINT:"recommend_seekpoint"}},function(e,t,r){"use strict";r.d(t,"c",(function(){return n})),r.d(t,"b",(function(){return s})),r.d(t,"a",(function(){return a}));var i=r(3),n={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},s={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},a=function(){function e(e){this._type=e||"undefined",this._status=n.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return e.prototype.destroy=function(){this._status=n.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null},e.prototype.isWorking=function(){return this._status===n.kConnecting||this._status===n.kBuffering},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"needStashBuffer",{get:function(){return this._needStash},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onContentLengthKnown",{get:function(){return this._onContentLengthKnown},set:function(e){this._onContentLengthKnown=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onURLRedirect",{get:function(){return this._onURLRedirect},set:function(e){this._onURLRedirect=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(e){this._onDataArrival=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onError",{get:function(){return this._onError},set:function(e){this._onError=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onComplete",{get:function(){return this._onComplete},set:function(e){this._onComplete=e},enumerable:!1,configurable:!0}),e.prototype.open=function(e,t){throw new i.c("Unimplemented abstract function!")},e.prototype.abort=function(){throw new i.c("Unimplemented abstract function!")},e}()},function(e,t,r){"use strict";r.d(t,"d",(function(){return s})),r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return o})),r.d(t,"c",(function(){return c}));var i,n=(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),s=function(){function e(e){this._message=e}return Object.defineProperty(e.prototype,"name",{get:function(){return"RuntimeException"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),e.prototype.toString=function(){return this.name+": "+this.message},e}(),a=function(e){function t(t){return e.call(this,t)||this}return n(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return"IllegalStateException"},enumerable:!1,configurable:!0}),t}(s),o=function(e){function t(t){return e.call(this,t)||this}return n(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return"InvalidArgumentException"},enumerable:!1,configurable:!0}),t}(s),c=function(e){function t(t){return e.call(this,t)||this}return n(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return"NotImplementedException"},enumerable:!1,configurable:!0}),t}(s)},function(e,t,r){"use strict";var i={};!function(){var e=self.navigator.userAgent.toLowerCase(),t=/(edge)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(iemobile)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(e)||[],r=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(android)/.exec(e)||/(windows)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||[],n={browser:t[5]||t[3]||t[1]||"",version:t[2]||t[4]||"0",majorVersion:t[4]||t[2]||"0",platform:r[0]||""},s={};if(n.browser){s[n.browser]=!0;var a=n.majorVersion.split(".");s.version={major:parseInt(n.majorVersion,10),string:n.version},a.length>1&&(s.version.minor=parseInt(a[1],10)),a.length>2&&(s.version.build=parseInt(a[2],10))}for(var o in n.platform&&(s[n.platform]=!0),(s.chrome||s.opr||s.safari)&&(s.webkit=!0),(s.rv||s.iemobile)&&(s.rv&&delete s.rv,n.browser="msie",s.msie=!0),s.edge&&(delete s.edge,n.browser="msedge",s.msedge=!0),s.opr&&(n.browser="opera",s.opera=!0),s.safari&&s.android&&(n.browser="android",s.android=!0),s.name=n.browser,s.platform=n.platform,i)i.hasOwnProperty(o)&&delete i[o];Object.assign(i,s)}(),t.a=i},function(e,t,r){"use strict";t.a={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"}},function(e,t,r){"use strict";var i,n="object"==typeof Reflect?Reflect:null,s=n&&"function"==typeof n.apply?n.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};i=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise((function(r,i){function n(r){e.removeListener(t,s),i(r)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",n),r([].slice.call(arguments))}v(e,t,s,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&v(e,"error",t,{once:!0})}(e,n)}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var c=10;function l(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function d(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function u(e,t,r,i){var n,s,a,o;if(l(r),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),s=e._events),a=s[t]),void 0===a)a=s[t]=r,++e._eventsCount;else if("function"==typeof a?a=s[t]=i?[r,a]:[a,r]:i?a.unshift(r):a.push(r),(n=d(e))>0&&a.length>n&&!a.warned){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=a.length,o=c,console&&console.warn&&console.warn(o)}return e}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(e,t,r){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},n=h.bind(i);return n.listener=r,i.wrapFn=n,n}function f(e,t,r){var i=e._events;if(void 0===i)return[];var n=i[t];return void 0===n?[]:"function"==typeof n?r?[n.listener||n]:[n]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(n):g(n,n.length)}function m(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function g(e,t){for(var r=new Array(t),i=0;i<t;++i)r[i]=e[i];return r}function v(e,t,r,i){if("function"==typeof e.on)i.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function n(s){i.once&&e.removeEventListener(t,n),r(s)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return d(this)},o.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i="error"===e,n=this._events;if(void 0!==n)i=i&&void 0===n.error;else if(!i)return!1;if(i){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var c=n[e];if(void 0===c)return!1;if("function"==typeof c)s(c,this,t);else{var l=c.length,d=g(c,l);for(r=0;r<l;++r)s(d[r],this,t)}return!0},o.prototype.addListener=function(e,t){return u(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return u(this,e,t,!0)},o.prototype.once=function(e,t){return l(t),this.on(e,p(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return l(t),this.prependListener(e,p(this,e,t)),this},o.prototype.removeListener=function(e,t){var r,i,n,s,a;if(l(t),void 0===(i=this._events))return this;if(void 0===(r=i[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(n=-1,s=r.length-1;s>=0;s--)if(r[s]===t||r[s].listener===t){a=r[s].listener,n=s;break}if(n<0)return this;0===n?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,n),1===r.length&&(i[e]=r[0]),void 0!==i.removeListener&&this.emit("removeListener",e,a||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,r,i;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var n,s=Object.keys(r);for(i=0;i<s.length;++i)"removeListener"!==(n=s[i])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},o.prototype.listeners=function(e){return f(this,e,!0)},o.prototype.rawListeners=function(e){return f(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},o.prototype.listenerCount=m,o.prototype.eventNames=function(){return this._eventsCount>0?i(this._events):[]}},function(e,t,r){"use strict";r.d(t,"d",(function(){return i})),r.d(t,"b",(function(){return n})),r.d(t,"a",(function(){return s})),r.d(t,"c",(function(){return a}));var i=function(e,t,r,i,n){this.dts=e,this.pts=t,this.duration=r,this.originalDts=i,this.isSyncPoint=n,this.fileposition=null},n=function(){function e(){this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return e.prototype.appendSyncPoint=function(e){e.isSyncPoint=!0,this.syncPoints.push(e)},e}(),s=function(){function e(){this._list=[]}return e.prototype.clear=function(){this._list=[]},e.prototype.appendArray=function(e){var t=this._list;0!==e.length&&(t.length>0&&e[0].originalDts<t[t.length-1].originalDts&&this.clear(),Array.prototype.push.apply(t,e))},e.prototype.getLastSyncPointBeforeDts=function(e){if(0==this._list.length)return null;var t=this._list,r=0,i=t.length-1,n=0,s=0,a=i;for(e<t[0].dts&&(r=0,s=a+1);s<=a;){if((n=s+Math.floor((a-s)/2))===i||e>=t[n].dts&&e<t[n+1].dts){r=n;break}t[n].dts<e?s=n+1:a=n-1}return this._list[r]},e}(),a=function(){function e(e){this._type=e,this._list=[],this._lastAppendLocation=-1}return Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),e.prototype.isEmpty=function(){return 0===this._list.length},e.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},e.prototype._searchNearestSegmentBefore=function(e){var t=this._list;if(0===t.length)return-2;var r=t.length-1,i=0,n=0,s=r,a=0;if(e<t[0].originalBeginDts)return-1;for(;n<=s;){if((i=n+Math.floor((s-n)/2))===r||e>t[i].lastSample.originalDts&&e<t[i+1].originalBeginDts){a=i;break}t[i].originalBeginDts<e?n=i+1:s=i-1}return a},e.prototype._searchNearestSegmentAfter=function(e){return this._searchNearestSegmentBefore(e)+1},e.prototype.append=function(e){var t=this._list,r=e,i=this._lastAppendLocation,n=0;-1!==i&&i<t.length&&r.originalBeginDts>=t[i].lastSample.originalDts&&(i===t.length-1||i<t.length-1&&r.originalBeginDts<t[i+1].originalBeginDts)?n=i+1:t.length>0&&(n=this._searchNearestSegmentBefore(r.originalBeginDts)+1),this._lastAppendLocation=n,this._list.splice(n,0,r)},e.prototype.getLastSegmentBefore=function(e){var t=this._searchNearestSegmentBefore(e);return t>=0?this._list[t]:null},e.prototype.getLastSampleBefore=function(e){var t=this.getLastSegmentBefore(e);return null!=t?t.lastSample:null},e.prototype.getLastSyncPointBefore=function(e){for(var t=this._searchNearestSegmentBefore(e),r=this._list[t].syncPoints;0===r.length&&t>0;)t--,r=this._list[t].syncPoints;return r.length>0?r[r.length-1]:null},e}()},function(e,t,r){"use strict";var i=function(){function e(){this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return e.prototype.isComplete=function(){var e=!1===this.hasAudio||!0===this.hasAudio&&null!=this.audioCodec&&null!=this.audioSampleRate&&null!=this.audioChannelCount,t=!1===this.hasVideo||!0===this.hasVideo&&null!=this.videoCodec&&null!=this.width&&null!=this.height&&null!=this.fps&&null!=this.profile&&null!=this.level&&null!=this.refFrames&&null!=this.chromaFormat&&null!=this.sarNum&&null!=this.sarDen;return null!=this.mimeType&&e&&t},e.prototype.isSeekable=function(){return!0===this.hasKeyframesIndex},e.prototype.getNearestKeyframe=function(e){if(null==this.keyframesIndex)return null;var t=this.keyframesIndex,r=this._search(t.times,e);return{index:r,milliseconds:t.times[r],fileposition:t.filepositions[r]}},e.prototype._search=function(e,t){var r=0,i=e.length-1,n=0,s=0,a=i;for(t<e[0]&&(r=0,s=a+1);s<=a;){if((n=s+Math.floor((a-s)/2))===i||t>=e[n]&&t<e[n+1]){r=n;break}e[n]<t?s=n+1:a=n-1}return r},e}();t.a=i},function(e,t,r){"use strict";var i=r(6),n=r.n(i),s=r(0),a=function(){function e(){}return Object.defineProperty(e,"forceGlobalTag",{get:function(){return s.a.FORCE_GLOBAL_TAG},set:function(t){s.a.FORCE_GLOBAL_TAG=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"globalTag",{get:function(){return s.a.GLOBAL_TAG},set:function(t){s.a.GLOBAL_TAG=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableAll",{get:function(){return s.a.ENABLE_VERBOSE&&s.a.ENABLE_DEBUG&&s.a.ENABLE_INFO&&s.a.ENABLE_WARN&&s.a.ENABLE_ERROR},set:function(t){s.a.ENABLE_VERBOSE=t,s.a.ENABLE_DEBUG=t,s.a.ENABLE_INFO=t,s.a.ENABLE_WARN=t,s.a.ENABLE_ERROR=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableDebug",{get:function(){return s.a.ENABLE_DEBUG},set:function(t){s.a.ENABLE_DEBUG=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableVerbose",{get:function(){return s.a.ENABLE_VERBOSE},set:function(t){s.a.ENABLE_VERBOSE=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableInfo",{get:function(){return s.a.ENABLE_INFO},set:function(t){s.a.ENABLE_INFO=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableWarn",{get:function(){return s.a.ENABLE_WARN},set:function(t){s.a.ENABLE_WARN=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableError",{get:function(){return s.a.ENABLE_ERROR},set:function(t){s.a.ENABLE_ERROR=t,e._notifyChange()},enumerable:!1,configurable:!0}),e.getConfig=function(){return{globalTag:s.a.GLOBAL_TAG,forceGlobalTag:s.a.FORCE_GLOBAL_TAG,enableVerbose:s.a.ENABLE_VERBOSE,enableDebug:s.a.ENABLE_DEBUG,enableInfo:s.a.ENABLE_INFO,enableWarn:s.a.ENABLE_WARN,enableError:s.a.ENABLE_ERROR,enableCallback:s.a.ENABLE_CALLBACK}},e.applyConfig=function(e){s.a.GLOBAL_TAG=e.globalTag,s.a.FORCE_GLOBAL_TAG=e.forceGlobalTag,s.a.ENABLE_VERBOSE=e.enableVerbose,s.a.ENABLE_DEBUG=e.enableDebug,s.a.ENABLE_INFO=e.enableInfo,s.a.ENABLE_WARN=e.enableWarn,s.a.ENABLE_ERROR=e.enableError,s.a.ENABLE_CALLBACK=e.enableCallback},e._notifyChange=function(){var t=e.emitter;if(t.listenerCount("change")>0){var r=e.getConfig();t.emit("change",r)}},e.registerListener=function(t){e.emitter.addListener("change",t)},e.removeListener=function(t){e.emitter.removeListener("change",t)},e.addLogListener=function(t){s.a.emitter.addListener("log",t),s.a.emitter.listenerCount("log")>0&&(s.a.ENABLE_CALLBACK=!0,e._notifyChange())},e.removeLogListener=function(t){s.a.emitter.removeListener("log",t),0===s.a.emitter.listenerCount("log")&&(s.a.ENABLE_CALLBACK=!1,e._notifyChange())},e}();a.emitter=new n.a,t.a=a},function(e,t,r){"use strict";var i=r(6),n=r.n(i),s=r(0),a=r(4),o=r(8);function c(e,t,r){var i=e;if(t+r<i.length){for(;r--;)if(128!=(192&i[++t]))return!1;return!0}return!1}var l,d=function(e){for(var t=[],r=e,i=0,n=e.length;i<n;)if(r[i]<128)t.push(String.fromCharCode(r[i])),++i;else{if(r[i]<192);else if(r[i]<224){if(c(r,i,1)&&(s=(31&r[i])<<6|63&r[i+1])>=128){t.push(String.fromCharCode(65535&s)),i+=2;continue}}else if(r[i]<240){if(c(r,i,2)&&(s=(15&r[i])<<12|(63&r[i+1])<<6|63&r[i+2])>=2048&&55296!=(63488&s)){t.push(String.fromCharCode(65535&s)),i+=3;continue}}else if(r[i]<248){var s;if(c(r,i,3)&&(s=(7&r[i])<<18|(63&r[i+1])<<12|(63&r[i+2])<<6|63&r[i+3])>65536&&s<1114112){s-=65536,t.push(String.fromCharCode(s>>>10|55296)),t.push(String.fromCharCode(1023&s|56320)),i+=4;continue}}t.push(String.fromCharCode(65533)),++i}return t.join("")},u=r(3),h=(l=new ArrayBuffer(2),new DataView(l).setInt16(0,256,!0),256===new Int16Array(l)[0]),p=function(){function e(){}return e.parseScriptData=function(t,r,i){var n={};try{var a=e.parseValue(t,r,i),o=e.parseValue(t,r+a.size,i-a.size);n[a.data]=o.data}catch(e){s.a.e("AMF",e.toString())}return n},e.parseObject=function(t,r,i){if(i<3)throw new u.a("Data not enough when parse ScriptDataObject");var n=e.parseString(t,r,i),s=e.parseValue(t,r+n.size,i-n.size),a=s.objectEnd;return{data:{name:n.data,value:s.data},size:n.size+s.size,objectEnd:a}},e.parseVariable=function(t,r,i){return e.parseObject(t,r,i)},e.parseString=function(e,t,r){if(r<2)throw new u.a("Data not enough when parse String");var i=new DataView(e,t,r).getUint16(0,!h);return{data:i>0?d(new Uint8Array(e,t+2,i)):"",size:2+i}},e.parseLongString=function(e,t,r){if(r<4)throw new u.a("Data not enough when parse LongString");var i=new DataView(e,t,r).getUint32(0,!h);return{data:i>0?d(new Uint8Array(e,t+4,i)):"",size:4+i}},e.parseDate=function(e,t,r){if(r<10)throw new u.a("Data size invalid when parse Date");var i=new DataView(e,t,r),n=i.getFloat64(0,!h),s=i.getInt16(8,!h);return{data:new Date(n+=60*s*1e3),size:10}},e.parseValue=function(t,r,i){if(i<1)throw new u.a("Data not enough when parse Value");var n,a=new DataView(t,r,i),o=1,c=a.getUint8(0),l=!1;try{switch(c){case 0:n=a.getFloat64(1,!h),o+=8;break;case 1:n=!!a.getUint8(1),o+=1;break;case 2:var d=e.parseString(t,r+1,i-1);n=d.data,o+=d.size;break;case 3:n={};var p=0;for(9==(16777215&a.getUint32(i-4,!h))&&(p=3);o<i-4;){var f=e.parseObject(t,r+o,i-o-p);if(f.objectEnd)break;n[f.data.name]=f.data.value,o+=f.size}o<=i-3&&9==(16777215&a.getUint32(o-1,!h))&&(o+=3);break;case 8:for(n={},o+=4,p=0,9==(16777215&a.getUint32(i-4,!h))&&(p=3);o<i-8;){var m=e.parseVariable(t,r+o,i-o-p);if(m.objectEnd)break;n[m.data.name]=m.data.value,o+=m.size}o<=i-3&&9==(16777215&a.getUint32(o-1,!h))&&(o+=3);break;case 9:n=void 0,o=1,l=!0;break;case 10:n=[];var g=a.getUint32(1,!h);o+=4;for(var v=0;v<g;v++){var _=e.parseValue(t,r+o,i-o);n.push(_.data),o+=_.size}break;case 11:var y=e.parseDate(t,r+1,i-1);n=y.data,o+=y.size;break;case 12:var b=e.parseString(t,r+1,i-1);n=b.data,o+=b.size;break;default:o=i,s.a.w("AMF","Unsupported AMF value type "+c)}}catch(e){s.a.e("AMF",e.toString())}return{data:n,size:o,objectEnd:l}},e}(),f=function(){function e(e){this.TAG="ExpGolomb",this._buffer=e,this._buffer_index=0,this._total_bytes=e.byteLength,this._total_bits=8*e.byteLength,this._current_word=0,this._current_word_bits_left=0}return e.prototype.destroy=function(){this._buffer=null},e.prototype._fillCurrentWord=function(){var e=this._total_bytes-this._buffer_index;if(e<=0)throw new u.a("ExpGolomb: _fillCurrentWord() but no bytes available");var t=Math.min(4,e),r=new Uint8Array(4);r.set(this._buffer.subarray(this._buffer_index,this._buffer_index+t)),this._current_word=new DataView(r.buffer).getUint32(0,!1),this._buffer_index+=t,this._current_word_bits_left=8*t},e.prototype.readBits=function(e){if(e>32)throw new u.b("ExpGolomb: readBits() bits exceeded max 32bits!");if(e<=this._current_word_bits_left){var t=this._current_word>>>32-e;return this._current_word<<=e,this._current_word_bits_left-=e,t}var r=this._current_word_bits_left?this._current_word:0;r>>>=32-this._current_word_bits_left;var i=e-this._current_word_bits_left;this._fillCurrentWord();var n=Math.min(i,this._current_word_bits_left),s=this._current_word>>>32-n;return this._current_word<<=n,this._current_word_bits_left-=n,r<<n|s},e.prototype.readBool=function(){return 1===this.readBits(1)},e.prototype.readByte=function(){return this.readBits(8)},e.prototype._skipLeadingZero=function(){var e;for(e=0;e<this._current_word_bits_left;e++)if(0!=(this._current_word&2147483648>>>e))return this._current_word<<=e,this._current_word_bits_left-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()},e.prototype.readUEG=function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1},e.prototype.readSEG=function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)},e}(),m=function(){function e(){}return e._ebsp2rbsp=function(e){for(var t=e,r=t.byteLength,i=new Uint8Array(r),n=0,s=0;s<r;s++)s>=2&&3===t[s]&&0===t[s-1]&&0===t[s-2]||(i[n]=t[s],n++);return new Uint8Array(i.buffer,0,n)},e.parseSPS=function(t){for(var r=t.subarray(1,4),i="avc1.",n=0;n<3;n++){var s=r[n].toString(16);s.length<2&&(s="0"+s),i+=s}var a=e._ebsp2rbsp(t),o=new f(a);o.readByte();var c=o.readByte();o.readByte();var l=o.readByte();o.readUEG();var d=e.getProfileString(c),u=e.getLevelString(l),h=1,p=420,m=8,g=8;if((100===c||110===c||122===c||244===c||44===c||83===c||86===c||118===c||128===c||138===c||144===c)&&(3===(h=o.readUEG())&&o.readBits(1),h<=3&&(p=[0,420,422,444][h]),m=o.readUEG()+8,g=o.readUEG()+8,o.readBits(1),o.readBool()))for(var v=3!==h?8:12,_=0;_<v;_++)o.readBool()&&(_<6?e._skipScalingList(o,16):e._skipScalingList(o,64));o.readUEG();var y=o.readUEG();if(0===y)o.readUEG();else if(1===y){o.readBits(1),o.readSEG(),o.readSEG();var b=o.readUEG();for(_=0;_<b;_++)o.readSEG()}var E=o.readUEG();o.readBits(1);var S=o.readUEG(),w=o.readUEG(),T=o.readBits(1);0===T&&o.readBits(1),o.readBits(1);var R=0,C=0,A=0,P=0;o.readBool()&&(R=o.readUEG(),C=o.readUEG(),A=o.readUEG(),P=o.readUEG());var D=1,L=1,k=0,I=!0,O=0,M=0;if(o.readBool()){if(o.readBool()){var x=o.readByte();x>0&&x<16?(D=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][x-1],L=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][x-1]):255===x&&(D=o.readByte()<<8|o.readByte(),L=o.readByte()<<8|o.readByte())}if(o.readBool()&&o.readBool(),o.readBool()&&(o.readBits(4),o.readBool()&&o.readBits(24)),o.readBool()&&(o.readUEG(),o.readUEG()),o.readBool()){var N=o.readBits(32),F=o.readBits(32);I=o.readBool(),k=(O=F)/(M=2*N)}}var B=1;1===D&&1===L||(B=D/L);var j=0,U=0;0===h?(j=1,U=2-T):(j=3===h?1:2,U=(1===h?2:1)*(2-T));var V=16*(S+1),G=16*(w+1)*(2-T);V-=(R+C)*j,G-=(A+P)*U;var H=Math.ceil(V*B);return o.destroy(),o=null,{codec_mimetype:i,profile_idc:c,level_idc:l,profile_string:d,level_string:u,chroma_format_idc:h,bit_depth:m,bit_depth_luma:m,bit_depth_chroma:g,ref_frames:E,chroma_format:p,chroma_format_string:e.getChromaFormatString(p),frame_rate:{fixed:I,fps:k,fps_den:M,fps_num:O},sar_ratio:{width:D,height:L},codec_size:{width:V,height:G},present_size:{width:H,height:G}}},e._skipScalingList=function(e,t){for(var r=8,i=8,n=0;n<t;n++)0!==i&&(i=(r+e.readSEG()+256)%256),r=0===i?r:i},e.getProfileString=function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},e.getLevelString=function(e){return(e/10).toFixed(1)},e.getChromaFormatString=function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},e}(),g=r(5),v=function(){function e(){}return e._ebsp2rbsp=function(e){for(var t=e,r=t.byteLength,i=new Uint8Array(r),n=0,s=0;s<r;s++)s>=2&&3===t[s]&&0===t[s-1]&&0===t[s-2]||(i[n]=t[s],n++);return new Uint8Array(i.buffer,0,n)},e.parseVPS=function(t){var r=e._ebsp2rbsp(t),i=new f(r);return i.readByte(),i.readByte(),i.readBits(4),i.readBits(2),i.readBits(6),{num_temporal_layers:i.readBits(3)+1,temporal_id_nested:i.readBool()}},e.parseSPS=function(t){var r=e._ebsp2rbsp(t),i=new f(r);i.readByte(),i.readByte();for(var n=0,s=0,a=0,o=0,c=(i.readBits(4),i.readBits(3)),l=(i.readBool(),i.readBits(2)),d=i.readBool(),u=i.readBits(5),h=i.readByte(),p=i.readByte(),m=i.readByte(),g=i.readByte(),v=i.readByte(),_=i.readByte(),y=i.readByte(),b=i.readByte(),E=i.readByte(),S=i.readByte(),w=i.readByte(),T=[],R=[],C=0;C<c;C++)T.push(i.readBool()),R.push(i.readBool());if(c>0)for(C=c;C<8;C++)i.readBits(2);for(C=0;C<c;C++)T[C]&&(i.readByte(),i.readByte(),i.readByte(),i.readByte(),i.readByte(),i.readByte(),i.readByte(),i.readByte(),i.readByte(),i.readByte(),i.readByte()),R[C]&&i.readByte();i.readUEG();var A=i.readUEG();3==A&&i.readBits(1);var P=i.readUEG(),D=i.readUEG();i.readBool()&&(n+=i.readUEG(),s+=i.readUEG(),a+=i.readUEG(),o+=i.readUEG());var L=i.readUEG(),k=i.readUEG(),I=i.readUEG();for(C=i.readBool()?0:c;C<=c;C++)i.readUEG(),i.readUEG(),i.readUEG();if(i.readUEG(),i.readUEG(),i.readUEG(),i.readUEG(),i.readUEG(),i.readUEG(),i.readBool()&&i.readBool())for(var O=0;O<4;O++)for(var M=0;M<(3===O?2:6);M++)if(i.readBool()){var x=Math.min(64,1<<4+(O<<1));for(O>1&&i.readSEG(),C=0;C<x;C++)i.readSEG()}else i.readUEG();i.readBool(),i.readBool(),i.readBool()&&(i.readByte(),i.readUEG(),i.readUEG(),i.readBool());var N=i.readUEG(),F=0;for(C=0;C<N;C++){var B=!1;if(0!==C&&(B=i.readBool()),B){C===N&&i.readUEG(),i.readBool(),i.readUEG();for(var j=0,U=0;U<=F;U++){var V=i.readBool(),G=!1;V||(G=i.readBool()),(V||G)&&j++}F=j}else{var H=i.readUEG(),K=i.readUEG();for(F=H+K,U=0;U<H;U++)i.readUEG(),i.readBool();for(U=0;U<K;U++)i.readUEG(),i.readBool()}}if(i.readBool()){var q=i.readUEG();for(C=0;C<q;C++){for(U=0;U<I+4;U++)i.readBits(1);i.readBits(1)}}var W=0,z=1,$=1,Y=!1,Q=1,J=1;if(i.readBool(),i.readBool(),i.readBool()){if(i.readBool()){var X=i.readByte();X>0&&X<=16?(z=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][X-1],$=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][X-1]):255===X&&(z=i.readBits(16),$=i.readBits(16))}if(i.readBool()&&i.readBool(),i.readBool()&&(i.readBits(3),i.readBool(),i.readBool()&&(i.readByte(),i.readByte(),i.readByte())),i.readBool()&&(i.readUEG(),i.readUEG()),i.readBool(),i.readBool(),i.readBool(),i.readBool()&&(i.readUEG(),i.readUEG(),i.readUEG(),i.readUEG()),i.readBool()&&(Q=i.readBits(32),J=i.readBits(32),i.readBool()&&(i.readUEG(),i.readBool()))){var Z,ee,te=!1;for(Z=i.readBool(),ee=i.readBool(),(Z||ee)&&((te=i.readBool())&&(i.readByte(),i.readBits(5),i.readBool(),i.readBits(5)),i.readBits(4),i.readBits(4),te&&i.readBits(4),i.readBits(5),i.readBits(5),i.readBits(5)),C=0;C<=c;C++){var re=i.readBool();Y=re;var ie=!1,ne=1;re||(ie=i.readBool());var se=!1;if(ie?i.readSEG():se=i.readBool(),se||(ne=i.readUEG()+1),Z)for(U=0;U<ne;U++)i.readUEG(),i.readUEG(),te&&(i.readUEG(),i.readUEG());if(ee)for(U=0;U<ne;U++)i.readUEG(),i.readUEG(),te&&(i.readUEG(),i.readUEG())}}i.readBool()&&(i.readBool(),i.readBool(),i.readBool(),W=i.readUEG(),i.readUEG(),i.readUEG(),i.readUEG(),i.readUEG())}i.readBool();var ae="hvc1."+u+".1.L"+w+".B0",oe=P-(n+s)*(1===A||2===A?2:1),ce=D-(a+o)*(1===A?2:1),le=1;return 1!==z&&1!==$&&(le=z/$),i.destroy(),i=null,{codec_mimetype:ae,level_string:e.getLevelString(w),profile_idc:u,bit_depth:L+8,ref_frames:1,chroma_format:A,chroma_format_string:e.getChromaFormatString(A),general_level_idc:w,general_profile_space:l,general_tier_flag:d,general_profile_idc:u,general_profile_compatibility_flags_1:h,general_profile_compatibility_flags_2:p,general_profile_compatibility_flags_3:m,general_profile_compatibility_flags_4:g,general_constraint_indicator_flags_1:v,general_constraint_indicator_flags_2:_,general_constraint_indicator_flags_3:y,general_constraint_indicator_flags_4:b,general_constraint_indicator_flags_5:E,general_constraint_indicator_flags_6:S,min_spatial_segmentation_idc:W,constant_frame_rate:0,chroma_format_idc:A,bit_depth_luma_minus8:L,bit_depth_chroma_minus8:k,frame_rate:{fixed:Y,fps:J/Q,fps_den:Q,fps_num:J},sar_ratio:{width:z,height:$},codec_size:{width:oe,height:ce},present_size:{width:oe*le,height:ce}}},e.parsePPS=function(t){var r=e._ebsp2rbsp(t),i=new f(r);i.readByte(),i.readByte(),i.readUEG(),i.readUEG(),i.readBool(),i.readBool(),i.readBits(3),i.readBool(),i.readBool(),i.readUEG(),i.readUEG(),i.readSEG(),i.readBool(),i.readBool(),i.readBool()&&i.readUEG(),i.readSEG(),i.readSEG(),i.readBool(),i.readBool(),i.readBool(),i.readBool();var n=i.readBool(),s=i.readBool(),a=1;return s&&n?a=0:s?a=3:n&&(a=2),{parallelismType:a}},e.getChromaFormatString=function(e){switch(e){case 0:return"4:0:0";case 1:return"4:2:0";case 2:return"4:2:2";case 3:return"4:4:4";default:return"Unknown"}},e.getProfileString=function(e){switch(e){case 1:return"Main";case 2:return"Main10";case 3:return"MainSP";case 4:return"Rext";case 9:return"SCC";default:return"Unknown"}},e.getLevelString=function(e){return(e/30).toFixed(1)},e}();function _(e){return e.byteOffset%2==0&&e.byteLength%2==0}function y(e){return e.byteOffset%4==0&&e.byteLength%4==0}function b(e,t){for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}var E,S=function(e,t){return e.byteLength===t.byteLength&&(y(e)&&y(t)?function(e,t){return b(new Uint32Array(e.buffer,e.byteOffset,e.byteLength/4),new Uint32Array(t.buffer,t.byteOffset,t.byteLength/4))}(e,t):_(e)&&_(t)?function(e,t){return b(new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2),new Uint16Array(t.buffer,t.byteOffset,t.byteLength/2))}(e,t):function(e,t){return b(e,t)}(e,t))},w=function(){function e(e,t){this.TAG="FLVDemuxer",this._config=t,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=e.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=e.hasAudioTrack,this._hasVideo=e.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new o.a,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=function(){var e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]}()}return e.prototype.destroy=function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null},e.probe=function(e){var t=new Uint8Array(e);if(t.byteLength<9)return{needMoreData:!0};var r={match:!1};if(70!==t[0]||76!==t[1]||86!==t[2]||1!==t[3])return r;var i,n=(4&t[4])>>>2!=0,s=0!=(1&t[4]),a=(i=t)[5]<<24|i[6]<<16|i[7]<<8|i[8];return a<9?r:{match:!0,consumed:a,dataOffset:a,hasAudioTrack:n,hasVideoTrack:s}},e.prototype.bindDataSource=function(e){return e.onDataArrival=this.parseChunks.bind(this),this},Object.defineProperty(e.prototype,"onTrackMetadata",{get:function(){return this._onTrackMetadata},set:function(e){this._onTrackMetadata=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMediaInfo",{get:function(){return this._onMediaInfo},set:function(e){this._onMediaInfo=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMetaDataArrived",{get:function(){return this._onMetaDataArrived},set:function(e){this._onMetaDataArrived=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onScriptDataArrived",{get:function(){return this._onScriptDataArrived},set:function(e){this._onScriptDataArrived=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onError",{get:function(){return this._onError},set:function(e){this._onError=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDataAvailable",{get:function(){return this._onDataAvailable},set:function(e){this._onDataAvailable=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"timestampBase",{get:function(){return this._timestampBase},set:function(e){this._timestampBase=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"overridedDuration",{get:function(){return this._duration},set:function(e){this._durationOverrided=!0,this._duration=e,this._mediaInfo.duration=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"overridedHasAudio",{set:function(e){this._hasAudioFlagOverrided=!0,this._hasAudio=e,this._mediaInfo.hasAudio=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"overridedHasVideo",{set:function(e){this._hasVideoFlagOverrided=!0,this._hasVideo=e,this._mediaInfo.hasVideo=e},enumerable:!1,configurable:!0}),e.prototype.resetMediaInfo=function(){this._mediaInfo=new o.a},e.prototype._isInitialMetadataDispatched=function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!(this._hasAudio||!this._hasVideo)&&this._videoInitialMetadataDispatched},e.prototype.parseChunks=function(t,r){if(!(this._onError&&this._onMediaInfo&&this._onTrackMetadata&&this._onDataAvailable))throw new u.a("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var i=0,n=this._littleEndian;if(0===r){if(!(t.byteLength>13))return 0;i=e.probe(t).dataOffset}for(this._firstParse&&(this._firstParse=!1,r+i!==this._dataOffset&&s.a.w(this.TAG,"First time parsing but chunk byteStart invalid!"),0!==(a=new DataView(t,i)).getUint32(0,!n)&&s.a.w(this.TAG,"PrevTagSize0 !== 0 !!!"),i+=4);i<t.byteLength;){this._dispatch=!0;var a=new DataView(t,i);if(i+11+4>t.byteLength)break;var o=a.getUint8(0),c=16777215&a.getUint32(0,!n);if(i+11+c+4>t.byteLength)break;if(8===o||9===o||18===o){var l=a.getUint8(4),d=a.getUint8(5),h=a.getUint8(6)|d<<8|l<<16|a.getUint8(7)<<24;0!=(16777215&a.getUint32(7,!n))&&s.a.w(this.TAG,"Meet tag which has StreamID != 0!");var p=i+11;switch(o){case 8:this._parseAudioData(t,p,c,h);break;case 9:this._parseVideoData(t,p,c,h,r+i);break;case 18:this._parseScriptData(t,p,c)}var f=a.getUint32(11+c,!n);f!==11+c&&s.a.w(this.TAG,"Invalid PrevTagSize "+f),i+=11+c+4}else s.a.w(this.TAG,"Unsupported tag type "+o+", skipped"),i+=11+c+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),i},e.prototype._parseScriptData=function(e,t,r){var i=p.parseScriptData(e,t,r);if(i.hasOwnProperty("onMetaData")){if(null==i.onMetaData||"object"!=typeof i.onMetaData)return void s.a.w(this.TAG,"Invalid onMetaData structure!");this._metadata&&s.a.w(this.TAG,"Found another onMetaData tag!"),this._metadata=i;var n=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},n)),"boolean"==typeof n.hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=n.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),"boolean"==typeof n.hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=n.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),"number"==typeof n.audiodatarate&&(this._mediaInfo.audioDataRate=n.audiodatarate),"number"==typeof n.videodatarate&&(this._mediaInfo.videoDataRate=n.videodatarate),"number"==typeof n.width&&(this._mediaInfo.width=n.width),"number"==typeof n.height&&(this._mediaInfo.height=n.height),"number"==typeof n.duration){if(!this._durationOverrided){var a=Math.floor(n.duration*this._timescale);this._duration=a,this._mediaInfo.duration=a}}else this._mediaInfo.duration=0;if("number"==typeof n.framerate){var o=Math.floor(1e3*n.framerate);if(o>0){var c=o/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=c,this._referenceFrameRate.fps_num=o,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=c}}if("object"==typeof n.keyframes){this._mediaInfo.hasKeyframesIndex=!0;var l=n.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(l),n.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=n,s.a.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(i).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},i))},e.prototype._parseKeyframesIndex=function(e){for(var t=[],r=[],i=1;i<e.times.length;i++){var n=this._timestampBase+Math.floor(1e3*e.times[i]);t.push(n),r.push(e.filepositions[i])}return{times:t,filepositions:r}},e.prototype._parseAudioData=function(e,t,r,i){if(r<=1)s.a.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");else if(!0!==this._hasAudioFlagOverrided||!1!==this._hasAudio){this._littleEndian;var n=new DataView(e,t,r).getUint8(0),a=n>>>4;if(2===a||10===a){var o=0,c=(12&n)>>>2;if(c>=0&&c<=4){o=this._flvSoundRateTable[c];var l=1&n,d=this._audioMetadata,u=this._audioTrack;if(d||(!1===this._hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(d=this._audioMetadata={}).type="audio",d.id=u.id,d.timescale=this._timescale,d.duration=this._duration,d.audioSampleRate=o,d.channelCount=0===l?1:2),10===a){var h=this._parseAACAudioData(e,t+1,r-1);if(null==h)return;if(0===h.packetType){if(d.config){if(S(h.data.config,d.config))return;s.a.w(this.TAG,"AudioSpecificConfig has been changed, re-generate initialization segment")}var p=h.data;d.audioSampleRate=p.samplingRate,d.channelCount=p.channelCount,d.codec=p.codec,d.originalCodec=p.originalCodec,d.config=p.config,d.refSampleDuration=1024/d.audioSampleRate*d.timescale,s.a.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",d),(v=this._mediaInfo).audioCodec=d.originalCodec,v.audioSampleRate=d.audioSampleRate,v.audioChannelCount=d.channelCount,v.hasVideo?null!=v.videoCodec&&(v.mimeType='video/x-flv; codecs="'+v.videoCodec+","+v.audioCodec+'"'):v.mimeType='video/x-flv; codecs="'+v.audioCodec+'"',v.isComplete()&&this._onMediaInfo(v)}else if(1===h.packetType){var f=this._timestampBase+i,m={unit:h.data,length:h.data.byteLength,dts:f,pts:f};u.samples.push(m),u.length+=h.data.length}else s.a.e(this.TAG,"Flv: Unsupported AAC data type "+h.packetType)}else if(2===a){if(!d.codec){var v;if(null==(p=this._parseMP3AudioData(e,t+1,r-1,!0)))return;d.audioSampleRate=p.samplingRate,d.channelCount=p.channelCount,d.codec=p.codec,d.originalCodec=p.originalCodec,d.refSampleDuration=1152/d.audioSampleRate*d.timescale,s.a.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",d),(v=this._mediaInfo).audioCodec=d.codec,v.audioSampleRate=d.audioSampleRate,v.audioChannelCount=d.channelCount,v.audioDataRate=p.bitRate,v.hasVideo?null!=v.videoCodec&&(v.mimeType='video/x-flv; codecs="'+v.videoCodec+","+v.audioCodec+'"'):v.mimeType='video/x-flv; codecs="'+v.audioCodec+'"',v.isComplete()&&this._onMediaInfo(v)}var _=this._parseMP3AudioData(e,t+1,r-1,!1);if(null==_)return;f=this._timestampBase+i;var y={unit:_,length:_.byteLength,dts:f,pts:f};u.samples.push(y),u.length+=_.length}}else this._onError(g.a.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+c)}else this._onError(g.a.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+a)}},e.prototype._parseAACAudioData=function(e,t,r){if(!(r<=1)){var i={},n=new Uint8Array(e,t,r);return i.packetType=n[0],0===n[0]?i.data=this._parseAACAudioSpecificConfig(e,t+1,r-1):i.data=n.subarray(1),i}s.a.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!")},e.prototype._parseAACAudioSpecificConfig=function(e,t,r){var i,n,s=new Uint8Array(e,t,r),a=null,o=0,c=null;if(o=i=s[0]>>>3,(n=(7&s[0])<<1|s[1]>>>7)<0||n>=this._mpegSamplingRates.length)this._onError(g.a.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");else{var l=this._mpegSamplingRates[n],d=(120&s[1])>>>3;if(!(d<0||d>=8)){5===o&&(c=(7&s[1])<<1|s[2]>>>7,s[2]);var u=self.navigator.userAgent.toLowerCase();return-1!==u.indexOf("firefox")?n>=6?(o=5,a=new Array(4),c=n-3):(o=2,a=new Array(2),c=n):-1!==u.indexOf("android")?(o=2,a=new Array(2),c=n):(o=5,c=n,a=new Array(4),n>=6?c=n-3:1===d&&(o=2,a=new Array(2),c=n)),a[0]=o<<3,a[0]|=(15&n)>>>1,a[1]=(15&n)<<7,a[1]|=(15&d)<<3,5===o&&(a[1]|=(15&c)>>>1,a[2]=(1&c)<<7,a[2]|=8,a[3]=0),{config:a,samplingRate:l,channelCount:d,codec:"mp4a.40."+o,originalCodec:"mp4a.40."+i}}this._onError(g.a.FORMAT_ERROR,"Flv: AAC invalid channel configuration")}},e.prototype._parseMP3AudioData=function(e,t,r,i){if(!(r<4)){this._littleEndian;var n=new Uint8Array(e,t,r),a=null;if(i){if(255!==n[0])return;var o=n[1]>>>3&3,c=(6&n[1])>>1,l=(240&n[2])>>>4,d=(12&n[2])>>>2,u=3!=(n[3]>>>6&3)?2:1,h=0,p=0;switch(o){case 0:h=this._mpegAudioV25SampleRateTable[d];break;case 2:h=this._mpegAudioV20SampleRateTable[d];break;case 3:h=this._mpegAudioV10SampleRateTable[d]}switch(c){case 1:l<this._mpegAudioL3BitRateTable.length&&(p=this._mpegAudioL3BitRateTable[l]);break;case 2:l<this._mpegAudioL2BitRateTable.length&&(p=this._mpegAudioL2BitRateTable[l]);break;case 3:l<this._mpegAudioL1BitRateTable.length&&(p=this._mpegAudioL1BitRateTable[l])}a={bitRate:p,samplingRate:h,channelCount:u,codec:"mp3",originalCodec:"mp3"}}else a=n;return a}s.a.w(this.TAG,"Flv: Invalid MP3 packet, header missing!")},e.prototype._parseVideoData=function(e,t,r,i,n){if(r<=1)s.a.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");else if(!0!==this._hasVideoFlagOverrided||!1!==this._hasVideo){var a=new Uint8Array(e,t,r)[0],o=(112&a)>>>4;if(0!=(128&a)){var c=15&a,l=String.fromCharCode.apply(String,new Uint8Array(e,t,r).slice(1,5));if("hvc1"!==l)return void this._onError(g.a.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+l);this._parseEnhancedHEVCVideoPacket(e,t+5,r-5,i,n,o,c)}else{var d=15&a;if(7===d)this._parseAVCVideoPacket(e,t+1,r-1,i,n,o);else{if(12!==d)return void this._onError(g.a.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+d);this._parseHEVCVideoPacket(e,t+1,r-1,i,n,o)}}}},e.prototype._parseAVCVideoPacket=function(e,t,r,i,n,a){if(r<4)s.a.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");else{var o=this._littleEndian,c=new DataView(e,t,r),l=c.getUint8(0),d=(16777215&c.getUint32(0,!o))<<8>>8;if(0===l)this._parseAVCDecoderConfigurationRecord(e,t+4,r-4);else if(1===l)this._parseAVCVideoData(e,t+4,r-4,i,n,a,d);else if(2!==l)return void this._onError(g.a.FORMAT_ERROR,"Flv: Invalid video packet type "+l)}},e.prototype._parseHEVCVideoPacket=function(e,t,r,i,n,a){if(r<4)s.a.w(this.TAG,"Flv: Invalid HEVC packet, missing HEVCPacketType or/and CompositionTime");else{var o=this._littleEndian,c=new DataView(e,t,r),l=c.getUint8(0),d=(16777215&c.getUint32(0,!o))<<8>>8;if(0===l)this._parseHEVCDecoderConfigurationRecord(e,t+4,r-4);else if(1===l)this._parseHEVCVideoData(e,t+4,r-4,i,n,a,d);else if(2!==l)return void this._onError(g.a.FORMAT_ERROR,"Flv: Invalid video packet type "+l)}},e.prototype._parseEnhancedHEVCVideoPacket=function(e,t,r,i,n,a,o){if(r<4)s.a.w(this.TAG,"Flv: Invalid HEVC packet, missing HEVCPacketType or/and CompositionTime");else{var c=this._littleEndian,l=new DataView(e,t,r);if(0===o)this._parseHEVCDecoderConfigurationRecord(e,t,r);else if(1===o){var d=(4294967040&l.getUint32(0,!c))>>8;this._parseHEVCVideoData(e,t+3,r-3,i,n,a,d)}else if(3===o)this._parseHEVCVideoData(e,t,r,i,n,a,0);else if(2!==o)return void this._onError(g.a.FORMAT_ERROR,"Flv: Invalid video packet type "+o)}},e.prototype._parseAVCDecoderConfigurationRecord=function(e,t,r){if(r<7)s.a.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");else{var i=this._videoMetadata,n=this._videoTrack,a=this._littleEndian,o=new DataView(e,t,r);if(i){if(void 0!==i.avcc){var c=new Uint8Array(e,t,r);if(S(c,i.avcc))return;s.a.w(this.TAG,"AVCDecoderConfigurationRecord has been changed, re-generate initialization segment")}}else!1===this._hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(i=this._videoMetadata={}).type="video",i.id=n.id,i.timescale=this._timescale,i.duration=this._duration;var l=o.getUint8(0),d=o.getUint8(1);if(o.getUint8(2),o.getUint8(3),1===l&&0!==d)if(this._naluLengthSize=1+(3&o.getUint8(4)),3===this._naluLengthSize||4===this._naluLengthSize){var u=31&o.getUint8(5);if(0!==u){u>1&&s.a.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+u);for(var h=6,p=0;p<u;p++){var f=o.getUint16(h,!a);if(h+=2,0!==f){var v=new Uint8Array(e,t+h,f);h+=f;var _=m.parseSPS(v);if(0===p){i.codecWidth=_.codec_size.width,i.codecHeight=_.codec_size.height,i.presentWidth=_.present_size.width,i.presentHeight=_.present_size.height,i.profile=_.profile_string,i.level=_.level_string,i.bitDepth=_.bit_depth,i.chromaFormat=_.chroma_format,i.sarRatio=_.sar_ratio,i.frameRate=_.frame_rate,!1!==_.frame_rate.fixed&&0!==_.frame_rate.fps_num&&0!==_.frame_rate.fps_den||(i.frameRate=this._referenceFrameRate);var y=i.frameRate.fps_den,b=i.frameRate.fps_num;i.refSampleDuration=i.timescale*(y/b);for(var E=v.subarray(1,4),w="avc1.",T=0;T<3;T++){var R=E[T].toString(16);R.length<2&&(R="0"+R),w+=R}i.codec=w;var C=this._mediaInfo;C.width=i.codecWidth,C.height=i.codecHeight,C.fps=i.frameRate.fps,C.profile=i.profile,C.level=i.level,C.refFrames=_.ref_frames,C.chromaFormat=_.chroma_format_string,C.sarNum=i.sarRatio.width,C.sarDen=i.sarRatio.height,C.videoCodec=w,C.hasAudio?null!=C.audioCodec&&(C.mimeType='video/x-flv; codecs="'+C.videoCodec+","+C.audioCodec+'"'):C.mimeType='video/x-flv; codecs="'+C.videoCodec+'"',C.isComplete()&&this._onMediaInfo(C)}}}var A=o.getUint8(h);if(0!==A){for(A>1&&s.a.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+A),h++,p=0;p<A;p++)f=o.getUint16(h,!a),h+=2,0!==f&&(h+=f);i.avcc=new Uint8Array(r),i.avcc.set(new Uint8Array(e,t,r),0),s.a.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",i)}else this._onError(g.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS")}else this._onError(g.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS")}else this._onError(g.a.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));else this._onError(g.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord")}},e.prototype._parseHEVCDecoderConfigurationRecord=function(e,t,r){if(r<22)s.a.w(this.TAG,"Flv: Invalid HEVCDecoderConfigurationRecord, lack of data!");else{var i=this._videoMetadata,n=this._videoTrack,a=this._littleEndian,o=new DataView(e,t,r);if(i){if(void 0!==i.hvcc){var c=new Uint8Array(e,t,r);if(S(c,i.hvcc))return;s.a.w(this.TAG,"HEVCDecoderConfigurationRecord has been changed, re-generate initialization segment")}}else!1===this._hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(i=this._videoMetadata={}).type="video",i.id=n.id,i.timescale=this._timescale,i.duration=this._duration;var l=o.getUint8(0),d=31&o.getUint8(1);if(1===l&&0!==d)if(this._naluLengthSize=1+(3&o.getUint8(21)),3===this._naluLengthSize||4===this._naluLengthSize){for(var u=o.getUint8(22),h=0,p=23;h<u;h++){var f=63&o.getUint8(p+0),m=o.getUint16(p+1,!a);p+=3;for(var _=0;_<m;_++){var y=o.getUint16(p+0,!a);if(0===_)if(33===f){p+=2;var b=new Uint8Array(e,t+p,y),E=v.parseSPS(b);i.codecWidth=E.codec_size.width,i.codecHeight=E.codec_size.height,i.presentWidth=E.present_size.width,i.presentHeight=E.present_size.height,i.profile=E.profile_string,i.level=E.level_string,i.bitDepth=E.bit_depth,i.chromaFormat=E.chroma_format,i.sarRatio=E.sar_ratio,i.frameRate=E.frame_rate,!1!==E.frame_rate.fixed&&0!==E.frame_rate.fps_num&&0!==E.frame_rate.fps_den||(i.frameRate=this._referenceFrameRate);var w=i.frameRate.fps_den,T=i.frameRate.fps_num;i.refSampleDuration=i.timescale*(w/T),i.codec=E.codec_mimetype;var R=this._mediaInfo;R.width=i.codecWidth,R.height=i.codecHeight,R.fps=i.frameRate.fps,R.profile=i.profile,R.level=i.level,R.refFrames=E.ref_frames,R.chromaFormat=E.chroma_format_string,R.sarNum=i.sarRatio.width,R.sarDen=i.sarRatio.height,R.videoCodec=E.codec_mimetype,R.hasAudio?null!=R.audioCodec&&(R.mimeType='video/x-flv; codecs="'+R.videoCodec+","+R.audioCodec+'"'):R.mimeType='video/x-flv; codecs="'+R.videoCodec+'"',R.isComplete()&&this._onMediaInfo(R),p+=y}else p+=2+y;else p+=2+y}}i.hvcc=new Uint8Array(r),i.hvcc.set(new Uint8Array(e,t,r),0),s.a.v(this.TAG,"Parsed HEVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",i)}else this._onError(g.a.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));else this._onError(g.a.FORMAT_ERROR,"Flv: Invalid HEVCDecoderConfigurationRecord")}},e.prototype._parseAVCVideoData=function(e,t,r,i,n,a,o){for(var c=this._littleEndian,l=new DataView(e,t,r),d=[],u=0,h=0,p=this._naluLengthSize,f=this._timestampBase+i,m=1===a;h<r;){if(h+4>=r){s.a.w(this.TAG,"Malformed Nalu near timestamp "+f+", offset = "+h+", dataSize = "+r);break}var g=l.getUint32(h,!c);if(3===p&&(g>>>=8),g>r-p)return void s.a.w(this.TAG,"Malformed Nalus near timestamp "+f+", NaluSize > DataSize!");var v=31&l.getUint8(h+p);5===v&&(m=!0);var _=new Uint8Array(e,t+h,p+g),y={type:v,data:_};d.push(y),u+=_.byteLength,h+=p+g}if(d.length){var b=this._videoTrack,E={units:d,length:u,isKeyframe:m,dts:f,cts:o,pts:f+o};m&&(E.fileposition=n),b.samples.push(E),b.length+=u}},e.prototype._parseHEVCVideoData=function(e,t,r,i,n,a,o){for(var c=this._littleEndian,l=new DataView(e,t,r),d=[],u=0,h=0,p=this._naluLengthSize,f=this._timestampBase+i,m=1===a;h<r;){if(h+4>=r){s.a.w(this.TAG,"Malformed Nalu near timestamp "+f+", offset = "+h+", dataSize = "+r);break}var g=l.getUint32(h,!c);if(3===p&&(g>>>=8),g>r-p)return void s.a.w(this.TAG,"Malformed Nalus near timestamp "+f+", NaluSize > DataSize!");var v=31&l.getUint8(h+p);19!==v&&20!==v||(m=!0);var _=new Uint8Array(e,t+h,p+g),y={type:v,data:_};d.push(y),u+=_.byteLength,h+=p+g}if(d.length){var b=this._videoTrack,E={units:d,length:u,isKeyframe:m,dts:f,cts:o,pts:f+o};m&&(E.fileposition=n),b.samples.push(E),b.length+=u}},e}(),T=function(){function e(){}return e.prototype.destroy=function(){this.onError=null,this.onMediaInfo=null,this.onMetaDataArrived=null,this.onTrackMetadata=null,this.onDataAvailable=null,this.onTimedID3Metadata=null,this.onSMPTE2038Metadata=null,this.onSCTE35Metadata=null,this.onPESPrivateData=null,this.onPESPrivateDataDescriptor=null},e}(),R=function(){this.program_pmt_pid={}};!function(e){e[e.kMPEG1Audio=3]="kMPEG1Audio",e[e.kMPEG2Audio=4]="kMPEG2Audio",e[e.kPESPrivateData=6]="kPESPrivateData",e[e.kADTSAAC=15]="kADTSAAC",e[e.kLOASAAC=17]="kLOASAAC",e[e.kAC3=129]="kAC3",e[e.kID3=21]="kID3",e[e.kSCTE35=134]="kSCTE35",e[e.kH264=27]="kH264",e[e.kH265=36]="kH265"}(E||(E={}));var C,A=function(){this.pid_stream_type={},this.common_pids={h264:void 0,h265:void 0,adts_aac:void 0,loas_aac:void 0,opus:void 0,ac3:void 0,mp3:void 0},this.pes_private_data_pids={},this.timed_id3_pids={},this.scte_35_pids={},this.smpte2038_pids={}},P=function(){},D=function(){},L=function(){this.slices=[],this.total_length=0,this.expected_length=0,this.file_position=0};!function(e){e[e.kUnspecified=0]="kUnspecified",e[e.kSliceNonIDR=1]="kSliceNonIDR",e[e.kSliceDPA=2]="kSliceDPA",e[e.kSliceDPB=3]="kSliceDPB",e[e.kSliceDPC=4]="kSliceDPC",e[e.kSliceIDR=5]="kSliceIDR",e[e.kSliceSEI=6]="kSliceSEI",e[e.kSliceSPS=7]="kSliceSPS",e[e.kSlicePPS=8]="kSlicePPS",e[e.kSliceAUD=9]="kSliceAUD",e[e.kEndOfSequence=10]="kEndOfSequence",e[e.kEndOfStream=11]="kEndOfStream",e[e.kFiller=12]="kFiller",e[e.kSPSExt=13]="kSPSExt",e[e.kReserved0=14]="kReserved0"}(C||(C={}));var k,I,O=function(){},M=function(e){var t=e.data.byteLength;this.type=e.type,this.data=new Uint8Array(4+t),new DataView(this.data.buffer).setUint32(0,t),this.data.set(e.data,4)},x=function(){function e(e){this.TAG="H264AnnexBParser",this.current_startcode_offset_=0,this.eof_flag_=!1,this.data_=e,this.current_startcode_offset_=this.findNextStartCodeOffset(0),this.eof_flag_&&s.a.e(this.TAG,"Could not find H264 startcode until payload end!")}return e.prototype.findNextStartCodeOffset=function(e){for(var t=e,r=this.data_;;){if(t+3>=r.byteLength)return this.eof_flag_=!0,r.byteLength;var i=r[t+0]<<24|r[t+1]<<16|r[t+2]<<8|r[t+3],n=r[t+0]<<16|r[t+1]<<8|r[t+2];if(1===i||1===n)return t;t++}},e.prototype.readNextNaluPayload=function(){for(var e=this.data_,t=null;null==t&&!this.eof_flag_;){var r=this.current_startcode_offset_,i=31&e[r+=1==(e[r]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3])?4:3],n=(128&e[r])>>>7,s=this.findNextStartCodeOffset(r);if(this.current_startcode_offset_=s,!(i>=C.kReserved0)&&0===n){var a=e.subarray(r,s);(t=new O).type=i,t.data=a}}return t},e}(),N=function(){function e(e,t,r){var i=8+e.byteLength+1+2+t.byteLength,n=!1;66!==e[3]&&77!==e[3]&&88!==e[3]&&(n=!0,i+=4);var s=this.data=new Uint8Array(i);s[0]=1,s[1]=e[1],s[2]=e[2],s[3]=e[3],s[4]=255,s[5]=225;var a=e.byteLength;s[6]=a>>>8,s[7]=255&a;var o=8;s.set(e,8),s[o+=a]=1;var c=t.byteLength;s[o+1]=c>>>8,s[o+2]=255&c,s.set(t,o+3),o+=3+c,n&&(s[o]=252|r.chroma_format_idc,s[o+1]=248|r.bit_depth_luma-8,s[o+2]=248|r.bit_depth_chroma-8,s[o+3]=0,o+=4)}return e.prototype.getData=function(){return this.data},e}();!function(e){e[e.kNull=0]="kNull",e[e.kAACMain=1]="kAACMain",e[e.kAAC_LC=2]="kAAC_LC",e[e.kAAC_SSR=3]="kAAC_SSR",e[e.kAAC_LTP=4]="kAAC_LTP",e[e.kAAC_SBR=5]="kAAC_SBR",e[e.kAAC_Scalable=6]="kAAC_Scalable",e[e.kLayer1=32]="kLayer1",e[e.kLayer2=33]="kLayer2",e[e.kLayer3=34]="kLayer3"}(k||(k={})),function(e){e[e.k96000Hz=0]="k96000Hz",e[e.k88200Hz=1]="k88200Hz",e[e.k64000Hz=2]="k64000Hz",e[e.k48000Hz=3]="k48000Hz",e[e.k44100Hz=4]="k44100Hz",e[e.k32000Hz=5]="k32000Hz",e[e.k24000Hz=6]="k24000Hz",e[e.k22050Hz=7]="k22050Hz",e[e.k16000Hz=8]="k16000Hz",e[e.k12000Hz=9]="k12000Hz",e[e.k11025Hz=10]="k11025Hz",e[e.k8000Hz=11]="k8000Hz",e[e.k7350Hz=12]="k7350Hz"}(I||(I={}));var F,B,j=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],U=(F=function(e,t){return(F=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}F(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),V=function(){},G=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return U(t,e),t}(V),H=function(){function e(e){this.TAG="AACADTSParser",this.data_=e,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&s.a.e(this.TAG,"Could not found ADTS syncword until payload end")}return e.prototype.findNextSyncwordOffset=function(e){for(var t=e,r=this.data_;;){if(t+7>=r.byteLength)return this.eof_flag_=!0,r.byteLength;if(4095==(r[t+0]<<8|r[t+1])>>>4)return t;t++}},e.prototype.readNextAACFrame=function(){for(var e=this.data_,t=null;null==t&&!this.eof_flag_;){var r=this.current_syncword_offset_,i=(8&e[r+1])>>>3,n=(6&e[r+1])>>>1,s=1&e[r+1],a=(192&e[r+2])>>>6,o=(60&e[r+2])>>>2,c=(1&e[r+2])<<2|(192&e[r+3])>>>6,l=(3&e[r+3])<<11|e[r+4]<<3|(224&e[r+5])>>>5;if(e[r+6],r+l>this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var d=1===s?7:9,u=l-d;r+=d;var h=this.findNextSyncwordOffset(r+u);if(this.current_syncword_offset_=h,(0===i||1===i)&&0===n){var p=e.subarray(r,r+u);(t=new V).audio_object_type=a+1,t.sampling_freq_index=o,t.sampling_frequency=j[o],t.channel_config=c,t.data=p}}return t},e.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},e.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},e}(),K=function(){function e(e){this.TAG="AACLOASParser",this.data_=e,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&s.a.e(this.TAG,"Could not found LOAS syncword until payload end")}return e.prototype.findNextSyncwordOffset=function(e){for(var t=e,r=this.data_;;){if(t+1>=r.byteLength)return this.eof_flag_=!0,r.byteLength;if(695==(r[t+0]<<3|r[t+1]>>>5))return t;t++}},e.prototype.getLATMValue=function(e){for(var t=e.readBits(2),r=0,i=0;i<=t;i++)r<<=8,r|=e.readByte();return r},e.prototype.readNextAACFrame=function(e){for(var t=this.data_,r=null;null==r&&!this.eof_flag_;){var i=this.current_syncword_offset_,n=(31&t[i+1])<<8|t[i+2];if(i+3+n>=this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var a=new f(t.subarray(i+3,i+3+n)),o=null;if(a.readBool()){if(null==e){s.a.w(this.TAG,"StreamMuxConfig Missing"),this.current_syncword_offset_=this.findNextSyncwordOffset(i+3+n),a.destroy();continue}o=e}else{var c=a.readBool();if(c&&a.readBool()){s.a.e(this.TAG,"audioMuxVersionA is Not Supported"),a.destroy();break}if(c&&this.getLATMValue(a),!a.readBool()){s.a.e(this.TAG,"allStreamsSameTimeFraming zero is Not Supported"),a.destroy();break}if(0!==a.readBits(6)){s.a.e(this.TAG,"more than 2 numSubFrames Not Supported"),a.destroy();break}if(0!==a.readBits(4)){s.a.e(this.TAG,"more than 2 numProgram Not Supported"),a.destroy();break}if(0!==a.readBits(3)){s.a.e(this.TAG,"more than 2 numLayer Not Supported"),a.destroy();break}var l=c?this.getLATMValue(a):0,d=a.readBits(5);l-=5;var u=a.readBits(4);l-=4;var h=a.readBits(4);l-=4,a.readBits(3),(l-=3)>0&&a.readBits(l);var p=a.readBits(3);if(0!==p){s.a.e(this.TAG,"frameLengthType = "+p+". Only frameLengthType = 0 Supported"),a.destroy();break}a.readByte();var m=a.readBool();if(m)if(c)this.getLATMValue(a);else{for(var g=0;;){g<<=8;var v=a.readBool();if(g+=a.readByte(),!v)break}console.log(g)}a.readBool()&&a.readByte(),(o=new G).audio_object_type=d,o.sampling_freq_index=u,o.sampling_frequency=j[o.sampling_freq_index],o.channel_config=h,o.other_data_present=m}for(var _=0;;){var y=a.readByte();if(_+=y,255!==y)break}for(var b=new Uint8Array(_),E=0;E<_;E++)b[E]=a.readByte();(r=new G).audio_object_type=o.audio_object_type,r.sampling_freq_index=o.sampling_freq_index,r.sampling_frequency=j[o.sampling_freq_index],r.channel_config=o.channel_config,r.other_data_present=o.other_data_present,r.data=b,this.current_syncword_offset_=this.findNextSyncwordOffset(i+3+n)}return r},e.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},e.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},e}(),q=function(e){var t=null,r=e.audio_object_type,i=e.audio_object_type,n=e.sampling_freq_index,s=e.channel_config,a=0,o=navigator.userAgent.toLowerCase();-1!==o.indexOf("firefox")?n>=6?(i=5,t=new Array(4),a=n-3):(i=2,t=new Array(2),a=n):-1!==o.indexOf("android")?(i=2,t=new Array(2),a=n):(i=5,a=n,t=new Array(4),n>=6?a=n-3:1===s&&(i=2,t=new Array(2),a=n)),t[0]=i<<3,t[0]|=(15&n)>>>1,t[1]=(15&n)<<7,t[1]|=(15&s)<<3,5===i&&(t[1]|=(15&a)>>>1,t[2]=(1&a)<<7,t[2]|=8,t[3]=0),this.config=t,this.sampling_rate=j[n],this.channel_count=s,this.codec_mimetype="mp4a.40."+i,this.original_codec_mimetype="mp4a.40."+r},W=function(){},z=function(){};!function(e){e[e.kSpliceNull=0]="kSpliceNull",e[e.kSpliceSchedule=4]="kSpliceSchedule",e[e.kSpliceInsert=5]="kSpliceInsert",e[e.kTimeSignal=6]="kTimeSignal",e[e.kBandwidthReservation=7]="kBandwidthReservation",e[e.kPrivateCommand=255]="kPrivateCommand"}(B||(B={}));var $,Y=function(e){var t=e.readBool();return t?(e.readBits(6),{time_specified_flag:t,pts_time:4*e.readBits(31)+e.readBits(2)}):(e.readBits(7),{time_specified_flag:t})},Q=function(e){var t=e.readBool();return e.readBits(6),{auto_return:t,duration:4*e.readBits(31)+e.readBits(2)}},J=function(e,t){var r=t.readBits(8);return e?{component_tag:r}:{component_tag:r,splice_time:Y(t)}},X=function(e){return{component_tag:e.readBits(8),utc_splice_time:e.readBits(32)}},Z=function(e){var t=e.readBits(32),r=e.readBool();e.readBits(7);var i={splice_event_id:t,splice_event_cancel_indicator:r};if(r)return i;if(i.out_of_network_indicator=e.readBool(),i.program_splice_flag=e.readBool(),i.duration_flag=e.readBool(),e.readBits(5),i.program_splice_flag)i.utc_splice_time=e.readBits(32);else{i.component_count=e.readBits(8),i.components=[];for(var n=0;n<i.component_count;n++)i.components.push(X(e))}return i.duration_flag&&(i.break_duration=Q(e)),i.unique_program_id=e.readBits(16),i.avail_num=e.readBits(8),i.avails_expected=e.readBits(8),i},ee=function(e,t,r,i){return{descriptor_tag:e,descriptor_length:t,identifier:r,provider_avail_id:i.readBits(32)}},te=function(e,t,r,i){var n=i.readBits(8),s=i.readBits(3);i.readBits(5);for(var a="",o=0;o<s;o++)a+=String.fromCharCode(i.readBits(8));return{descriptor_tag:e,descriptor_length:t,identifier:r,preroll:n,dtmf_count:s,DTMF_char:a}},re=function(e){var t=e.readBits(8);return e.readBits(7),{component_tag:t,pts_offset:4*e.readBits(31)+e.readBits(2)}},ie=function(e,t,r,i){var n=i.readBits(32),s=i.readBool();i.readBits(7);var a={descriptor_tag:e,descriptor_length:t,identifier:r,segmentation_event_id:n,segmentation_event_cancel_indicator:s};if(s)return a;if(a.program_segmentation_flag=i.readBool(),a.segmentation_duration_flag=i.readBool(),a.delivery_not_restricted_flag=i.readBool(),a.delivery_not_restricted_flag?i.readBits(5):(a.web_delivery_allowed_flag=i.readBool(),a.no_regional_blackout_flag=i.readBool(),a.archive_allowed_flag=i.readBool(),a.device_restrictions=i.readBits(2)),!a.program_segmentation_flag){a.component_count=i.readBits(8),a.components=[];for(var o=0;o<a.component_count;o++)a.components.push(re(i))}a.segmentation_duration_flag&&(a.segmentation_duration=i.readBits(40)),a.segmentation_upid_type=i.readBits(8),a.segmentation_upid_length=i.readBits(8);var c=new Uint8Array(a.segmentation_upid_length);for(o=0;o<a.segmentation_upid_length;o++)c[o]=i.readBits(8);return a.segmentation_upid=c.buffer,a.segmentation_type_id=i.readBits(8),a.segment_num=i.readBits(8),a.segments_expected=i.readBits(8),52!==a.segmentation_type_id&&54!==a.segmentation_type_id&&56!==a.segmentation_type_id&&58!==a.segmentation_type_id||(a.sub_segment_num=i.readBits(8),a.sub_segments_expected=i.readBits(8)),a},ne=function(e,t,r,i){return{descriptor_tag:e,descriptor_length:t,identifier:r,TAI_seconds:i.readBits(48),TAI_ns:i.readBits(32),UTC_offset:i.readBits(16)}},se=function(e){return{component_tag:e.readBits(8),ISO_code:String.fromCharCode(e.readBits(8),e.readBits(8),e.readBits(8)),Bit_Stream_Mode:e.readBits(3),Num_Channels:e.readBits(4),Full_Srvc_Audio:e.readBool()}},ae=function(e,t,r,i){for(var n=i.readBits(4),s=[],a=0;a<n;a++)s.push(se(i));return{descriptor_tag:e,descriptor_length:t,identifier:r,audio_count:n,components:s}};!function(e){e[e.kSliceIDR_W_RADL=19]="kSliceIDR_W_RADL",e[e.kSliceIDR_N_LP=20]="kSliceIDR_N_LP",e[e.kSliceCRA_NUT=21]="kSliceCRA_NUT",e[e.kSliceVPS=32]="kSliceVPS",e[e.kSliceSPS=33]="kSliceSPS",e[e.kSlicePPS=34]="kSlicePPS",e[e.kSliceAUD=35]="kSliceAUD"}($||($={}));var oe=function(){},ce=function(e){var t=e.data.byteLength;this.type=e.type,this.data=new Uint8Array(4+t),new DataView(this.data.buffer).setUint32(0,t),this.data.set(e.data,4)},le=function(){function e(e){this.TAG="H265AnnexBParser",this.current_startcode_offset_=0,this.eof_flag_=!1,this.data_=e,this.current_startcode_offset_=this.findNextStartCodeOffset(0),this.eof_flag_&&s.a.e(this.TAG,"Could not find H265 startcode until payload end!")}return e.prototype.findNextStartCodeOffset=function(e){for(var t=e,r=this.data_;;){if(t+3>=r.byteLength)return this.eof_flag_=!0,r.byteLength;var i=r[t+0]<<24|r[t+1]<<16|r[t+2]<<8|r[t+3],n=r[t+0]<<16|r[t+1]<<8|r[t+2];if(1===i||1===n)return t;t++}},e.prototype.readNextNaluPayload=function(){for(var e=this.data_,t=null;null==t&&!this.eof_flag_;){var r=this.current_startcode_offset_,i=e[r+=1==(e[r]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3])?4:3]>>1&63,n=(128&e[r])>>>7,s=this.findNextStartCodeOffset(r);if(this.current_startcode_offset_=s,0===n){var a=e.subarray(r,s);(t=new oe).type=i,t.data=a}}return t},e}(),de=function(){function e(e,t,r,i){var n=23+(5+e.byteLength)+(5+t.byteLength)+(5+r.byteLength),s=this.data=new Uint8Array(n);s[0]=1,s[1]=(3&i.general_profile_space)<<6|(i.general_tier_flag?1:0)<<5|31&i.general_profile_idc,s[2]=i.general_profile_compatibility_flags_1,s[3]=i.general_profile_compatibility_flags_2,s[4]=i.general_profile_compatibility_flags_3,s[5]=i.general_profile_compatibility_flags_4,s[6]=i.general_constraint_indicator_flags_1,s[7]=i.general_constraint_indicator_flags_2,s[8]=i.general_constraint_indicator_flags_3,s[9]=i.general_constraint_indicator_flags_4,s[10]=i.general_constraint_indicator_flags_5,s[11]=i.general_constraint_indicator_flags_6,s[12]=i.general_level_idc,s[13]=240|(3840&i.min_spatial_segmentation_idc)>>8,s[14]=255&i.min_spatial_segmentation_idc,s[15]=252|3&i.parallelismType,s[16]=252|3&i.chroma_format_idc,s[17]=248|7&i.bit_depth_luma_minus8,s[18]=248|7&i.bit_depth_chroma_minus8,s[19]=0,s[20]=0,s[21]=(3&i.constant_frame_rate)<<6|(7&i.num_temporal_layers)<<3|(i.temporal_id_nested?1:0)<<2|3,s[22]=3,s[23]=128|$.kSliceVPS,s[24]=0,s[25]=1,s[26]=(65280&e.byteLength)>>8,s[27]=(255&e.byteLength)>>0,s.set(e,28),s[23+(5+e.byteLength)+0]=128|$.kSliceSPS,s[23+(5+e.byteLength)+1]=0,s[23+(5+e.byteLength)+2]=1,s[23+(5+e.byteLength)+3]=(65280&t.byteLength)>>8,s[23+(5+e.byteLength)+4]=(255&t.byteLength)>>0,s.set(t,23+(5+e.byteLength)+5),s[23+(5+e.byteLength+5+t.byteLength)+0]=128|$.kSlicePPS,s[23+(5+e.byteLength+5+t.byteLength)+1]=0,s[23+(5+e.byteLength+5+t.byteLength)+2]=1,s[23+(5+e.byteLength+5+t.byteLength)+3]=(65280&r.byteLength)>>8,s[23+(5+e.byteLength+5+t.byteLength)+4]=(255&r.byteLength)>>0,s.set(r,23+(5+e.byteLength+5+t.byteLength)+5)}return e.prototype.getData=function(){return this.data},e}(),ue=function(){},he=function(){},pe=function(){},fe=[[64,64,80,80,96,96,112,112,128,128,160,160,192,192,224,224,256,256,320,320,384,384,448,448,512,512,640,640,768,768,896,896,1024,1024,1152,1152,1280,1280],[69,70,87,88,104,105,121,122,139,140,174,175,208,209,243,244,278,279,348,349,417,418,487,488,557,558,696,697,835,836,975,976,1114,1115,1253,1254,1393,1394],[96,96,120,120,144,144,168,168,192,192,240,240,288,288,336,336,384,384,480,480,576,576,672,672,768,768,960,960,1152,1152,1344,1344,1536,1536,1728,1728,1920,1920]],me=function(){function e(e){this.TAG="AC3Parser",this.data_=e,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&s.a.e(this.TAG,"Could not found AC3 syncword until payload end")}return e.prototype.findNextSyncwordOffset=function(e){for(var t=e,r=this.data_;;){if(t+7>=r.byteLength)return this.eof_flag_=!0,r.byteLength;if(2935==(r[t+0]<<8|r[t+1]<<0))return t;t++}},e.prototype.readNextAC3Frame=function(){for(var e=this.data_,t=null;null==t&&!this.eof_flag_;){var r=this.current_syncword_offset_,i=e[r+4]>>6,n=[48e3,44200,33e3][i],s=63&e[r+4],a=2*fe[i][s];if(r+a>this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var o=this.findNextSyncwordOffset(r+a);this.current_syncword_offset_=o;var c=e[r+5]>>3,l=7&e[r+5],d=e[r+6]>>5,u=0;0!=(1&d)&&1!==d&&(u+=2),0!=(4&d)&&(u+=2),2===d&&(u+=2);var h=(e[r+6]<<8|e[r+7]<<0)>>12-u&1,p=[2,1,2,3,3,4,4,5][d]+h;(t=new pe).sampling_frequency=n,t.channel_count=p,t.channel_mode=d,t.bit_stream_identification=c,t.low_frequency_effects_channel_on=h,t.bit_stream_mode=l,t.frame_size_code=s,t.data=e.subarray(r,r+a)}return t},e.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},e.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},e}(),ge=function(e){var t;t=[e.sampling_rate_code<<6|e.bit_stream_identification<<1|e.bit_stream_mode>>2,(3&e.bit_stream_mode)<<6|e.channel_mode<<3|e.low_frequency_effects_channel_on<<2|e.frame_size_code>>4,e.frame_size_code<<4&224],this.config=t,this.sampling_rate=e.sampling_frequency,this.bit_stream_identification=e.bit_stream_identification,this.bit_stream_mode=e.bit_stream_mode,this.low_frequency_effects_channel_on=e.low_frequency_effects_channel_on,this.channel_count=e.channel_count,this.channel_mode=e.channel_mode,this.codec_mimetype="ac-3",this.original_codec_mimetype="ac-3"},ve=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),_e=function(){return(_e=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},ye=function(e){function t(t,r){var i=e.call(this)||this;return i.TAG="TSDemuxer",i.first_parse_=!0,i.media_info_=new o.a,i.timescale_=90,i.duration_=0,i.current_pmt_pid_=-1,i.program_pmt_map_={},i.pes_slice_queues_={},i.section_slice_queues_={},i.video_metadata_={vps:void 0,sps:void 0,pps:void 0,details:void 0},i.audio_metadata_={codec:void 0,audio_object_type:void 0,sampling_freq_index:void 0,sampling_frequency:void 0,channel_config:void 0},i.aac_last_sample_pts_=void 0,i.aac_last_incomplete_data_=null,i.has_video_=!1,i.has_audio_=!1,i.video_init_segment_dispatched_=!1,i.audio_init_segment_dispatched_=!1,i.video_metadata_changed_=!1,i.audio_metadata_changed_=!1,i.loas_previous_frame=null,i.video_track_={type:"video",id:1,sequenceNumber:0,samples:[],length:0},i.audio_track_={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},i.ts_packet_size_=t.ts_packet_size,i.sync_offset_=t.sync_offset,i.config_=r,i}return ve(t,e),t.prototype.destroy=function(){this.media_info_=null,this.pes_slice_queues_=null,this.section_slice_queues_=null,this.video_metadata_=null,this.audio_metadata_=null,this.aac_last_incomplete_data_=null,this.video_track_=null,this.audio_track_=null,e.prototype.destroy.call(this)},t.probe=function(e){var t=new Uint8Array(e),r=-1,i=188;if(t.byteLength<=3*i)return{needMoreData:!0};for(;-1===r;){for(var n=Math.min(1e3,t.byteLength-3*i),a=0;a<n;){if(71===t[a]&&71===t[a+i]&&71===t[a+2*i]){r=a;break}a++}if(-1===r)if(188===i)i=192;else{if(192!==i)break;i=204}}return-1===r?{match:!1}:(192===i&&r>=4?(s.a.v("TSDemuxer","ts_packet_size = 192, m2ts mode"),r-=4):204===i&&s.a.v("TSDemuxer","ts_packet_size = 204, RS encoded MPEG2-TS stream"),{match:!0,consumed:0,ts_packet_size:i,sync_offset:r})},t.prototype.bindDataSource=function(e){return e.onDataArrival=this.parseChunks.bind(this),this},t.prototype.resetMediaInfo=function(){this.media_info_=new o.a},t.prototype.parseChunks=function(e,t){if(!(this.onError&&this.onMediaInfo&&this.onTrackMetadata&&this.onDataAvailable))throw new u.a("onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var r=0;for(this.first_parse_&&(this.first_parse_=!1,r=this.sync_offset_);r+this.ts_packet_size_<=e.byteLength;){var i=t+r;192===this.ts_packet_size_&&(r+=4);var n=new Uint8Array(e,r,188),a=n[0];if(71!==a){s.a.e(this.TAG,"sync_byte = "+a+", not 0x47");break}var o=(64&n[1])>>>6,c=(n[1],(31&n[1])<<8|n[2]),l=(48&n[3])>>>4,d=15&n[3],h={},p=4;if(2==l||3==l){var f=n[4];if(5+f===188){r+=188,204===this.ts_packet_size_&&(r+=16);continue}f>0&&(h=this.parseAdaptationField(e,r+4,1+f)),p=5+f}if(1==l||3==l)if(0===c||c===this.current_pmt_pid_||null!=this.pmt_&&this.pmt_.pid_stream_type[c]===E.kSCTE35){var m=188-p;this.handleSectionSlice(e,r+p,m,{pid:c,file_position:i,payload_unit_start_indicator:o,continuity_conunter:d,random_access_indicator:h.random_access_indicator})}else if(null!=this.pmt_&&null!=this.pmt_.pid_stream_type[c]){m=188-p;var g=this.pmt_.pid_stream_type[c];c!==this.pmt_.common_pids.h264&&c!==this.pmt_.common_pids.h265&&c!==this.pmt_.common_pids.adts_aac&&c!==this.pmt_.common_pids.loas_aac&&c!==this.pmt_.common_pids.ac3&&c!==this.pmt_.common_pids.opus&&c!==this.pmt_.common_pids.mp3&&!0!==this.pmt_.pes_private_data_pids[c]&&!0!==this.pmt_.timed_id3_pids[c]||this.handlePESSlice(e,r+p,m,{pid:c,stream_type:g,file_position:i,payload_unit_start_indicator:o,continuity_conunter:d,random_access_indicator:h.random_access_indicator})}r+=188,204===this.ts_packet_size_&&(r+=16)}return this.dispatchAudioVideoMediaSegment(),r},t.prototype.parseAdaptationField=function(e,t,r){var i=new Uint8Array(e,t,r),n=i[0];return n>0?n>183?(s.a.w(this.TAG,"Illegal adaptation_field_length: "+n),{}):{discontinuity_indicator:(128&i[1])>>>7,random_access_indicator:(64&i[1])>>>6,elementary_stream_priority_indicator:(32&i[1])>>>5}:{}},t.prototype.handleSectionSlice=function(e,t,r,i){var n=new Uint8Array(e,t,r),s=this.section_slice_queues_[i.pid];if(i.payload_unit_start_indicator){var a=n[0];if(null!=s&&0!==s.total_length){var o=new Uint8Array(e,t+1,Math.min(r,a));s.slices.push(o),s.total_length+=o.byteLength,s.total_length===s.expected_length?this.emitSectionSlices(s,i):this.clearSlices(s,i)}for(var c=1+a;c<n.byteLength&&255!==n[c+0];){var l=(15&n[c+1])<<8|n[c+2];this.section_slice_queues_[i.pid]=new L,(s=this.section_slice_queues_[i.pid]).expected_length=l+3,s.file_position=i.file_position,s.random_access_indicator=i.random_access_indicator,o=new Uint8Array(e,t+c,Math.min(r-c,s.expected_length-s.total_length)),s.slices.push(o),s.total_length+=o.byteLength,s.total_length===s.expected_length?this.emitSectionSlices(s,i):s.total_length>=s.expected_length&&this.clearSlices(s,i),c+=o.byteLength}}else null!=s&&0!==s.total_length&&(o=new Uint8Array(e,t,Math.min(r,s.expected_length-s.total_length)),s.slices.push(o),s.total_length+=o.byteLength,s.total_length===s.expected_length?this.emitSectionSlices(s,i):s.total_length>=s.expected_length&&this.clearSlices(s,i))},t.prototype.handlePESSlice=function(e,t,r,i){var n=new Uint8Array(e,t,r),a=n[0]<<16|n[1]<<8|n[2],o=(n[3],n[4]<<8|n[5]);if(i.payload_unit_start_indicator){if(1!==a)return void s.a.e(this.TAG,"handlePESSlice: packet_start_code_prefix should be 1 but with value "+a);var c=this.pes_slice_queues_[i.pid];c&&(0===c.expected_length||c.expected_length===c.total_length?this.emitPESSlices(c,i):this.clearSlices(c,i)),this.pes_slice_queues_[i.pid]=new L,this.pes_slice_queues_[i.pid].file_position=i.file_position,this.pes_slice_queues_[i.pid].random_access_indicator=i.random_access_indicator}if(null!=this.pes_slice_queues_[i.pid]){var l=this.pes_slice_queues_[i.pid];l.slices.push(n),i.payload_unit_start_indicator&&(l.expected_length=0===o?0:o+6),l.total_length+=n.byteLength,l.expected_length>0&&l.expected_length===l.total_length?this.emitPESSlices(l,i):l.expected_length>0&&l.expected_length<l.total_length&&this.clearSlices(l,i)}},t.prototype.emitSectionSlices=function(e,t){for(var r=new Uint8Array(e.total_length),i=0,n=0;i<e.slices.length;i++){var s=e.slices[i];r.set(s,n),n+=s.byteLength}e.slices=[],e.expected_length=-1,e.total_length=0;var a=new D;a.pid=t.pid,a.data=r,a.file_position=e.file_position,a.random_access_indicator=e.random_access_indicator,this.parseSection(a)},t.prototype.emitPESSlices=function(e,t){for(var r=new Uint8Array(e.total_length),i=0,n=0;i<e.slices.length;i++){var s=e.slices[i];r.set(s,n),n+=s.byteLength}e.slices=[],e.expected_length=-1,e.total_length=0;var a=new P;a.pid=t.pid,a.data=r,a.stream_type=t.stream_type,a.file_position=e.file_position,a.random_access_indicator=e.random_access_indicator,this.parsePES(a)},t.prototype.clearSlices=function(e,t){e.slices=[],e.expected_length=-1,e.total_length=0},t.prototype.parseSection=function(e){var t=e.data,r=e.pid;0===r?this.parsePAT(t):r===this.current_pmt_pid_?this.parsePMT(t):null!=this.pmt_&&this.pmt_.scte_35_pids[r]&&this.parseSCTE35(t)},t.prototype.parsePES=function(e){var t=e.data,r=t[0]<<16|t[1]<<8|t[2],i=t[3],n=t[4]<<8|t[5];if(1===r)if(188!==i&&190!==i&&191!==i&&240!==i&&241!==i&&255!==i&&242!==i&&248!==i){t[6];var a=(192&t[7])>>>6,o=t[8],c=void 0,l=void 0;2!==a&&3!==a||(c=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,l=3===a?536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2:c);var d=9+o,u=void 0;if(0!==n){if(n<3+o)return void s.a.v(this.TAG,"Malformed PES: PES_packet_length < 3 + PES_header_data_length");u=n-3-o}else u=t.byteLength-d;var h=t.subarray(d,d+u);switch(e.stream_type){case E.kMPEG1Audio:case E.kMPEG2Audio:this.parseMP3Payload(h,c);break;case E.kPESPrivateData:this.pmt_.common_pids.opus===e.pid?this.parseOpusPayload(h,c):this.pmt_.common_pids.ac3===e.pid?this.parseAC3Payload(h,c):this.pmt_.smpte2038_pids[e.pid]?this.parseSMPTE2038MetadataPayload(h,c,l,e.pid,i):this.parsePESPrivateDataPayload(h,c,l,e.pid,i);break;case E.kADTSAAC:this.parseADTSAACPayload(h,c);break;case E.kLOASAAC:this.parseLOASAACPayload(h,c);break;case E.kAC3:this.parseAC3Payload(h,c);break;case E.kID3:this.parseTimedID3MetadataPayload(h,c,l,e.pid,i);break;case E.kH264:this.parseH264Payload(h,c,l,e.file_position,e.random_access_indicator);break;case E.kH265:this.parseH265Payload(h,c,l,e.file_position,e.random_access_indicator)}}else 188!==i&&191!==i&&240!==i&&241!==i&&255!==i&&242!==i&&248!==i||e.stream_type!==E.kPESPrivateData||(d=6,u=void 0,u=0!==n?n:t.byteLength-d,h=t.subarray(d,d+u),this.parsePESPrivateDataPayload(h,void 0,void 0,e.pid,i));else s.a.e(this.TAG,"parsePES: packet_start_code_prefix should be 1 but with value "+r)},t.prototype.parsePAT=function(e){var t=e[0];if(0===t){var r=(15&e[1])<<8|e[2],i=(e[3],e[4],(62&e[5])>>>1),n=1&e[5],a=e[6],o=(e[7],null);if(1===n&&0===a)(o=new R).version_number=i;else if(null==(o=this.pat_))return;for(var c=r-5-4,l=-1,d=-1,u=8;u<8+c;u+=4){var h=e[u]<<8|e[u+1],p=(31&e[u+2])<<8|e[u+3];0===h?o.network_pid=p:(o.program_pmt_pid[h]=p,-1===l&&(l=h),-1===d&&(d=p))}1===n&&0===a&&(null==this.pat_&&s.a.v(this.TAG,"Parsed first PAT: "+JSON.stringify(o)),this.pat_=o,this.current_program_=l,this.current_pmt_pid_=d)}else s.a.e(this.TAG,"parsePAT: table_id "+t+" is not corresponded to PAT!")},t.prototype.parsePMT=function(e){var t=e[0];if(2===t){var r=(15&e[1])<<8|e[2],i=e[3]<<8|e[4],n=(62&e[5])>>>1,a=1&e[5],o=e[6],c=(e[7],null);if(1===a&&0===o)(c=new A).program_number=i,c.version_number=n,this.program_pmt_map_[i]=c;else if(null==(c=this.program_pmt_map_[i]))return;e[8],e[9];for(var l=(15&e[10])<<8|e[11],d=12+l,u=r-9-l-4,h=d;h<d+u;){var p=e[h],f=(31&e[h+1])<<8|e[h+2],m=(15&e[h+3])<<8|e[h+4];c.pid_stream_type[f]=p;var g=c.common_pids.h264||c.common_pids.h265,v=c.common_pids.adts_aac||c.common_pids.loas_aac||c.common_pids.ac3||c.common_pids.opus||c.common_pids.mp3;if(p!==E.kH264||g)if(p!==E.kH265||g)if(p!==E.kADTSAAC||v)if(p!==E.kLOASAAC||v)if(p!==E.kAC3||v)if(p!==E.kMPEG1Audio&&p!==E.kMPEG2Audio||v)if(p===E.kPESPrivateData){if(c.pes_private_data_pids[f]=!0,m>0){for(var _=h+5;_<h+5+m;){var y=e[_+0],b=e[_+1];if(5===y){var S=String.fromCharCode.apply(String,Array.from(e.subarray(_+2,_+2+b)));"VANC"===S?c.smpte2038_pids[f]=!0:"Opus"===S&&(c.common_pids.opus=f)}else if(127===y&&f===c.common_pids.opus){var w=null;if(128===e[_+2]&&(w=e[_+3]),null==w){s.a.e(this.TAG,"Not Supported Opus channel count.");continue}var T={codec:"opus",channel_count:0==(15&w)?2:15&w,channel_config_code:w,sample_rate:48e3},R={codec:"opus",meta:T};0==this.audio_init_segment_dispatched_?(this.audio_metadata_=T,this.dispatchAudioInitSegment(R)):this.detectAudioMetadataChange(R)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(R))}_+=2+b}var C=e.subarray(h+5,h+5+m);this.dispatchPESPrivateDataDescriptor(f,p,C)}}else p===E.kID3?c.timed_id3_pids[f]=!0:p===E.kSCTE35&&(c.scte_35_pids[f]=!0);else c.common_pids.mp3=f;else c.common_pids.ac3=f;else c.common_pids.loas_aac=f;else c.common_pids.adts_aac=f;else c.common_pids.h265=f;else c.common_pids.h264=f;h+=5+m}i===this.current_program_&&(null==this.pmt_&&s.a.v(this.TAG,"Parsed first PMT: "+JSON.stringify(c)),this.pmt_=c,(c.common_pids.h264||c.common_pids.h265)&&(this.has_video_=!0),(c.common_pids.adts_aac||c.common_pids.loas_aac||c.common_pids.ac3||c.common_pids.opus||c.common_pids.mp3)&&(this.has_audio_=!0))}else s.a.e(this.TAG,"parsePMT: table_id "+t+" is not corresponded to PMT!")},t.prototype.parseSCTE35=function(e){var t=function(e){var t=new f(e),r=t.readBits(8),i=t.readBool(),n=t.readBool();t.readBits(2);var s=t.readBits(12),a=t.readBits(8),o=t.readBool(),c=t.readBits(6),l=4*t.readBits(31)+t.readBits(2),d=t.readBits(8),u=t.readBits(12),h=t.readBits(12),p=t.readBits(8),m=null;p===B.kSpliceNull?m={}:p===B.kSpliceSchedule?m=function(e){for(var t=e.readBits(8),r=[],i=0;i<t;i++)r.push(Z(e));return{splice_count:t,events:r}}(t):p===B.kSpliceInsert?m=function(e){var t=e.readBits(32),r=e.readBool();e.readBits(7);var i={splice_event_id:t,splice_event_cancel_indicator:r};if(r)return i;if(i.out_of_network_indicator=e.readBool(),i.program_splice_flag=e.readBool(),i.duration_flag=e.readBool(),i.splice_immediate_flag=e.readBool(),e.readBits(4),i.program_splice_flag&&!i.splice_immediate_flag&&(i.splice_time=Y(e)),!i.program_splice_flag){i.component_count=e.readBits(8),i.components=[];for(var n=0;n<i.component_count;n++)i.components.push(J(i.splice_immediate_flag,e))}return i.duration_flag&&(i.break_duration=Q(e)),i.unique_program_id=e.readBits(16),i.avail_num=e.readBits(8),i.avails_expected=e.readBits(8),i}(t):p===B.kTimeSignal?m=function(e){return{splice_time:Y(e)}}(t):p===B.kBandwidthReservation?m={}:p===B.kPrivateCommand?m=function(e,t){for(var r=String.fromCharCode(t.readBits(8),t.readBits(8),t.readBits(8),t.readBits(8)),i=new Uint8Array(e-4),n=0;n<e-4;n++)i[n]=t.readBits(8);return{identifier:r,private_data:i.buffer}}(h,t):t.readBits(8*h);for(var g=[],v=t.readBits(16),_=0;_<v;){var y=t.readBits(8),b=t.readBits(8),E=String.fromCharCode(t.readBits(8),t.readBits(8),t.readBits(8),t.readBits(8));0===y?g.push(ee(y,b,E,t)):1===y?g.push(te(y,b,E,t)):2===y?g.push(ie(y,b,E,t)):3===y?g.push(ne(y,b,E,t)):4===y?g.push(ae(y,b,E,t)):t.readBits(8*(b-4)),_+=2+b}var S={table_id:r,section_syntax_indicator:i,private_indicator:n,section_length:s,protocol_version:a,encrypted_packet:o,encryption_algorithm:c,pts_adjustment:l,cw_index:d,tier:u,splice_command_length:h,splice_command_type:p,splice_command:m,descriptor_loop_length:v,splice_descriptors:g,E_CRC32:o?t.readBits(32):void 0,CRC32:t.readBits(32)};if(p===B.kSpliceInsert){var w=m;if(w.splice_event_cancel_indicator)return{splice_command_type:p,detail:S,data:e};if(w.program_splice_flag&&!w.splice_immediate_flag){var T=w.duration_flag?w.break_duration.auto_return:void 0,R=w.duration_flag?w.break_duration.duration/90:void 0;return w.splice_time.time_specified_flag?{splice_command_type:p,pts:(l+w.splice_time.pts_time)%Math.pow(2,33),auto_return:T,duraiton:R,detail:S,data:e}:{splice_command_type:p,auto_return:T,duraiton:R,detail:S,data:e}}return{splice_command_type:p,auto_return:T=w.duration_flag?w.break_duration.auto_return:void 0,duraiton:R=w.duration_flag?w.break_duration.duration/90:void 0,detail:S,data:e}}if(p===B.kTimeSignal){var C=m;return C.splice_time.time_specified_flag?{splice_command_type:p,pts:(l+C.splice_time.pts_time)%Math.pow(2,33),detail:S,data:e}:{splice_command_type:p,detail:S,data:e}}return{splice_command_type:p,detail:S,data:e}}(e);if(null!=t.pts){var r=Math.floor(t.pts/this.timescale_);t.pts=r}else t.nearest_pts=this.aac_last_sample_pts_;this.onSCTE35Metadata&&this.onSCTE35Metadata(t)},t.prototype.parseH264Payload=function(e,t,r,i,n){for(var a=new x(e),o=null,c=[],l=0,d=!1;null!=(o=a.readNextNaluPayload());){var u=new M(o);if(u.type===C.kSliceSPS){var h=m.parseSPS(o.data);this.video_init_segment_dispatched_?!0===this.detectVideoMetadataChange(u,h)&&(s.a.v(this.TAG,"H264: Critical h264 metadata has been changed, attempt to re-generate InitSegment"),this.video_metadata_changed_=!0,this.video_metadata_={vps:void 0,sps:u,pps:void 0,details:h}):(this.video_metadata_.sps=u,this.video_metadata_.details=h)}else u.type===C.kSlicePPS?this.video_init_segment_dispatched_&&!this.video_metadata_changed_||(this.video_metadata_.pps=u,this.video_metadata_.sps&&this.video_metadata_.pps&&(this.video_metadata_changed_&&this.dispatchVideoMediaSegment(),this.dispatchVideoInitSegment())):(u.type===C.kSliceIDR||u.type===C.kSliceNonIDR&&1===n)&&(d=!0);this.video_init_segment_dispatched_&&(c.push(u),l+=u.data.byteLength)}var p=Math.floor(t/this.timescale_),f=Math.floor(r/this.timescale_);if(c.length){var g=this.video_track_,v={units:c,length:l,isKeyframe:d,dts:f,pts:p,cts:p-f,file_position:i};g.samples.push(v),g.length+=l}},t.prototype.parseH265Payload=function(e,t,r,i,n){for(var a=new le(e),o=null,c=[],l=0,d=!1;null!=(o=a.readNextNaluPayload());){var u=new ce(o);if(u.type===$.kSliceVPS){if(!this.video_init_segment_dispatched_){var h=v.parseVPS(o.data);this.video_metadata_.vps=u,this.video_metadata_.details=_e(_e({},this.video_metadata_.details),h)}}else u.type===$.kSliceSPS?(h=v.parseSPS(o.data),this.video_init_segment_dispatched_?!0===this.detectVideoMetadataChange(u,h)&&(s.a.v(this.TAG,"H265: Critical h265 metadata has been changed, attempt to re-generate InitSegment"),this.video_metadata_changed_=!0,this.video_metadata_={vps:void 0,sps:u,pps:void 0,details:h}):(this.video_metadata_.sps=u,this.video_metadata_.details=_e(_e({},this.video_metadata_.details),h))):u.type===$.kSlicePPS?this.video_init_segment_dispatched_&&!this.video_metadata_changed_||(h=v.parsePPS(o.data),this.video_metadata_.pps=u,this.video_metadata_.details=_e(_e({},this.video_metadata_.details),h),this.video_metadata_.vps&&this.video_metadata_.sps&&this.video_metadata_.pps&&(this.video_metadata_changed_&&this.dispatchVideoMediaSegment(),this.dispatchVideoInitSegment())):u.type!==$.kSliceIDR_W_RADL&&u.type!==$.kSliceIDR_N_LP&&u.type!==$.kSliceCRA_NUT||(d=!0);this.video_init_segment_dispatched_&&(c.push(u),l+=u.data.byteLength)}var p=Math.floor(t/this.timescale_),f=Math.floor(r/this.timescale_);if(c.length){var m=this.video_track_,g={units:c,length:l,isKeyframe:d,dts:f,pts:p,cts:p-f,file_position:i};m.samples.push(g),m.length+=l}},t.prototype.detectVideoMetadataChange=function(e,t){if(t.codec_mimetype!==this.video_metadata_.details.codec_mimetype)return s.a.v(this.TAG,"Video: Codec mimeType changed from "+this.video_metadata_.details.codec_mimetype+" to "+t.codec_mimetype),!0;if(t.codec_size.width!==this.video_metadata_.details.codec_size.width||t.codec_size.height!==this.video_metadata_.details.codec_size.height){var r=this.video_metadata_.details.codec_size,i=t.codec_size;return s.a.v(this.TAG,"Video: Coded Resolution changed from "+r.width+"x"+r.height+" to "+i.width+"x"+i.height),!0}return t.present_size.width!==this.video_metadata_.details.present_size.width&&(s.a.v(this.TAG,"Video: Present resolution width changed from "+this.video_metadata_.details.present_size.width+" to "+t.present_size.width),!0)},t.prototype.isInitSegmentDispatched=function(){return this.has_video_&&this.has_audio_?this.video_init_segment_dispatched_&&this.audio_init_segment_dispatched_:this.has_video_&&!this.has_audio_?this.video_init_segment_dispatched_:!(this.has_video_||!this.has_audio_)&&this.audio_init_segment_dispatched_},t.prototype.dispatchVideoInitSegment=function(){var e=this.video_metadata_.details,t={type:"video"};t.id=this.video_track_.id,t.timescale=1e3,t.duration=this.duration_,t.codecWidth=e.codec_size.width,t.codecHeight=e.codec_size.height,t.presentWidth=e.present_size.width,t.presentHeight=e.present_size.height,t.profile=e.profile_string,t.level=e.level_string,t.bitDepth=e.bit_depth,t.chromaFormat=e.chroma_format,t.sarRatio=e.sar_ratio,t.frameRate=e.frame_rate;var r=t.frameRate.fps_den,i=t.frameRate.fps_num;if(t.refSampleDuration=r/i*1e3,t.codec=e.codec_mimetype,this.video_metadata_.vps){var n=this.video_metadata_.vps.data.subarray(4),a=this.video_metadata_.sps.data.subarray(4),o=this.video_metadata_.pps.data.subarray(4),c=new de(n,a,o,e);t.hvcc=c.getData(),0==this.video_init_segment_dispatched_&&s.a.v(this.TAG,"Generated first HEVCDecoderConfigurationRecord for mimeType: "+t.codec)}else{a=this.video_metadata_.sps.data.subarray(4),o=this.video_metadata_.pps.data.subarray(4);var l=new N(a,o,e);t.avcc=l.getData(),0==this.video_init_segment_dispatched_&&s.a.v(this.TAG,"Generated first AVCDecoderConfigurationRecord for mimeType: "+t.codec)}this.onTrackMetadata("video",t),this.video_init_segment_dispatched_=!0,this.video_metadata_changed_=!1;var d=this.media_info_;d.hasVideo=!0,d.width=t.codecWidth,d.height=t.codecHeight,d.fps=t.frameRate.fps,d.profile=t.profile,d.level=t.level,d.refFrames=e.ref_frames,d.chromaFormat=e.chroma_format_string,d.sarNum=t.sarRatio.width,d.sarDen=t.sarRatio.height,d.videoCodec=t.codec,d.hasAudio&&d.audioCodec?d.mimeType='video/mp2t; codecs="'+d.videoCodec+","+d.audioCodec+'"':d.mimeType='video/mp2t; codecs="'+d.videoCodec+'"',d.isComplete()&&this.onMediaInfo(d)},t.prototype.dispatchVideoMediaSegment=function(){this.isInitSegmentDispatched()&&this.video_track_.length&&this.onDataAvailable(null,this.video_track_)},t.prototype.dispatchAudioMediaSegment=function(){this.isInitSegmentDispatched()&&this.audio_track_.length&&this.onDataAvailable(this.audio_track_,null)},t.prototype.dispatchAudioVideoMediaSegment=function(){this.isInitSegmentDispatched()&&(this.audio_track_.length||this.video_track_.length)&&this.onDataAvailable(this.audio_track_,this.video_track_)},t.prototype.parseADTSAACPayload=function(e,t){if(!this.has_video_||this.video_init_segment_dispatched_){if(this.aac_last_incomplete_data_){var r=new Uint8Array(e.byteLength+this.aac_last_incomplete_data_.byteLength);r.set(this.aac_last_incomplete_data_,0),r.set(e,this.aac_last_incomplete_data_.byteLength),e=r}var i,n;if(null!=t&&(n=t/this.timescale_),"aac"===this.audio_metadata_.codec){if(null==t&&null!=this.aac_last_sample_pts_)i=1024/this.audio_metadata_.sampling_frequency*1e3,n=this.aac_last_sample_pts_+i;else if(null==t)return void s.a.w(this.TAG,"AAC: Unknown pts");if(this.aac_last_incomplete_data_&&this.aac_last_sample_pts_){i=1024/this.audio_metadata_.sampling_frequency*1e3;var a=this.aac_last_sample_pts_+i;Math.abs(a-n)>1&&(s.a.w(this.TAG,"AAC: Detected pts overlapped, expected: "+a+"ms, PES pts: "+n+"ms"),n=a)}}for(var o,c=new H(e),l=null,d=n;null!=(l=c.readNextAACFrame());){i=1024/l.sampling_frequency*1e3;var u={codec:"aac",data:l};0==this.audio_init_segment_dispatched_?(this.audio_metadata_={codec:"aac",audio_object_type:l.audio_object_type,sampling_freq_index:l.sampling_freq_index,sampling_frequency:l.sampling_frequency,channel_config:l.channel_config},this.dispatchAudioInitSegment(u)):this.detectAudioMetadataChange(u)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(u)),o=d;var h=Math.floor(d),p={unit:l.data,length:l.data.byteLength,pts:h,dts:h};this.audio_track_.samples.push(p),this.audio_track_.length+=l.data.byteLength,d+=i}c.hasIncompleteData()&&(this.aac_last_incomplete_data_=c.getIncompleteData()),o&&(this.aac_last_sample_pts_=o)}},t.prototype.parseLOASAACPayload=function(e,t){var r;if(!this.has_video_||this.video_init_segment_dispatched_){if(this.aac_last_incomplete_data_){var i=new Uint8Array(e.byteLength+this.aac_last_incomplete_data_.byteLength);i.set(this.aac_last_incomplete_data_,0),i.set(e,this.aac_last_incomplete_data_.byteLength),e=i}var n,a;if(null!=t&&(a=t/this.timescale_),"aac"===this.audio_metadata_.codec){if(null==t&&null!=this.aac_last_sample_pts_)n=1024/this.audio_metadata_.sampling_frequency*1e3,a=this.aac_last_sample_pts_+n;else if(null==t)return void s.a.w(this.TAG,"AAC: Unknown pts");if(this.aac_last_incomplete_data_&&this.aac_last_sample_pts_){n=1024/this.audio_metadata_.sampling_frequency*1e3;var o=this.aac_last_sample_pts_+n;Math.abs(o-a)>1&&(s.a.w(this.TAG,"AAC: Detected pts overlapped, expected: "+o+"ms, PES pts: "+a+"ms"),a=o)}}for(var c,l=new K(e),d=null,u=a;null!=(d=l.readNextAACFrame(null!==(r=this.loas_previous_frame)&&void 0!==r?r:void 0));){this.loas_previous_frame=d,n=1024/d.sampling_frequency*1e3;var h={codec:"aac",data:d};0==this.audio_init_segment_dispatched_?(this.audio_metadata_={codec:"aac",audio_object_type:d.audio_object_type,sampling_freq_index:d.sampling_freq_index,sampling_frequency:d.sampling_frequency,channel_config:d.channel_config},this.dispatchAudioInitSegment(h)):this.detectAudioMetadataChange(h)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(h)),c=u;var p=Math.floor(u),f={unit:d.data,length:d.data.byteLength,pts:p,dts:p};this.audio_track_.samples.push(f),this.audio_track_.length+=d.data.byteLength,u+=n}l.hasIncompleteData()&&(this.aac_last_incomplete_data_=l.getIncompleteData()),c&&(this.aac_last_sample_pts_=c)}},t.prototype.parseAC3Payload=function(e,t){if(!this.has_video_||this.video_init_segment_dispatched_){var r,i;if(null!=t&&(i=t/this.timescale_),"ac-3"===this.audio_metadata_.codec)if(null==t&&null!=this.aac_last_sample_pts_)r=1536/this.audio_metadata_.sampling_frequency*1e3,i=this.aac_last_sample_pts_+r;else if(null==t)return void s.a.w(this.TAG,"Opus: Unknown pts");for(var n,a=new me(e),o=null,c=i;null!=(o=a.readNextAC3Frame());){r=1536/o.sampling_frequency*1e3;var l={codec:"ac-3",data:o};0==this.audio_init_segment_dispatched_?(this.audio_metadata_={codec:"ac-3",sampling_frequency:o.sampling_frequency,bit_stream_identification:o.bit_stream_identification,bit_stream_mode:o.bit_stream_mode,low_frequency_effects_channel_on:o.low_frequency_effects_channel_on,channel_mode:o.channel_mode},console.log(JSON.stringify(this.audio_metadata_)),this.dispatchAudioInitSegment(l)):this.detectAudioMetadataChange(l)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(l)),n=c;var d=Math.floor(c),u={unit:o.data,length:o.data.byteLength,pts:d,dts:d};this.audio_track_.samples.push(u),this.audio_track_.length+=o.data.byteLength,c+=r}n&&(this.aac_last_sample_pts_=n)}},t.prototype.parseOpusPayload=function(e,t){if(!this.has_video_||this.video_init_segment_dispatched_){var r,i;if(null!=t&&(i=t/this.timescale_),"opus"===this.audio_metadata_.codec)if(null==t&&null!=this.aac_last_sample_pts_)r=20,i=this.aac_last_sample_pts_+r;else if(null==t)return void s.a.w(this.TAG,"Opus: Unknown pts");for(var n,a=i,o=0;o<e.length;){r=20;for(var c=0!=(16&e[o+1]),l=0!=(8&e[o+1]),d=o+2,u=0;255===e[d];)u+=255,d+=1;u+=e[d],d+=1,d+=c?2:0,d+=l?2:0,n=a;var h=Math.floor(a),p=e.slice(d,d+u),f={unit:p,length:p.byteLength,pts:h,dts:h};this.audio_track_.samples.push(f),this.audio_track_.length+=p.byteLength,a+=r,o=d+u}n&&(this.aac_last_sample_pts_=n)}},t.prototype.parseMP3Payload=function(e,t){if(!this.has_video_||this.video_init_segment_dispatched_){var r=e[1]>>>3&3,i=(6&e[1])>>1,n=(e[2],(12&e[2])>>>2),s=3!=(e[3]>>>6&3)?2:1,a=0,o=34;switch(r){case 0:a=[11025,12e3,8e3,0][n];break;case 2:a=[22050,24e3,16e3,0][n];break;case 3:a=[44100,48e3,32e3,0][n]}switch(i){case 1:o=34;break;case 2:o=33;break;case 3:o=32}var c=new he;c.object_type=o,c.sample_rate=a,c.channel_count=s,c.data=e;var l={codec:"mp3",data:c};0==this.audio_init_segment_dispatched_?(this.audio_metadata_={codec:"mp3",object_type:o,sample_rate:a,channel_count:s},this.dispatchAudioInitSegment(l)):this.detectAudioMetadataChange(l)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(l));var d={unit:e,length:e.byteLength,pts:t/this.timescale_,dts:t/this.timescale_};this.audio_track_.samples.push(d),this.audio_track_.length+=e.byteLength}},t.prototype.detectAudioMetadataChange=function(e){if(e.codec!==this.audio_metadata_.codec)return s.a.v(this.TAG,"Audio: Audio Codecs changed from "+this.audio_metadata_.codec+" to "+e.codec),!0;if("aac"===e.codec&&"aac"===this.audio_metadata_.codec){if((t=e.data).audio_object_type!==this.audio_metadata_.audio_object_type)return s.a.v(this.TAG,"AAC: AudioObjectType changed from "+this.audio_metadata_.audio_object_type+" to "+t.audio_object_type),!0;if(t.sampling_freq_index!==this.audio_metadata_.sampling_freq_index)return s.a.v(this.TAG,"AAC: SamplingFrequencyIndex changed from "+this.audio_metadata_.sampling_freq_index+" to "+t.sampling_freq_index),!0;if(t.channel_config!==this.audio_metadata_.channel_config)return s.a.v(this.TAG,"AAC: Channel configuration changed from "+this.audio_metadata_.channel_config+" to "+t.channel_config),!0}else if("ac-3"===e.codec&&"ac-3"===this.audio_metadata_.codec){var t;if((t=e.data).sampling_frequency!==this.audio_metadata_.sampling_frequency)return s.a.v(this.TAG,"AC3: Sampling Frequency changed from "+this.audio_metadata_.sampling_frequency+" to "+t.sampling_frequency),!0;if(t.bit_stream_identification!==this.audio_metadata_.bit_stream_identification)return s.a.v(this.TAG,"AC3: Bit Stream Identification changed from "+this.audio_metadata_.bit_stream_identification+" to "+t.bit_stream_identification),!0;if(t.bit_stream_mode!==this.audio_metadata_.bit_stream_mode)return s.a.v(this.TAG,"AC3: BitStream Mode changed from "+this.audio_metadata_.bit_stream_mode+" to "+t.bit_stream_mode),!0;if(t.channel_mode!==this.audio_metadata_.channel_mode)return s.a.v(this.TAG,"AC3: Channel Mode changed from "+this.audio_metadata_.channel_mode+" to "+t.channel_mode),!0;if(t.low_frequency_effects_channel_on!==this.audio_metadata_.low_frequency_effects_channel_on)return s.a.v(this.TAG,"AC3: Low Frequency Effects Channel On changed from "+this.audio_metadata_.low_frequency_effects_channel_on+" to "+t.low_frequency_effects_channel_on),!0}else if("opus"===e.codec&&"opus"===this.audio_metadata_.codec){if((r=e.meta).sample_rate!==this.audio_metadata_.sample_rate)return s.a.v(this.TAG,"Opus: SamplingFrequencyIndex changed from "+this.audio_metadata_.sample_rate+" to "+r.sample_rate),!0;if(r.channel_count!==this.audio_metadata_.channel_count)return s.a.v(this.TAG,"Opus: Channel count changed from "+this.audio_metadata_.channel_count+" to "+r.channel_count),!0}else if("mp3"===e.codec&&"mp3"===this.audio_metadata_.codec){var r;if((r=e.data).object_type!==this.audio_metadata_.object_type)return s.a.v(this.TAG,"MP3: AudioObjectType changed from "+this.audio_metadata_.object_type+" to "+r.object_type),!0;if(r.sample_rate!==this.audio_metadata_.sample_rate)return s.a.v(this.TAG,"MP3: SamplingFrequencyIndex changed from "+this.audio_metadata_.sample_rate+" to "+r.sample_rate),!0;if(r.channel_count!==this.audio_metadata_.channel_count)return s.a.v(this.TAG,"MP3: Channel count changed from "+this.audio_metadata_.channel_count+" to "+r.channel_count),!0}return!1},t.prototype.dispatchAudioInitSegment=function(e){var t={type:"audio"};if(t.id=this.audio_track_.id,t.timescale=1e3,t.duration=this.duration_,"aac"===this.audio_metadata_.codec){var r="aac"===e.codec?e.data:null,i=new q(r);t.audioSampleRate=i.sampling_rate,t.channelCount=i.channel_count,t.codec=i.codec_mimetype,t.originalCodec=i.original_codec_mimetype,t.config=i.config,t.refSampleDuration=1024/t.audioSampleRate*t.timescale}else if("ac-3"===this.audio_metadata_.codec){var n="ac-3"===e.codec?e.data:null,a=new ge(n);t.audioSampleRate=a.sampling_rate,t.channelCount=a.channel_count,t.codec=a.codec_mimetype,t.originalCodec=a.original_codec_mimetype,t.config=a.config,t.refSampleDuration=1536/t.audioSampleRate*t.timescale}else"opus"===this.audio_metadata_.codec?(t.audioSampleRate=this.audio_metadata_.sample_rate,t.channelCount=this.audio_metadata_.channel_count,t.channelConfigCode=this.audio_metadata_.channel_config_code,t.codec="opus",t.originalCodec="opus",t.config=void 0,t.refSampleDuration=20):"mp3"===this.audio_metadata_.codec&&(t.audioSampleRate=this.audio_metadata_.sample_rate,t.channelCount=this.audio_metadata_.channel_count,t.codec="mp3",t.originalCodec="mp3",t.config=void 0);0==this.audio_init_segment_dispatched_&&s.a.v(this.TAG,"Generated first AudioSpecificConfig for mimeType: "+t.codec),this.onTrackMetadata("audio",t),this.audio_init_segment_dispatched_=!0,this.video_metadata_changed_=!1;var o=this.media_info_;o.hasAudio=!0,o.audioCodec=t.originalCodec,o.audioSampleRate=t.audioSampleRate,o.audioChannelCount=t.channelCount,o.hasVideo&&o.videoCodec?o.mimeType='video/mp2t; codecs="'+o.videoCodec+","+o.audioCodec+'"':o.mimeType='video/mp2t; codecs="'+o.audioCodec+'"',o.isComplete()&&this.onMediaInfo(o)},t.prototype.dispatchPESPrivateDataDescriptor=function(e,t,r){var i=new z;i.pid=e,i.stream_type=t,i.descriptor=r,this.onPESPrivateDataDescriptor&&this.onPESPrivateDataDescriptor(i)},t.prototype.parsePESPrivateDataPayload=function(e,t,r,i,n){var s=new W;if(s.pid=i,s.stream_id=n,s.len=e.byteLength,s.data=e,null!=t){var a=Math.floor(t/this.timescale_);s.pts=a}else s.nearest_pts=this.aac_last_sample_pts_;if(null!=r){var o=Math.floor(r/this.timescale_);s.dts=o}this.onPESPrivateData&&this.onPESPrivateData(s)},t.prototype.parseTimedID3MetadataPayload=function(e,t,r,i,n){var s=new W;if(s.pid=i,s.stream_id=n,s.len=e.byteLength,s.data=e,null!=t){var a=Math.floor(t/this.timescale_);s.pts=a}if(null!=r){var o=Math.floor(r/this.timescale_);s.dts=o}this.onTimedID3Metadata&&this.onTimedID3Metadata(s)},t.prototype.parseSMPTE2038MetadataPayload=function(e,t,r,i,n){var s=new ue;if(s.pid=i,s.stream_id=n,s.len=e.byteLength,s.data=e,null!=t){var a=Math.floor(t/this.timescale_);s.pts=a}if(s.nearest_pts=this.aac_last_sample_pts_,null!=r){var o=Math.floor(r/this.timescale_);s.dts=o}s.ancillaries=function(e){for(var t=new f(e),r=0,i=[];r+=6,0===t.readBits(6);){var n=t.readBool();r+=1;var s=t.readBits(11);r+=11;var a=t.readBits(12);r+=12;var o=255&t.readBits(10);r+=10;var c=255&t.readBits(10);r+=10;var l=255&t.readBits(10);r+=10;for(var d=new Uint8Array(l),u=0;u<l;u++){var h=255&t.readBits(10);r+=10,d[u]=h}t.readBits(10),r+=10;var p="User Defined";65===o?7===c&&(p="SCTE-104"):95===o?220===c?p="ARIB STD-B37 (1SEG)":221===c?p="ARIB STD-B37 (ANALOG)":222===c?p="ARIB STD-B37 (SD)":223===c&&(p="ARIB STD-B37 (HD)"):97===o&&(1===c?p="EIA-708":2===c&&(p="EIA-608")),i.push({yc_indicator:n,line_number:s,horizontal_offset:a,did:o,sdid:c,user_data:d,description:p,information:{}}),t.readBits(8-(r-Math.floor(r/8))%8),r+=(8-(r-Math.floor(r/8)))%8}return t.destroy(),t=null,i}(e),this.onSMPTE2038Metadata&&this.onSMPTE2038Metadata(s)},t}(T),be=function(){function e(){}return e.init=function(){for(var t in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],hvc1:[],hvcC:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[],Opus:[],dOps:[],"ac-3":[],dac3:[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var r=e.constants={};r.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),r.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),r.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),r.STSC=r.STCO=r.STTS,r.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),r.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),r.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),r.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},e.box=function(e){for(var t=8,r=null,i=Array.prototype.slice.call(arguments,1),n=i.length,s=0;s<n;s++)t+=i[s].byteLength;(r=new Uint8Array(t))[0]=t>>>24&255,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r.set(e,4);var a=8;for(s=0;s<n;s++)r.set(i[s],a),a+=i[s].byteLength;return r},e.generateInitSegment=function(t){var r=e.box(e.types.ftyp,e.constants.FTYP),i=e.moov(t),n=new Uint8Array(r.byteLength+i.byteLength);return n.set(r,0),n.set(i,r.byteLength),n},e.moov=function(t){var r=e.mvhd(t.timescale,t.duration),i=e.trak(t),n=e.mvex(t);return e.box(e.types.moov,r,i,n)},e.mvhd=function(t,r){return e.box(e.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,r>>>24&255,r>>>16&255,r>>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},e.trak=function(t){return e.box(e.types.trak,e.tkhd(t),e.mdia(t))},e.tkhd=function(t){var r=t.id,i=t.duration,n=t.presentWidth,s=t.presentHeight;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>>8&255,255&n,0,0,s>>>8&255,255&s,0,0]))},e.mdia=function(t){return e.box(e.types.mdia,e.mdhd(t),e.hdlr(t),e.minf(t))},e.mdhd=function(t){var r=t.timescale,i=t.duration;return e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r,i>>>24&255,i>>>16&255,i>>>8&255,255&i,85,196,0,0]))},e.hdlr=function(t){var r;return r="audio"===t.type?e.constants.HDLR_AUDIO:e.constants.HDLR_VIDEO,e.box(e.types.hdlr,r)},e.minf=function(t){var r;return r="audio"===t.type?e.box(e.types.smhd,e.constants.SMHD):e.box(e.types.vmhd,e.constants.VMHD),e.box(e.types.minf,r,e.dinf(),e.stbl(t))},e.dinf=function(){return e.box(e.types.dinf,e.box(e.types.dref,e.constants.DREF))},e.stbl=function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.constants.STTS),e.box(e.types.stsc,e.constants.STSC),e.box(e.types.stsz,e.constants.STSZ),e.box(e.types.stco,e.constants.STCO))},e.stsd=function(t){return"audio"===t.type?"mp3"===t.codec?e.box(e.types.stsd,e.constants.STSD_PREFIX,e.mp3(t)):"ac-3"===t.codec?e.box(e.types.stsd,e.constants.STSD_PREFIX,e.ac3(t)):"opus"===t.codec?e.box(e.types.stsd,e.constants.STSD_PREFIX,e.Opus(t)):e.box(e.types.stsd,e.constants.STSD_PREFIX,e.mp4a(t)):"video"===t.type&&t.codec.startsWith("hvc1")?e.box(e.types.stsd,e.constants.STSD_PREFIX,e.hvc1(t)):e.box(e.types.stsd,e.constants.STSD_PREFIX,e.avc1(t))},e.mp3=function(t){var r=t.channelCount,i=t.audioSampleRate,n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r,0,16,0,0,0,0,i>>>8&255,255&i,0,0]);return e.box(e.types[".mp3"],n)},e.mp4a=function(t){var r=t.channelCount,i=t.audioSampleRate,n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r,0,16,0,0,0,0,i>>>8&255,255&i,0,0]);return e.box(e.types.mp4a,n,e.esds(t))},e.ac3=function(t){var r=t.channelCount,i=t.audioSampleRate,n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r,0,16,0,0,0,0,i>>>8&255,255&i,0,0]);return e.box(e.types["ac-3"],n,e.box(e.types.dac3,new Uint8Array(t.config)))},e.esds=function(t){var r=t.config||[],i=r.length,n=new Uint8Array([0,0,0,0,3,23+i,0,1,0,4,15+i,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([i]).concat(r).concat([6,1,2]));return e.box(e.types.esds,n)},e.Opus=function(t){var r=t.channelCount,i=t.audioSampleRate,n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r,0,16,0,0,0,0,i>>>8&255,255&i,0,0]);return e.box(e.types.Opus,n,e.dOps(t))},e.dOps=function(t){var r=t.channelCount,i=t.channelConfigCode,n=t.audioSampleRate;if(t.config)return e.box(e.types.dOps,a);var s=[];switch(i){case 1:case 2:s=[0];break;case 0:s=[255,1,1,0,1];break;case 128:s=[255,2,0,0,1];break;case 3:s=[1,2,1,0,2,1];break;case 4:s=[1,2,2,0,1,2,3];break;case 5:s=[1,3,2,0,4,1,2,3];break;case 6:s=[1,4,2,0,4,1,2,3,5];break;case 7:s=[1,4,2,0,4,1,2,3,5,6];break;case 8:s=[1,5,3,0,6,1,2,3,4,5,7];break;case 130:s=[1,1,2,0,1];break;case 131:s=[1,1,3,0,1,2];break;case 132:s=[1,1,4,0,1,2,3];break;case 133:s=[1,1,5,0,1,2,3,4];break;case 134:s=[1,1,6,0,1,2,3,4,5];break;case 135:s=[1,1,7,0,1,2,3,4,5,6];break;case 136:s=[1,1,8,0,1,2,3,4,5,6,7]}var a=new Uint8Array(function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var s=arguments[t],a=0,o=s.length;a<o;a++,n++)i[n]=s[a];return i}([0,r,0,0,n>>>24&255,n>>>17&255,n>>>8&255,n>>>0&255,0,0],s));return e.box(e.types.dOps,a)},e.avc1=function(t){var r=t.avcc,i=t.codecWidth,n=t.codecHeight,s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i>>>8&255,255&i,n>>>8&255,255&n,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return e.box(e.types.avc1,s,e.box(e.types.avcC,r))},e.hvc1=function(t){var r=t.hvcc,i=t.codecWidth,n=t.codecHeight,s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i>>>8&255,255&i,n>>>8&255,255&n,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return e.box(e.types.hvc1,s,e.box(e.types.hvcC,r))},e.mvex=function(t){return e.box(e.types.mvex,e.trex(t))},e.trex=function(t){var r=t.id,i=new Uint8Array([0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return e.box(e.types.trex,i)},e.moof=function(t,r){return e.box(e.types.moof,e.mfhd(t.sequenceNumber),e.traf(t,r))},e.mfhd=function(t){var r=new Uint8Array([0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t]);return e.box(e.types.mfhd,r)},e.traf=function(t,r){var i=t.id,n=e.box(e.types.tfhd,new Uint8Array([0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i])),s=e.box(e.types.tfdt,new Uint8Array([0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r])),a=e.sdtp(t),o=e.trun(t,a.byteLength+16+16+8+16+8+8);return e.box(e.types.traf,n,s,o,a)},e.sdtp=function(t){for(var r=t.samples||[],i=r.length,n=new Uint8Array(4+i),s=0;s<i;s++){var a=r[s].flags;n[s+4]=a.isLeading<<6|a.dependsOn<<4|a.isDependedOn<<2|a.hasRedundancy}return e.box(e.types.sdtp,n)},e.trun=function(t,r){var i=t.samples||[],n=i.length,s=12+16*n,a=new Uint8Array(s);r+=8+s,a.set([0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,255&n,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0);for(var o=0;o<n;o++){var c=i[o].duration,l=i[o].size,d=i[o].flags,u=i[o].cts;a.set([c>>>24&255,c>>>16&255,c>>>8&255,255&c,l>>>24&255,l>>>16&255,l>>>8&255,255&l,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.isNonSync,0,0,u>>>24&255,u>>>16&255,u>>>8&255,255&u],12+16*o)}return e.box(e.types.trun,a)},e.mdat=function(t){return e.box(e.types.mdat,t)},e}();be.init();var Ee=be,Se=function(){function e(){}return e.getSilentFrame=function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},e}(),we=r(7),Te=function(){function e(e){this.TAG="MP4Remuxer",this._config=e,this._isLive=!0===e.isLive,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new we.c("audio"),this._videoSegmentInfoList=new we.c("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!(!a.a.chrome||!(a.a.version.major<50||50===a.a.version.major&&a.a.version.build<2661)),this._fillSilentAfterSeek=a.a.msedge||a.a.msie,this._mp3UseMpegAudio=!a.a.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return e.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null},e.prototype.bindDataSource=function(e){return e.onDataAvailable=this.remux.bind(this),e.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this},Object.defineProperty(e.prototype,"onInitSegment",{get:function(){return this._onInitSegment},set:function(e){this._onInitSegment=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMediaSegment",{get:function(){return this._onMediaSegment},set:function(e){this._onMediaSegment=e},enumerable:!1,configurable:!0}),e.prototype.insertDiscontinuity=function(){this._audioNextDts=this._videoNextDts=void 0},e.prototype.seek=function(e){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()},e.prototype.remux=function(e,t){if(!this._onMediaSegment)throw new u.a("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(e,t),t&&this._remuxVideo(t),e&&this._remuxAudio(e)},e.prototype._onTrackMetadataReceived=function(e,t){var r=null,i="mp4",n=t.codec;if("audio"===e)this._audioMeta=t,"mp3"===t.codec&&this._mp3UseMpegAudio?(i="mpeg",n="",r=new Uint8Array):r=Ee.generateInitSegment(t);else{if("video"!==e)return;this._videoMeta=t,r=Ee.generateInitSegment(t)}if(!this._onInitSegment)throw new u.a("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(e,{type:e,data:r.buffer,codec:n,container:e+"/"+i,mediaDuration:t.duration})},e.prototype._calculateDtsBase=function(e,t){this._dtsBaseInited||(e&&e.samples&&e.samples.length&&(this._audioDtsBase=e.samples[0].dts),t&&t.samples&&t.samples.length&&(this._videoDtsBase=t.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)},e.prototype.getTimestampBase=function(){if(this._dtsBaseInited)return this._dtsBase},e.prototype.flushStashedSamples=function(){var e=this._videoStashedLastSample,t=this._audioStashedLastSample,r={type:"video",id:1,sequenceNumber:0,samples:[],length:0};null!=e&&(r.samples.push(e),r.length=e.length);var i={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};null!=t&&(i.samples.push(t),i.length=t.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(r,!0),this._remuxAudio(i,!0)},e.prototype._remuxAudio=function(e,t){if(null!=this._audioMeta){var r,i=e,n=i.samples,o=void 0,c=-1,l=this._audioMeta.refSampleDuration,d="mp3"===this._audioMeta.codec&&this._mp3UseMpegAudio,u=this._dtsBaseInited&&void 0===this._audioNextDts,h=!1;if(n&&0!==n.length&&(1!==n.length||t)){var p=0,f=null,m=0;d?(p=0,m=i.length):(p=8,m=8+i.length);var g=null;if(n.length>1&&(m-=(g=n.pop()).length),null!=this._audioStashedLastSample){var v=this._audioStashedLastSample;this._audioStashedLastSample=null,n.unshift(v),m+=v.length}null!=g&&(this._audioStashedLastSample=g);var _=n[0].dts-this._dtsBase;if(this._audioNextDts)o=_-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())o=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&"mp3"!==this._audioMeta.originalCodec&&(h=!0);else{var y=this._audioSegmentInfoList.getLastSampleBefore(_);if(null!=y){var b=_-(y.originalDts+y.duration);b<=3&&(b=0),o=_-(y.dts+y.duration+b)}else o=0}if(h){var E=_-o,S=this._videoSegmentInfoList.getLastSegmentBefore(_);if(null!=S&&S.beginDts<E){if(O=Se.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount)){var w=S.beginDts,T=E-S.beginDts;s.a.v(this.TAG,"InsertPrefixSilentAudio: dts: "+w+", duration: "+T),n.unshift({unit:O,dts:w,pts:w}),m+=O.byteLength}}else h=!1}for(var R=[],C=0;C<n.length;C++){var A=(v=n[C]).unit,P=v.dts-this._dtsBase,D=(w=P,!1),L=null,k=0;if(!(P<-.001)){if("mp3"!==this._audioMeta.codec){var I=P;if(this._audioNextDts&&(I=this._audioNextDts),(o=P-I)<=-3*l){s.a.w(this.TAG,"Dropping 1 audio frame (originalDts: "+P+" ms ,curRefDts: "+I+" ms)  due to dtsCorrection: "+o+" ms overlap.");continue}if(o>=3*l&&this._fillAudioTimestampGap&&!a.a.safari){D=!0;var O,M=Math.floor(o/l);s.a.w(this.TAG,"Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.\noriginalDts: "+P+" ms, curRefDts: "+I+" ms, dtsCorrection: "+Math.round(o)+" ms, generate: "+M+" frames"),w=Math.floor(I),k=Math.floor(I+l)-w,null==(O=Se.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount))&&(s.a.w(this.TAG,"Unable to generate silent frame for "+this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame"),O=A),L=[];for(var x=0;x<M;x++){I+=l;var N=Math.floor(I),F=Math.floor(I+l)-N,B={dts:N,pts:N,cts:0,unit:O,size:O.byteLength,duration:F,originalDts:P,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};L.push(B),m+=B.size}this._audioNextDts=I+l}else w=Math.floor(I),k=Math.floor(I+l)-w,this._audioNextDts=I+l}else w=P-o,k=C!==n.length-1?n[C+1].dts-this._dtsBase-o-w:null!=g?g.dts-this._dtsBase-o-w:R.length>=1?R[R.length-1].duration:Math.floor(l),this._audioNextDts=w+k;-1===c&&(c=w),R.push({dts:w,pts:w,cts:0,unit:v.unit,size:v.unit.byteLength,duration:k,originalDts:P,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),D&&R.push.apply(R,L)}}if(0===R.length)return i.samples=[],void(i.length=0);for(d?f=new Uint8Array(m):((f=new Uint8Array(m))[0]=m>>>24&255,f[1]=m>>>16&255,f[2]=m>>>8&255,f[3]=255&m,f.set(Ee.types.mdat,4)),C=0;C<R.length;C++)A=R[C].unit,f.set(A,p),p+=A.byteLength;var j=R[R.length-1];r=j.dts+j.duration;var U=new we.b;U.beginDts=c,U.endDts=r,U.beginPts=c,U.endPts=r,U.originalBeginDts=R[0].originalDts,U.originalEndDts=j.originalDts+j.duration,U.firstSample=new we.d(R[0].dts,R[0].pts,R[0].duration,R[0].originalDts,!1),U.lastSample=new we.d(j.dts,j.pts,j.duration,j.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(U),i.samples=R,i.sequenceNumber++;var V;V=d?new Uint8Array:Ee.moof(i,c),i.samples=[],i.length=0;var G={type:"audio",data:this._mergeBoxes(V,f).buffer,sampleCount:R.length,info:U};d&&u&&(G.timestampOffset=c),this._onMediaSegment("audio",G)}}},e.prototype._remuxVideo=function(e,t){if(null!=this._videoMeta){var r,i,n=e,s=n.samples,a=void 0,o=-1,c=-1;if(s&&0!==s.length&&(1!==s.length||t)){var l=8,d=null,u=8+e.length,h=null;if(s.length>1&&(u-=(h=s.pop()).length),null!=this._videoStashedLastSample){var p=this._videoStashedLastSample;this._videoStashedLastSample=null,s.unshift(p),u+=p.length}null!=h&&(this._videoStashedLastSample=h);var f=s[0].dts-this._dtsBase;if(this._videoNextDts)a=f-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())a=0;else{var m=this._videoSegmentInfoList.getLastSampleBefore(f);if(null!=m){var g=f-(m.originalDts+m.duration);g<=3&&(g=0),a=f-(m.dts+m.duration+g)}else a=0}for(var v=new we.b,_=[],y=0;y<s.length;y++){var b=(p=s[y]).dts-this._dtsBase,E=p.isKeyframe,S=b-a,w=p.cts,T=S+w;-1===o&&(o=S,c=T);var R;if(R=y!==s.length-1?s[y+1].dts-this._dtsBase-a-S:null!=h?h.dts-this._dtsBase-a-S:_.length>=1?_[_.length-1].duration:Math.floor(this._videoMeta.refSampleDuration),E){var C=new we.d(S,T,R,p.dts,!0);C.fileposition=p.fileposition,v.appendSyncPoint(C)}_.push({dts:S,pts:T,cts:w,units:p.units,size:p.length,isKeyframe:E,duration:R,originalDts:b,flags:{isLeading:0,dependsOn:E?2:1,isDependedOn:E?1:0,hasRedundancy:0,isNonSync:E?0:1}})}for((d=new Uint8Array(u))[0]=u>>>24&255,d[1]=u>>>16&255,d[2]=u>>>8&255,d[3]=255&u,d.set(Ee.types.mdat,4),y=0;y<_.length;y++)for(var A=_[y].units;A.length;){var P=A.shift().data;d.set(P,l),l+=P.byteLength}var D=_[_.length-1];if(r=D.dts+D.duration,i=D.pts+D.duration,this._videoNextDts=r,v.beginDts=o,v.endDts=r,v.beginPts=c,v.endPts=i,v.originalBeginDts=_[0].originalDts,v.originalEndDts=D.originalDts+D.duration,v.firstSample=new we.d(_[0].dts,_[0].pts,_[0].duration,_[0].originalDts,_[0].isKeyframe),v.lastSample=new we.d(D.dts,D.pts,D.duration,D.originalDts,D.isKeyframe),this._isLive||this._videoSegmentInfoList.append(v),n.samples=_,n.sequenceNumber++,this._forceFirstIDR){var L=_[0].flags;L.dependsOn=2,L.isNonSync=0}var k=Ee.moof(n,o);n.samples=[],n.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(k,d).buffer,sampleCount:_.length,info:v})}}},e.prototype._mergeBoxes=function(e,t){var r=new Uint8Array(e.byteLength+t.byteLength);return r.set(e,0),r.set(t,e.byteLength),r},e}(),Re=r(11),Ce=r(1),Ae=function(){function e(e,t){this.TAG="TransmuxingController",this._emitter=new n.a,this._config=t,e.segments||(e.segments=[{duration:e.duration,filesize:e.filesize,url:e.url}]),"boolean"!=typeof e.cors&&(e.cors=!0),"boolean"!=typeof e.withCredentials&&(e.withCredentials=!1),this._mediaDataSource=e,this._currentSegmentIndex=0;var r=0;this._mediaDataSource.segments.forEach((function(i){i.timestampBase=r,r+=i.duration,i.cors=e.cors,i.withCredentials=e.withCredentials,t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy)})),isNaN(r)||this._mediaDataSource.duration===r||(this._mediaDataSource.duration=r),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return e.prototype.destroy=function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null},e.prototype.on=function(e,t){this._emitter.addListener(e,t)},e.prototype.off=function(e,t){this._emitter.removeListener(e,t)},e.prototype.start=function(){this._loadSegment(0),this._enableStatisticsReporter()},e.prototype._loadSegment=function(e,t){this._currentSegmentIndex=e;var r=this._mediaDataSource.segments[e],i=this._ioctl=new Re.a(r,this._config,e);i.onError=this._onIOException.bind(this),i.onSeeked=this._onIOSeeked.bind(this),i.onComplete=this._onIOComplete.bind(this),i.onRedirect=this._onIORedirect.bind(this),i.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),t?this._demuxer.bindDataSource(this._ioctl):i.onDataArrival=this._onInitChunkArrival.bind(this),i.open(t)},e.prototype.stop=function(){this._internalAbort(),this._disableStatisticsReporter()},e.prototype._internalAbort=function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)},e.prototype.pause=function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())},e.prototype.resume=function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())},e.prototype.seek=function(e){if(null!=this._mediaInfo&&this._mediaInfo.isSeekable()){var t=this._searchSegmentIndexContains(e);if(t===this._currentSegmentIndex){var r=this._mediaInfo.segments[t];if(null==r)this._pendingSeekTime=e;else{var i=r.getNearestKeyframe(e);this._remuxer.seek(i.milliseconds),this._ioctl.seek(i.fileposition),this._pendingResolveSeekPoint=i.milliseconds}}else{var n=this._mediaInfo.segments[t];null==n?(this._pendingSeekTime=e,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(t)):(i=n.getNearestKeyframe(e),this._internalAbort(),this._remuxer.seek(e),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[t].timestampBase,this._loadSegment(t,i.fileposition),this._pendingResolveSeekPoint=i.milliseconds,this._reportSegmentMediaInfo(t))}this._enableStatisticsReporter()}},e.prototype._searchSegmentIndexContains=function(e){for(var t=this._mediaDataSource.segments,r=t.length-1,i=0;i<t.length;i++)if(e<t[i].timestampBase){r=i-1;break}return r},e.prototype._onInitChunkArrival=function(e,t){var r=this,i=0;if(t>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,i=this._demuxer.parseChunks(e,t);else{var n=null;(n=w.probe(e)).match&&(this._setupFLVDemuxerRemuxer(n),i=this._demuxer.parseChunks(e,t)),n.match||n.needMoreData||(n=ye.probe(e)).match&&(this._setupTSDemuxerRemuxer(n),i=this._demuxer.parseChunks(e,t)),n.match||n.needMoreData||(n=null,s.a.e(this.TAG,"Non MPEG-TS/FLV, Unsupported media type!"),Promise.resolve().then((function(){r._internalAbort()})),this._emitter.emit(Ce.a.DEMUX_ERROR,g.a.FORMAT_UNSUPPORTED,"Non MPEG-TS/FLV, Unsupported media type!"))}return i},e.prototype._setupFLVDemuxerRemuxer=function(e){this._demuxer=new w(e,this._config),this._remuxer||(this._remuxer=new Te(this._config));var t=this._mediaDataSource;null==t.duration||isNaN(t.duration)||(this._demuxer.overridedDuration=t.duration),"boolean"==typeof t.hasAudio&&(this._demuxer.overridedHasAudio=t.hasAudio),"boolean"==typeof t.hasVideo&&(this._demuxer.overridedHasVideo=t.hasVideo),this._demuxer.timestampBase=t.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this)},e.prototype._setupTSDemuxerRemuxer=function(e){var t=this._demuxer=new ye(e,this._config);this._remuxer||(this._remuxer=new Te(this._config)),t.onError=this._onDemuxException.bind(this),t.onMediaInfo=this._onMediaInfo.bind(this),t.onMetaDataArrived=this._onMetaDataArrived.bind(this),t.onTimedID3Metadata=this._onTimedID3Metadata.bind(this),t.onSMPTE2038Metadata=this._onSMPTE2038Metadata.bind(this),t.onSCTE35Metadata=this._onSCTE35Metadata.bind(this),t.onPESPrivateDataDescriptor=this._onPESPrivateDataDescriptor.bind(this),t.onPESPrivateData=this._onPESPrivateData.bind(this),this._remuxer.bindDataSource(this._demuxer),this._demuxer.bindDataSource(this._ioctl),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this)},e.prototype._onMediaInfo=function(e){var t=this;null==this._mediaInfo&&(this._mediaInfo=Object.assign({},e),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,o.a.prototype));var r=Object.assign({},e);Object.setPrototypeOf(r,o.a.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=r,this._reportSegmentMediaInfo(this._currentSegmentIndex),null!=this._pendingSeekTime&&Promise.resolve().then((function(){var e=t._pendingSeekTime;t._pendingSeekTime=null,t.seek(e)}))},e.prototype._onMetaDataArrived=function(e){this._emitter.emit(Ce.a.METADATA_ARRIVED,e)},e.prototype._onScriptDataArrived=function(e){this._emitter.emit(Ce.a.SCRIPTDATA_ARRIVED,e)},e.prototype._onTimedID3Metadata=function(e){var t=this._remuxer.getTimestampBase();null!=t&&(null!=e.pts&&(e.pts-=t),null!=e.dts&&(e.dts-=t),this._emitter.emit(Ce.a.TIMED_ID3_METADATA_ARRIVED,e))},e.prototype._onSMPTE2038Metadata=function(e){var t=this._remuxer.getTimestampBase();null!=t&&(null!=e.pts&&(e.pts-=t),null!=e.dts&&(e.dts-=t),null!=e.nearest_pts&&(e.nearest_pts-=t),this._emitter.emit(Ce.a.SMPTE2038_METADATA_ARRIVED,e))},e.prototype._onSCTE35Metadata=function(e){var t=this._remuxer.getTimestampBase();null!=t&&(null!=e.pts&&(e.pts-=t),null!=e.nearest_pts&&(e.nearest_pts-=t),this._emitter.emit(Ce.a.SCTE35_METADATA_ARRIVED,e))},e.prototype._onPESPrivateDataDescriptor=function(e){this._emitter.emit(Ce.a.PES_PRIVATE_DATA_DESCRIPTOR,e)},e.prototype._onPESPrivateData=function(e){var t=this._remuxer.getTimestampBase();null!=t&&(null!=e.pts&&(e.pts-=t),null!=e.nearest_pts&&(e.nearest_pts-=t),null!=e.dts&&(e.dts-=t),this._emitter.emit(Ce.a.PES_PRIVATE_DATA_ARRIVED,e))},e.prototype._onIOSeeked=function(){this._remuxer.insertDiscontinuity()},e.prototype._onIOComplete=function(e){var t=e+1;t<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer&&this._remuxer.flushStashedSamples(),this._loadSegment(t)):(this._remuxer&&this._remuxer.flushStashedSamples(),this._emitter.emit(Ce.a.LOADING_COMPLETE),this._disableStatisticsReporter())},e.prototype._onIORedirect=function(e){var t=this._ioctl.extraData;this._mediaDataSource.segments[t].redirectedURL=e},e.prototype._onIORecoveredEarlyEof=function(){this._emitter.emit(Ce.a.RECOVERED_EARLY_EOF)},e.prototype._onIOException=function(e,t){s.a.e(this.TAG,"IOException: type = "+e+", code = "+t.code+", msg = "+t.msg),this._emitter.emit(Ce.a.IO_ERROR,e,t),this._disableStatisticsReporter()},e.prototype._onDemuxException=function(e,t){s.a.e(this.TAG,"DemuxException: type = "+e+", info = "+t),this._emitter.emit(Ce.a.DEMUX_ERROR,e,t)},e.prototype._onRemuxerInitSegmentArrival=function(e,t){this._emitter.emit(Ce.a.INIT_SEGMENT,e,t)},e.prototype._onRemuxerMediaSegmentArrival=function(e,t){if(null==this._pendingSeekTime&&(this._emitter.emit(Ce.a.MEDIA_SEGMENT,e,t),null!=this._pendingResolveSeekPoint&&"video"===e)){var r=t.info.syncPoints,i=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,a.a.safari&&r.length>0&&r[0].originalDts===i&&(i=r[0].pts),this._emitter.emit(Ce.a.RECOMMEND_SEEKPOINT,i)}},e.prototype._enableStatisticsReporter=function(){null==this._statisticsReporter&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))},e.prototype._disableStatisticsReporter=function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},e.prototype._reportSegmentMediaInfo=function(e){var t=this._mediaInfo.segments[e],r=Object.assign({},t);r.duration=this._mediaInfo.duration,r.segmentCount=this._mediaInfo.segmentCount,delete r.segments,delete r.keyframesIndex,this._emitter.emit(Ce.a.MEDIA_INFO,r)},e.prototype._reportStatisticsInfo=function(){var e={};e.url=this._ioctl.currentURL,e.hasRedirect=this._ioctl.hasRedirect,e.hasRedirect&&(e.redirectedURL=this._ioctl.currentRedirectedURL),e.speed=this._ioctl.currentSpeed,e.loaderType=this._ioctl.loaderType,e.currentSegmentIndex=this._currentSegmentIndex,e.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(Ce.a.STATISTICS_INFO,e)},e}();t.a=Ae},function(e,t,r){"use strict";var i,n=r(0),s=function(){function e(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return e.prototype.reset=function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0},e.prototype.addBytes=function(e){0===this._firstCheckpoint?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=e,this._totalBytes+=e):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=e,this._totalBytes+=e):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=e,this._totalBytes+=e,this._lastCheckpoint=this._now())},Object.defineProperty(e.prototype,"currentKBps",{get:function(){this.addBytes(0);var e=(this._now()-this._lastCheckpoint)/1e3;return 0==e&&(e=1),this._intervalBytes/e/1024},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastSecondKBps",{get:function(){return this.addBytes(0),0!==this._lastSecondBytes?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"averageKBps",{get:function(){var e=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/e/1024},enumerable:!1,configurable:!0}),e}(),a=r(2),o=r(4),c=r(3),l=(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),d=function(e){function t(t,r){var i=e.call(this,"fetch-stream-loader")||this;return i.TAG="FetchStreamLoader",i._seekHandler=t,i._config=r,i._needStash=!0,i._requestAbort=!1,i._abortController=null,i._contentLength=null,i._receivedLength=0,i}return l(t,e),t.isSupported=function(){try{var e=o.a.msedge&&o.a.version.minor>=15048,t=!o.a.msedge||e;return self.fetch&&self.ReadableStream&&t}catch(e){return!1}},t.prototype.destroy=function(){this.isWorking()&&this.abort(),e.prototype.destroy.call(this)},t.prototype.open=function(e,t){var r=this;this._dataSource=e,this._range=t;var i=e.url;this._config.reuseRedirectedURL&&null!=e.redirectedURL&&(i=e.redirectedURL);var n=this._seekHandler.getConfig(i,t),s=new self.Headers;if("object"==typeof n.headers){var o=n.headers;for(var l in o)o.hasOwnProperty(l)&&s.append(l,o[l])}var d={method:"GET",headers:s,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if("object"==typeof this._config.headers)for(var l in this._config.headers)s.append(l,this._config.headers[l]);!1===e.cors&&(d.mode="same-origin"),e.withCredentials&&(d.credentials="include"),e.referrerPolicy&&(d.referrerPolicy=e.referrerPolicy),self.AbortController&&(this._abortController=new self.AbortController,d.signal=this._abortController.signal),this._status=a.c.kConnecting,self.fetch(n.url,d).then((function(e){if(r._requestAbort)return r._status=a.c.kIdle,void e.body.cancel();if(e.ok&&e.status>=200&&e.status<=299){if(e.url!==n.url&&r._onURLRedirect){var t=r._seekHandler.removeURLParameters(e.url);r._onURLRedirect(t)}var i=e.headers.get("Content-Length");return null!=i&&(r._contentLength=parseInt(i),0!==r._contentLength&&r._onContentLengthKnown&&r._onContentLengthKnown(r._contentLength)),r._pump.call(r,e.body.getReader())}if(r._status=a.c.kError,!r._onError)throw new c.d("FetchStreamLoader: Http code invalid, "+e.status+" "+e.statusText);r._onError(a.b.HTTP_STATUS_CODE_INVALID,{code:e.status,msg:e.statusText})})).catch((function(e){if(!r._abortController||!r._abortController.signal.aborted){if(r._status=a.c.kError,!r._onError)throw e;r._onError(a.b.EXCEPTION,{code:-1,msg:e.message})}}))},t.prototype.abort=function(){if(this._requestAbort=!0,(this._status!==a.c.kBuffering||!o.a.chrome)&&this._abortController)try{this._abortController.abort()}catch(e){}},t.prototype._pump=function(e){var t=this;return e.read().then((function(r){if(r.done)if(null!==t._contentLength&&t._receivedLength<t._contentLength){t._status=a.c.kError;var i=a.b.EARLY_EOF,n={code:-1,msg:"Fetch stream meet Early-EOF"};if(!t._onError)throw new c.d(n.msg);t._onError(i,n)}else t._status=a.c.kComplete,t._onComplete&&t._onComplete(t._range.from,t._range.from+t._receivedLength-1);else{if(t._abortController&&t._abortController.signal.aborted)return void(t._status=a.c.kComplete);if(!0===t._requestAbort)return t._status=a.c.kComplete,e.cancel();t._status=a.c.kBuffering;var s=r.value.buffer,o=t._range.from+t._receivedLength;t._receivedLength+=s.byteLength,t._onDataArrival&&t._onDataArrival(s,o,t._receivedLength),t._pump(e)}})).catch((function(e){if(t._abortController&&t._abortController.signal.aborted)t._status=a.c.kComplete;else if(11!==e.code||!o.a.msedge){t._status=a.c.kError;var r=0,i=null;if(19!==e.code&&"network error"!==e.message||!(null===t._contentLength||null!==t._contentLength&&t._receivedLength<t._contentLength)?(r=a.b.EXCEPTION,i={code:e.code,msg:e.message}):(r=a.b.EARLY_EOF,i={code:e.code,msg:"Fetch stream meet Early-EOF"}),!t._onError)throw new c.d(i.msg);t._onError(r,i)}}))},t}(a.a),u=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),h=function(e){function t(t,r){var i=e.call(this,"xhr-moz-chunked-loader")||this;return i.TAG="MozChunkedLoader",i._seekHandler=t,i._config=r,i._needStash=!0,i._xhr=null,i._requestAbort=!1,i._contentLength=null,i._receivedLength=0,i}return u(t,e),t.isSupported=function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="moz-chunked-arraybuffer","moz-chunked-arraybuffer"===e.responseType}catch(e){return n.a.w("MozChunkedLoader",e.message),!1}},t.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),e.prototype.destroy.call(this)},t.prototype.open=function(e,t){this._dataSource=e,this._range=t;var r=e.url;this._config.reuseRedirectedURL&&null!=e.redirectedURL&&(r=e.redirectedURL);var i=this._seekHandler.getConfig(r,t);this._requestURL=i.url;var n=this._xhr=new XMLHttpRequest;if(n.open("GET",i.url,!0),n.responseType="moz-chunked-arraybuffer",n.onreadystatechange=this._onReadyStateChange.bind(this),n.onprogress=this._onProgress.bind(this),n.onloadend=this._onLoadEnd.bind(this),n.onerror=this._onXhrError.bind(this),e.withCredentials&&(n.withCredentials=!0),"object"==typeof i.headers){var s=i.headers;for(var o in s)s.hasOwnProperty(o)&&n.setRequestHeader(o,s[o])}if("object"==typeof this._config.headers)for(var o in s=this._config.headers)s.hasOwnProperty(o)&&n.setRequestHeader(o,s[o]);this._status=a.c.kConnecting,n.send()},t.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=a.c.kComplete},t.prototype._onReadyStateChange=function(e){var t=e.target;if(2===t.readyState){if(null!=t.responseURL&&t.responseURL!==this._requestURL&&this._onURLRedirect){var r=this._seekHandler.removeURLParameters(t.responseURL);this._onURLRedirect(r)}if(0!==t.status&&(t.status<200||t.status>299)){if(this._status=a.c.kError,!this._onError)throw new c.d("MozChunkedLoader: Http code invalid, "+t.status+" "+t.statusText);this._onError(a.b.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText})}else this._status=a.c.kBuffering}},t.prototype._onProgress=function(e){if(this._status!==a.c.kError){null===this._contentLength&&null!==e.total&&0!==e.total&&(this._contentLength=e.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var t=e.target.response,r=this._range.from+this._receivedLength;this._receivedLength+=t.byteLength,this._onDataArrival&&this._onDataArrival(t,r,this._receivedLength)}},t.prototype._onLoadEnd=function(e){!0!==this._requestAbort?this._status!==a.c.kError&&(this._status=a.c.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)):this._requestAbort=!1},t.prototype._onXhrError=function(e){this._status=a.c.kError;var t=0,r=null;if(this._contentLength&&e.loaded<this._contentLength?(t=a.b.EARLY_EOF,r={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(t=a.b.EXCEPTION,r={code:-1,msg:e.constructor.name+" "+e.type}),!this._onError)throw new c.d(r.msg);this._onError(t,r)},t}(a.a),p=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),f=function(e){function t(t,r){var i=e.call(this,"xhr-range-loader")||this;return i.TAG="RangeLoader",i._seekHandler=t,i._config=r,i._needStash=!1,i._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],i._currentChunkSizeKB=384,i._currentSpeedNormalized=0,i._zeroSpeedChunkCount=0,i._xhr=null,i._speedSampler=new s,i._requestAbort=!1,i._waitForTotalLength=!1,i._totalLengthReceived=!1,i._currentRequestURL=null,i._currentRedirectedURL=null,i._currentRequestRange=null,i._totalLength=null,i._contentLength=null,i._receivedLength=0,i._lastTimeLoaded=0,i}return p(t,e),t.isSupported=function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="arraybuffer","arraybuffer"===e.responseType}catch(e){return n.a.w("RangeLoader",e.message),!1}},t.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),e.prototype.destroy.call(this)},Object.defineProperty(t.prototype,"currentSpeed",{get:function(){return this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),t.prototype.open=function(e,t){this._dataSource=e,this._range=t,this._status=a.c.kConnecting;var r=!1;null!=this._dataSource.filesize&&0!==this._dataSource.filesize&&(r=!0,this._totalLength=this._dataSource.filesize),this._totalLengthReceived||r?this._openSubRange():(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1}))},t.prototype._openSubRange=function(){var e=1024*this._currentChunkSizeKB,t=this._range.from+this._receivedLength,r=t+e;null!=this._contentLength&&r-this._range.from>=this._contentLength&&(r=this._range.from+this._contentLength-1),this._currentRequestRange={from:t,to:r},this._internalOpen(this._dataSource,this._currentRequestRange)},t.prototype._internalOpen=function(e,t){this._lastTimeLoaded=0;var r=e.url;this._config.reuseRedirectedURL&&(null!=this._currentRedirectedURL?r=this._currentRedirectedURL:null!=e.redirectedURL&&(r=e.redirectedURL));var i=this._seekHandler.getConfig(r,t);this._currentRequestURL=i.url;var n=this._xhr=new XMLHttpRequest;if(n.open("GET",i.url,!0),n.responseType="arraybuffer",n.onreadystatechange=this._onReadyStateChange.bind(this),n.onprogress=this._onProgress.bind(this),n.onload=this._onLoad.bind(this),n.onerror=this._onXhrError.bind(this),e.withCredentials&&(n.withCredentials=!0),"object"==typeof i.headers){var s=i.headers;for(var a in s)s.hasOwnProperty(a)&&n.setRequestHeader(a,s[a])}if("object"==typeof this._config.headers)for(var a in s=this._config.headers)s.hasOwnProperty(a)&&n.setRequestHeader(a,s[a]);n.send()},t.prototype.abort=function(){this._requestAbort=!0,this._internalAbort(),this._status=a.c.kComplete},t.prototype._internalAbort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},t.prototype._onReadyStateChange=function(e){var t=e.target;if(2===t.readyState){if(null!=t.responseURL){var r=this._seekHandler.removeURLParameters(t.responseURL);t.responseURL!==this._currentRequestURL&&r!==this._currentRedirectedURL&&(this._currentRedirectedURL=r,this._onURLRedirect&&this._onURLRedirect(r))}if(t.status>=200&&t.status<=299){if(this._waitForTotalLength)return;this._status=a.c.kBuffering}else{if(this._status=a.c.kError,!this._onError)throw new c.d("RangeLoader: Http code invalid, "+t.status+" "+t.statusText);this._onError(a.b.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText})}}},t.prototype._onProgress=function(e){if(this._status!==a.c.kError){if(null===this._contentLength){var t=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,t=!0;var r=e.total;this._internalAbort(),null!=r&0!==r&&(this._totalLength=r)}if(-1===this._range.to?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,t)return void this._openSubRange();this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var i=e.loaded-this._lastTimeLoaded;this._lastTimeLoaded=e.loaded,this._speedSampler.addBytes(i)}},t.prototype._normalizeSpeed=function(e){var t=this._chunkSizeKBList,r=t.length-1,i=0,n=0,s=r;if(e<t[0])return t[0];for(;n<=s;){if((i=n+Math.floor((s-n)/2))===r||e>=t[i]&&e<t[i+1])return t[i];t[i]<e?n=i+1:s=i-1}},t.prototype._onLoad=function(e){if(this._status!==a.c.kError)if(this._waitForTotalLength)this._waitForTotalLength=!1;else{this._lastTimeLoaded=0;var t=this._speedSampler.lastSecondKBps;if(0===t&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(t=this._speedSampler.currentKBps)),0!==t){var r=this._normalizeSpeed(t);this._currentSpeedNormalized!==r&&(this._currentSpeedNormalized=r,this._currentChunkSizeKB=r)}var i=e.target.response,n=this._range.from+this._receivedLength;this._receivedLength+=i.byteLength;var s=!1;null!=this._contentLength&&this._receivedLength<this._contentLength?this._openSubRange():s=!0,this._onDataArrival&&this._onDataArrival(i,n,this._receivedLength),s&&(this._status=a.c.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},t.prototype._onXhrError=function(e){this._status=a.c.kError;var t=0,r=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(t=a.b.EARLY_EOF,r={code:-1,msg:"RangeLoader meet Early-Eof"}):(t=a.b.EXCEPTION,r={code:-1,msg:e.constructor.name+" "+e.type}),!this._onError)throw new c.d(r.msg);this._onError(t,r)},t}(a.a),m=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),g=function(e){function t(){var t=e.call(this,"websocket-loader")||this;return t.TAG="WebSocketLoader",t._needStash=!0,t._ws=null,t._requestAbort=!1,t._receivedLength=0,t}return m(t,e),t.isSupported=function(){try{return void 0!==self.WebSocket}catch(e){return!1}},t.prototype.destroy=function(){this._ws&&this.abort(),e.prototype.destroy.call(this)},t.prototype.open=function(e){try{var t=this._ws=new self.WebSocket(e.url);t.binaryType="arraybuffer",t.onopen=this._onWebSocketOpen.bind(this),t.onclose=this._onWebSocketClose.bind(this),t.onmessage=this._onWebSocketMessage.bind(this),t.onerror=this._onWebSocketError.bind(this),this._status=a.c.kConnecting}catch(e){this._status=a.c.kError;var r={code:e.code,msg:e.message};if(!this._onError)throw new c.d(r.msg);this._onError(a.b.EXCEPTION,r)}},t.prototype.abort=function(){var e=this._ws;!e||0!==e.readyState&&1!==e.readyState||(this._requestAbort=!0,e.close()),this._ws=null,this._status=a.c.kComplete},t.prototype._onWebSocketOpen=function(e){this._status=a.c.kBuffering},t.prototype._onWebSocketClose=function(e){!0!==this._requestAbort?(this._status=a.c.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)):this._requestAbort=!1},t.prototype._onWebSocketMessage=function(e){var t=this;if(e.data instanceof ArrayBuffer)this._dispatchArrayBuffer(e.data);else if(e.data instanceof Blob){var r=new FileReader;r.onload=function(){t._dispatchArrayBuffer(r.result)},r.readAsArrayBuffer(e.data)}else{this._status=a.c.kError;var i={code:-1,msg:"Unsupported WebSocket message type: "+e.data.constructor.name};if(!this._onError)throw new c.d(i.msg);this._onError(a.b.EXCEPTION,i)}},t.prototype._dispatchArrayBuffer=function(e){var t=e,r=this._receivedLength;this._receivedLength+=t.byteLength,this._onDataArrival&&this._onDataArrival(t,r,this._receivedLength)},t.prototype._onWebSocketError=function(e){this._status=a.c.kError;var t={code:e.code,msg:e.message};if(!this._onError)throw new c.d(t.msg);this._onError(a.b.EXCEPTION,t)},t}(a.a),v=function(){function e(e){this._zeroStart=e||!1}return e.prototype.getConfig=function(e,t){var r={};if(0!==t.from||-1!==t.to){var i;i=-1!==t.to?"bytes="+t.from.toString()+"-"+t.to.toString():"bytes="+t.from.toString()+"-",r.Range=i}else this._zeroStart&&(r.Range="bytes=0-");return{url:e,headers:r}},e.prototype.removeURLParameters=function(e){return e},e}(),_=function(){function e(e,t){this._startName=e,this._endName=t}return e.prototype.getConfig=function(e,t){var r=e;if(0!==t.from||-1!==t.to){var i=!0;-1===r.indexOf("?")&&(r+="?",i=!1),i&&(r+="&"),r+=this._startName+"="+t.from.toString(),-1!==t.to&&(r+="&"+this._endName+"="+t.to.toString())}return{url:r,headers:{}}},e.prototype.removeURLParameters=function(e){var t=e.split("?")[0],r=void 0,i=e.indexOf("?");-1!==i&&(r=e.substring(i+1));var n="";if(null!=r&&r.length>0)for(var s=r.split("&"),a=0;a<s.length;a++){var o=s[a].split("="),c=a>0;o[0]!==this._startName&&o[0]!==this._endName&&(c&&(n+="&"),n+=s[a])}return 0===n.length?t:t+"?"+n},e}(),y=function(){function e(e,t,r){this.TAG="IOController",this._config=t,this._extraData=r,this._stashInitialSize=65536,null!=t.stashInitialSize&&t.stashInitialSize>0&&(this._stashInitialSize=t.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=3145728,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,!1===t.enableStashBuffer&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=e,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(e.url),this._refTotalLength=e.filesize?e.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new s,this._speedNormalizeList=[32,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return e.prototype.destroy=function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null},e.prototype.isWorking=function(){return this._loader&&this._loader.isWorking()&&!this._paused},e.prototype.isPaused=function(){return this._paused},Object.defineProperty(e.prototype,"status",{get:function(){return this._loader.status},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"extraData",{get:function(){return this._extraData},set:function(e){this._extraData=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(e){this._onDataArrival=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onSeeked",{get:function(){return this._onSeeked},set:function(e){this._onSeeked=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onError",{get:function(){return this._onError},set:function(e){this._onError=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onComplete",{get:function(){return this._onComplete},set:function(e){this._onComplete=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onRedirect",{get:function(){return this._onRedirect},set:function(e){this._onRedirect=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onRecoveredEarlyEof",{get:function(){return this._onRecoveredEarlyEof},set:function(e){this._onRecoveredEarlyEof=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentURL",{get:function(){return this._dataSource.url},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasRedirect",{get:function(){return null!=this._redirectedURL||null!=this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentRedirectedURL",{get:function(){return this._redirectedURL||this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentSpeed",{get:function(){return this._loaderClass===f?this._loader.currentSpeed:this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loaderType",{get:function(){return this._loader.type},enumerable:!1,configurable:!0}),e.prototype._selectSeekHandler=function(){var e=this._config;if("range"===e.seekType)this._seekHandler=new v(this._config.rangeLoadZeroStart);else if("param"===e.seekType){var t=e.seekParamStart||"bstart",r=e.seekParamEnd||"bend";this._seekHandler=new _(t,r)}else{if("custom"!==e.seekType)throw new c.b("Invalid seekType in config: "+e.seekType);if("function"!=typeof e.customSeekHandler)throw new c.b("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new e.customSeekHandler}},e.prototype._selectLoader=function(){if(null!=this._config.customLoader)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=g;else if(d.isSupported())this._loaderClass=d;else if(h.isSupported())this._loaderClass=h;else{if(!f.isSupported())throw new c.d("Your browser doesn't support xhr with arraybuffer responseType!");this._loaderClass=f}},e.prototype._createLoader=function(){this._loader=new this._loaderClass(this._seekHandler,this._config),!1===this._loader.needStashBuffer&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)},e.prototype.open=function(e){this._currentRange={from:0,to:-1},e&&(this._currentRange.from=e),this._speedSampler.reset(),e||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))},e.prototype.abort=function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)},e.prototype.pause=function(){this.isWorking()&&(this._loader.abort(),0!==this._stashUsed?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)},e.prototype.resume=function(){if(this._paused){this._paused=!1;var e=this._resumeFrom;this._resumeFrom=0,this._internalSeek(e,!0)}},e.prototype.seek=function(e){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(e,!0)},e.prototype._internalSeek=function(e,t){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(t),this._loader.destroy(),this._loader=null;var r={from:e,to:-1};this._currentRange={from:r.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,r),this._onSeeked&&this._onSeeked()},e.prototype.updateUrl=function(e){if(!e||"string"!=typeof e||0===e.length)throw new c.b("Url must be a non-empty string!");this._dataSource.url=e},e.prototype._expandBuffer=function(e){for(var t=this._stashSize;t+1048576<e;)t*=2;if((t+=1048576)!==this._bufferSize){var r=new ArrayBuffer(t);if(this._stashUsed>0){var i=new Uint8Array(this._stashBuffer,0,this._stashUsed);new Uint8Array(r,0,t).set(i,0)}this._stashBuffer=r,this._bufferSize=t}},e.prototype._normalizeSpeed=function(e){var t=this._speedNormalizeList,r=t.length-1,i=0,n=0,s=r;if(e<t[0])return t[0];for(;n<=s;){if((i=n+Math.floor((s-n)/2))===r||e>=t[i]&&e<t[i+1])return t[i];t[i]<e?n=i+1:s=i-1}},e.prototype._adjustStashSize=function(e){var t=0;(t=this._config.isLive?e/8:e<512?e:e>=512&&e<=1024?Math.floor(1.5*e):2*e)>8192&&(t=8192);var r=1024*t+1048576;this._bufferSize<r&&this._expandBuffer(r),this._stashSize=1024*t},e.prototype._dispatchChunks=function(e,t){return this._currentRange.to=t+e.byteLength-1,this._onDataArrival(e,t)},e.prototype._onURLRedirect=function(e){this._redirectedURL=e,this._onRedirect&&this._onRedirect(e)},e.prototype._onContentLengthKnown=function(e){e&&this._fullRequestFlag&&(this._totalLength=e,this._fullRequestFlag=!1)},e.prototype._onLoaderChunkArrival=function(e,t,r){if(!this._onDataArrival)throw new c.a("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(e.byteLength);var i=this._speedSampler.lastSecondKBps;if(0!==i){var n=this._normalizeSpeed(i);this._speedNormalized!==n&&(this._speedNormalized=n,this._adjustStashSize(n))}if(this._enableStash)if(0===this._stashUsed&&0===this._stashByteStart&&(this._stashByteStart=t),this._stashUsed+e.byteLength<=this._stashSize)(o=new Uint8Array(this._stashBuffer,0,this._stashSize)).set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength;else if(o=new Uint8Array(this._stashBuffer,0,this._bufferSize),this._stashUsed>0){var s=this._stashBuffer.slice(0,this._stashUsed);(l=this._dispatchChunks(s,this._stashByteStart))<s.byteLength?l>0&&(d=new Uint8Array(s,l),o.set(d,0),this._stashUsed=d.byteLength,this._stashByteStart+=l):(this._stashUsed=0,this._stashByteStart+=l),this._stashUsed+e.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+e.byteLength),o=new Uint8Array(this._stashBuffer,0,this._bufferSize)),o.set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength}else(l=this._dispatchChunks(e,t))<e.byteLength&&((a=e.byteLength-l)>this._bufferSize&&(this._expandBuffer(a),o=new Uint8Array(this._stashBuffer,0,this._bufferSize)),o.set(new Uint8Array(e,l),0),this._stashUsed+=a,this._stashByteStart=t+l);else if(0===this._stashUsed){var a;(l=this._dispatchChunks(e,t))<e.byteLength&&((a=e.byteLength-l)>this._bufferSize&&this._expandBuffer(a),(o=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(e,l),0),this._stashUsed+=a,this._stashByteStart=t+l)}else{var o,l;if(this._stashUsed+e.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+e.byteLength),(o=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength,(l=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart))<this._stashUsed&&l>0){var d=new Uint8Array(this._stashBuffer,l);o.set(d,0)}this._stashUsed-=l,this._stashByteStart+=l}}},e.prototype._flushStashBuffer=function(e){if(this._stashUsed>0){var t=this._stashBuffer.slice(0,this._stashUsed),r=this._dispatchChunks(t,this._stashByteStart),i=t.byteLength-r;if(r<t.byteLength){if(!e){if(r>0){var s=new Uint8Array(this._stashBuffer,0,this._bufferSize),a=new Uint8Array(t,r);s.set(a,0),this._stashUsed=a.byteLength,this._stashByteStart+=r}return 0}n.a.w(this.TAG,i+" bytes unconsumed data remain when flush buffer, dropped")}return this._stashUsed=0,this._stashByteStart=0,i}return 0},e.prototype._onLoaderComplete=function(e,t){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)},e.prototype._onLoaderError=function(e,t){switch(n.a.e(this.TAG,"Loader error, code = "+t.code+", msg = "+t.msg),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,e=a.b.UNRECOVERABLE_EARLY_EOF),e){case a.b.EARLY_EOF:if(!this._config.isLive&&this._totalLength){var r=this._currentRange.to+1;return void(r<this._totalLength&&(n.a.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(r,!1)))}e=a.b.UNRECOVERABLE_EARLY_EOF;case a.b.UNRECOVERABLE_EARLY_EOF:case a.b.CONNECTING_TIMEOUT:case a.b.HTTP_STATUS_CODE_INVALID:case a.b.EXCEPTION:}if(!this._onError)throw new c.d("IOException: "+t.msg);this._onError(e,t)},e}();t.a=y},function(e,t,r){"use strict";var i=function(){function e(){}return e.install=function(){Object.setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Object.assign=Object.assign||function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var i=arguments[r];if(null!=i)for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])}return t},"function"!=typeof self.Promise&&r(15).polyfill()},e}();i.install(),t.a=i},function(e,t,r){function i(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r.oe=function(e){throw console.error(e),e};var i=r(r.s=ENTRY_MODULE);return i.default||i}function n(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function s(e,t,i){var s={};s[i]=[];var a=t.toString(),o=a.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!o)return s;for(var c,l=o[1],d=new RegExp("(\\\\n|\\W)"+n(l)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");c=d.exec(a);)"dll-reference"!==c[3]&&s[i].push(c[3]);for(d=new RegExp("\\("+n(l)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");c=d.exec(a);)e[c[2]]||(s[i].push(c[1]),e[c[2]]=r(c[1]).m),s[c[2]]=s[c[2]]||[],s[c[2]].push(c[4]);for(var u,h=Object.keys(s),p=0;p<h.length;p++)for(var f=0;f<s[h[p]].length;f++)u=s[h[p]][f],isNaN(1*u)||(s[h[p]][f]=1*s[h[p]][f]);return s}function a(e){return Object.keys(e).reduce((function(t,r){return t||e[r].length>0}),!1)}e.exports=function(e,t){t=t||{};var n={main:r.m},o=t.all?{main:Object.keys(n.main)}:function(e,t){for(var r={main:[t]},i={main:[]},n={main:{}};a(r);)for(var o=Object.keys(r),c=0;c<o.length;c++){var l=o[c],d=r[l].pop();if(n[l]=n[l]||{},!n[l][d]&&e[l][d]){n[l][d]=!0,i[l]=i[l]||[],i[l].push(d);for(var u=s(e,e[l][d],l),h=Object.keys(u),p=0;p<h.length;p++)r[h[p]]=r[h[p]]||[],r[h[p]]=r[h[p]].concat(u[h[p]])}}return i}(n,e),c="";Object.keys(o).filter((function(e){return"main"!==e})).forEach((function(e){for(var t=0;o[e][t];)t++;o[e].push(t),n[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",c=c+"var "+e+" = ("+i.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+o[e].map((function(t){return JSON.stringify(t)+": "+n[e][t].toString()})).join(",")+"});\n"})),c=c+"new (("+i.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+o.main.map((function(e){return JSON.stringify(e)+": "+n.main[e].toString()})).join(",")+"}))(self);";var l=new window.Blob([c],{type:"text/javascript"});if(t.bare)return l;var d=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(l),u=new window.Worker(d);return u.objectURL=d,u}},function(e,t,r){e.exports=r(19).default},function(e,t,r){(function(t,r){var i;i=function(){"use strict";function e(e){return"function"==typeof e}var i=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},n=0,s=void 0,a=void 0,o=function(e,t){f[n]=e,f[n+1]=t,2===(n+=2)&&(a?a(m):b())},c="undefined"!=typeof window?window:void 0,l=c||{},d=l.MutationObserver||l.WebKitMutationObserver,u="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),h="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function p(){var e=setTimeout;return function(){return e(m,1)}}var f=new Array(1e3);function m(){for(var e=0;e<n;e+=2)(0,f[e])(f[e+1]),f[e]=void 0,f[e+1]=void 0;n=0}var g,v,_,y,b=void 0;function E(e,t){var r=this,i=new this.constructor(T);void 0===i[w]&&M(i);var n=r._state;if(n){var s=arguments[n-1];o((function(){return I(n,i,s,r._result)}))}else L(r,i,e,t);return i}function S(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(T);return C(t,e),t}u?b=function(){return t.nextTick(m)}:d?(v=0,_=new d(m),y=document.createTextNode(""),_.observe(y,{characterData:!0}),b=function(){y.data=v=++v%2}):h?((g=new MessageChannel).port1.onmessage=m,b=function(){return g.port2.postMessage(0)}):b=void 0===c?function(){try{var e=Function("return this")().require("vertx");return void 0!==(s=e.runOnLoop||e.runOnContext)?function(){s(m)}:p()}catch(e){return p()}}():p();var w=Math.random().toString(36).substring(2);function T(){}function R(t,r,i){r.constructor===t.constructor&&i===E&&r.constructor.resolve===S?function(e,t){1===t._state?P(e,t._result):2===t._state?D(e,t._result):L(t,void 0,(function(t){return C(e,t)}),(function(t){return D(e,t)}))}(t,r):void 0===i?P(t,r):e(i)?function(e,t,r){o((function(e){var i=!1,n=function(e,t,r,i){try{e.call(t,r,i)}catch(e){return e}}(r,t,(function(r){i||(i=!0,t!==r?C(e,r):P(e,r))}),(function(t){i||(i=!0,D(e,t))}),e._label);!i&&n&&(i=!0,D(e,n))}),e)}(t,r,i):P(t,r)}function C(e,t){if(e===t)D(e,new TypeError("You cannot resolve a promise with itself"));else if(n=typeof(i=t),null===i||"object"!==n&&"function"!==n)P(e,t);else{var r=void 0;try{r=t.then}catch(t){return void D(e,t)}R(e,t,r)}var i,n}function A(e){e._onerror&&e._onerror(e._result),k(e)}function P(e,t){void 0===e._state&&(e._result=t,e._state=1,0!==e._subscribers.length&&o(k,e))}function D(e,t){void 0===e._state&&(e._state=2,e._result=t,o(A,e))}function L(e,t,r,i){var n=e._subscribers,s=n.length;e._onerror=null,n[s]=t,n[s+1]=r,n[s+2]=i,0===s&&e._state&&o(k,e)}function k(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var i=void 0,n=void 0,s=e._result,a=0;a<t.length;a+=3)i=t[a],n=t[a+r],i?I(r,i,n,s):n(s);e._subscribers.length=0}}function I(t,r,i,n){var s=e(i),a=void 0,o=void 0,c=!0;if(s){try{a=i(n)}catch(e){c=!1,o=e}if(r===a)return void D(r,new TypeError("A promises callback cannot return that same promise."))}else a=n;void 0!==r._state||(s&&c?C(r,a):!1===c?D(r,o):1===t?P(r,a):2===t&&D(r,a))}var O=0;function M(e){e[w]=O++,e._state=void 0,e._result=void 0,e._subscribers=[]}var x=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(T),this.promise[w]||M(this.promise),i(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?P(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&P(this.promise,this._result))):D(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;void 0===this._state&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var r=this._instanceConstructor,i=r.resolve;if(i===S){var n=void 0,s=void 0,a=!1;try{n=e.then}catch(e){a=!0,s=e}if(n===E&&void 0!==e._state)this._settledAt(e._state,t,e._result);else if("function"!=typeof n)this._remaining--,this._result[t]=e;else if(r===N){var o=new r(T);a?D(o,s):R(o,e,n),this._willSettleAt(o,t)}else this._willSettleAt(new r((function(t){return t(e)})),t)}else this._willSettleAt(i(e),t)},e.prototype._settledAt=function(e,t,r){var i=this.promise;void 0===i._state&&(this._remaining--,2===e?D(i,r):this._result[t]=r),0===this._remaining&&P(i,this._result)},e.prototype._willSettleAt=function(e,t){var r=this;L(e,void 0,(function(e){return r._settledAt(1,t,e)}),(function(e){return r._settledAt(2,t,e)}))},e}(),N=function(){function t(e){this[w]=O++,this._result=this._state=void 0,this._subscribers=[],T!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(e,t){try{t((function(t){C(e,t)}),(function(t){D(e,t)}))}catch(t){D(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(e){return this.then(null,e)},t.prototype.finally=function(t){var r=this.constructor;return e(t)?this.then((function(e){return r.resolve(t()).then((function(){return e}))}),(function(e){return r.resolve(t()).then((function(){throw e}))})):this.then(t,t)},t}();return N.prototype.then=E,N.all=function(e){return new x(this,e).promise},N.race=function(e){var t=this;return i(e)?new t((function(r,i){for(var n=e.length,s=0;s<n;s++)t.resolve(e[s]).then(r,i)})):new t((function(e,t){return t(new TypeError("You must pass an array to race."))}))},N.resolve=S,N.reject=function(e){var t=new this(T);return D(t,e),t},N._setScheduler=function(e){a=e},N._setAsap=function(e){o=e},N._asap=o,N.polyfill=function(){var e=void 0;if(void 0!==r)e=r;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var i=null;try{i=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===i&&!t.cast)return}e.Promise=N},N.Promise=N,N},e.exports=i()}).call(this,r(16),r(17))},function(e,t){var r,i,n=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function o(e){if(r===setTimeout)return setTimeout(e,0);if((r===s||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:s}catch(e){r=s}try{i="function"==typeof clearTimeout?clearTimeout:a}catch(e){i=a}}();var c,l=[],d=!1,u=-1;function h(){d&&c&&(d=!1,c.length?l=c.concat(l):u=-1,l.length&&p())}function p(){if(!d){var e=o(h);d=!0;for(var t=l.length;t;){for(c=l,l=[];++u<t;)c&&c[u].run();u=-1,t=l.length}c=null,d=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===a||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function m(){}n.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];l.push(new f(e,t)),1!==l.length||d||o(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=m,n.addListener=m,n.once=m,n.off=m,n.removeListener=m,n.removeAllListeners=m,n.emit=m,n.prependListener=m,n.prependOnceListener=m,n.listeners=function(e){return[]},n.binding=function(e){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";r.r(t);var i=r(9),n=r(12),s=r(10),a=r(1);t.default=function(e){var t=null,r=function(t,r){e.postMessage({msg:"logcat_callback",data:{type:t,logcat:r}})}.bind(this);function o(t,r){var i={msg:a.a.INIT_SEGMENT,data:{type:t,data:r}};e.postMessage(i,[r.data])}function c(t,r){var i={msg:a.a.MEDIA_SEGMENT,data:{type:t,data:r}};e.postMessage(i,[r.data])}function l(){var t={msg:a.a.LOADING_COMPLETE};e.postMessage(t)}function d(){var t={msg:a.a.RECOVERED_EARLY_EOF};e.postMessage(t)}function u(t){var r={msg:a.a.MEDIA_INFO,data:t};e.postMessage(r)}function h(t){var r={msg:a.a.METADATA_ARRIVED,data:t};e.postMessage(r)}function p(t){var r={msg:a.a.SCRIPTDATA_ARRIVED,data:t};e.postMessage(r)}function f(t){var r={msg:a.a.TIMED_ID3_METADATA_ARRIVED,data:t};e.postMessage(r)}function m(t){var r={msg:a.a.SMPTE2038_METADATA_ARRIVED,data:t};e.postMessage(r)}function g(t){var r={msg:a.a.SCTE35_METADATA_ARRIVED,data:t};e.postMessage(r)}function v(t){var r={msg:a.a.PES_PRIVATE_DATA_DESCRIPTOR,data:t};e.postMessage(r)}function _(t){var r={msg:a.a.PES_PRIVATE_DATA_ARRIVED,data:t};e.postMessage(r)}function y(t){var r={msg:a.a.STATISTICS_INFO,data:t};e.postMessage(r)}function b(t,r){e.postMessage({msg:a.a.IO_ERROR,data:{type:t,info:r}})}function E(t,r){e.postMessage({msg:a.a.DEMUX_ERROR,data:{type:t,info:r}})}function S(t){e.postMessage({msg:a.a.RECOMMEND_SEEKPOINT,data:t})}n.a.install(),e.addEventListener("message",(function(n){switch(n.data.cmd){case"init":(t=new s.a(n.data.param[0],n.data.param[1])).on(a.a.IO_ERROR,b.bind(this)),t.on(a.a.DEMUX_ERROR,E.bind(this)),t.on(a.a.INIT_SEGMENT,o.bind(this)),t.on(a.a.MEDIA_SEGMENT,c.bind(this)),t.on(a.a.LOADING_COMPLETE,l.bind(this)),t.on(a.a.RECOVERED_EARLY_EOF,d.bind(this)),t.on(a.a.MEDIA_INFO,u.bind(this)),t.on(a.a.METADATA_ARRIVED,h.bind(this)),t.on(a.a.SCRIPTDATA_ARRIVED,p.bind(this)),t.on(a.a.TIMED_ID3_METADATA_ARRIVED,f.bind(this)),t.on(a.a.SMPTE2038_METADATA_ARRIVED,m.bind(this)),t.on(a.a.SCTE35_METADATA_ARRIVED,g.bind(this)),t.on(a.a.PES_PRIVATE_DATA_DESCRIPTOR,v.bind(this)),t.on(a.a.PES_PRIVATE_DATA_ARRIVED,_.bind(this)),t.on(a.a.STATISTICS_INFO,y.bind(this)),t.on(a.a.RECOMMEND_SEEKPOINT,S.bind(this));break;case"destroy":t&&(t.destroy(),t=null),e.postMessage({msg:"destroyed"});break;case"start":t.start();break;case"stop":t.stop();break;case"seek":t.seek(n.data.param);break;case"pause":t.pause();break;case"resume":t.resume();break;case"logging_config":var w=n.data.param;i.a.applyConfig(w),!0===w.enableCallback?i.a.addLogListener(r):i.a.removeLogListener(r)}}))}},function(e,t,r){"use strict";r.r(t);var i=r(12),n=r(11),s={enableWorker:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,liveBufferLatencyChasing:!1,liveBufferLatencyMaxLatency:1.5,liveBufferLatencyMinRemain:.5,lazyLoad:!0,lazyLoadMaxDuration:180,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:180,autoCleanupMinBackwardDuration:120,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0};function a(){return Object.assign({},s)}var o=function(){function e(){}return e.supportMSEH264Playback=function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')},e.supportMSEH265Playback=function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="hvc1.1.6.L93.B0"')},e.supportNetworkStreamIO=function(){var e=new n.a({},a()),t=e.loaderType;return e.destroy(),"fetch-stream-loader"==t||"xhr-moz-chunked-loader"==t},e.getNetworkLoaderTypeName=function(){var e=new n.a({},a()),t=e.loaderType;return e.destroy(),t},e.supportNativeMediaPlayback=function(t){null==e.videoElement&&(e.videoElement=window.document.createElement("video"));var r=e.videoElement.canPlayType(t);return"probably"===r||"maybe"==r},e.getFeatureList=function(){var t={msePlayback:!1,mseLivePlayback:!1,mseH265Playback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeMP4H265Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return t.msePlayback=e.supportMSEH264Playback(),t.networkStreamIO=e.supportNetworkStreamIO(),t.networkLoaderName=e.getNetworkLoaderTypeName(),t.mseLivePlayback=t.msePlayback&&t.networkStreamIO,t.mseH265Playback=e.supportMSEH265Playback(),t.nativeMP4H264Playback=e.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),t.nativeMP4H265Playback=e.supportNativeMediaPlayback('video/mp4; codecs="hvc1.1.6.L93.B0"'),t.nativeWebmVP8Playback=e.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),t.nativeWebmVP9Playback=e.supportNativeMediaPlayback('video/webm; codecs="vp9"'),t},e}(),c=r(2),l=r(6),d=r.n(l),u=r(0),h=r(4),p={ERROR:"error",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",TIMED_ID3_METADATA_ARRIVED:"timed_id3_metadata_arrived",SMPTE2038_METADATA_ARRIVED:"smpte2038_metadata_arrived",SCTE35_METADATA_ARRIVED:"scte35_metadata_arrived",PES_PRIVATE_DATA_DESCRIPTOR:"pes_private_data_descriptor",PES_PRIVATE_DATA_ARRIVED:"pes_private_data_arrived",STATISTICS_INFO:"statistics_info"},f=r(13),m=r.n(f),g=r(9),v=r(10),_=r(1),y=r(8),b=function(){function e(e,t){if(this.TAG="Transmuxer",this._emitter=new d.a,t.enableWorker&&"undefined"!=typeof Worker)try{this._worker=m()(18),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[e,t]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},g.a.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:g.a.getConfig()})}catch(r){u.a.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new v.a(e,t)}else this._controller=new v.a(e,t);if(this._controller){var r=this._controller;r.on(_.a.IO_ERROR,this._onIOError.bind(this)),r.on(_.a.DEMUX_ERROR,this._onDemuxError.bind(this)),r.on(_.a.INIT_SEGMENT,this._onInitSegment.bind(this)),r.on(_.a.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),r.on(_.a.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),r.on(_.a.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),r.on(_.a.MEDIA_INFO,this._onMediaInfo.bind(this)),r.on(_.a.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),r.on(_.a.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),r.on(_.a.TIMED_ID3_METADATA_ARRIVED,this._onTimedID3MetadataArrived.bind(this)),r.on(_.a.SMPTE2038_METADATA_ARRIVED,this._onSMPTE2038MetadataArrived.bind(this)),r.on(_.a.SCTE35_METADATA_ARRIVED,this._onSCTE35MetadataArrived.bind(this)),r.on(_.a.PES_PRIVATE_DATA_DESCRIPTOR,this._onPESPrivateDataDescriptor.bind(this)),r.on(_.a.PES_PRIVATE_DATA_ARRIVED,this._onPESPrivateDataArrived.bind(this)),r.on(_.a.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),r.on(_.a.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return e.prototype.destroy=function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),g.a.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null},e.prototype.on=function(e,t){this._emitter.addListener(e,t)},e.prototype.off=function(e,t){this._emitter.removeListener(e,t)},e.prototype.hasWorker=function(){return null!=this._worker},e.prototype.open=function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()},e.prototype.close=function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()},e.prototype.seek=function(e){this._worker?this._worker.postMessage({cmd:"seek",param:e}):this._controller.seek(e)},e.prototype.pause=function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()},e.prototype.resume=function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()},e.prototype._onInitSegment=function(e,t){var r=this;Promise.resolve().then((function(){r._emitter.emit(_.a.INIT_SEGMENT,e,t)}))},e.prototype._onMediaSegment=function(e,t){var r=this;Promise.resolve().then((function(){r._emitter.emit(_.a.MEDIA_SEGMENT,e,t)}))},e.prototype._onLoadingComplete=function(){var e=this;Promise.resolve().then((function(){e._emitter.emit(_.a.LOADING_COMPLETE)}))},e.prototype._onRecoveredEarlyEof=function(){var e=this;Promise.resolve().then((function(){e._emitter.emit(_.a.RECOVERED_EARLY_EOF)}))},e.prototype._onMediaInfo=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(_.a.MEDIA_INFO,e)}))},e.prototype._onMetaDataArrived=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(_.a.METADATA_ARRIVED,e)}))},e.prototype._onScriptDataArrived=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(_.a.SCRIPTDATA_ARRIVED,e)}))},e.prototype._onTimedID3MetadataArrived=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(_.a.TIMED_ID3_METADATA_ARRIVED,e)}))},e.prototype._onSMPTE2038MetadataArrived=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(_.a.SMPTE2038_METADATA_ARRIVED,e)}))},e.prototype._onSCTE35MetadataArrived=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(_.a.SCTE35_METADATA_ARRIVED,e)}))},e.prototype._onPESPrivateDataDescriptor=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(_.a.PES_PRIVATE_DATA_DESCRIPTOR,e)}))},e.prototype._onPESPrivateDataArrived=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(_.a.PES_PRIVATE_DATA_ARRIVED,e)}))},e.prototype._onStatisticsInfo=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(_.a.STATISTICS_INFO,e)}))},e.prototype._onIOError=function(e,t){var r=this;Promise.resolve().then((function(){r._emitter.emit(_.a.IO_ERROR,e,t)}))},e.prototype._onDemuxError=function(e,t){var r=this;Promise.resolve().then((function(){r._emitter.emit(_.a.DEMUX_ERROR,e,t)}))},e.prototype._onRecommendSeekpoint=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(_.a.RECOMMEND_SEEKPOINT,e)}))},e.prototype._onLoggingConfigChanged=function(e){this._worker&&this._worker.postMessage({cmd:"logging_config",param:e})},e.prototype._onWorkerMessage=function(e){var t=e.data,r=t.data;if("destroyed"===t.msg||this._workerDestroying)return this._workerDestroying=!1,this._worker.terminate(),void(this._worker=null);switch(t.msg){case _.a.INIT_SEGMENT:case _.a.MEDIA_SEGMENT:this._emitter.emit(t.msg,r.type,r.data);break;case _.a.LOADING_COMPLETE:case _.a.RECOVERED_EARLY_EOF:this._emitter.emit(t.msg);break;case _.a.MEDIA_INFO:Object.setPrototypeOf(r,y.a.prototype),this._emitter.emit(t.msg,r);break;case _.a.METADATA_ARRIVED:case _.a.SCRIPTDATA_ARRIVED:case _.a.TIMED_ID3_METADATA_ARRIVED:case _.a.SMPTE2038_METADATA_ARRIVED:case _.a.SCTE35_METADATA_ARRIVED:case _.a.PES_PRIVATE_DATA_DESCRIPTOR:case _.a.PES_PRIVATE_DATA_ARRIVED:case _.a.STATISTICS_INFO:this._emitter.emit(t.msg,r);break;case _.a.IO_ERROR:case _.a.DEMUX_ERROR:this._emitter.emit(t.msg,r.type,r.info);break;case _.a.RECOMMEND_SEEKPOINT:this._emitter.emit(t.msg,r);break;case"logcat_callback":u.a.emitter.emit("log",r.type,r.logcat)}},e}(),E="error",S="source_open",w="update_end",T="buffer_full",R=r(7),C=r(3),A=function(){function e(e){this.TAG="MSEController",this._config=e,this._emitter=new d.a,this._config.isLive&&null==this._config.autoCleanupSourceBuffer&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new R.a}return e.prototype.destroy=function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null},e.prototype.on=function(e,t){this._emitter.addListener(e,t)},e.prototype.off=function(e,t){this._emitter.removeListener(e,t)},e.prototype.attachMediaElement=function(e){if(this._mediaSource)throw new C.a("MediaSource has been attached to an HTMLMediaElement!");var t=this._mediaSource=new window.MediaSource;t.addEventListener("sourceopen",this.e.onSourceOpen),t.addEventListener("sourceended",this.e.onSourceEnded),t.addEventListener("sourceclose",this.e.onSourceClose),this._mediaElement=e,this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),e.src=this._mediaSourceObjectURL},e.prototype.detachMediaElement=function(){if(this._mediaSource){var e=this._mediaSource;for(var t in this._sourceBuffers){var r=this._pendingSegments[t];r.splice(0,r.length),this._pendingSegments[t]=null,this._pendingRemoveRanges[t]=null,this._lastInitSegments[t]=null;var i=this._sourceBuffers[t];if(i){if("closed"!==e.readyState){try{e.removeSourceBuffer(i)}catch(e){u.a.e(this.TAG,e.message)}i.removeEventListener("error",this.e.onSourceBufferError),i.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[t]=null,this._sourceBuffers[t]=null}}if("open"===e.readyState)try{e.endOfStream()}catch(e){u.a.e(this.TAG,e.message)}e.removeEventListener("sourceopen",this.e.onSourceOpen),e.removeEventListener("sourceended",this.e.onSourceEnded),e.removeEventListener("sourceclose",this.e.onSourceClose),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)},e.prototype.appendInitSegment=function(e,t){if(!this._mediaSource||"open"!==this._mediaSource.readyState)return this._pendingSourceBufferInit.push(e),void this._pendingSegments[e.type].push(e);var r=e,i=""+r.container;r.codec&&r.codec.length>0&&(i+=";codecs="+r.codec);var n=!1;if(u.a.v(this.TAG,"Received Initialization Segment, mimeType: "+i),this._lastInitSegments[r.type]=r,i!==this._mimeTypes[r.type]){if(this._mimeTypes[r.type])u.a.v(this.TAG,"Notice: "+r.type+" mimeType changed, origin: "+this._mimeTypes[r.type]+", target: "+i);else{n=!0;try{var s=this._sourceBuffers[r.type]=this._mediaSource.addSourceBuffer(i);s.addEventListener("error",this.e.onSourceBufferError),s.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(e){return u.a.e(this.TAG,e.message),void this._emitter.emit(E,{code:e.code,msg:e.message})}}this._mimeTypes[r.type]=i}t||this._pendingSegments[r.type].push(r),n||this._sourceBuffers[r.type]&&!this._sourceBuffers[r.type].updating&&this._doAppendSegments(),h.a.safari&&"audio/mpeg"===r.container&&r.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=r.mediaDuration/1e3,this._updateMediaSourceDuration())},e.prototype.appendMediaSegment=function(e){var t=e;this._pendingSegments[t.type].push(t),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var r=this._sourceBuffers[t.type];!r||r.updating||this._hasPendingRemoveRanges()||this._doAppendSegments()},e.prototype.seek=function(e){for(var t in this._sourceBuffers)if(this._sourceBuffers[t]){var r=this._sourceBuffers[t];if("open"===this._mediaSource.readyState)try{r.abort()}catch(e){u.a.e(this.TAG,e.message)}this._idrList.clear();var i=this._pendingSegments[t];if(i.splice(0,i.length),"closed"!==this._mediaSource.readyState){for(var n=0;n<r.buffered.length;n++){var s=r.buffered.start(n),a=r.buffered.end(n);this._pendingRemoveRanges[t].push({start:s,end:a})}if(r.updating||this._doRemoveRanges(),h.a.safari){var o=this._lastInitSegments[t];o&&(this._pendingSegments[t].push(o),r.updating||this._doAppendSegments())}}}},e.prototype.endOfStream=function(){var e=this._mediaSource,t=this._sourceBuffers;e&&"open"===e.readyState?t.video&&t.video.updating||t.audio&&t.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,e.endOfStream()):e&&"closed"===e.readyState&&this._hasPendingSegments()&&(this._hasPendingEos=!0)},e.prototype.getNearestKeyframe=function(e){return this._idrList.getLastSyncPointBeforeDts(e)},e.prototype._needCleanupSourceBuffer=function(){if(!this._config.autoCleanupSourceBuffer)return!1;var e=this._mediaElement.currentTime;for(var t in this._sourceBuffers){var r=this._sourceBuffers[t];if(r){var i=r.buffered;if(i.length>=1&&e-i.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1},e.prototype._doCleanupSourceBuffer=function(){var e=this._mediaElement.currentTime;for(var t in this._sourceBuffers){var r=this._sourceBuffers[t];if(r){for(var i=r.buffered,n=!1,s=0;s<i.length;s++){var a=i.start(s),o=i.end(s);if(a<=e&&e<o+3){if(e-a>=this._config.autoCleanupMaxBackwardDuration){n=!0;var c=e-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[t].push({start:a,end:c})}}else o<e&&(n=!0,this._pendingRemoveRanges[t].push({start:a,end:o}))}n&&!r.updating&&this._doRemoveRanges()}}},e.prototype._updateMediaSourceDuration=function(){var e=this._sourceBuffers;if(0!==this._mediaElement.readyState&&"open"===this._mediaSource.readyState&&!(e.video&&e.video.updating||e.audio&&e.audio.updating)){var t=this._mediaSource.duration,r=this._pendingMediaDuration;r>0&&(isNaN(t)||r>t)&&(u.a.v(this.TAG,"Update MediaSource duration from "+t+" to "+r),this._mediaSource.duration=r),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}},e.prototype._doRemoveRanges=function(){for(var e in this._pendingRemoveRanges)if(this._sourceBuffers[e]&&!this._sourceBuffers[e].updating)for(var t=this._sourceBuffers[e],r=this._pendingRemoveRanges[e];r.length&&!t.updating;){var i=r.shift();t.remove(i.start,i.end)}},e.prototype._doAppendSegments=function(){var e=this._pendingSegments;for(var t in e)if(this._sourceBuffers[t]&&!this._sourceBuffers[t].updating&&e[t].length>0){var r=e[t].shift();if(r.timestampOffset){var i=this._sourceBuffers[t].timestampOffset,n=r.timestampOffset/1e3;Math.abs(i-n)>.1&&(u.a.v(this.TAG,"Update MPEG audio timestampOffset from "+i+" to "+n),this._sourceBuffers[t].timestampOffset=n),delete r.timestampOffset}if(!r.data||0===r.data.byteLength)continue;try{this._sourceBuffers[t].appendBuffer(r.data),this._isBufferFull=!1,"video"===t&&r.hasOwnProperty("info")&&this._idrList.appendArray(r.info.syncPoints)}catch(e){this._pendingSegments[t].unshift(r),22===e.code?(this._isBufferFull||this._emitter.emit(T),this._isBufferFull=!0):(u.a.e(this.TAG,e.message),this._emitter.emit(E,{code:e.code,msg:e.message}))}}},e.prototype._onSourceOpen=function(){if(u.a.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var e=this._pendingSourceBufferInit;e.length;){var t=e.shift();this.appendInitSegment(t,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(S)},e.prototype._onSourceEnded=function(){u.a.v(this.TAG,"MediaSource onSourceEnded")},e.prototype._onSourceClose=function(){u.a.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&null!=this.e&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))},e.prototype._hasPendingSegments=function(){var e=this._pendingSegments;return e.video.length>0||e.audio.length>0},e.prototype._hasPendingRemoveRanges=function(){var e=this._pendingRemoveRanges;return e.video.length>0||e.audio.length>0},e.prototype._onSourceBufferUpdateEnd=function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(w)},e.prototype._onSourceBufferError=function(e){u.a.e(this.TAG,"SourceBuffer Error: "+e)},e}(),P=r(5),D={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},L={NETWORK_EXCEPTION:c.b.EXCEPTION,NETWORK_STATUS_CODE_INVALID:c.b.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:c.b.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:c.b.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:P.a.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:P.a.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:P.a.CODEC_UNSUPPORTED},k=function(){function e(e,t){this.TAG="MSEPlayer",this._type="MSEPlayer",this._emitter=new d.a,this._config=a(),"object"==typeof t&&Object.assign(this._config,t);var r=e.type.toLowerCase();if("mse"!==r&&"mpegts"!==r&&"m2ts"!==r&&"flv"!==r)throw new C.b("MSEPlayer requires an mpegts/m2ts/flv MediaDataSource input!");!0===e.isLive&&(this._config.isLive=!0),this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)},self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now,this._pendingSeekTime=null,this._requestSetTime=!1,this._seekpointRecord=null,this._progressChecker=null,this._mediaDataSource=e,this._mediaElement=null,this._msectl=null,this._transmuxer=null,this._mseSourceOpened=!1,this._hasPendingLoad=!1,this._receivedCanPlay=!1,this._mediaInfo=null,this._statisticsInfo=null;var i=h.a.chrome&&(h.a.version.major<50||50===h.a.version.major&&h.a.version.build<2661);this._alwaysSeekKeyframe=!!(i||h.a.msedge||h.a.msie),this._alwaysSeekKeyframe&&(this._config.accurateSeek=!1)}return e.prototype.destroy=function(){null!=this._progressChecker&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._transmuxer&&this.unload(),this._mediaElement&&this.detachMediaElement(),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},e.prototype.on=function(e,t){var r=this;e===p.MEDIA_INFO?null!=this._mediaInfo&&Promise.resolve().then((function(){r._emitter.emit(p.MEDIA_INFO,r.mediaInfo)})):e===p.STATISTICS_INFO&&null!=this._statisticsInfo&&Promise.resolve().then((function(){r._emitter.emit(p.STATISTICS_INFO,r.statisticsInfo)})),this._emitter.addListener(e,t)},e.prototype.off=function(e,t){this._emitter.removeListener(e,t)},e.prototype.attachMediaElement=function(e){var t=this;if(this._mediaElement=e,e.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),e.addEventListener("seeking",this.e.onvSeeking),e.addEventListener("canplay",this.e.onvCanPlay),e.addEventListener("stalled",this.e.onvStalled),e.addEventListener("progress",this.e.onvProgress),this._msectl=new A(this._config),this._msectl.on(w,this._onmseUpdateEnd.bind(this)),this._msectl.on(T,this._onmseBufferFull.bind(this)),this._msectl.on(S,(function(){t._mseSourceOpened=!0,t._hasPendingLoad&&(t._hasPendingLoad=!1,t.load())})),this._msectl.on(E,(function(e){t._emitter.emit(p.ERROR,D.MEDIA_ERROR,L.MEDIA_MSE_ERROR,e)})),this._msectl.attachMediaElement(e),null!=this._pendingSeekTime)try{e.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(e){}},e.prototype.detachMediaElement=function(){this._mediaElement&&(this._msectl.detachMediaElement(),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("seeking",this.e.onvSeeking),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("stalled",this.e.onvStalled),this._mediaElement.removeEventListener("progress",this.e.onvProgress),this._mediaElement=null),this._msectl&&(this._msectl.destroy(),this._msectl=null)},e.prototype.load=function(){var e=this;if(!this._mediaElement)throw new C.a("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new C.a("MSEPlayer.load() has been called, please call unload() first!");this._hasPendingLoad||(this._config.deferLoadAfterSourceOpen&&!1===this._mseSourceOpened?this._hasPendingLoad=!0:(this._mediaElement.readyState>0&&(this._requestSetTime=!0,this._mediaElement.currentTime=0),this._transmuxer=new b(this._mediaDataSource,this._config),this._transmuxer.on(_.a.INIT_SEGMENT,(function(t,r){e._msectl.appendInitSegment(r)})),this._transmuxer.on(_.a.MEDIA_SEGMENT,(function(t,r){if(e._msectl.appendMediaSegment(r),e._config.lazyLoad&&!e._config.isLive){var i=e._mediaElement.currentTime;r.info.endDts>=1e3*(i+e._config.lazyLoadMaxDuration)&&null==e._progressChecker&&(u.a.v(e.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),e._suspendTransmuxer())}})),this._transmuxer.on(_.a.LOADING_COMPLETE,(function(){e._msectl.endOfStream(),e._emitter.emit(p.LOADING_COMPLETE)})),this._transmuxer.on(_.a.RECOVERED_EARLY_EOF,(function(){e._emitter.emit(p.RECOVERED_EARLY_EOF)})),this._transmuxer.on(_.a.IO_ERROR,(function(t,r){e._emitter.emit(p.ERROR,D.NETWORK_ERROR,t,r)})),this._transmuxer.on(_.a.DEMUX_ERROR,(function(t,r){e._emitter.emit(p.ERROR,D.MEDIA_ERROR,t,{code:-1,msg:r})})),this._transmuxer.on(_.a.MEDIA_INFO,(function(t){e._mediaInfo=t,e._emitter.emit(p.MEDIA_INFO,Object.assign({},t))})),this._transmuxer.on(_.a.METADATA_ARRIVED,(function(t){e._emitter.emit(p.METADATA_ARRIVED,t)})),this._transmuxer.on(_.a.SCRIPTDATA_ARRIVED,(function(t){e._emitter.emit(p.SCRIPTDATA_ARRIVED,t)})),this._transmuxer.on(_.a.TIMED_ID3_METADATA_ARRIVED,(function(t){e._emitter.emit(p.TIMED_ID3_METADATA_ARRIVED,t)})),this._transmuxer.on(_.a.SMPTE2038_METADATA_ARRIVED,(function(t){e._emitter.emit(p.SMPTE2038_METADATA_ARRIVED,t)})),this._transmuxer.on(_.a.SCTE35_METADATA_ARRIVED,(function(t){e._emitter.emit(p.SCTE35_METADATA_ARRIVED,t)})),this._transmuxer.on(_.a.PES_PRIVATE_DATA_DESCRIPTOR,(function(t){e._emitter.emit(p.PES_PRIVATE_DATA_DESCRIPTOR,t)})),this._transmuxer.on(_.a.PES_PRIVATE_DATA_ARRIVED,(function(t){e._emitter.emit(p.PES_PRIVATE_DATA_ARRIVED,t)})),this._transmuxer.on(_.a.STATISTICS_INFO,(function(t){e._statisticsInfo=e._fillStatisticsInfo(t),e._emitter.emit(p.STATISTICS_INFO,Object.assign({},e._statisticsInfo))})),this._transmuxer.on(_.a.RECOMMEND_SEEKPOINT,(function(t){e._mediaElement&&!e._config.accurateSeek&&(e._requestSetTime=!0,e._mediaElement.currentTime=t/1e3)})),this._transmuxer.open()))},e.prototype.unload=function(){this._mediaElement&&this._mediaElement.pause(),this._msectl&&this._msectl.seek(0),this._transmuxer&&(this._transmuxer.close(),this._transmuxer.destroy(),this._transmuxer=null)},e.prototype.play=function(){return this._mediaElement.play()},e.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(e){this._mediaElement.volume=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(e){this._mediaElement.muted=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(e){this._mediaElement?this._internalSeek(e):this._pendingSeekTime=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mediaInfo",{get:function(){return Object.assign({},this._mediaInfo)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"statisticsInfo",{get:function(){return null==this._statisticsInfo&&(this._statisticsInfo={}),this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo),Object.assign({},this._statisticsInfo)},enumerable:!1,configurable:!0}),e.prototype._fillStatisticsInfo=function(e){if(e.playerType=this._type,!(this._mediaElement instanceof HTMLVideoElement))return e;var t=!0,r=0,i=0;if(this._mediaElement.getVideoPlaybackQuality){var n=this._mediaElement.getVideoPlaybackQuality();r=n.totalVideoFrames,i=n.droppedVideoFrames}else null!=this._mediaElement.webkitDecodedFrameCount?(r=this._mediaElement.webkitDecodedFrameCount,i=this._mediaElement.webkitDroppedFrameCount):t=!1;return t&&(e.decodedFrames=r,e.droppedFrames=i),e},e.prototype._onmseUpdateEnd=function(){var e=this._mediaElement.buffered,t=this._mediaElement.currentTime;if(this._config.isLive&&this._config.liveBufferLatencyChasing&&e.length>0&&!this._mediaElement.paused){var r=e.end(e.length-1);if(r>this._config.liveBufferLatencyMaxLatency&&r-t>this._config.liveBufferLatencyMaxLatency){var i=r-this._config.liveBufferLatencyMinRemain;this.currentTime=i}}if(this._config.lazyLoad&&!this._config.isLive){for(var n=0,s=0;s<e.length;s++){var a=e.start(s),o=e.end(s);if(a<=t&&t<o){n=o;break}}n>=t+this._config.lazyLoadMaxDuration&&null==this._progressChecker&&(u.a.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this._suspendTransmuxer())}},e.prototype._onmseBufferFull=function(){u.a.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),null==this._progressChecker&&this._suspendTransmuxer()},e.prototype._suspendTransmuxer=function(){this._transmuxer&&(this._transmuxer.pause(),null==this._progressChecker&&(this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1e3)))},e.prototype._checkProgressAndResume=function(){for(var e=this._mediaElement.currentTime,t=this._mediaElement.buffered,r=!1,i=0;i<t.length;i++){var n=t.start(i),s=t.end(i);if(e>=n&&e<s){e>=s-this._config.lazyLoadRecoverDuration&&(r=!0);break}}r&&(window.clearInterval(this._progressChecker),this._progressChecker=null,r&&(u.a.v(this.TAG,"Continue loading from paused position"),this._transmuxer.resume()))},e.prototype._isTimepointBuffered=function(e){for(var t=this._mediaElement.buffered,r=0;r<t.length;r++){var i=t.start(r),n=t.end(r);if(e>=i&&e<n)return!0}return!1},e.prototype._internalSeek=function(e){var t=this._isTimepointBuffered(e),r=!1,i=0;if(e<1&&this._mediaElement.buffered.length>0){var n=this._mediaElement.buffered.start(0);(n<1&&e<n||h.a.safari)&&(r=!0,i=h.a.safari?.1:n)}if(r)this._requestSetTime=!0,this._mediaElement.currentTime=i;else if(t){if(this._alwaysSeekKeyframe){var s=this._msectl.getNearestKeyframe(Math.floor(1e3*e));this._requestSetTime=!0,this._mediaElement.currentTime=null!=s?s.dts/1e3:e}else this._requestSetTime=!0,this._mediaElement.currentTime=e;null!=this._progressChecker&&this._checkProgressAndResume()}else null!=this._progressChecker&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._msectl.seek(e),this._transmuxer.seek(Math.floor(1e3*e)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=e)},e.prototype._checkAndApplyUnbufferedSeekpoint=function(){if(this._seekpointRecord)if(this._seekpointRecord.recordTime<=this._now()-100){var e=this._mediaElement.currentTime;this._seekpointRecord=null,this._isTimepointBuffered(e)||(null!=this._progressChecker&&(window.clearTimeout(this._progressChecker),this._progressChecker=null),this._msectl.seek(e),this._transmuxer.seek(Math.floor(1e3*e)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=e))}else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},e.prototype._checkAndResumeStuckPlayback=function(e){var t=this._mediaElement;if(e||!this._receivedCanPlay||t.readyState<2){var r=t.buffered;r.length>0&&t.currentTime<r.start(0)&&(u.a.w(this.TAG,"Playback seems stuck at "+t.currentTime+", seek to "+r.start(0)),this._requestSetTime=!0,this._mediaElement.currentTime=r.start(0),this._mediaElement.removeEventListener("progress",this.e.onvProgress))}else this._mediaElement.removeEventListener("progress",this.e.onvProgress)},e.prototype._onvLoadedMetadata=function(e){null!=this._pendingSeekTime&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)},e.prototype._onvSeeking=function(e){var t=this._mediaElement.currentTime,r=this._mediaElement.buffered;if(this._requestSetTime)this._requestSetTime=!1;else{if(t<1&&r.length>0){var i=r.start(0);if(i<1&&t<i||h.a.safari)return this._requestSetTime=!0,void(this._mediaElement.currentTime=h.a.safari?.1:i)}if(this._isTimepointBuffered(t)){if(this._alwaysSeekKeyframe){var n=this._msectl.getNearestKeyframe(Math.floor(1e3*t));null!=n&&(this._requestSetTime=!0,this._mediaElement.currentTime=n.dts/1e3)}null!=this._progressChecker&&this._checkProgressAndResume()}else this._seekpointRecord={seekPoint:t,recordTime:this._now()},window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)}},e.prototype._onvCanPlay=function(e){this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)},e.prototype._onvStalled=function(e){this._checkAndResumeStuckPlayback(!0)},e.prototype._onvProgress=function(e){this._checkAndResumeStuckPlayback()},e}(),I=function(){function e(e,t){this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new d.a,this._config=a(),"object"==typeof t&&Object.assign(this._config,t);var r=e.type.toLowerCase();if("mse"===r||"mpegts"===r||"m2ts"===r||"flv"===r)throw new C.b("NativePlayer does't support mse/mpegts/m2ts/flv MediaDataSource input!");if(e.hasOwnProperty("segments"))throw new C.b("NativePlayer("+e.type+") doesn't support multipart playback!");this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=e,this._mediaElement=null}return e.prototype.destroy=function(){this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},e.prototype.on=function(e,t){var r=this;e===p.MEDIA_INFO?null!=this._mediaElement&&0!==this._mediaElement.readyState&&Promise.resolve().then((function(){r._emitter.emit(p.MEDIA_INFO,r.mediaInfo)})):e===p.STATISTICS_INFO&&null!=this._mediaElement&&0!==this._mediaElement.readyState&&Promise.resolve().then((function(){r._emitter.emit(p.STATISTICS_INFO,r.statisticsInfo)})),this._emitter.addListener(e,t)},e.prototype.off=function(e,t){this._emitter.removeListener(e,t)},e.prototype.attachMediaElement=function(e){if(this._mediaElement=e,e.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),null!=this._pendingSeekTime)try{e.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(e){}},e.prototype.detachMediaElement=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),null!=this._statisticsReporter&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},e.prototype.load=function(){if(!this._mediaElement)throw new C.a("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)},e.prototype.unload=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),null!=this._statisticsReporter&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},e.prototype.play=function(){return this._mediaElement.play()},e.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(e){this._mediaElement.volume=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(e){this._mediaElement.muted=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(e){this._mediaElement?this._mediaElement.currentTime=e:this._pendingSeekTime=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mediaInfo",{get:function(){var e={mimeType:(this._mediaElement instanceof HTMLAudioElement?"audio/":"video/")+this._mediaDataSource.type};return this._mediaElement&&(e.duration=Math.floor(1e3*this._mediaElement.duration),this._mediaElement instanceof HTMLVideoElement&&(e.width=this._mediaElement.videoWidth,e.height=this._mediaElement.videoHeight)),e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"statisticsInfo",{get:function(){var e={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return e;var t=!0,r=0,i=0;if(this._mediaElement.getVideoPlaybackQuality){var n=this._mediaElement.getVideoPlaybackQuality();r=n.totalVideoFrames,i=n.droppedVideoFrames}else null!=this._mediaElement.webkitDecodedFrameCount?(r=this._mediaElement.webkitDecodedFrameCount,i=this._mediaElement.webkitDroppedFrameCount):t=!1;return t&&(e.decodedFrames=r,e.droppedFrames=i),e},enumerable:!1,configurable:!0}),e.prototype._onvLoadedMetadata=function(e){null!=this._pendingSeekTime&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(p.MEDIA_INFO,this.mediaInfo)},e.prototype._reportStatisticsInfo=function(){this._emitter.emit(p.STATISTICS_INFO,this.statisticsInfo)},e}();i.a.install();var O={createPlayer:function(e,t){var r=e;if(null==r||"object"!=typeof r)throw new C.b("MediaDataSource must be an javascript object!");if(!r.hasOwnProperty("type"))throw new C.b("MediaDataSource must has type field to indicate video file type!");switch(r.type){case"mse":case"mpegts":case"m2ts":case"flv":return new k(r,t);default:return new I(r,t)}},isSupported:function(){return o.supportMSEH264Playback()},getFeatureList:function(){return o.getFeatureList()}};O.BaseLoader=c.a,O.LoaderStatus=c.c,O.LoaderErrors=c.b,O.Events=p,O.ErrorTypes=D,O.ErrorDetails=L,O.MSEPlayer=k,O.NativePlayer=I,O.LoggingControl=g.a,Object.defineProperty(O,"version",{enumerable:!0,get:function(){return"1.7.3"}}),t.default=O}])},5798:(e,t,r)=>{"use strict";var i=String.prototype.replace,n=/%20/g,s=r(2769),a={RFC1738:"RFC1738",RFC3986:"RFC3986"};e.exports=s.assign({default:a.RFC3986,formatters:{RFC1738:function(e){return i.call(e,n,"+")},RFC3986:function(e){return String(e)}}},a)},129:(e,t,r)=>{"use strict";var i=r(8261),n=r(5235),s=r(5798);e.exports={formats:s,parse:n,stringify:i}},5235:(e,t,r)=>{"use strict";var i=r(2769),n=Object.prototype.hasOwnProperty,s=Array.isArray,a={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:i.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},o=function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))},c=function(e,t){return e&&"string"==typeof e&&t.comma&&e.indexOf(",")>-1?e.split(","):e},l=function(e,t,r,i){if(e){var s=r.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,a=/(\[[^[\]]*])/g,o=r.depth>0&&/(\[[^[\]]*])/.exec(s),l=o?s.slice(0,o.index):s,d=[];if(l){if(!r.plainObjects&&n.call(Object.prototype,l)&&!r.allowPrototypes)return;d.push(l)}for(var u=0;r.depth>0&&null!==(o=a.exec(s))&&u<r.depth;){if(u+=1,!r.plainObjects&&n.call(Object.prototype,o[1].slice(1,-1))&&!r.allowPrototypes)return;d.push(o[1])}return o&&d.push("["+s.slice(o.index)+"]"),function(e,t,r,i){for(var n=i?t:c(t,r),s=e.length-1;s>=0;--s){var a,o=e[s];if("[]"===o&&r.parseArrays)a=[].concat(n);else{a=r.plainObjects?Object.create(null):{};var l="["===o.charAt(0)&&"]"===o.charAt(o.length-1)?o.slice(1,-1):o,d=parseInt(l,10);r.parseArrays||""!==l?!isNaN(d)&&o!==l&&String(d)===l&&d>=0&&r.parseArrays&&d<=r.arrayLimit?(a=[])[d]=n:a[l]=n:a={0:n}}n=a}return n}(d,t,r,i)}};e.exports=function(e,t){var r=function(e){if(!e)return a;if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=void 0===e.charset?a.charset:e.charset;return{allowDots:void 0===e.allowDots?a.allowDots:!!e.allowDots,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:a.allowPrototypes,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:a.arrayLimit,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:a.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:a.comma,decoder:"function"==typeof e.decoder?e.decoder:a.decoder,delimiter:"string"==typeof e.delimiter||i.isRegExp(e.delimiter)?e.delimiter:a.delimiter,depth:"number"==typeof e.depth||!1===e.depth?+e.depth:a.depth,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:a.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:a.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:a.plainObjects,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:a.strictNullHandling}}(t);if(""===e||null==e)return r.plainObjects?Object.create(null):{};for(var d="string"==typeof e?function(e,t){var r,l={},d=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,u=t.parameterLimit===1/0?void 0:t.parameterLimit,h=d.split(t.delimiter,u),p=-1,f=t.charset;if(t.charsetSentinel)for(r=0;r<h.length;++r)0===h[r].indexOf("utf8=")&&("utf8=%E2%9C%93"===h[r]?f="utf-8":"utf8=%26%2310003%3B"===h[r]&&(f="iso-8859-1"),p=r,r=h.length);for(r=0;r<h.length;++r)if(r!==p){var m,g,v=h[r],_=v.indexOf("]="),y=-1===_?v.indexOf("="):_+1;-1===y?(m=t.decoder(v,a.decoder,f,"key"),g=t.strictNullHandling?null:""):(m=t.decoder(v.slice(0,y),a.decoder,f,"key"),g=i.maybeMap(c(v.slice(y+1),t),(function(e){return t.decoder(e,a.decoder,f,"value")}))),g&&t.interpretNumericEntities&&"iso-8859-1"===f&&(g=o(g)),v.indexOf("[]=")>-1&&(g=s(g)?[g]:g),n.call(l,m)?l[m]=i.combine(l[m],g):l[m]=g}return l}(e,r):e,u=r.plainObjects?Object.create(null):{},h=Object.keys(d),p=0;p<h.length;++p){var f=h[p],m=l(f,d[f],r,"string"==typeof e);u=i.merge(u,m,r)}return i.compact(u)}},8261:(e,t,r)=>{"use strict";var i=r(2769),n=r(5798),s=Object.prototype.hasOwnProperty,a={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},o=Array.isArray,c=Array.prototype.push,l=function(e,t){c.apply(e,o(t)?t:[t])},d=Date.prototype.toISOString,u=n.default,h={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:i.encode,encodeValuesOnly:!1,format:u,formatter:n.formatters[u],indices:!1,serializeDate:function(e){return d.call(e)},skipNulls:!1,strictNullHandling:!1},p=function e(t,r,n,s,a,c,d,u,p,f,m,g,v){var _,y=t;if("function"==typeof d?y=d(r,y):y instanceof Date?y=f(y):"comma"===n&&o(y)&&(y=i.maybeMap(y,(function(e){return e instanceof Date?f(e):e})).join(",")),null===y){if(s)return c&&!g?c(r,h.encoder,v,"key"):r;y=""}if("string"==typeof(_=y)||"number"==typeof _||"boolean"==typeof _||"symbol"==typeof _||"bigint"==typeof _||i.isBuffer(y))return c?[m(g?r:c(r,h.encoder,v,"key"))+"="+m(c(y,h.encoder,v,"value"))]:[m(r)+"="+m(String(y))];var b,E=[];if(void 0===y)return E;if(o(d))b=d;else{var S=Object.keys(y);b=u?S.sort(u):S}for(var w=0;w<b.length;++w){var T=b[w],R=y[T];if(!a||null!==R){var C=o(y)?"function"==typeof n?n(r,T):r:r+(p?"."+T:"["+T+"]");l(E,e(R,C,n,s,a,c,d,u,p,f,m,g,v))}}return E};e.exports=function(e,t){var r,i=e,c=function(e){if(!e)return h;if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||h.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=n.default;if(void 0!==e.format){if(!s.call(n.formatters,e.format))throw new TypeError("Unknown format option provided.");r=e.format}var i=n.formatters[r],a=h.filter;return("function"==typeof e.filter||o(e.filter))&&(a=e.filter),{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:h.addQueryPrefix,allowDots:void 0===e.allowDots?h.allowDots:!!e.allowDots,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:h.charsetSentinel,delimiter:void 0===e.delimiter?h.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:h.encode,encoder:"function"==typeof e.encoder?e.encoder:h.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:h.encodeValuesOnly,filter:a,formatter:i,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:h.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:h.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:h.strictNullHandling}}(t);"function"==typeof c.filter?i=(0,c.filter)("",i):o(c.filter)&&(r=c.filter);var d,u=[];if("object"!=typeof i||null===i)return"";d=t&&t.arrayFormat in a?t.arrayFormat:t&&"indices"in t?t.indices?"indices":"repeat":"indices";var f=a[d];r||(r=Object.keys(i)),c.sort&&r.sort(c.sort);for(var m=0;m<r.length;++m){var g=r[m];c.skipNulls&&null===i[g]||l(u,p(i[g],g,f,c.strictNullHandling,c.skipNulls,c.encode?c.encoder:null,c.filter,c.sort,c.allowDots,c.serializeDate,c.formatter,c.encodeValuesOnly,c.charset))}var v=u.join(c.delimiter),_=!0===c.addQueryPrefix?"?":"";return c.charsetSentinel&&("iso-8859-1"===c.charset?_+="utf8=%26%2310003%3B&":_+="utf8=%E2%9C%93&"),v.length>0?_+v:""}},2769:e=>{"use strict";var t=Object.prototype.hasOwnProperty,r=Array.isArray,i=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),n=function(e,t){for(var r=t&&t.plainObjects?Object.create(null):{},i=0;i<e.length;++i)void 0!==e[i]&&(r[i]=e[i]);return r};e.exports={arrayToObject:n,assign:function(e,t){return Object.keys(t).reduce((function(e,r){return e[r]=t[r],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],i=[],n=0;n<t.length;++n)for(var s=t[n],a=s.obj[s.prop],o=Object.keys(a),c=0;c<o.length;++c){var l=o[c],d=a[l];"object"==typeof d&&null!==d&&-1===i.indexOf(d)&&(t.push({obj:a,prop:l}),i.push(d))}return function(e){for(;e.length>1;){var t=e.pop(),i=t.obj[t.prop];if(r(i)){for(var n=[],s=0;s<i.length;++s)void 0!==i[s]&&n.push(i[s]);t.obj[t.prop]=n}}}(t),e},decode:function(e,t,r){var i=e.replace(/\+/g," ");if("iso-8859-1"===r)return i.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(i)}catch(e){return i}},encode:function(e,t,r){if(0===e.length)return e;var n=e;if("symbol"==typeof e?n=Symbol.prototype.toString.call(e):"string"!=typeof e&&(n=String(e)),"iso-8859-1"===r)return escape(n).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var s="",a=0;a<n.length;++a){var o=n.charCodeAt(a);45===o||46===o||95===o||126===o||o>=48&&o<=57||o>=65&&o<=90||o>=97&&o<=122?s+=n.charAt(a):o<128?s+=i[o]:o<2048?s+=i[192|o>>6]+i[128|63&o]:o<55296||o>=57344?s+=i[224|o>>12]+i[128|o>>6&63]+i[128|63&o]:(a+=1,o=65536+((1023&o)<<10|1023&n.charCodeAt(a)),s+=i[240|o>>18]+i[128|o>>12&63]+i[128|o>>6&63]+i[128|63&o])}return s},isBuffer:function(e){return!(!e||"object"!=typeof e||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},maybeMap:function(e,t){if(r(e)){for(var i=[],n=0;n<e.length;n+=1)i.push(t(e[n]));return i}return t(e)},merge:function e(i,s,a){if(!s)return i;if("object"!=typeof s){if(r(i))i.push(s);else{if(!i||"object"!=typeof i)return[i,s];(a&&(a.plainObjects||a.allowPrototypes)||!t.call(Object.prototype,s))&&(i[s]=!0)}return i}if(!i||"object"!=typeof i)return[i].concat(s);var o=i;return r(i)&&!r(s)&&(o=n(i,a)),r(i)&&r(s)?(s.forEach((function(r,n){if(t.call(i,n)){var s=i[n];s&&"object"==typeof s&&r&&"object"==typeof r?i[n]=e(s,r,a):i.push(r)}else i[n]=r})),i):Object.keys(s).reduce((function(r,i){var n=s[i];return t.call(r,i)?r[i]=e(r[i],n,a):r[i]=n,r}),o)}}},4375:(e,t,r)=>{let i;e.exports="function"==typeof queueMicrotask?queueMicrotask.bind("undefined"!=typeof window?window:r.g):e=>(i||(i=Promise.resolve())).then(e).catch((e=>setTimeout((()=>{throw e}),0)))},6692:e=>{var t=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),(t+=null!=e["network-id"]?" network-id %d":"%v")+(null!=e["network-cost"]?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",(t+=null!=e.rateNumerator?" rate=%s":"")+(null!=e.rateDenominator?"/%s":"")}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(t).forEach((function(e){t[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}))},766:(e,t,r)=>{var i=r(962),n=r(5776);t.write=n,t.parse=i.parse,t.parseParams=i.parseParams,t.parseFmtpConfig=i.parseFmtpConfig,t.parsePayloads=i.parsePayloads,t.parseRemoteCandidates=i.parseRemoteCandidates,t.parseImageAttributes=i.parseImageAttributes,t.parseSimulcastStreamList=i.parseSimulcastStreamList},962:(e,t,r)=>{var i=function(e){return String(Number(e))===e?Number(e):e},n=function(e,t,r){var n=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:n&&!t[e.name]&&(t[e.name]={});var s=e.push?{}:n?t[e.name]:t;!function(e,t,r,n){if(n&&!r)t[n]=i(e[1]);else for(var s=0;s<r.length;s+=1)null!=e[s+1]&&(t[r[s]]=i(e[s+1]))}(r.match(e.reg),s,e.names,e.name),e.push&&t[e.push].push(s)},s=r(6692),a=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},r=[],i=t;return e.split(/(\r\n|\r|\n)/).filter(a).forEach((function(e){var t=e[0],a=e.slice(2);"m"===t&&(r.push({rtp:[],fmtp:[]}),i=r[r.length-1]);for(var o=0;o<(s[t]||[]).length;o+=1){var c=s[t][o];if(c.reg.test(a))return n(c,i,a)}})),t.media=r,t};var o=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=i(r[1]):1===r.length&&t.length>1&&(e[r[0]]=void 0),e};t.parseParams=function(e){return e.split(/;\s?/).reduce(o,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(i),n=0;n<r.length;n+=3)t.push({component:r[n],ip:r[n+1],port:r[n+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(o,{})}))},t.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var t,r=!1;return"~"!==e[0]?t=i(e):(t=i(e.substring(1,e.length)),r=!0),{scid:t,paused:r}}))}))}},5776:(e,t,r)=>{var i=r(6692),n=/%[sdv%]/g,s=function(e){var t=1,r=arguments,i=r.length;return e.replace(n,(function(e){if(t>=i)return e;var n=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(n);case"%d":return Number(n);case"%v":return""}}))},a=function(e,t,r){var i=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var n=0;n<t.names.length;n+=1){var a=t.names[n];t.name?i.push(r[t.name][a]):i.push(r[t.names[n]])}else i.push(r[t.name]);return s.apply(null,i)},o=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var r=t.outerOrder||o,n=t.innerOrder||c,s=[];return r.forEach((function(t){i[t].forEach((function(r){r.name in e&&null!=e[r.name]?s.push(a(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){s.push(a(t,r,e))}))}))})),e.media.forEach((function(e){s.push(a("m",i.m[0],e)),n.forEach((function(t){i[t].forEach((function(r){r.name in e&&null!=e[r.name]?s.push(a(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){s.push(a(t,r,e))}))}))}))})),s.join("\r\n")+"\r\n"}},8213:(e,t,r)=>{var i=r(2728),n=Object.prototype.hasOwnProperty;function s(){this._array=[],this._set=Object.create(null)}s.fromArray=function(e,t){for(var r=new s,i=0,n=e.length;i<n;i++)r.add(e[i],t);return r},s.prototype.size=function(){return Object.getOwnPropertyNames(this._set).length},s.prototype.add=function(e,t){var r=i.toSetString(e),s=n.call(this._set,r),a=this._array.length;s&&!t||this._array.push(e),s||(this._set[r]=a)},s.prototype.has=function(e){var t=i.toSetString(e);return n.call(this._set,t)},s.prototype.indexOf=function(e){var t=i.toSetString(e);if(n.call(this._set,t))return this._set[t];throw new Error('"'+e+'" is not in the set.')},s.prototype.at=function(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)},s.prototype.toArray=function(){return this._array.slice()},t.I=s},6400:(e,t,r)=>{var i=r(7923);t.encode=function(e){var t,r="",n=function(e){return e<0?1+(-e<<1):0+(e<<1)}(e);do{t=31&n,(n>>>=5)>0&&(t|=32),r+=i.encode(t)}while(n>0);return r},t.decode=function(e,t,r){var n,s,a,o,c=e.length,l=0,d=0;do{if(t>=c)throw new Error("Expected more digits in base 64 VLQ value.");if(-1===(s=i.decode(e.charCodeAt(t++))))throw new Error("Invalid base64 digit: "+e.charAt(t-1));n=!!(32&s),l+=(s&=31)<<d,d+=5}while(n);r.value=(o=(a=l)>>1,1==(1&a)?-o:o),r.rest=t}},7923:(e,t)=>{var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");t.encode=function(e){if(0<=e&&e<r.length)return r[e];throw new TypeError("Must be between 0 and 63: "+e)},t.decode=function(e){return 65<=e&&e<=90?e-65:97<=e&&e<=122?e-97+26:48<=e&&e<=57?e-48+52:43==e?62:47==e?63:-1}},9216:(e,t)=>{function r(e,i,n,s,a,o){var c=Math.floor((i-e)/2)+e,l=a(n,s[c],!0);return 0===l?c:l>0?i-c>1?r(c,i,n,s,a,o):o==t.LEAST_UPPER_BOUND?i<s.length?i:-1:c:c-e>1?r(e,c,n,s,a,o):o==t.LEAST_UPPER_BOUND?c:e<0?-1:e}t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2,t.search=function(e,i,n,s){if(0===i.length)return-1;var a=r(-1,i.length,e,i,n,s||t.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&0===n(i[a],i[a-1],!0);)--a;return a}},1188:(e,t,r)=>{var i=r(2728);function n(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}n.prototype.unsortedForEach=function(e,t){this._array.forEach(e,t)},n.prototype.add=function(e){var t,r,n,s,a,o;r=e,n=(t=this._last).generatedLine,s=r.generatedLine,a=t.generatedColumn,o=r.generatedColumn,s>n||s==n&&o>=a||i.compareByGeneratedPositionsInflated(t,r)<=0?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))},n.prototype.toArray=function(){return this._sorted||(this._array.sort(i.compareByGeneratedPositionsInflated),this._sorted=!0),this._array},t.H=n},2826:(e,t)=>{function r(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}function i(e,t,n,s){if(n<s){var a=n-1;r(e,(d=n,u=s,Math.round(d+Math.random()*(u-d))),s);for(var o=e[s],c=n;c<s;c++)t(e[c],o)<=0&&r(e,a+=1,c);r(e,a+1,c);var l=a+1;i(e,t,n,l-1),i(e,t,l+1,s)}var d,u}t.U=function(e,t){i(e,t,0,e.length-1)}},6771:(e,t,r)=>{var i=r(2728),n=r(9216),s=r(8213).I,a=r(6400),o=r(2826).U;function c(e){var t=e;return"string"==typeof e&&(t=JSON.parse(e.replace(/^\)\]\}'/,""))),null!=t.sections?new u(t):new l(t)}function l(e){var t=e;"string"==typeof e&&(t=JSON.parse(e.replace(/^\)\]\}'/,"")));var r=i.getArg(t,"version"),n=i.getArg(t,"sources"),a=i.getArg(t,"names",[]),o=i.getArg(t,"sourceRoot",null),c=i.getArg(t,"sourcesContent",null),l=i.getArg(t,"mappings"),d=i.getArg(t,"file",null);if(r!=this._version)throw new Error("Unsupported version: "+r);n=n.map(String).map(i.normalize).map((function(e){return o&&i.isAbsolute(o)&&i.isAbsolute(e)?i.relative(o,e):e})),this._names=s.fromArray(a.map(String),!0),this._sources=s.fromArray(n,!0),this.sourceRoot=o,this.sourcesContent=c,this._mappings=l,this.file=d}function d(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}function u(e){var t=e;"string"==typeof e&&(t=JSON.parse(e.replace(/^\)\]\}'/,"")));var r=i.getArg(t,"version"),n=i.getArg(t,"sections");if(r!=this._version)throw new Error("Unsupported version: "+r);this._sources=new s,this._names=new s;var a={line:-1,column:0};this._sections=n.map((function(e){if(e.url)throw new Error("Support for url field in sections not implemented.");var t=i.getArg(e,"offset"),r=i.getArg(t,"line"),n=i.getArg(t,"column");if(r<a.line||r===a.line&&n<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=t,{generatedOffset:{generatedLine:r+1,generatedColumn:n+1},consumer:new c(i.getArg(e,"map"))}}))}c.fromSourceMap=function(e){return l.fromSourceMap(e)},c.prototype._version=3,c.prototype.__generatedMappings=null,Object.defineProperty(c.prototype,"_generatedMappings",{get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),c.prototype.__originalMappings=null,Object.defineProperty(c.prototype,"_originalMappings",{get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),c.prototype._charIsMappingSeparator=function(e,t){var r=e.charAt(t);return";"===r||","===r},c.prototype._parseMappings=function(e,t){throw new Error("Subclasses must implement _parseMappings")},c.GENERATED_ORDER=1,c.ORIGINAL_ORDER=2,c.GREATEST_LOWER_BOUND=1,c.LEAST_UPPER_BOUND=2,c.prototype.eachMapping=function(e,t,r){var n,s=t||null;switch(r||c.GENERATED_ORDER){case c.GENERATED_ORDER:n=this._generatedMappings;break;case c.ORIGINAL_ORDER:n=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var a=this.sourceRoot;n.map((function(e){var t=null===e.source?null:this._sources.at(e.source);return null!=t&&null!=a&&(t=i.join(a,t)),{source:t,generatedLine:e.generatedLine,generatedColumn:e.generatedColumn,originalLine:e.originalLine,originalColumn:e.originalColumn,name:null===e.name?null:this._names.at(e.name)}}),this).forEach(e,s)},c.prototype.allGeneratedPositionsFor=function(e){var t=i.getArg(e,"line"),r={source:i.getArg(e,"source"),originalLine:t,originalColumn:i.getArg(e,"column",0)};if(null!=this.sourceRoot&&(r.source=i.relative(this.sourceRoot,r.source)),!this._sources.has(r.source))return[];r.source=this._sources.indexOf(r.source);var s=[],a=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",i.compareByOriginalPositions,n.LEAST_UPPER_BOUND);if(a>=0){var o=this._originalMappings[a];if(void 0===e.column)for(var c=o.originalLine;o&&o.originalLine===c;)s.push({line:i.getArg(o,"generatedLine",null),column:i.getArg(o,"generatedColumn",null),lastColumn:i.getArg(o,"lastGeneratedColumn",null)}),o=this._originalMappings[++a];else for(var l=o.originalColumn;o&&o.originalLine===t&&o.originalColumn==l;)s.push({line:i.getArg(o,"generatedLine",null),column:i.getArg(o,"generatedColumn",null),lastColumn:i.getArg(o,"lastGeneratedColumn",null)}),o=this._originalMappings[++a]}return s},t.SourceMapConsumer=c,l.prototype=Object.create(c.prototype),l.prototype.consumer=c,l.fromSourceMap=function(e){var t=Object.create(l.prototype),r=t._names=s.fromArray(e._names.toArray(),!0),n=t._sources=s.fromArray(e._sources.toArray(),!0);t.sourceRoot=e._sourceRoot,t.sourcesContent=e._generateSourcesContent(t._sources.toArray(),t.sourceRoot),t.file=e._file;for(var a=e._mappings.toArray().slice(),c=t.__generatedMappings=[],u=t.__originalMappings=[],h=0,p=a.length;h<p;h++){var f=a[h],m=new d;m.generatedLine=f.generatedLine,m.generatedColumn=f.generatedColumn,f.source&&(m.source=n.indexOf(f.source),m.originalLine=f.originalLine,m.originalColumn=f.originalColumn,f.name&&(m.name=r.indexOf(f.name)),u.push(m)),c.push(m)}return o(t.__originalMappings,i.compareByOriginalPositions),t},l.prototype._version=3,Object.defineProperty(l.prototype,"sources",{get:function(){return this._sources.toArray().map((function(e){return null!=this.sourceRoot?i.join(this.sourceRoot,e):e}),this)}}),l.prototype._parseMappings=function(e,t){for(var r,n,s,c,l,u=1,h=0,p=0,f=0,m=0,g=0,v=e.length,_=0,y={},b={},E=[],S=[];_<v;)if(";"===e.charAt(_))u++,_++,h=0;else if(","===e.charAt(_))_++;else{for((r=new d).generatedLine=u,c=_;c<v&&!this._charIsMappingSeparator(e,c);c++);if(s=y[n=e.slice(_,c)])_+=n.length;else{for(s=[];_<c;)a.decode(e,_,b),l=b.value,_=b.rest,s.push(l);if(2===s.length)throw new Error("Found a source, but no line and column");if(3===s.length)throw new Error("Found a source and line, but no column");y[n]=s}r.generatedColumn=h+s[0],h=r.generatedColumn,s.length>1&&(r.source=m+s[1],m+=s[1],r.originalLine=p+s[2],p=r.originalLine,r.originalLine+=1,r.originalColumn=f+s[3],f=r.originalColumn,s.length>4&&(r.name=g+s[4],g+=s[4])),S.push(r),"number"==typeof r.originalLine&&E.push(r)}o(S,i.compareByGeneratedPositionsDeflated),this.__generatedMappings=S,o(E,i.compareByOriginalPositions),this.__originalMappings=E},l.prototype._findMapping=function(e,t,r,i,s,a){if(e[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[r]);if(e[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[i]);return n.search(e,t,s,a)},l.prototype.computeColumnSpans=function(){for(var e=0;e<this._generatedMappings.length;++e){var t=this._generatedMappings[e];if(e+1<this._generatedMappings.length){var r=this._generatedMappings[e+1];if(t.generatedLine===r.generatedLine){t.lastGeneratedColumn=r.generatedColumn-1;continue}}t.lastGeneratedColumn=1/0}},l.prototype.originalPositionFor=function(e){var t={generatedLine:i.getArg(e,"line"),generatedColumn:i.getArg(e,"column")},r=this._findMapping(t,this._generatedMappings,"generatedLine","generatedColumn",i.compareByGeneratedPositionsDeflated,i.getArg(e,"bias",c.GREATEST_LOWER_BOUND));if(r>=0){var n=this._generatedMappings[r];if(n.generatedLine===t.generatedLine){var s=i.getArg(n,"source",null);null!==s&&(s=this._sources.at(s),null!=this.sourceRoot&&(s=i.join(this.sourceRoot,s)));var a=i.getArg(n,"name",null);return null!==a&&(a=this._names.at(a)),{source:s,line:i.getArg(n,"originalLine",null),column:i.getArg(n,"originalColumn",null),name:a}}}return{source:null,line:null,column:null,name:null}},l.prototype.hasContentsOfAllSources=function(){return!!this.sourcesContent&&this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some((function(e){return null==e}))},l.prototype.sourceContentFor=function(e,t){if(!this.sourcesContent)return null;if(null!=this.sourceRoot&&(e=i.relative(this.sourceRoot,e)),this._sources.has(e))return this.sourcesContent[this._sources.indexOf(e)];var r;if(null!=this.sourceRoot&&(r=i.urlParse(this.sourceRoot))){var n=e.replace(/^file:\/\//,"");if("file"==r.scheme&&this._sources.has(n))return this.sourcesContent[this._sources.indexOf(n)];if((!r.path||"/"==r.path)&&this._sources.has("/"+e))return this.sourcesContent[this._sources.indexOf("/"+e)]}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')},l.prototype.generatedPositionFor=function(e){var t=i.getArg(e,"source");if(null!=this.sourceRoot&&(t=i.relative(this.sourceRoot,t)),!this._sources.has(t))return{line:null,column:null,lastColumn:null};var r={source:t=this._sources.indexOf(t),originalLine:i.getArg(e,"line"),originalColumn:i.getArg(e,"column")},n=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",i.compareByOriginalPositions,i.getArg(e,"bias",c.GREATEST_LOWER_BOUND));if(n>=0){var s=this._originalMappings[n];if(s.source===r.source)return{line:i.getArg(s,"generatedLine",null),column:i.getArg(s,"generatedColumn",null),lastColumn:i.getArg(s,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},u.prototype=Object.create(c.prototype),u.prototype.constructor=c,u.prototype._version=3,Object.defineProperty(u.prototype,"sources",{get:function(){for(var e=[],t=0;t<this._sections.length;t++)for(var r=0;r<this._sections[t].consumer.sources.length;r++)e.push(this._sections[t].consumer.sources[r]);return e}}),u.prototype.originalPositionFor=function(e){var t={generatedLine:i.getArg(e,"line"),generatedColumn:i.getArg(e,"column")},r=n.search(t,this._sections,(function(e,t){return e.generatedLine-t.generatedOffset.generatedLine||e.generatedColumn-t.generatedOffset.generatedColumn})),s=this._sections[r];return s?s.consumer.originalPositionFor({line:t.generatedLine-(s.generatedOffset.generatedLine-1),column:t.generatedColumn-(s.generatedOffset.generatedLine===t.generatedLine?s.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}},u.prototype.hasContentsOfAllSources=function(){return this._sections.every((function(e){return e.consumer.hasContentsOfAllSources()}))},u.prototype.sourceContentFor=function(e,t){for(var r=0;r<this._sections.length;r++){var i=this._sections[r].consumer.sourceContentFor(e,!0);if(i)return i}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')},u.prototype.generatedPositionFor=function(e){for(var t=0;t<this._sections.length;t++){var r=this._sections[t];if(-1!==r.consumer.sources.indexOf(i.getArg(e,"source"))){var n=r.consumer.generatedPositionFor(e);if(n)return{line:n.line+(r.generatedOffset.generatedLine-1),column:n.column+(r.generatedOffset.generatedLine===n.line?r.generatedOffset.generatedColumn-1:0)}}}return{line:null,column:null}},u.prototype._parseMappings=function(e,t){this.__generatedMappings=[],this.__originalMappings=[];for(var r=0;r<this._sections.length;r++)for(var n=this._sections[r],s=n.consumer._generatedMappings,a=0;a<s.length;a++){var c=s[a],l=n.consumer._sources.at(c.source);null!==n.consumer.sourceRoot&&(l=i.join(n.consumer.sourceRoot,l)),this._sources.add(l),l=this._sources.indexOf(l);var d=n.consumer._names.at(c.name);this._names.add(d),d=this._names.indexOf(d);var u={source:l,generatedLine:c.generatedLine+(n.generatedOffset.generatedLine-1),generatedColumn:c.generatedColumn+(n.generatedOffset.generatedLine===c.generatedLine?n.generatedOffset.generatedColumn-1:0),originalLine:c.originalLine,originalColumn:c.originalColumn,name:d};this.__generatedMappings.push(u),"number"==typeof u.originalLine&&this.__originalMappings.push(u)}o(this.__generatedMappings,i.compareByGeneratedPositionsDeflated),o(this.__originalMappings,i.compareByOriginalPositions)}},4433:(e,t,r)=>{var i=r(6400),n=r(2728),s=r(8213).I,a=r(1188).H;function o(e){e||(e={}),this._file=n.getArg(e,"file",null),this._sourceRoot=n.getArg(e,"sourceRoot",null),this._skipValidation=n.getArg(e,"skipValidation",!1),this._sources=new s,this._names=new s,this._mappings=new a,this._sourcesContents=null}o.prototype._version=3,o.fromSourceMap=function(e){var t=e.sourceRoot,r=new o({file:e.file,sourceRoot:t});return e.eachMapping((function(e){var i={generated:{line:e.generatedLine,column:e.generatedColumn}};null!=e.source&&(i.source=e.source,null!=t&&(i.source=n.relative(t,i.source)),i.original={line:e.originalLine,column:e.originalColumn},null!=e.name&&(i.name=e.name)),r.addMapping(i)})),e.sources.forEach((function(t){var i=e.sourceContentFor(t);null!=i&&r.setSourceContent(t,i)})),r},o.prototype.addMapping=function(e){var t=n.getArg(e,"generated"),r=n.getArg(e,"original",null),i=n.getArg(e,"source",null),s=n.getArg(e,"name",null);this._skipValidation||this._validateMapping(t,r,i,s),null!=i&&(i=String(i),this._sources.has(i)||this._sources.add(i)),null!=s&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:t.line,generatedColumn:t.column,originalLine:null!=r&&r.line,originalColumn:null!=r&&r.column,source:i,name:s})},o.prototype.setSourceContent=function(e,t){var r=e;null!=this._sourceRoot&&(r=n.relative(this._sourceRoot,r)),null!=t?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[n.toSetString(r)]=t):this._sourcesContents&&(delete this._sourcesContents[n.toSetString(r)],0===Object.keys(this._sourcesContents).length&&(this._sourcesContents=null))},o.prototype.applySourceMap=function(e,t,r){var i=t;if(null==t){if(null==e.file)throw new Error('SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map\'s "file" property. Both were omitted.');i=e.file}var a=this._sourceRoot;null!=a&&(i=n.relative(a,i));var o=new s,c=new s;this._mappings.unsortedForEach((function(t){if(t.source===i&&null!=t.originalLine){var s=e.originalPositionFor({line:t.originalLine,column:t.originalColumn});null!=s.source&&(t.source=s.source,null!=r&&(t.source=n.join(r,t.source)),null!=a&&(t.source=n.relative(a,t.source)),t.originalLine=s.line,t.originalColumn=s.column,null!=s.name&&(t.name=s.name))}var l=t.source;null==l||o.has(l)||o.add(l);var d=t.name;null==d||c.has(d)||c.add(d)}),this),this._sources=o,this._names=c,e.sources.forEach((function(t){var i=e.sourceContentFor(t);null!=i&&(null!=r&&(t=n.join(r,t)),null!=a&&(t=n.relative(a,t)),this.setSourceContent(t,i))}),this)},o.prototype._validateMapping=function(e,t,r,i){if((!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0)||t||r||i)&&!(e&&"line"in e&&"column"in e&&t&&"line"in t&&"column"in t&&e.line>0&&e.column>=0&&t.line>0&&t.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:r,original:t,name:i}))},o.prototype._serializeMappings=function(){for(var e,t,r,s,a=0,o=1,c=0,l=0,d=0,u=0,h="",p=this._mappings.toArray(),f=0,m=p.length;f<m;f++){if(e="",(t=p[f]).generatedLine!==o)for(a=0;t.generatedLine!==o;)e+=";",o++;else if(f>0){if(!n.compareByGeneratedPositionsInflated(t,p[f-1]))continue;e+=","}e+=i.encode(t.generatedColumn-a),a=t.generatedColumn,null!=t.source&&(s=this._sources.indexOf(t.source),e+=i.encode(s-u),u=s,e+=i.encode(t.originalLine-1-l),l=t.originalLine-1,e+=i.encode(t.originalColumn-c),c=t.originalColumn,null!=t.name&&(r=this._names.indexOf(t.name),e+=i.encode(r-d),d=r)),h+=e}return h},o.prototype._generateSourcesContent=function(e,t){return e.map((function(e){if(!this._sourcesContents)return null;null!=t&&(e=n.relative(t,e));var r=n.toSetString(e);return Object.prototype.hasOwnProperty.call(this._sourcesContents,r)?this._sourcesContents[r]:null}),this)},o.prototype.toJSON=function(){var e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return null!=this._file&&(e.file=this._file),null!=this._sourceRoot&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e},o.prototype.toString=function(){return JSON.stringify(this.toJSON())},t.SourceMapGenerator=o},7085:(e,t,r)=>{var i=r(4433).SourceMapGenerator,n=r(2728),s=/(\r?\n)/,a="$$$isSourceNode$$$";function o(e,t,r,i,n){this.children=[],this.sourceContents={},this.line=null==e?null:e,this.column=null==t?null:t,this.source=null==r?null:r,this.name=null==n?null:n,this[a]=!0,null!=i&&this.add(i)}o.fromStringWithSourceMap=function(e,t,r){var i=new o,a=e.split(s),c=function(){return a.shift()+(a.shift()||"")},l=1,d=0,u=null;return t.eachMapping((function(e){if(null!==u){if(!(l<e.generatedLine)){var t=(r=a[0]).substr(0,e.generatedColumn-d);return a[0]=r.substr(e.generatedColumn-d),d=e.generatedColumn,h(u,t),void(u=e)}h(u,c()),l++,d=0}for(;l<e.generatedLine;)i.add(c()),l++;if(d<e.generatedColumn){var r=a[0];i.add(r.substr(0,e.generatedColumn)),a[0]=r.substr(e.generatedColumn),d=e.generatedColumn}u=e}),this),a.length>0&&(u&&h(u,c()),i.add(a.join(""))),t.sources.forEach((function(e){var s=t.sourceContentFor(e);null!=s&&(null!=r&&(e=n.join(r,e)),i.setSourceContent(e,s))})),i;function h(e,t){if(null===e||void 0===e.source)i.add(t);else{var s=r?n.join(r,e.source):e.source;i.add(new o(e.originalLine,e.originalColumn,s,t,e.name))}}},o.prototype.add=function(e){if(Array.isArray(e))e.forEach((function(e){this.add(e)}),this);else{if(!e[a]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);e&&this.children.push(e)}return this},o.prototype.prepend=function(e){if(Array.isArray(e))for(var t=e.length-1;t>=0;t--)this.prepend(e[t]);else{if(!e[a]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);this.children.unshift(e)}return this},o.prototype.walk=function(e){for(var t,r=0,i=this.children.length;r<i;r++)(t=this.children[r])[a]?t.walk(e):""!==t&&e(t,{source:this.source,line:this.line,column:this.column,name:this.name})},o.prototype.join=function(e){var t,r,i=this.children.length;if(i>0){for(t=[],r=0;r<i-1;r++)t.push(this.children[r]),t.push(e);t.push(this.children[r]),this.children=t}return this},o.prototype.replaceRight=function(e,t){var r=this.children[this.children.length-1];return r[a]?r.replaceRight(e,t):"string"==typeof r?this.children[this.children.length-1]=r.replace(e,t):this.children.push("".replace(e,t)),this},o.prototype.setSourceContent=function(e,t){this.sourceContents[n.toSetString(e)]=t},o.prototype.walkSourceContents=function(e){for(var t=0,r=this.children.length;t<r;t++)this.children[t][a]&&this.children[t].walkSourceContents(e);var i=Object.keys(this.sourceContents);for(t=0,r=i.length;t<r;t++)e(n.fromSetString(i[t]),this.sourceContents[i[t]])},o.prototype.toString=function(){var e="";return this.walk((function(t){e+=t})),e},o.prototype.toStringWithSourceMap=function(e){var t={code:"",line:1,column:0},r=new i(e),n=!1,s=null,a=null,o=null,c=null;return this.walk((function(e,i){t.code+=e,null!==i.source&&null!==i.line&&null!==i.column?(s===i.source&&a===i.line&&o===i.column&&c===i.name||r.addMapping({source:i.source,original:{line:i.line,column:i.column},generated:{line:t.line,column:t.column},name:i.name}),s=i.source,a=i.line,o=i.column,c=i.name,n=!0):n&&(r.addMapping({generated:{line:t.line,column:t.column}}),s=null,n=!1);for(var l=0,d=e.length;l<d;l++)10===e.charCodeAt(l)?(t.line++,t.column=0,l+1===d?(s=null,n=!1):n&&r.addMapping({source:i.source,original:{line:i.line,column:i.column},generated:{line:t.line,column:t.column},name:i.name})):t.column++})),this.walkSourceContents((function(e,t){r.setSourceContent(e,t)})),{code:t.code,map:r}},t.SourceNode=o},2728:(e,t)=>{t.getArg=function(e,t,r){if(t in e)return e[t];if(3===arguments.length)return r;throw new Error('"'+t+'" is a required argument.')};var r=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.]*)(?::(\d+))?(\S*)$/,i=/^data:.+\,.+$/;function n(e){var t=e.match(r);return t?{scheme:t[1],auth:t[2],host:t[3],port:t[4],path:t[5]}:null}function s(e){var t="";return e.scheme&&(t+=e.scheme+":"),t+="//",e.auth&&(t+=e.auth+"@"),e.host&&(t+=e.host),e.port&&(t+=":"+e.port),e.path&&(t+=e.path),t}function a(e){var r=e,i=n(e);if(i){if(!i.path)return e;r=i.path}for(var a,o=t.isAbsolute(r),c=r.split(/\/+/),l=0,d=c.length-1;d>=0;d--)"."===(a=c[d])?c.splice(d,1):".."===a?l++:l>0&&(""===a?(c.splice(d+1,l),l=0):(c.splice(d,2),l--));return""===(r=c.join("/"))&&(r=o?"/":"."),i?(i.path=r,s(i)):r}t.urlParse=n,t.urlGenerate=s,t.normalize=a,t.join=function(e,t){""===e&&(e="."),""===t&&(t=".");var r=n(t),o=n(e);if(o&&(e=o.path||"/"),r&&!r.scheme)return o&&(r.scheme=o.scheme),s(r);if(r||t.match(i))return t;if(o&&!o.host&&!o.path)return o.host=t,s(o);var c="/"===t.charAt(0)?t:a(e.replace(/\/+$/,"")+"/"+t);return o?(o.path=c,s(o)):c},t.isAbsolute=function(e){return"/"===e.charAt(0)||!!e.match(r)},t.relative=function(e,t){""===e&&(e="."),e=e.replace(/\/$/,"");for(var r=0;0!==t.indexOf(e+"/");){var i=e.lastIndexOf("/");if(i<0)return t;if((e=e.slice(0,i)).match(/^([^\/]+:\/)?\/*$/))return t;++r}return Array(r+1).join("../")+t.substr(e.length+1)};var o=!("__proto__"in Object.create(null));function c(e){return e}function l(e){if(!e)return!1;var t=e.length;if(t<9)return!1;if(95!==e.charCodeAt(t-1)||95!==e.charCodeAt(t-2)||111!==e.charCodeAt(t-3)||116!==e.charCodeAt(t-4)||111!==e.charCodeAt(t-5)||114!==e.charCodeAt(t-6)||112!==e.charCodeAt(t-7)||95!==e.charCodeAt(t-8)||95!==e.charCodeAt(t-9))return!1;for(var r=t-10;r>=0;r--)if(36!==e.charCodeAt(r))return!1;return!0}function d(e,t){return e===t?0:e>t?1:-1}t.toSetString=o?c:function(e){return l(e)?"$"+e:e},t.fromSetString=o?c:function(e){return l(e)?e.slice(1):e},t.compareByOriginalPositions=function(e,t,r){var i=e.source-t.source;return 0!==i||0!=(i=e.originalLine-t.originalLine)||0!=(i=e.originalColumn-t.originalColumn)||r||0!=(i=e.generatedColumn-t.generatedColumn)||0!=(i=e.generatedLine-t.generatedLine)?i:e.name-t.name},t.compareByGeneratedPositionsDeflated=function(e,t,r){var i=e.generatedLine-t.generatedLine;return 0!==i||0!=(i=e.generatedColumn-t.generatedColumn)||r||0!=(i=e.source-t.source)||0!=(i=e.originalLine-t.originalLine)||0!=(i=e.originalColumn-t.originalColumn)?i:e.name-t.name},t.compareByGeneratedPositionsInflated=function(e,t){var r=e.generatedLine-t.generatedLine;return 0!==r||0!=(r=e.generatedColumn-t.generatedColumn)||0!==(r=d(e.source,t.source))||0!=(r=e.originalLine-t.originalLine)||0!=(r=e.originalColumn-t.originalColumn)?r:d(e.name,t.name)}},9125:(e,t,r)=>{t.SourceMapGenerator=r(4433).SourceMapGenerator,t.SourceMapConsumer=r(6771).SourceMapConsumer,t.SourceNode=r(7085).SourceNode},4595:function(e,t,r){var i,n,s;!function(a,o){"use strict";n=[r(9829)],i=function(e){return{backtrace:function(t){var r=[],i=10;"object"==typeof t&&"number"==typeof t.maxStackSize&&(i=t.maxStackSize);for(var n=arguments.callee;n&&r.length<i&&n.arguments;){for(var s=new Array(n.arguments.length),a=0;a<s.length;++a)s[a]=n.arguments[a];/function(?:\s+([\w$]+))+\s*\(/.test(n.toString())?r.push(new e({functionName:RegExp.$1||void 0,args:s})):r.push(new e({args:s}));try{n=n.caller}catch(e){break}}return r}}},void 0===(s=i.apply(t,n))||(e.exports=s)}()},9829:function(e,t){var r,i,n;!function(s,a){"use strict";i=[],void 0===(n="function"==typeof(r=function(){function e(e){return e.charAt(0).toUpperCase()+e.substring(1)}function t(e){return function(){return this[e]}}var r=["isConstructor","isEval","isNative","isToplevel"],i=["columnNumber","lineNumber"],n=["fileName","functionName","source"],s=r.concat(i,n,["args"],["evalOrigin"]);function a(t){if(t)for(var r=0;r<s.length;r++)void 0!==t[s[r]]&&this["set"+e(s[r])](t[s[r]])}a.prototype={getArgs:function(){return this.args},setArgs:function(e){if("[object Array]"!==Object.prototype.toString.call(e))throw new TypeError("Args must be an Array");this.args=e},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(e){if(e instanceof a)this.evalOrigin=e;else{if(!(e instanceof Object))throw new TypeError("Eval Origin must be an Object or StackFrame");this.evalOrigin=new a(e)}},toString:function(){var e=this.getFileName()||"",t=this.getLineNumber()||"",r=this.getColumnNumber()||"",i=this.getFunctionName()||"";return this.getIsEval()?e?"[eval] ("+e+":"+t+":"+r+")":"[eval]:"+t+":"+r:i?i+" ("+e+":"+t+":"+r+")":e+":"+t+":"+r}},a.fromString=function(e){var t=e.indexOf("("),r=e.lastIndexOf(")"),i=e.substring(0,t),n=e.substring(t+1,r).split(","),s=e.substring(r+1);if(0===s.indexOf("@"))var o=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(s,""),c=o[1],l=o[2],d=o[3];return new a({functionName:i,args:n||void 0,fileName:c,lineNumber:l||void 0,columnNumber:d||void 0})};for(var o=0;o<r.length;o++)a.prototype["get"+e(r[o])]=t(r[o]),a.prototype["set"+e(r[o])]=function(e){return function(t){this[e]=Boolean(t)}}(r[o]);for(var c=0;c<i.length;c++)a.prototype["get"+e(i[c])]=t(i[c]),a.prototype["set"+e(i[c])]=function(e){return function(t){if(r=t,isNaN(parseFloat(r))||!isFinite(r))throw new TypeError(e+" must be a Number");var r;this[e]=Number(t)}}(i[c]);for(var l=0;l<n.length;l++)a.prototype["get"+e(n[l])]=t(n[l]),a.prototype["set"+e(n[l])]=function(e){return function(t){this[e]=String(t)}}(n[l]);return a})?r.apply(t,i):r)||(e.exports=n)}()},4358:function(e,t,r){var i,n,s;!function(a,o){"use strict";n=[r(9125),r(9829)],void 0===(s="function"==typeof(i=function(e,t){function r(e){return new Promise((function(t,r){var i=new XMLHttpRequest;i.open("get",e),i.onerror=r,i.onreadystatechange=function(){4===i.readyState&&(i.status>=200&&i.status<300||"file://"===e.substr(0,7)&&i.responseText?t(i.responseText):r(new Error("HTTP status: "+i.status+" retrieving "+e)))},i.send()}))}function i(e){if("undefined"!=typeof window&&window.atob)return window.atob(e);throw new Error("You must supply a polyfill for window.atob in this environment")}function n(e){if("object"!=typeof e)throw new TypeError("Given StackFrame is not an object");if("string"!=typeof e.fileName)throw new TypeError("Given file name is not a String");if("number"!=typeof e.lineNumber||e.lineNumber%1!=0||e.lineNumber<1)throw new TypeError("Given line number must be a positive integer");if("number"!=typeof e.columnNumber||e.columnNumber%1!=0||e.columnNumber<0)throw new TypeError("Given column number must be a non-negative integer");return!0}return function s(a){if(!(this instanceof s))return new s(a);a=a||{},this.sourceCache=a.sourceCache||{},this.sourceMapConsumerCache=a.sourceMapConsumerCache||{},this.ajax=a.ajax||r,this._atob=a.atob||i,this._get=function(e){return new Promise(function(t,r){var i="data:"===e.substr(0,5);if(this.sourceCache[e])t(this.sourceCache[e]);else if(a.offline&&!i)r(new Error("Cannot make network requests in offline mode"));else if(i){var n=e.match(/^data:application\/json;([\w=:"-]+;)*base64,/);if(n){var s=n[0].length,o=e.substr(s),c=this._atob(o);this.sourceCache[e]=c,t(c)}else r(new Error("The encoding of the inline sourcemap is not supported"))}else{var l=this.ajax(e,{method:"get"});this.sourceCache[e]=l,l.then(t,r)}}.bind(this))},this._getSourceMapConsumer=function(t,r){return new Promise(function(i){if(this.sourceMapConsumerCache[t])i(this.sourceMapConsumerCache[t]);else{var n=new Promise(function(i,n){return this._get(t).then((function(t){"string"==typeof t&&(t=function(e){if("undefined"!=typeof JSON&&JSON.parse)return JSON.parse(e);throw new Error("You must supply a polyfill for JSON.parse in this environment")}(t.replace(/^\)\]\}'/,""))),void 0===t.sourceRoot&&(t.sourceRoot=r),i(new e.SourceMapConsumer(t))})).catch(n)}.bind(this));this.sourceMapConsumerCache[t]=n,i(n)}}.bind(this))},this.pinpoint=function(e){return new Promise(function(t,r){this.getMappedLocation(e).then(function(e){function r(){t(e)}this.findFunctionName(e).then(t,r).catch(r)}.bind(this),r)}.bind(this))},this.findFunctionName=function(e){return new Promise(function(r,i){n(e),this._get(e.fileName).then((function(i){var n=e.lineNumber,s=e.columnNumber,a=function(e,t){for(var r=[/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*function\b/,/function\s+([^('"`]*?)\s*\(([^)]*)\)/,/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*(?:eval|new Function)\b/,/\b(?!(?:if|for|switch|while|with|catch)\b)(?:(?:static)\s+)?(\S+)\s*\(.*?\)\s*\{/,/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*\(.*?\)\s*=>/],i=e.split("\n"),n="",s=Math.min(t,20),a=0;a<s;++a){var o=i[t-a-1],c=o.indexOf("//");if(c>=0&&(o=o.substr(0,c)),o){n=o+n;for(var l=r.length,d=0;d<l;d++){var u=r[d].exec(n);if(u&&u[1])return u[1]}}}}(i,n);r(a?new t({functionName:a,args:e.args,fileName:e.fileName,lineNumber:n,columnNumber:s}):e)}),i).catch(i)}.bind(this))},this.getMappedLocation=function(e){return new Promise(function(r,i){(function(){if("function"!=typeof Object.defineProperty||"function"!=typeof Object.create)throw new Error("Unable to consume source maps in older browsers")})(),n(e);var s=this.sourceCache,a=e.fileName;this._get(a).then(function(i){var n=function(e){for(var t,r,i=/\/\/[#@] ?sourceMappingURL=([^\s'"]+)\s*$/gm;r=i.exec(e);)t=r[1];if(t)return t;throw new Error("sourceMappingURL not found")}(i),o="data:"===n.substr(0,5),c=a.substring(0,a.lastIndexOf("/")+1);return"/"===n[0]||o||/^https?:\/\/|^\/\//i.test(n)||(n=c+n),this._getSourceMapConsumer(n,c).then((function(i){return function(e,r,i){return new Promise((function(n,s){var a=r.originalPositionFor({line:e.lineNumber,column:e.columnNumber});if(a.source){var o=r.sourceContentFor(a.source);o&&(i[a.source]=o),n(new t({functionName:a.name||e.functionName,args:e.args,fileName:a.source,lineNumber:a.line,columnNumber:a.column}))}else s(new Error("Could not get original source for given stackframe and source map"))}))}(e,i,s).then(r).catch((function(){r(e)}))}))}.bind(this),i).catch(i)}.bind(this))}}})?i.apply(t,n):i)||(e.exports=s)}()},401:function(e,t,r){var i,n,s;!function(a,o){"use strict";n=[r(9180),r(4595),r(4358)],i=function(e,t,r){var i={filter:function(e){return-1===(e.functionName||"").indexOf("StackTrace$$")&&-1===(e.functionName||"").indexOf("ErrorStackParser$$")&&-1===(e.functionName||"").indexOf("StackTraceGPS$$")&&-1===(e.functionName||"").indexOf("StackGenerator$$")},sourceCache:{}},n=function(){try{throw new Error}catch(e){return e}};function s(e,t){var r={};return[e,t].forEach((function(e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r})),r}function a(e){return e.stack||e["opera#sourceloc"]}function o(e,t){return"function"==typeof t?e.filter(t):e}return{get:function(e){var t=n();return a(t)?this.fromError(t,e):this.generateArtificially(e)},getSync:function(r){r=s(i,r);var c=n();return o(a(c)?e.parse(c):t.backtrace(r),r.filter)},fromError:function(t,n){n=s(i,n);var a=new r(n);return new Promise(function(r){var i=o(e.parse(t),n.filter);r(Promise.all(i.map((function(e){return new Promise((function(t){function r(){t(e)}a.pinpoint(e).then(t,r).catch(r)}))}))))}.bind(this))},generateArtificially:function(e){e=s(i,e);var r=t.backtrace(e);return"function"==typeof e.filter&&(r=r.filter(e.filter)),Promise.resolve(r)},instrument:function(e,t,r,i){if("function"!=typeof e)throw new Error("Cannot instrument non-function object");if("function"==typeof e.__stacktraceOriginalFn)return e;var n=function(){try{return this.get().then(t,r).catch(r),e.apply(i||this,arguments)}catch(e){throw a(e)&&this.fromError(e).then(t,r).catch(r),e}}.bind(this);return n.__stacktraceOriginalFn=e,n},deinstrument:function(e){if("function"!=typeof e)throw new Error("Cannot de-instrument non-function object");return"function"==typeof e.__stacktraceOriginalFn?e.__stacktraceOriginalFn:e},report:function(e,t,r,i){return new Promise((function(n,s){var a=new XMLHttpRequest;if(a.onerror=s,a.onreadystatechange=function(){4===a.readyState&&(a.status>=200&&a.status<400?n(a.responseText):s(new Error("POST to "+t+" failed with status: "+a.status)))},a.open("post",t),a.setRequestHeader("Content-Type","application/json"),i&&"object"==typeof i.headers){var o=i.headers;for(var c in o)Object.prototype.hasOwnProperty.call(o,c)&&a.setRequestHeader(c,o[c])}var l={stack:e};null!=r&&(l.message=r),a.send(JSON.stringify(l))}))}}},void 0===(s=i.apply(t,n))||(e.exports=s)}()},2045:(e,t,r)=>{e.exports={EventEmitter:r(6901)}},6901:e=>{"use strict";var t,r="object"==typeof Reflect?Reflect:null,i=r&&"function"==typeof r.apply?r.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};t=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var n=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise((function(r,i){function n(r){e.removeListener(t,s),i(r)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",n),r([].slice.call(arguments))}m(e,t,s,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&m(e,"error",t,{once:!0})}(e,n)}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var a=10;function o(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function l(e,t,r,i){var n,s,a,l;if(o(r),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),s=e._events),a=s[t]),void 0===a)a=s[t]=r,++e._eventsCount;else if("function"==typeof a?a=s[t]=i?[r,a]:[a,r]:i?a.unshift(r):a.push(r),(n=c(e))>0&&a.length>n&&!a.warned){a.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=e,d.type=t,d.count=a.length,l=d,console&&console.warn&&console.warn(l)}return e}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(e,t,r){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},n=d.bind(i);return n.listener=r,i.wrapFn=n,n}function h(e,t,r){var i=e._events;if(void 0===i)return[];var n=i[t];return void 0===n?[]:"function"==typeof n?r?[n.listener||n]:[n]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(n):f(n,n.length)}function p(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function f(e,t){for(var r=new Array(t),i=0;i<t;++i)r[i]=e[i];return r}function m(e,t,r,i){if("function"==typeof e.on)i.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function n(s){i.once&&e.removeEventListener(t,n),r(s)}))}}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||n(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||n(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,s=this._events;if(void 0!==s)n=n&&void 0===s.error;else if(!n)return!1;if(n){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var c=s[e];if(void 0===c)return!1;if("function"==typeof c)i(c,this,t);else{var l=c.length,d=f(c,l);for(r=0;r<l;++r)i(d[r],this,t)}return!0},s.prototype.addListener=function(e,t){return l(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return l(this,e,t,!0)},s.prototype.once=function(e,t){return o(t),this.on(e,u(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return o(t),this.prependListener(e,u(this,e,t)),this},s.prototype.removeListener=function(e,t){var r,i,n,s,a;if(o(t),void 0===(i=this._events))return this;if(void 0===(r=i[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(n=-1,s=r.length-1;s>=0;s--)if(r[s]===t||r[s].listener===t){a=r[s].listener,n=s;break}if(n<0)return this;0===n?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,n),1===r.length&&(i[e]=r[0]),void 0!==i.removeListener&&this.emit("removeListener",e,a||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,r,i;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var n,s=Object.keys(r);for(i=0;i<s.length;++i)"removeListener"!==(n=s[i])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},s.prototype.listeners=function(e){return h(this,e,!0)},s.prototype.rawListeners=function(e){return h(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},s.prototype.listenerCount=p,s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},7881:(e,t,r)=>{"use strict";e.exports=r(5923)},5923:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerCore=void 0;const i=r(9307);i.__exportStar(r(4702),t);var n=r(6159);Object.defineProperty(t,"LoggerCore",{enumerable:!0,get:function(){return n.LoggerCore}}),i.__exportStar(r(4557),t)},6159:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerCore=void 0;const i=r(9307),n=r(4702),s=i.__importDefault(r(7392)),a=r(1729),o=r(4557),c=r(4690),l=e=>{},d=new WeakMap;function u(e,...t){for(const r of t){if("object"!=typeof r||Array.isArray(r)){console.error("Invalid logger data:",r);continue}if((0,n.isSerializableObject)(r)){u(e,r.toJSON());continue}const{aggregates:t}=r,s=i.__rest(r,["aggregates"]);if("object"==typeof t)for(const[r,i]of Object.entries(t))e.aggregates[r]=i;for(const[t,r]of Object.entries(s))e[t]=null==r?r:JSON.parse(JSON.stringify(r))}}t.LoggerCore=class{constructor(e){this.debug=l,this.deprecated=l,this.error=l,this.fatal=l,this.info=l,this.local=l,this.network=l,this.notice=l,this.timing=l,this.trace=l,this.warn=l,this.packageContext={meta:{}},this.messageContext={},this.attachedObjects=new Set,this.emitter=new a.EventEmitter,this.printer={},this.lastLogged={},this.name=e,this.packageContext.meta={package:this.name},this.httpWriter=new o.LoggerGlobal,this.httpWriter.registerPackage(this),this.proxyingToEmitter=!1,this.debugLogger=(0,s.default)(this.name),n.LEVELS.forEach((e=>{this[e]=this.log.bind(this,e),this.printer[e]=this.printLog.bind(this,e)}))}flush(){this.httpWriter.send()}attachObject(e){return e.on("disposed",(()=>{this.attachedObjects.delete(e)})),this.attachedObjects.add(e),this}setMessageAggregate(e,t){return void 0===t?this.removeMessageAggregate(e):(null==this.messageContext.aggregates?this.messageContext.aggregates={[e]:t}:this.messageContext.aggregates[e]=t,this)}appendChain(e){var t,r;let i=0;d.has(e)&&(i=d.get(e)+1);const n=null!==(r=null===(t=this.messageContext.aggregates)||void 0===t?void 0:t.chain)&&void 0!==r?r:"",s=""===n?`${e.displayName}#${i}`:`${n}:${e.displayName}#${i}`;return this.setMessageAggregate("chain",s),d.set(e,i),this}removeMessageAggregate(e){return null!=this.messageContext.aggregates&&null!=this.messageContext.aggregates[e]&&(delete this.messageContext.aggregates[e],0===Object.keys(this.messageContext.aggregates).length&&delete this.messageContext.aggregates),this}clearMessageAggregates(){return this.messageContext={},this}setLoggerAggregate(e,t){return null==this.packageContext.aggregates?this.packageContext.aggregates={[e]:t}:this.packageContext.aggregates[e]=t,this}setLoggerMeta(e,t){return null==this.packageContext.meta?this.packageContext.meta={[e]:t,package:this.name}:this.packageContext.meta[e]=t,this}getLoggerMeta(e){var t;if((null===(t=this.packageContext)||void 0===t?void 0:t.meta)&&null!=this.packageContext.meta[e])return this.packageContext.meta[e]}log(e,t,r){var i,n;null===(n=null===(i=this.printer)||void 0===i?void 0:i[e])||void 0===n||n.call(i,t,r,this.messageContext.aggregates);const[s,a]=this.handleLogData(t,r,!0),o=Object.assign({message:`${s}`,level:"trace"===e?"debug":e,time:(new Date).toISOString()},a);this.httpWriter.add(o,this),this.proxyingToEmitter&&this.emitter.emit(e,t,a)}throttledLog(e,t,r,i){var n;(null==this.lastLogged[r]||Date.now()-(null!==(n=this.lastLogged[r])&&void 0!==n?n:0)>t)&&(this.lastLogged[r]=Date.now(),this.log(e,r,i))}handleLogData(e,t,r=!1){var i,s,a;let o="";null!=t||(t={}),e instanceof Error?(o=e.message,(0,n.isSerializableObject)(e)?t.err=e:t.err={message:e.message,name:e.name,stack:e.stack}):o=e;let c={aggregates:{}};try{u(c,{aggregates:this.packageContext.aggregates},{aggregates:this.messageContext.aggregates},t,...this.attachedObjects)}catch(t){const n=`logging data were dropped because it's not serializable; log message: ${e}; error: ${t};`;r&&this.printLog("error",n),c={aggregates:{chain:null===(i=c.aggregates)||void 0===i?void 0:i.chain,contextId:null===(s=c.aggregates)||void 0===s?void 0:s.contextId,instanceId:null===(a=c.aggregates)||void 0===a?void 0:a.instanceId},__logging_error__:n}}return[o,c]}printLog(e,t,r){var i,n,s,a,o,l,d,u,h,p,f;const[m,g]=this.handleLogData(t,r);switch(e){case"warn":case"error":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?console[e](`${null!==(n=null===(i=g.aggregates)||void 0===i?void 0:i.chain)&&void 0!==n?n:""} ${m}`,g):"undefined"!=typeof window&&"function"==typeof(null===(s=window.console)||void 0===s?void 0:s.error)?window.console[e](`%c ${null!==(o=null===(a=g.aggregates)||void 0===a?void 0:a.chain)&&void 0!==o?o:""} ${m}`,c.browserStyles[e],[g]):this.debugLogger(`%c ${null!==(d=null===(l=g.aggregates)||void 0===l?void 0:l.chain)&&void 0!==d?d:""} ${m}`,c.browserStyles[e],[g]);break;default:"undefined"!=typeof navigator&&"ReactNative"===navigator.product?console.log(`${null!==(h=null===(u=g.aggregates)||void 0===u?void 0:u.chain)&&void 0!==h?h:""} ${m}`,g):this.debugLogger(`%c ${null!==(f=null===(p=g.aggregates)||void 0===p?void 0:p.chain)&&void 0!==f?f:""} ${m}`,c.browserStyles[e],[g])}}proxyToEmitter(e,t){for(const r of t)this.emitter.on(r,((t,i)=>{e.emit(r,t,i)}));this.proxyingToEmitter=!0}extend(e){var t,r,i;if(null!=(null===(t=null==e?void 0:e.messageContext)||void 0===t?void 0:t.aggregates))for(const[t,r]of Object.entries(e.messageContext.aggregates))this.setMessageAggregate(t,r);if(null!=(null===(r=null==e?void 0:e.packageContext)||void 0===r?void 0:r.aggregates))for(const[t,r]of Object.entries(e.packageContext.aggregates))this.setLoggerAggregate(t,r);if(null!=(null===(i=null==e?void 0:e.packageContext)||void 0===i?void 0:i.meta))for(const[t,r]of Object.entries(e.packageContext.meta))this.setLoggerMeta(t,r);return this}destroy(){this.flush(),this.httpWriter.removePackage(this)}}},4557:(e,t,r)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerGlobal=void 0;const n=r(9307),s=r(2045),a=r(4702),o=n.__importDefault(r(5452)),c=n.__importDefault(r(7254)),l=n.__importDefault(r(9289)),d=r(2543),u=r(8326),h=null!==(i=globalThis)&&void 0!==i?i:function(){return this}(),p={maxRequestSize:1048576,level:"warn",limit:500,interval:3e4};class f extends s.EventEmitter{constructor(){if(super(),this.options=p,this.storage=[],this.packageContextStorage=[],this.globalContext={meta:{userAgent:"undefined"!=typeof navigator?navigator.userAgent:"unknown",referrer:"undefined"!=typeof document?document.referrer:"unknown",source:"client",logId:(0,u.uuidv4)(),loggerVer:c.default.version}},this.watchTimeout=null,this.loggers=[],this.online=!0,this.throttleSend=(0,o.default)(this.send,5e3),h.LivelyHttpWriterV4)return h.LivelyHttpWriterV4;h.LivelyHttpWriterV4=this,null!=h.addEventListener&&(h.addEventListener("unload",(()=>this.send())),h.addEventListener("online",(()=>{this.online=!0,this.send()})),r.g.addEventListener("offline",(()=>{this.online=!1})))}static setOptions(e){(new f).setOptions(e)}setOptions(e){null!=e.host&&(this.options.host=e.host),null!=e.level&&(this.options.level=e.level),null!=e.maxRequestSize&&(this.options.maxRequestSize=e.maxRequestSize),null!=e.limit&&(this.options.limit=e.limit),null!=e.interval&&(this.options.interval=e.interval),this.resetTimeout()}static setGlobalAggregate(e,t){(new f).setGlobalAggregate(e,t)}setGlobalAggregate(e,t){null==this.globalContext.aggregates?this.globalContext.aggregates={[e]:t}:this.globalContext.aggregates[e]=t}static removeGlobalAggregate(e){(new f).removeGlobalAggregate(e)}removeGlobalAggregate(e){null!=this.globalContext.aggregates&&null!=this.globalContext.aggregates[e]&&(delete this.globalContext.aggregates[e],0===Object.keys(this.globalContext.aggregates).length&&delete this.globalContext.aggregates)}static clearGlobalAggregates(){(new f).clearGlobalAggregates()}clearGlobalAggregates(){this.globalContext.aggregates={}}static setGlobalMeta(e,t){(new f).setGlobalMeta(e,t)}setGlobalMeta(e,t){null==this.globalContext.meta?this.globalContext.meta={userAgent:"undefined"!=typeof navigator?navigator.userAgent:"unknown",referrer:"undefined"!=typeof document?document.referrer:"unknown",source:"client",logId:(0,u.uuidv4)(),loggerVer:c.default.version,[e]:t}:this.globalContext.meta[e]=t}static removeGlobalMeta(e){(new f).removeGlobalMeta(e)}removeGlobalMeta(e){null!=this.globalContext.meta&&null!=this.globalContext.meta[e]&&delete this.globalContext.meta[e]}resetTimeout(){this.options.interval&&(null!=this.watchTimeout&&("undefined"!=typeof window?window.clearTimeout(this.watchTimeout):clearTimeout(this.watchTimeout)),null!=this.send&&("undefined"!=typeof window?this.watchTimeout=window.setTimeout(this.send.bind(this),this.options.interval):this.watchTimeout=setTimeout(this.send.bind(this),this.options.interval)))}registerPackage(e){this.loggers.push(e)}removePackage(e){const t=this.loggers.indexOf(e);t>-1&&this.loggers.splice(t,1),this.loggers.push(e)}add(e,t){(0,d.meetsLevel)(e.level,this.options.level)&&(this.storage.push(e),null!=this.options.host&&this.online?(null!=t&&-1===this.packageContextStorage.indexOf(t.packageContext)&&this.packageContextStorage.push(t.packageContext),(0,d.meetsLevel)(e.level,"error")&&this.throttleSend()):this.checkStorageLimit())}send(){if(0===this.storage.length)return void this.resetTimeout();if(null==this.options.host)return this.checkStorageLimit(),void this.resetTimeout();const e=this.storage.splice(0,this.options.limit),t={},r={};this.packageContextStorage.forEach((e=>{null!=e.aggregates&&Object.keys(e.aggregates).forEach((r=>{var i;const n=null===(i=e.aggregates)||void 0===i?void 0:i[r];null!=n&&(t[r]=n)})),null!=e.meta&&a.PackageMetaKeys.forEach((t=>{var i;null!=(null===(i=e.meta)||void 0===i?void 0:i[t])&&(r[t]=e.meta[t])}))}));const i={aggregates:t,meta:r};this.packageContextStorage.splice(0,-1*this.packageContextStorage.length);const n={logs:e,sendTime:(new Date).toISOString(),context:{packageContexts:i,globalContext:this.globalContext}};let s;try{s=JSON.stringify(n)}catch(e){return this.add({level:"error",message:"Failed to stringify in logger",error:`${e}`,time:(new Date).toISOString()}),void this.resetTimeout()}if((0,l.default)(s)>this.options.maxRequestSize)return this.add({level:"error",message:`Body exceeds maxRequestSize. Dropped ${e.length} logs.`,time:(new Date).toISOString()}),void this.resetTimeout();f.fetch(`${this.options.host}/client-logs/v4`,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:s}).then((e=>{if(!e.ok)throw new TypeError(e.status.toString());return this.resetTimeout(),e})).catch((e=>{this.add({level:"network",message:"Network failure.",error:`${e}`,time:(new Date).toISOString()}),this.resetTimeout()}))}checkStorageLimit(){this.storage.length>this.options.limit&&this.storage.slice(-1*this.options.limit)}}t.LoggerGlobal=f,f.fetch="undefined"!=typeof window?window.fetch.bind(window):()=>Promise.resolve(new Response)},7254:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"@video/log-client",version:"5.0.2"}},8439:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerGlobal=void 0;const i=r(6159),n=r(4557);Object.defineProperty(t,"LoggerGlobal",{enumerable:!0,get:function(){return n.LoggerGlobal}}),t.default=i.LoggerCore},9289:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=e.length;for(let r=e.length-1;r>=0;r-=1){const i=e.charCodeAt(r);i>127&&i<=2047?t+=1:i>2047&&i<=65535&&(t+=2),i>=56320&&i<=57343&&(r-=1)}return t}},4690:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ttySyles=t.browserStyles=void 0,t.browserStyles={trace:"color: rgba(169,184,186,0.6)",debug:"color: #a9b8ba",network:"color: #a9b8ba",timing:"color: #a9b8ba",local:"color: #a9b8ba",info:"",warn:"color: #c0a044",notice:"color: #c0a044",deprecated:"color: #c0a044",error:"color: #f44336",fatal:"color: #f44336"},t.ttySyles={trace:"[38;5;239m",debug:"[38;5;239m",network:"[38;5;239m",timing:"[38;5;239m",local:"[38;5;239m",info:"[38;5;231m",warn:"[38;5;226m",notice:"[38;5;226m",deprecated:"[38;5;226m",error:"[38;5;196m",fatal:"[38;5;196m"}},2543:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.supportedLevels=t.meetsLevel=t.supportsLevel=void 0;const r={fatal:0,error:0,warn:1,notice:1,deprecated:1,info:2,local:3,debug:3,timing:3,network:3,trace:3};function i(e){return void 0!==r[e]}t.supportedLevels=r,t.supportsLevel=i,t.meetsLevel=function(e,t){return!(!i(e)||!i(t))&&r[e]<=r[t]}},8326:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uuidv4=void 0,t.uuidv4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}},5996:e=>{var t=1e3,r=60*t,i=60*r,n=24*i;function s(e,t,r,i){var n=t>=1.5*r;return Math.round(e/r)+" "+i+(n?"s":"")}e.exports=function(e,a){a=a||{};var o,c,l=typeof e;if("string"===l&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var s=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(s){var a=parseFloat(s[1]);switch((s[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*a;case"weeks":case"week":case"w":return 6048e5*a;case"days":case"day":case"d":return a*n;case"hours":case"hour":case"hrs":case"hr":case"h":return a*i;case"minutes":case"minute":case"mins":case"min":case"m":return a*r;case"seconds":case"second":case"secs":case"sec":case"s":return a*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}}}(e);if("number"===l&&isFinite(e))return a.long?(o=e,(c=Math.abs(o))>=n?s(o,c,n,"day"):c>=i?s(o,c,i,"hour"):c>=r?s(o,c,r,"minute"):c>=t?s(o,c,t,"second"):o+" ms"):function(e){var s=Math.abs(e);return s>=n?Math.round(e/n)+"d":s>=i?Math.round(e/i)+"h":s>=r?Math.round(e/r)+"m":s>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},7392:(e,t,r)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let i=0,n=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(i++,"%c"===e&&(n=i))})),t.splice(n,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=!1),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=r(3253)(t);const{formatters:i}=e.exports;i.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},3253:(e,t,r)=>{e.exports=function(e){function t(e){let r,n,s,a=null;function o(...e){if(!o.enabled)return;const i=o,n=Number(new Date),s=n-(r||n);i.diff=s,i.prev=r,i.curr=n,r=n,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let a=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((r,n)=>{if("%%"===r)return"%";a++;const s=t.formatters[n];if("function"==typeof s){const t=e[a];r=s.call(i,t),e.splice(a,1),a--}return r})),t.formatArgs.call(i,e),(i.log||t.log).apply(i,e)}return o.namespace=e,o.useColors=t.useColors(),o.color=t.selectColor(e),o.extend=i,o.destroy=t.destroy,Object.defineProperty(o,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==a?a:(n!==t.namespaces&&(n=t.namespaces,s=t.enabled(e)),s),set:e=>{a=e}}),"function"==typeof t.init&&t.init(o),o}function i(e,r){const i=t(this.namespace+(void 0===r?":":r)+e);return i.log=this.log,i}function n(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(n),...t.skips.map(n).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const i=("string"==typeof e?e:"").split(/[\s,]+/),n=i.length;for(r=0;r<n;r++)i[r]&&("-"===(e=i[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let r,i;for(r=0,i=t.skips.length;r<i;r++)if(t.skips[r].test(e))return!1;for(r=0,i=t.names.length;r<i;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(5996),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((r=>{t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}},1729:e=>{"use strict";var t,r="object"==typeof Reflect?Reflect:null,i=r&&"function"==typeof r.apply?r.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};t=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var n=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise((function(r,i){function n(r){e.removeListener(t,s),i(r)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",n),r([].slice.call(arguments))}m(e,t,s,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&m(e,"error",t,{once:!0})}(e,n)}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var a=10;function o(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function l(e,t,r,i){var n,s,a,l;if(o(r),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),s=e._events),a=s[t]),void 0===a)a=s[t]=r,++e._eventsCount;else if("function"==typeof a?a=s[t]=i?[r,a]:[a,r]:i?a.unshift(r):a.push(r),(n=c(e))>0&&a.length>n&&!a.warned){a.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=e,d.type=t,d.count=a.length,l=d,console&&console.warn&&console.warn(l)}return e}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(e,t,r){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},n=d.bind(i);return n.listener=r,i.wrapFn=n,n}function h(e,t,r){var i=e._events;if(void 0===i)return[];var n=i[t];return void 0===n?[]:"function"==typeof n?r?[n.listener||n]:[n]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(n):f(n,n.length)}function p(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function f(e,t){for(var r=new Array(t),i=0;i<t;++i)r[i]=e[i];return r}function m(e,t,r,i){if("function"==typeof e.on)i.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function n(s){i.once&&e.removeEventListener(t,n),r(s)}))}}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||n(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||n(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,s=this._events;if(void 0!==s)n=n&&void 0===s.error;else if(!n)return!1;if(n){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var c=s[e];if(void 0===c)return!1;if("function"==typeof c)i(c,this,t);else{var l=c.length,d=f(c,l);for(r=0;r<l;++r)i(d[r],this,t)}return!0},s.prototype.addListener=function(e,t){return l(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return l(this,e,t,!0)},s.prototype.once=function(e,t){return o(t),this.on(e,u(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return o(t),this.prependListener(e,u(this,e,t)),this},s.prototype.removeListener=function(e,t){var r,i,n,s,a;if(o(t),void 0===(i=this._events))return this;if(void 0===(r=i[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(n=-1,s=r.length-1;s>=0;s--)if(r[s]===t||r[s].listener===t){a=r[s].listener,n=s;break}if(n<0)return this;0===n?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,n),1===r.length&&(i[e]=r[0]),void 0!==i.removeListener&&this.emit("removeListener",e,a||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,r,i;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var n,s=Object.keys(r);for(i=0;i<s.length;++i)"removeListener"!==(n=s[i])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},s.prototype.listeners=function(e){return h(this,e,!0)},s.prototype.rawListeners=function(e){return h(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},s.prototype.listenerCount=p,s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},5452:(e,t,r)=>{var i="Expected a function",n=NaN,s="[object Symbol]",a=/^\s+|\s+$/g,o=/^[-+]0x[0-9a-f]+$/i,c=/^0b[01]+$/i,l=/^0o[0-7]+$/i,d=parseInt,u="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g,h="object"==typeof self&&self&&self.Object===Object&&self,p=u||h||Function("return this")(),f=Object.prototype.toString,m=Math.max,g=Math.min,v=function(){return p.Date.now()};function _(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function y(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&f.call(e)==s}(e))return n;if(_(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=_(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(a,"");var r=c.test(e);return r||l.test(e)?d(e.slice(2),r?2:8):o.test(e)?n:+e}e.exports=function(e,t,r){var n=!0,s=!0;if("function"!=typeof e)throw new TypeError(i);return _(r)&&(n="leading"in r?!!r.leading:n,s="trailing"in r?!!r.trailing:s),function(e,t,r){var n,s,a,o,c,l,d=0,u=!1,h=!1,p=!0;if("function"!=typeof e)throw new TypeError(i);function f(t){var r=n,i=s;return n=s=void 0,d=t,o=e.apply(i,r)}function b(e){var r=e-l;return void 0===l||r>=t||r<0||h&&e-d>=a}function E(){var e=v();if(b(e))return S(e);c=setTimeout(E,function(e){var r=t-(e-l);return h?g(r,a-(e-d)):r}(e))}function S(e){return c=void 0,p&&n?f(e):(n=s=void 0,o)}function w(){var e=v(),r=b(e);if(n=arguments,s=this,l=e,r){if(void 0===c)return function(e){return d=e,c=setTimeout(E,t),u?f(e):o}(l);if(h)return c=setTimeout(E,t),f(l)}return void 0===c&&(c=setTimeout(E,t)),o}return t=y(t)||0,_(r)&&(u=!!r.leading,a=(h="maxWait"in r)?m(y(r.maxWait)||0,t):a,p="trailing"in r?!!r.trailing:p),w.cancel=function(){void 0!==c&&clearTimeout(c),d=0,n=l=s=c=void 0},w.flush=function(){return void 0===c?o:S(v())},w}(e,t,{leading:n,maxWait:t,trailing:s})}},4702:(e,t,r)=>{"use strict";e.exports=r(4866)},4866:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PackageMetaKeys=t.LEVELS=t.isSerializableObject=t.isPlainRecord=t.GlobalMetaKeys=t.extractAggregates=void 0;var i=r(2162);Object.defineProperty(t,"extractAggregates",{enumerable:!0,get:function(){return i.extractAggregates}}),Object.defineProperty(t,"GlobalMetaKeys",{enumerable:!0,get:function(){return i.GlobalMetaKeys}}),Object.defineProperty(t,"isPlainRecord",{enumerable:!0,get:function(){return i.isPlainRecord}}),Object.defineProperty(t,"isSerializableObject",{enumerable:!0,get:function(){return i.isSerializableObject}}),Object.defineProperty(t,"LEVELS",{enumerable:!0,get:function(){return i.LEVELS}}),Object.defineProperty(t,"PackageMetaKeys",{enumerable:!0,get:function(){return i.PackageMetaKeys}})},2162:(e,t)=>{"use strict";function r(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)&&"toJSON"in e&&"function"==typeof e.toJSON}function i(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)&&!r(e)&&!Object.values(e).some((e=>null!=e&&!["number","string","boolean"].includes(typeof e)))}Object.defineProperty(t,"__esModule",{value:!0}),t.extractAggregates=t.isPlainRecord=t.isSerializableObject=t.PackageMetaKeys=t.GlobalMetaKeys=t.LEVELS=void 0,t.LEVELS=["trace","debug","network","timing","local","info","warn","notice","deprecated","error","fatal"],t.GlobalMetaKeys=["source","logId","userAgent","referrer","loggerVer"],t.PackageMetaKeys=["package","component","service","release","chain","client","contextId","instanceId","commitHash"],t.isSerializableObject=r,t.isPlainRecord=i,t.extractAggregates=function(e,...t){if(!r(e))return{};const n=e.toJSON();if(null==n||"object"!=typeof n||Array.isArray(n)||r(n))return{};const s=n.aggregates;if(!i(s))return{};for(const e of t)delete s[e];return s}},7382:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(3161);const n=(e,t)=>e!==t&&(0,i.isObject)(e)&&(0,i.isObject)(t)?Object.keys(t).reduce(((r,s)=>{if((0,i.hasOwnProperty)(e,s)){const a=n(e[s],t[s]);return(0,i.isObject)(a)&&(0,i.isEmpty)(a)||(r[s]=a),r}return r[s]=t[s],r}),(0,i.makeObjectWithoutPrototype)()):{};var s=n;t.default=s},3420:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(3161);const n=(e,t)=>e!==t&&(0,i.isObject)(e)&&(0,i.isObject)(t)?Object.keys(e).reduce(((r,s)=>{if((0,i.hasOwnProperty)(t,s)){const a=n(e[s],t[s]);return(0,i.isObject)(a)&&(0,i.isEmpty)(a)||(r[s]=a),r}return r[s]=void 0,r}),(0,i.makeObjectWithoutPrototype)()):{};var s=n;t.default=s},5285:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(r(7382)),n=a(r(3420)),s=a(r(4092));function a(e){return e&&e.__esModule?e:{default:e}}t.default=(e,t)=>({added:(0,i.default)(e,t),deleted:(0,n.default)(e,t),updated:(0,s.default)(e,t)})},5932:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(3161);const n=(e,t)=>{if(e===t)return{};if(!(0,i.isObject)(e)||!(0,i.isObject)(t))return t;const r=Object.keys(e).reduce(((e,r)=>((0,i.hasOwnProperty)(t,r)||(e[r]=void 0),e)),(0,i.makeObjectWithoutPrototype)());return(0,i.isDate)(e)||(0,i.isDate)(t)?e.valueOf()==t.valueOf()?{}:t:Object.keys(t).reduce(((r,s)=>{if(!(0,i.hasOwnProperty)(e,s))return r[s]=t[s],r;const a=n(e[s],t[s]);return!(0,i.isEmptyObject)(a)||(0,i.isDate)(a)||!(0,i.isEmptyObject)(e[s])&&(0,i.isEmptyObject)(t[s])?(r[s]=a,r):r}),r)};var s=n;t.default=s},5910:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"addedDiff",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,"deletedDiff",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"detailedDiff",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"diff",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"updatedDiff",{enumerable:!0,get:function(){return a.default}});var i=c(r(5932)),n=c(r(7382)),s=c(r(3420)),a=c(r(4092)),o=c(r(5285));function c(e){return e&&e.__esModule?e:{default:e}}},4092:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(3161);const n=(e,t)=>e===t?{}:(0,i.isObject)(e)&&(0,i.isObject)(t)?(0,i.isDate)(e)||(0,i.isDate)(t)?e.valueOf()==t.valueOf()?{}:t:Object.keys(t).reduce(((r,s)=>{if((0,i.hasOwnProperty)(e,s)){const a=n(e[s],t[s]);return!(0,i.isEmptyObject)(a)||(0,i.isDate)(a)||!(0,i.isEmptyObject)(e[s])&&(0,i.isEmptyObject)(t[s])?(r[s]=a,r):r}return r}),(0,i.makeObjectWithoutPrototype)()):t;var s=n;t.default=s},3161:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeObjectWithoutPrototype=t.isObject=t.isEmptyObject=t.isEmpty=t.isDate=t.hasOwnProperty=void 0,t.isDate=e=>e instanceof Date;const r=e=>0===Object.keys(e).length;t.isEmpty=r;const i=e=>null!=e&&"object"==typeof e;t.isObject=i,t.hasOwnProperty=(e,...t)=>Object.prototype.hasOwnProperty.call(e,...t),t.isEmptyObject=e=>i(e)&&r(e),t.makeObjectWithoutPrototype=()=>Object.create(null)},7582:(e,t,r)=>{"use strict";r.r(t),r.d(t,{__addDisposableResource:()=>M,__assign:()=>s,__asyncDelegator:()=>R,__asyncGenerator:()=>T,__asyncValues:()=>C,__await:()=>w,__awaiter:()=>f,__classPrivateFieldGet:()=>k,__classPrivateFieldIn:()=>O,__classPrivateFieldSet:()=>I,__createBinding:()=>g,__decorate:()=>o,__disposeResources:()=>N,__esDecorate:()=>l,__exportStar:()=>v,__extends:()=>n,__generator:()=>m,__importDefault:()=>L,__importStar:()=>D,__makeTemplateObject:()=>A,__metadata:()=>p,__param:()=>c,__propKey:()=>u,__read:()=>y,__rest:()=>a,__runInitializers:()=>d,__setFunctionName:()=>h,__spread:()=>b,__spreadArray:()=>S,__spreadArrays:()=>E,__values:()=>_,default:()=>F});var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},i(e,t)};function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var s=function(){return s=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},s.apply(this,arguments)};function a(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(r[i[n]]=e[i[n]])}return r}function o(e,t,r,i){var n,s=arguments.length,a=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(a=(s<3?n(a):s>3?n(t,r,a):n(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a}function c(e,t){return function(r,i){t(r,i,e)}}function l(e,t,r,i,n,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,c=i.kind,l="getter"===c?"get":"setter"===c?"set":"value",d=!t&&e?i.static?e:e.prototype:null,u=t||(d?Object.getOwnPropertyDescriptor(d,i.name):{}),h=!1,p=r.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(h)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,r[p])("accessor"===c?{get:u.get,set:u.set}:u[l],f);if("accessor"===c){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(u.get=o),(o=a(g.set))&&(u.set=o),(o=a(g.init))&&n.unshift(o)}else(o=a(g))&&("field"===c?n.unshift(o):u[l]=o)}d&&Object.defineProperty(d,i.name,u),h=!0}function d(e,t,r){for(var i=arguments.length>2,n=0;n<t.length;n++)r=i?t[n].call(e,r):t[n].call(e);return i?r:void 0}function u(e){return"symbol"==typeof e?e:"".concat(e)}function h(e,t,r){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:r?"".concat(r," ",t):t})}function p(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function f(e,t,r,i){return new(r||(r=Promise))((function(n,s){function a(e){try{c(i.next(e))}catch(e){s(e)}}function o(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}c((i=i.apply(e,t||[])).next())}))}function m(e,t){var r,i,n,s,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(c){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(a=0)),a;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((n=(n=a.trys).length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){a.label=o[1];break}if(6===o[0]&&a.label<n[1]){a.label=n[1],n=o;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(o);break}n[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}}var g=Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]};function v(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||g(t,e,r)}function _(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function y(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,s=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=s.next()).done;)a.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return a}function b(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(y(arguments[t]));return e}function E(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var s=arguments[t],a=0,o=s.length;a<o;a++,n++)i[n]=s[a];return i}function S(e,t,r){if(r||2===arguments.length)for(var i,n=0,s=t.length;n<s;n++)!i&&n in t||(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))}function w(e){return this instanceof w?(this.v=e,this):new w(e)}function T(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,n=r.apply(e,t||[]),s=[];return i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i;function a(e){n[e]&&(i[e]=function(t){return new Promise((function(r,i){s.push([e,t,r,i])>1||o(e,t)}))})}function o(e,t){try{(r=n[e](t)).value instanceof w?Promise.resolve(r.value.v).then(c,l):d(s[0][2],r)}catch(e){d(s[0][3],e)}var r}function c(e){o("next",e)}function l(e){o("throw",e)}function d(e,t){e(t),s.shift(),s.length&&o(s[0][0],s[0][1])}}function R(e){var t,r;return t={},i("next"),i("throw",(function(e){throw e})),i("return"),t[Symbol.iterator]=function(){return this},t;function i(i,n){t[i]=e[i]?function(t){return(r=!r)?{value:w(e[i](t)),done:!1}:n?n(t):t}:n}}function C(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=_(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(r){t[r]=e[r]&&function(t){return new Promise((function(i,n){!function(e,t,r,i){Promise.resolve(i).then((function(t){e({value:t,done:r})}),t)}(i,n,(t=e[r](t)).done,t.value)}))}}}function A(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var P=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};function D(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&g(t,e,r);return P(t,e),t}function L(e){return e&&e.__esModule?e:{default:e}}function k(e,t,r,i){if("a"===r&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?i:"a"===r?i.call(e):i?i.value:t.get(e)}function I(e,t,r,i,n){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?n.call(e,r):n?n.value=r:t.set(e,r),r}function O(e,t){if(null===t||"object"!=typeof t&&"function"!=typeof t)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)}function M(e,t,r){if(null!=t){if("object"!=typeof t&&"function"!=typeof t)throw new TypeError("Object expected.");var i;if(r){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");i=t[Symbol.asyncDispose]}if(void 0===i){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");i=t[Symbol.dispose]}if("function"!=typeof i)throw new TypeError("Object not disposable.");e.stack.push({value:t,dispose:i,async:r})}else r&&e.stack.push({async:!0});return t}var x="function"==typeof SuppressedError?SuppressedError:function(e,t,r){var i=new Error(r);return i.name="SuppressedError",i.error=e,i.suppressed=t,i};function N(e){function t(t){e.error=e.hasError?new x(t,e.error,"An error was suppressed during disposal."):t,e.hasError=!0}return function r(){for(;e.stack.length;){var i=e.stack.pop();try{var n=i.dispose&&i.dispose.call(i.value);if(i.async)return Promise.resolve(n).then(r,(function(e){return t(e),r()}))}catch(e){t(e)}}if(e.hasError)throw e.error}()}const F={__extends:n,__assign:s,__rest:a,__decorate:o,__param:c,__metadata:p,__awaiter:f,__generator:m,__createBinding:g,__exportStar:v,__values:_,__read:y,__spread:b,__spreadArrays:E,__spreadArray:S,__await:w,__asyncGenerator:T,__asyncDelegator:R,__asyncValues:C,__makeTemplateObject:A,__importStar:D,__importDefault:L,__classPrivateFieldGet:k,__classPrivateFieldSet:I,__classPrivateFieldIn:O,__addDisposableResource:M,__disposeResources:N}},9307:(e,t,r)=>{"use strict";r.r(t),r.d(t,{__addDisposableResource:()=>M,__assign:()=>s,__asyncDelegator:()=>R,__asyncGenerator:()=>T,__asyncValues:()=>C,__await:()=>w,__awaiter:()=>f,__classPrivateFieldGet:()=>k,__classPrivateFieldIn:()=>O,__classPrivateFieldSet:()=>I,__createBinding:()=>g,__decorate:()=>o,__disposeResources:()=>N,__esDecorate:()=>l,__exportStar:()=>v,__extends:()=>n,__generator:()=>m,__importDefault:()=>L,__importStar:()=>D,__makeTemplateObject:()=>A,__metadata:()=>p,__param:()=>c,__propKey:()=>u,__read:()=>y,__rest:()=>a,__runInitializers:()=>d,__setFunctionName:()=>h,__spread:()=>b,__spreadArray:()=>S,__spreadArrays:()=>E,__values:()=>_,default:()=>F});var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},i(e,t)};function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var s=function(){return s=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},s.apply(this,arguments)};function a(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(r[i[n]]=e[i[n]])}return r}function o(e,t,r,i){var n,s=arguments.length,a=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(a=(s<3?n(a):s>3?n(t,r,a):n(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a}function c(e,t){return function(r,i){t(r,i,e)}}function l(e,t,r,i,n,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,c=i.kind,l="getter"===c?"get":"setter"===c?"set":"value",d=!t&&e?i.static?e:e.prototype:null,u=t||(d?Object.getOwnPropertyDescriptor(d,i.name):{}),h=!1,p=r.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(h)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,r[p])("accessor"===c?{get:u.get,set:u.set}:u[l],f);if("accessor"===c){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(u.get=o),(o=a(g.set))&&(u.set=o),(o=a(g.init))&&n.unshift(o)}else(o=a(g))&&("field"===c?n.unshift(o):u[l]=o)}d&&Object.defineProperty(d,i.name,u),h=!0}function d(e,t,r){for(var i=arguments.length>2,n=0;n<t.length;n++)r=i?t[n].call(e,r):t[n].call(e);return i?r:void 0}function u(e){return"symbol"==typeof e?e:"".concat(e)}function h(e,t,r){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:r?"".concat(r," ",t):t})}function p(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function f(e,t,r,i){return new(r||(r=Promise))((function(n,s){function a(e){try{c(i.next(e))}catch(e){s(e)}}function o(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}c((i=i.apply(e,t||[])).next())}))}function m(e,t){var r,i,n,s,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(c){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(a=0)),a;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((n=(n=a.trys).length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){a.label=o[1];break}if(6===o[0]&&a.label<n[1]){a.label=n[1],n=o;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(o);break}n[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}}var g=Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]};function v(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||g(t,e,r)}function _(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function y(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,s=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=s.next()).done;)a.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return a}function b(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(y(arguments[t]));return e}function E(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var s=arguments[t],a=0,o=s.length;a<o;a++,n++)i[n]=s[a];return i}function S(e,t,r){if(r||2===arguments.length)for(var i,n=0,s=t.length;n<s;n++)!i&&n in t||(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))}function w(e){return this instanceof w?(this.v=e,this):new w(e)}function T(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,n=r.apply(e,t||[]),s=[];return i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i;function a(e){n[e]&&(i[e]=function(t){return new Promise((function(r,i){s.push([e,t,r,i])>1||o(e,t)}))})}function o(e,t){try{(r=n[e](t)).value instanceof w?Promise.resolve(r.value.v).then(c,l):d(s[0][2],r)}catch(e){d(s[0][3],e)}var r}function c(e){o("next",e)}function l(e){o("throw",e)}function d(e,t){e(t),s.shift(),s.length&&o(s[0][0],s[0][1])}}function R(e){var t,r;return t={},i("next"),i("throw",(function(e){throw e})),i("return"),t[Symbol.iterator]=function(){return this},t;function i(i,n){t[i]=e[i]?function(t){return(r=!r)?{value:w(e[i](t)),done:!1}:n?n(t):t}:n}}function C(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=_(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(r){t[r]=e[r]&&function(t){return new Promise((function(i,n){!function(e,t,r,i){Promise.resolve(i).then((function(t){e({value:t,done:r})}),t)}(i,n,(t=e[r](t)).done,t.value)}))}}}function A(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var P=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};function D(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&g(t,e,r);return P(t,e),t}function L(e){return e&&e.__esModule?e:{default:e}}function k(e,t,r,i){if("a"===r&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?i:"a"===r?i.call(e):i?i.value:t.get(e)}function I(e,t,r,i,n){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?n.call(e,r):n?n.value=r:t.set(e,r),r}function O(e,t){if(null===t||"object"!=typeof t&&"function"!=typeof t)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)}function M(e,t,r){if(null!=t){if("object"!=typeof t&&"function"!=typeof t)throw new TypeError("Object expected.");var i;if(r){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");i=t[Symbol.asyncDispose]}if(void 0===i){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");i=t[Symbol.dispose]}if("function"!=typeof i)throw new TypeError("Object not disposable.");e.stack.push({value:t,dispose:i,async:r})}else r&&e.stack.push({async:!0});return t}var x="function"==typeof SuppressedError?SuppressedError:function(e,t,r){var i=new Error(r);return i.name="SuppressedError",i.error=e,i.suppressed=t,i};function N(e){function t(t){e.error=e.hasError?new x(t,e.error,"An error was suppressed during disposal."):t,e.hasError=!0}return function r(){for(;e.stack.length;){var i=e.stack.pop();try{var n=i.dispose&&i.dispose.call(i.value);if(i.async)return Promise.resolve(n).then(r,(function(e){return t(e),r()}))}catch(e){t(e)}}if(e.hasError)throw e.error}()}const F={__extends:n,__assign:s,__rest:a,__decorate:o,__param:c,__metadata:p,__awaiter:f,__generator:m,__createBinding:g,__exportStar:v,__values:_,__read:y,__spread:b,__spreadArrays:E,__spreadArray:S,__await:w,__asyncGenerator:T,__asyncDelegator:R,__asyncValues:C,__makeTemplateObject:A,__importStar:D,__importDefault:L,__classPrivateFieldGet:k,__classPrivateFieldSet:I,__classPrivateFieldIn:O,__addDisposableResource:M,__disposeResources:N}}},t={};function r(i){var n=t[i];if(void 0!==n)return n.exports;var s=t[i]={exports:{}};return e[i].call(s.exports,s,s.exports,r),s.exports}r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i=r(6010);VideoClient=i})();